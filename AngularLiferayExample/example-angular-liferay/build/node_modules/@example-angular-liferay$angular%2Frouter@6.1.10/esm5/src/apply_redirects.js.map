{"version":3,"sources":["../../../../../../../../../packages/router/src/apply_redirects.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Injector, NgModuleRef} from '@angular/core';\nimport {EmptyError, Observable, Observer, from, of } from 'rxjs';\nimport {catchError, concatAll, first, map, mergeMap} from 'rxjs/operators';\n\nimport {LoadedRouterConfig, Route, Routes} from './config';\nimport {RouterConfigLoader} from './router_config_loader';\nimport {PRIMARY_OUTLET, Params, defaultUrlMatcher, navigationCancelingError} from './shared';\nimport {UrlSegment, UrlSegmentGroup, UrlSerializer, UrlTree} from './url_tree';\nimport {andObservables, forEach, waitForMap, wrapIntoObservable} from './utils/collection';\n\nclass NoMatch {\n  public segmentGroup: UrlSegmentGroup|null;\n\n  constructor(segmentGroup?: UrlSegmentGroup) { this.segmentGroup = segmentGroup || null; }\n}\n\nclass AbsoluteRedirect {\n  constructor(public urlTree: UrlTree) {}\n}\n\nfunction noMatch(segmentGroup: UrlSegmentGroup): Observable<UrlSegmentGroup> {\n  return new Observable<UrlSegmentGroup>(\n      (obs: Observer<UrlSegmentGroup>) => obs.error(new NoMatch(segmentGroup)));\n}\n\nfunction absoluteRedirect(newTree: UrlTree): Observable<any> {\n  return new Observable<UrlSegmentGroup>(\n      (obs: Observer<UrlSegmentGroup>) => obs.error(new AbsoluteRedirect(newTree)));\n}\n\nfunction namedOutletsRedirect(redirectTo: string): Observable<any> {\n  return new Observable<UrlSegmentGroup>(\n      (obs: Observer<UrlSegmentGroup>) => obs.error(new Error(\n          `Only absolute redirects can have named outlets. redirectTo: '${redirectTo}'`)));\n}\n\nfunction canLoadFails(route: Route): Observable<LoadedRouterConfig> {\n  return new Observable<LoadedRouterConfig>(\n      (obs: Observer<LoadedRouterConfig>) => obs.error(navigationCancelingError(\n          `Cannot load children because the guard of the route \"path: '${route.path}'\" returned false`)));\n}\n\n/**\n * Returns the `UrlTree` with the redirection applied.\n *\n * Lazy modules are loaded along the way.\n */\nexport function applyRedirects(\n    moduleInjector: Injector, configLoader: RouterConfigLoader, urlSerializer: UrlSerializer,\n    urlTree: UrlTree, config: Routes): Observable<UrlTree> {\n  return new ApplyRedirects(moduleInjector, configLoader, urlSerializer, urlTree, config).apply();\n}\n\nclass ApplyRedirects {\n  private allowRedirects: boolean = true;\n  private ngModule: NgModuleRef<any>;\n\n  constructor(\n      moduleInjector: Injector, private configLoader: RouterConfigLoader,\n      private urlSerializer: UrlSerializer, private urlTree: UrlTree, private config: Routes) {\n    this.ngModule = moduleInjector.get(NgModuleRef);\n  }\n\n  apply(): Observable<UrlTree> {\n    const expanded$ =\n        this.expandSegmentGroup(this.ngModule, this.config, this.urlTree.root, PRIMARY_OUTLET);\n    const urlTrees$ = expanded$.pipe(\n        map((rootSegmentGroup: UrlSegmentGroup) => this.createUrlTree(\n                rootSegmentGroup, this.urlTree.queryParams, this.urlTree.fragment !)));\n    return urlTrees$.pipe(catchError((e: any) => {\n      if (e instanceof AbsoluteRedirect) {\n        // after an absolute redirect we do not apply any more redirects!\n        this.allowRedirects = false;\n        // we need to run matching, so we can fetch all lazy-loaded modules\n        return this.match(e.urlTree);\n      }\n\n      if (e instanceof NoMatch) {\n        throw this.noMatchError(e);\n      }\n\n      throw e;\n    }));\n  }\n\n  private match(tree: UrlTree): Observable<UrlTree> {\n    const expanded$ =\n        this.expandSegmentGroup(this.ngModule, this.config, tree.root, PRIMARY_OUTLET);\n    const mapped$ = expanded$.pipe(\n        map((rootSegmentGroup: UrlSegmentGroup) =>\n                this.createUrlTree(rootSegmentGroup, tree.queryParams, tree.fragment !)));\n    return mapped$.pipe(catchError((e: any): Observable<UrlTree> => {\n      if (e instanceof NoMatch) {\n        throw this.noMatchError(e);\n      }\n\n      throw e;\n    }));\n  }\n\n  private noMatchError(e: NoMatch): any {\n    return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`);\n  }\n\n  private createUrlTree(rootCandidate: UrlSegmentGroup, queryParams: Params, fragment: string):\n      UrlTree {\n    const root = rootCandidate.segments.length > 0 ?\n        new UrlSegmentGroup([], {[PRIMARY_OUTLET]: rootCandidate}) :\n        rootCandidate;\n    return new UrlTree(root, queryParams, fragment);\n  }\n\n  private expandSegmentGroup(\n      ngModule: NgModuleRef<any>, routes: Route[], segmentGroup: UrlSegmentGroup,\n      outlet: string): Observable<UrlSegmentGroup> {\n    if (segmentGroup.segments.length === 0 && segmentGroup.hasChildren()) {\n      return this.expandChildren(ngModule, routes, segmentGroup)\n          .pipe(map((children: any) => new UrlSegmentGroup([], children)));\n    }\n\n    return this.expandSegment(ngModule, segmentGroup, routes, segmentGroup.segments, outlet, true);\n  }\n\n  // Recursively expand segment groups for all the child outlets\n  private expandChildren(\n      ngModule: NgModuleRef<any>, routes: Route[],\n      segmentGroup: UrlSegmentGroup): Observable<{[name: string]: UrlSegmentGroup}> {\n    return waitForMap(\n        segmentGroup.children,\n        (childOutlet, child) => this.expandSegmentGroup(ngModule, routes, child, childOutlet));\n  }\n\n  private expandSegment(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[],\n      segments: UrlSegment[], outlet: string,\n      allowRedirects: boolean): Observable<UrlSegmentGroup> {\n    return of (...routes).pipe(\n        map((r: any) => {\n          const expanded$ = this.expandSegmentAgainstRoute(\n              ngModule, segmentGroup, routes, r, segments, outlet, allowRedirects);\n          return expanded$.pipe(catchError((e: any) => {\n            if (e instanceof NoMatch) {\n              // TODO(i): this return type doesn't match the declared Observable<UrlSegmentGroup> -\n              // talk to Jason\n              return of (null) as any;\n            }\n            throw e;\n          }));\n        }),\n        concatAll(), first((s: any) => !!s), catchError((e: any, _: any) => {\n          if (e instanceof EmptyError || e.name === 'EmptyError') {\n            if (this.noLeftoversInUrl(segmentGroup, segments, outlet)) {\n              return of (new UrlSegmentGroup([], {}));\n            }\n            throw new NoMatch(segmentGroup);\n          }\n          throw e;\n        }));\n  }\n\n  private noLeftoversInUrl(segmentGroup: UrlSegmentGroup, segments: UrlSegment[], outlet: string):\n      boolean {\n    return segments.length === 0 && !segmentGroup.children[outlet];\n  }\n\n  private expandSegmentAgainstRoute(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[], route: Route,\n      paths: UrlSegment[], outlet: string, allowRedirects: boolean): Observable<UrlSegmentGroup> {\n    if (getOutlet(route) !== outlet) {\n      return noMatch(segmentGroup);\n    }\n\n    if (route.redirectTo === undefined) {\n      return this.matchSegmentAgainstRoute(ngModule, segmentGroup, route, paths);\n    }\n\n    if (allowRedirects && this.allowRedirects) {\n      return this.expandSegmentAgainstRouteUsingRedirect(\n          ngModule, segmentGroup, routes, route, paths, outlet);\n    }\n\n    return noMatch(segmentGroup);\n  }\n\n  private expandSegmentAgainstRouteUsingRedirect(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[], route: Route,\n      segments: UrlSegment[], outlet: string): Observable<UrlSegmentGroup> {\n    if (route.path === '**') {\n      return this.expandWildCardWithParamsAgainstRouteUsingRedirect(\n          ngModule, routes, route, outlet);\n    }\n\n    return this.expandRegularSegmentAgainstRouteUsingRedirect(\n        ngModule, segmentGroup, routes, route, segments, outlet);\n  }\n\n  private expandWildCardWithParamsAgainstRouteUsingRedirect(\n      ngModule: NgModuleRef<any>, routes: Route[], route: Route,\n      outlet: string): Observable<UrlSegmentGroup> {\n    const newTree = this.applyRedirectCommands([], route.redirectTo !, {});\n    if (route.redirectTo !.startsWith('/')) {\n      return absoluteRedirect(newTree);\n    }\n\n    return this.lineralizeSegments(route, newTree).pipe(mergeMap((newSegments: UrlSegment[]) => {\n      const group = new UrlSegmentGroup(newSegments, {});\n      return this.expandSegment(ngModule, group, routes, newSegments, outlet, false);\n    }));\n  }\n\n  private expandRegularSegmentAgainstRouteUsingRedirect(\n      ngModule: NgModuleRef<any>, segmentGroup: UrlSegmentGroup, routes: Route[], route: Route,\n      segments: UrlSegment[], outlet: string): Observable<UrlSegmentGroup> {\n    const {matched, consumedSegments, lastChild, positionalParamSegments} =\n        match(segmentGroup, route, segments);\n    if (!matched) return noMatch(segmentGroup);\n\n    const newTree = this.applyRedirectCommands(\n        consumedSegments, route.redirectTo !, <any>positionalParamSegments);\n    if (route.redirectTo !.startsWith('/')) {\n      return absoluteRedirect(newTree);\n    }\n\n    return this.lineralizeSegments(route, newTree).pipe(mergeMap((newSegments: UrlSegment[]) => {\n      return this.expandSegment(\n          ngModule, segmentGroup, routes, newSegments.concat(segments.slice(lastChild)), outlet,\n          false);\n    }));\n  }\n\n  private matchSegmentAgainstRoute(\n      ngModule: NgModuleRef<any>, rawSegmentGroup: UrlSegmentGroup, route: Route,\n      segments: UrlSegment[]): Observable<UrlSegmentGroup> {\n    if (route.path === '**') {\n      if (route.loadChildren) {\n        return this.configLoader.load(ngModule.injector, route)\n            .pipe(map((cfg: LoadedRouterConfig) => {\n              route._loadedConfig = cfg;\n              return new UrlSegmentGroup(segments, {});\n            }));\n      }\n\n      return of (new UrlSegmentGroup(segments, {}));\n    }\n\n    const {matched, consumedSegments, lastChild} = match(rawSegmentGroup, route, segments);\n    if (!matched) return noMatch(rawSegmentGroup);\n\n    const rawSlicedSegments = segments.slice(lastChild);\n    const childConfig$ = this.getChildConfig(ngModule, route);\n\n    return childConfig$.pipe(mergeMap((routerConfig: LoadedRouterConfig) => {\n      const childModule = routerConfig.module;\n      const childConfig = routerConfig.routes;\n\n      const {segmentGroup, slicedSegments} =\n          split(rawSegmentGroup, consumedSegments, rawSlicedSegments, childConfig);\n\n      if (slicedSegments.length === 0 && segmentGroup.hasChildren()) {\n        const expanded$ = this.expandChildren(childModule, childConfig, segmentGroup);\n        return expanded$.pipe(\n            map((children: any) => new UrlSegmentGroup(consumedSegments, children)));\n      }\n\n      if (childConfig.length === 0 && slicedSegments.length === 0) {\n        return of (new UrlSegmentGroup(consumedSegments, {}));\n      }\n\n      const expanded$ = this.expandSegment(\n          childModule, segmentGroup, childConfig, slicedSegments, PRIMARY_OUTLET, true);\n      return expanded$.pipe(\n          map((cs: UrlSegmentGroup) =>\n                  new UrlSegmentGroup(consumedSegments.concat(cs.segments), cs.children)));\n    }));\n  }\n\n  private getChildConfig(ngModule: NgModuleRef<any>, route: Route): Observable<LoadedRouterConfig> {\n    if (route.children) {\n      // The children belong to the same module\n      return of (new LoadedRouterConfig(route.children, ngModule));\n    }\n\n    if (route.loadChildren) {\n      // lazy children belong to the loaded module\n      if (route._loadedConfig !== undefined) {\n        return of (route._loadedConfig);\n      }\n\n      return runCanLoadGuard(ngModule.injector, route).pipe(mergeMap((shouldLoad: boolean) => {\n        if (shouldLoad) {\n          return this.configLoader.load(ngModule.injector, route)\n              .pipe(map((cfg: LoadedRouterConfig) => {\n                route._loadedConfig = cfg;\n                return cfg;\n              }));\n        }\n        return canLoadFails(route);\n      }));\n    }\n\n    return of (new LoadedRouterConfig([], ngModule));\n  }\n\n  private lineralizeSegments(route: Route, urlTree: UrlTree): Observable<UrlSegment[]> {\n    let res: UrlSegment[] = [];\n    let c = urlTree.root;\n    while (true) {\n      res = res.concat(c.segments);\n      if (c.numberOfChildren === 0) {\n        return of (res);\n      }\n\n      if (c.numberOfChildren > 1 || !c.children[PRIMARY_OUTLET]) {\n        return namedOutletsRedirect(route.redirectTo !);\n      }\n\n      c = c.children[PRIMARY_OUTLET];\n    }\n  }\n\n  private applyRedirectCommands(\n      segments: UrlSegment[], redirectTo: string, posParams: {[k: string]: UrlSegment}): UrlTree {\n    return this.applyRedirectCreatreUrlTree(\n        redirectTo, this.urlSerializer.parse(redirectTo), segments, posParams);\n  }\n\n  private applyRedirectCreatreUrlTree(\n      redirectTo: string, urlTree: UrlTree, segments: UrlSegment[],\n      posParams: {[k: string]: UrlSegment}): UrlTree {\n    const newRoot = this.createSegmentGroup(redirectTo, urlTree.root, segments, posParams);\n    return new UrlTree(\n        newRoot, this.createQueryParams(urlTree.queryParams, this.urlTree.queryParams),\n        urlTree.fragment);\n  }\n\n  private createQueryParams(redirectToParams: Params, actualParams: Params): Params {\n    const res: Params = {};\n    forEach(redirectToParams, (v: any, k: string) => {\n      const copySourceValue = typeof v === 'string' && v.startsWith(':');\n      if (copySourceValue) {\n        const sourceName = v.substring(1);\n        res[k] = actualParams[sourceName];\n      } else {\n        res[k] = v;\n      }\n    });\n    return res;\n  }\n\n  private createSegmentGroup(\n      redirectTo: string, group: UrlSegmentGroup, segments: UrlSegment[],\n      posParams: {[k: string]: UrlSegment}): UrlSegmentGroup {\n    const updatedSegments = this.createSegments(redirectTo, group.segments, segments, posParams);\n\n    let children: {[n: string]: UrlSegmentGroup} = {};\n    forEach(group.children, (child: UrlSegmentGroup, name: string) => {\n      children[name] = this.createSegmentGroup(redirectTo, child, segments, posParams);\n    });\n\n    return new UrlSegmentGroup(updatedSegments, children);\n  }\n\n  private createSegments(\n      redirectTo: string, redirectToSegments: UrlSegment[], actualSegments: UrlSegment[],\n      posParams: {[k: string]: UrlSegment}): UrlSegment[] {\n    return redirectToSegments.map(\n        s => s.path.startsWith(':') ? this.findPosParam(redirectTo, s, posParams) :\n                                      this.findOrReturn(s, actualSegments));\n  }\n\n  private findPosParam(\n      redirectTo: string, redirectToUrlSegment: UrlSegment,\n      posParams: {[k: string]: UrlSegment}): UrlSegment {\n    const pos = posParams[redirectToUrlSegment.path.substring(1)];\n    if (!pos)\n      throw new Error(\n          `Cannot redirect to '${redirectTo}'. Cannot find '${redirectToUrlSegment.path}'.`);\n    return pos;\n  }\n\n  private findOrReturn(redirectToUrlSegment: UrlSegment, actualSegments: UrlSegment[]): UrlSegment {\n    let idx = 0;\n    for (const s of actualSegments) {\n      if (s.path === redirectToUrlSegment.path) {\n        actualSegments.splice(idx);\n        return s;\n      }\n      idx++;\n    }\n    return redirectToUrlSegment;\n  }\n}\n\nfunction runCanLoadGuard(moduleInjector: Injector, route: Route): Observable<boolean> {\n  const canLoad = route.canLoad;\n  if (!canLoad || canLoad.length === 0) return of (true);\n\n  const obs = from(canLoad).pipe(map((injectionToken: any) => {\n    const guard = moduleInjector.get(injectionToken);\n    return wrapIntoObservable(guard.canLoad ? guard.canLoad(route) : guard(route));\n  }));\n\n  return andObservables(obs);\n}\n\nfunction match(segmentGroup: UrlSegmentGroup, route: Route, segments: UrlSegment[]): {\n  matched: boolean,\n  consumedSegments: UrlSegment[],\n  lastChild: number,\n  positionalParamSegments: {[k: string]: UrlSegment}\n} {\n  if (route.path === '') {\n    if ((route.pathMatch === 'full') && (segmentGroup.hasChildren() || segments.length > 0)) {\n      return {matched: false, consumedSegments: [], lastChild: 0, positionalParamSegments: {}};\n    }\n\n    return {matched: true, consumedSegments: [], lastChild: 0, positionalParamSegments: {}};\n  }\n\n  const matcher = route.matcher || defaultUrlMatcher;\n  const res = matcher(segments, segmentGroup, route);\n\n  if (!res) {\n    return {\n      matched: false,\n      consumedSegments: <any[]>[],\n      lastChild: 0,\n      positionalParamSegments: {},\n    };\n  }\n\n  return {\n    matched: true,\n    consumedSegments: res.consumed !,\n    lastChild: res.consumed.length !,\n    positionalParamSegments: res.posParams !,\n  };\n}\n\nfunction split(\n    segmentGroup: UrlSegmentGroup, consumedSegments: UrlSegment[], slicedSegments: UrlSegment[],\n    config: Route[]) {\n  if (slicedSegments.length > 0 &&\n      containsEmptyPathRedirectsWithNamedOutlets(segmentGroup, slicedSegments, config)) {\n    const s = new UrlSegmentGroup(\n        consumedSegments, createChildrenForEmptySegments(\n                              config, new UrlSegmentGroup(slicedSegments, segmentGroup.children)));\n    return {segmentGroup: mergeTrivialChildren(s), slicedSegments: []};\n  }\n\n  if (slicedSegments.length === 0 &&\n      containsEmptyPathRedirects(segmentGroup, slicedSegments, config)) {\n    const s = new UrlSegmentGroup(\n        segmentGroup.segments, addEmptySegmentsToChildrenIfNeeded(\n                                   segmentGroup, slicedSegments, config, segmentGroup.children));\n    return {segmentGroup: mergeTrivialChildren(s), slicedSegments};\n  }\n\n  return {segmentGroup, slicedSegments};\n}\n\nfunction mergeTrivialChildren(s: UrlSegmentGroup): UrlSegmentGroup {\n  if (s.numberOfChildren === 1 && s.children[PRIMARY_OUTLET]) {\n    const c = s.children[PRIMARY_OUTLET];\n    return new UrlSegmentGroup(s.segments.concat(c.segments), c.children);\n  }\n\n  return s;\n}\n\nfunction addEmptySegmentsToChildrenIfNeeded(\n    segmentGroup: UrlSegmentGroup, slicedSegments: UrlSegment[], routes: Route[],\n    children: {[name: string]: UrlSegmentGroup}): {[name: string]: UrlSegmentGroup} {\n  const res: {[name: string]: UrlSegmentGroup} = {};\n  for (const r of routes) {\n    if (isEmptyPathRedirect(segmentGroup, slicedSegments, r) && !children[getOutlet(r)]) {\n      res[getOutlet(r)] = new UrlSegmentGroup([], {});\n    }\n  }\n  return {...children, ...res};\n}\n\nfunction createChildrenForEmptySegments(\n    routes: Route[], primarySegmentGroup: UrlSegmentGroup): {[name: string]: UrlSegmentGroup} {\n  const res: {[name: string]: UrlSegmentGroup} = {};\n  res[PRIMARY_OUTLET] = primarySegmentGroup;\n  for (const r of routes) {\n    if (r.path === '' && getOutlet(r) !== PRIMARY_OUTLET) {\n      res[getOutlet(r)] = new UrlSegmentGroup([], {});\n    }\n  }\n  return res;\n}\n\nfunction containsEmptyPathRedirectsWithNamedOutlets(\n    segmentGroup: UrlSegmentGroup, segments: UrlSegment[], routes: Route[]): boolean {\n  return routes.some(\n      r => isEmptyPathRedirect(segmentGroup, segments, r) && getOutlet(r) !== PRIMARY_OUTLET);\n}\n\nfunction containsEmptyPathRedirects(\n    segmentGroup: UrlSegmentGroup, segments: UrlSegment[], routes: Route[]): boolean {\n  return routes.some(r => isEmptyPathRedirect(segmentGroup, segments, r));\n}\n\nfunction isEmptyPathRedirect(\n    segmentGroup: UrlSegmentGroup, segments: UrlSegment[], r: Route): boolean {\n  if ((segmentGroup.hasChildren() || segments.length > 0) && r.pathMatch === 'full') {\n    return false;\n  }\n\n  return r.path === '' && r.redirectTo !== undefined;\n}\n\nfunction getOutlet(route: Route): string {\n  return route.outlet || PRIMARY_OUTLET;\n}\n"],"sourceRoot":""}