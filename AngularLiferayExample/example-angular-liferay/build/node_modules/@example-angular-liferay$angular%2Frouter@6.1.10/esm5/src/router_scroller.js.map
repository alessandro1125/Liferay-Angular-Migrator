{"version":3,"sources":["../../../../../../../../../packages/router/src/router_scroller.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ViewportScroller} from '@angular/common';\nimport {OnDestroy} from '@angular/core';\nimport {Unsubscribable} from 'rxjs';\n\nimport {NavigationEnd, NavigationStart, Scroll} from './events';\nimport {Router} from './router';\n\nexport class RouterScroller implements OnDestroy {\n  // TODO(issue/24571): remove '!'.\n  private routerEventsSubscription !: Unsubscribable;\n  // TODO(issue/24571): remove '!'.\n  private scrollEventsSubscription !: Unsubscribable;\n\n  private lastId = 0;\n  private lastSource: 'imperative'|'popstate'|'hashchange'|undefined = 'imperative';\n  private restoredId = 0;\n  private store: {[key: string]: [number, number]} = {};\n\n  constructor(\n      private router: Router,\n      /** @docsNotRequired */ public readonly viewportScroller: ViewportScroller, private options: {\n        scrollPositionRestoration?: 'disabled' | 'enabled' | 'top',\n        anchorScrolling?: 'disabled'|'enabled'\n      } = {}) {\n    // Default both options to 'disabled'\n    options.scrollPositionRestoration = options.scrollPositionRestoration || 'disabled';\n    options.anchorScrolling = options.anchorScrolling || 'disabled';\n  }\n\n  init(): void {\n    // we want to disable the automatic scrolling because having two places\n    // responsible for scrolling results race conditions, especially given\n    // that browser don't implement this behavior consistently\n    if (this.options.scrollPositionRestoration !== 'disabled') {\n      this.viewportScroller.setHistoryScrollRestoration('manual');\n    }\n    this.routerEventsSubscription = this.createScrollEvents();\n    this.scrollEventsSubscription = this.consumeScrollEvents();\n  }\n\n  private createScrollEvents() {\n    return this.router.events.subscribe(e => {\n      if (e instanceof NavigationStart) {\n        // store the scroll position of the current stable navigations.\n        this.store[this.lastId] = this.viewportScroller.getScrollPosition();\n        this.lastSource = e.navigationTrigger;\n        this.restoredId = e.restoredState ? e.restoredState.navigationId : 0;\n      } else if (e instanceof NavigationEnd) {\n        this.lastId = e.id;\n        this.scheduleScrollEvent(e, this.router.parseUrl(e.urlAfterRedirects).fragment);\n      }\n    });\n  }\n\n  private consumeScrollEvents() {\n    return this.router.events.subscribe(e => {\n      if (!(e instanceof Scroll)) return;\n      // a popstate event. The pop state event will always ignore anchor scrolling.\n      if (e.position) {\n        if (this.options.scrollPositionRestoration === 'top') {\n          this.viewportScroller.scrollToPosition([0, 0]);\n        } else if (this.options.scrollPositionRestoration === 'enabled') {\n          this.viewportScroller.scrollToPosition(e.position);\n        }\n        // imperative navigation \"forward\"\n      } else {\n        if (e.anchor && this.options.anchorScrolling === 'enabled') {\n          this.viewportScroller.scrollToAnchor(e.anchor);\n        } else if (this.options.scrollPositionRestoration !== 'disabled') {\n          this.viewportScroller.scrollToPosition([0, 0]);\n        }\n      }\n    });\n  }\n\n  private scheduleScrollEvent(routerEvent: NavigationEnd, anchor: string|null): void {\n    this.router.triggerEvent(new Scroll(\n        routerEvent, this.lastSource === 'popstate' ? this.store[this.restoredId] : null, anchor));\n  }\n\n  ngOnDestroy() {\n    if (this.routerEventsSubscription) {\n      this.routerEventsSubscription.unsubscribe();\n    }\n    if (this.scrollEventsSubscription) {\n      this.scrollEventsSubscription.unsubscribe();\n    }\n  }\n}\n"],"sourceRoot":""}