{"version":3,"sources":["../../../../../../../packages/compiler/src/output/abstract_js_emitter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n\nimport {AbstractEmitterVisitor, CATCH_ERROR_VAR, CATCH_STACK_VAR, EmitterVisitorContext} from './abstract_emitter';\nimport * as o from './output_ast';\n\nexport abstract class AbstractJsEmitterVisitor extends AbstractEmitterVisitor {\n  constructor() { super(false); }\n  visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any {\n    ctx.pushClass(stmt);\n    this._visitClassConstructor(stmt, ctx);\n\n    if (stmt.parent != null) {\n      ctx.print(stmt, `${stmt.name}.prototype = Object.create(`);\n      stmt.parent.visitExpression(this, ctx);\n      ctx.println(stmt, `.prototype);`);\n    }\n    stmt.getters.forEach((getter) => this._visitClassGetter(stmt, getter, ctx));\n    stmt.methods.forEach((method) => this._visitClassMethod(stmt, method, ctx));\n    ctx.popClass();\n    return null;\n  }\n\n  private _visitClassConstructor(stmt: o.ClassStmt, ctx: EmitterVisitorContext) {\n    ctx.print(stmt, `function ${stmt.name}(`);\n    if (stmt.constructorMethod != null) {\n      this._visitParams(stmt.constructorMethod.params, ctx);\n    }\n    ctx.println(stmt, `) {`);\n    ctx.incIndent();\n    if (stmt.constructorMethod != null) {\n      if (stmt.constructorMethod.body.length > 0) {\n        ctx.println(stmt, `var self = this;`);\n        this.visitAllStatements(stmt.constructorMethod.body, ctx);\n      }\n    }\n    ctx.decIndent();\n    ctx.println(stmt, `}`);\n  }\n\n  private _visitClassGetter(stmt: o.ClassStmt, getter: o.ClassGetter, ctx: EmitterVisitorContext) {\n    ctx.println(\n        stmt,\n        `Object.defineProperty(${stmt.name}.prototype, '${getter.name}', { get: function() {`);\n    ctx.incIndent();\n    if (getter.body.length > 0) {\n      ctx.println(stmt, `var self = this;`);\n      this.visitAllStatements(getter.body, ctx);\n    }\n    ctx.decIndent();\n    ctx.println(stmt, `}});`);\n  }\n\n  private _visitClassMethod(stmt: o.ClassStmt, method: o.ClassMethod, ctx: EmitterVisitorContext) {\n    ctx.print(stmt, `${stmt.name}.prototype.${method.name} = function(`);\n    this._visitParams(method.params, ctx);\n    ctx.println(stmt, `) {`);\n    ctx.incIndent();\n    if (method.body.length > 0) {\n      ctx.println(stmt, `var self = this;`);\n      this.visitAllStatements(method.body, ctx);\n    }\n    ctx.decIndent();\n    ctx.println(stmt, `};`);\n  }\n\n  visitWrappedNodeExpr(ast: o.WrappedNodeExpr<any>, ctx: EmitterVisitorContext): any {\n    throw new Error('Cannot emit a WrappedNodeExpr in Javascript.');\n  }\n\n  visitReadVarExpr(ast: o.ReadVarExpr, ctx: EmitterVisitorContext): string|null {\n    if (ast.builtin === o.BuiltinVar.This) {\n      ctx.print(ast, 'self');\n    } else if (ast.builtin === o.BuiltinVar.Super) {\n      throw new Error(\n          `'super' needs to be handled at a parent ast node, not at the variable level!`);\n    } else {\n      super.visitReadVarExpr(ast, ctx);\n    }\n    return null;\n  }\n  visitDeclareVarStmt(stmt: o.DeclareVarStmt, ctx: EmitterVisitorContext): any {\n    ctx.print(stmt, `var ${stmt.name}`);\n    if (stmt.value) {\n      ctx.print(stmt, ' = ');\n      stmt.value.visitExpression(this, ctx);\n    }\n    ctx.println(stmt, `;`);\n    return null;\n  }\n  visitCastExpr(ast: o.CastExpr, ctx: EmitterVisitorContext): any {\n    ast.value.visitExpression(this, ctx);\n    return null;\n  }\n  visitInvokeFunctionExpr(expr: o.InvokeFunctionExpr, ctx: EmitterVisitorContext): string|null {\n    const fnExpr = expr.fn;\n    if (fnExpr instanceof o.ReadVarExpr && fnExpr.builtin === o.BuiltinVar.Super) {\n      ctx.currentClass !.parent !.visitExpression(this, ctx);\n      ctx.print(expr, `.call(this`);\n      if (expr.args.length > 0) {\n        ctx.print(expr, `, `);\n        this.visitAllExpressions(expr.args, ctx, ',');\n      }\n      ctx.print(expr, `)`);\n    } else {\n      super.visitInvokeFunctionExpr(expr, ctx);\n    }\n    return null;\n  }\n  visitFunctionExpr(ast: o.FunctionExpr, ctx: EmitterVisitorContext): any {\n    ctx.print(ast, `function${ast.name ? ' ' + ast.name : ''}(`);\n    this._visitParams(ast.params, ctx);\n    ctx.println(ast, `) {`);\n    ctx.incIndent();\n    this.visitAllStatements(ast.statements, ctx);\n    ctx.decIndent();\n    ctx.print(ast, `}`);\n    return null;\n  }\n  visitDeclareFunctionStmt(stmt: o.DeclareFunctionStmt, ctx: EmitterVisitorContext): any {\n    ctx.print(stmt, `function ${stmt.name}(`);\n    this._visitParams(stmt.params, ctx);\n    ctx.println(stmt, `) {`);\n    ctx.incIndent();\n    this.visitAllStatements(stmt.statements, ctx);\n    ctx.decIndent();\n    ctx.println(stmt, `}`);\n    return null;\n  }\n  visitTryCatchStmt(stmt: o.TryCatchStmt, ctx: EmitterVisitorContext): any {\n    ctx.println(stmt, `try {`);\n    ctx.incIndent();\n    this.visitAllStatements(stmt.bodyStmts, ctx);\n    ctx.decIndent();\n    ctx.println(stmt, `} catch (${CATCH_ERROR_VAR.name}) {`);\n    ctx.incIndent();\n    const catchStmts =\n        [<o.Statement>CATCH_STACK_VAR.set(CATCH_ERROR_VAR.prop('stack')).toDeclStmt(null, [\n          o.StmtModifier.Final\n        ])].concat(stmt.catchStmts);\n    this.visitAllStatements(catchStmts, ctx);\n    ctx.decIndent();\n    ctx.println(stmt, `}`);\n    return null;\n  }\n\n  private _visitParams(params: o.FnParam[], ctx: EmitterVisitorContext): void {\n    this.visitAllObjects(param => ctx.print(null, param.name), params, ctx, ',');\n  }\n\n  getBuiltinMethodName(method: o.BuiltinMethod): string {\n    let name: string;\n    switch (method) {\n      case o.BuiltinMethod.ConcatArray:\n        name = 'concat';\n        break;\n      case o.BuiltinMethod.SubscribeObservable:\n        name = 'subscribe';\n        break;\n      case o.BuiltinMethod.Bind:\n        name = 'bind';\n        break;\n      default:\n        throw new Error(`Unknown builtin method: ${method}`);\n    }\n    return name;\n  }\n}\n"],"sourceRoot":""}