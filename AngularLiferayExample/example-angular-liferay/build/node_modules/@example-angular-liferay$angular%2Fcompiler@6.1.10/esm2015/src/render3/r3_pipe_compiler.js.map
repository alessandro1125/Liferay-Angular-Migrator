{"version":3,"sources":["../../../../../../../packages/compiler/src/render3/r3_pipe_compiler.ts"],"names":[],"mappings":";;;;;;;;;AAQA,aAA6B,cAA7B,QAAkD,qBAAlD;AAGA,WAAO,KAAK,CAAZ,MAAmB,sBAAnB;AACA,aAAuB,KAAvB,QAAmC,SAAnC;AAEA,aAA8B,sBAA9B,EAAsD,8BAAtD,QAA2F,cAA3F;AACA,aAAQ,eAAe,EAAvB,QAAgC,kBAAhC;AAeA,WAAM,SAAA,uBAAA,CAAkC,QAAlC,EAA0D;AAC9D,cAAM,sBAA6E,EAAnF;AAEA;AACA,4BAAoB,IAApB,CAAyB,EAAC,KAAK,MAAN,EAAc,OAAO,EAAE,OAAF,CAAU,SAAS,QAAnB,CAArB,EAAmD,QAAQ,KAA3D,EAAzB;AAEA;AACA,4BAAoB,IAApB,CAAyB,EAAC,KAAK,MAAN,EAAc,OAAO,SAAS,IAA9B,EAAoC,QAAQ,KAA5C,EAAzB;AAEA,cAAM,kBAAkB,uBAAuB;AAC7C,kBAAM,SAAS,IAD8B;AAE7C,uBAAW,SAAS,IAFyB;AAG7C,kBAAM,SAAS,IAH8B;AAI7C,oBAAQ,IAJqC;AAK7C,sBAAU,GAAG;AALgC,SAAvB,CAAxB;AAOA,4BAAoB,IAApB,CAAyB,EAAC,KAAK,SAAN,EAAiB,OAAO,eAAxB,EAAyC,QAAQ,KAAjD,EAAzB;AAEA;AACA,4BAAoB,IAApB,CAAyB,EAAC,KAAK,MAAN,EAAc,OAAO,EAAE,OAAF,CAAU,SAAS,IAAnB,CAArB,EAA+C,QAAQ,KAAvD,EAAzB;AAEA,cAAM,aAAa,EAAE,UAAF,CAAa,GAAG,UAAhB,EAA4B,MAA5B,CAAmC,CAAC,EAAE,UAAF,CAAa,mBAAb,CAAD,CAAnC,CAAnB;AACA,cAAM,OAAO,IAAI,EAAE,cAAN,CAAqB,EAAE,UAAF,CAAa,GAAG,OAAhB,EAAyB,CACzD,IAAI,EAAE,cAAN,CAAqB,SAAS,IAA9B,CADyD,EAEzD,IAAI,EAAE,cAAN,CAAqB,IAAI,EAAE,WAAN,CAAkB,SAAS,QAA3B,CAArB,CAFyD,CAAzB,CAArB,CAAb;AAIA,eAAO,EAAC,UAAD,EAAa,IAAb,EAAP;AACD;AAED;;;AAGA,WAAM,SAAA,sBAAA,CACF,SADE,EACwB,IADxB,EACmD,SADnD,EAC8E;AAClF,cAAM,sBAA6E,EAAnF;AAEA,cAAM,OAAO,eAAe,KAAK,IAApB,CAAb;AACA,YAAI,CAAC,IAAL,EAAW;AACT,mBAAO,MAAM,8BAA8B,KAAK,IAAI,EAA7C,CAAP;AACD;AAED,cAAM,WAA2B;AAC/B,gBAD+B;AAE/B,sBAAU,KAAK,IAFgB;AAG/B,kBAAM,UAAU,UAAV,CAAqB,KAAK,IAAL,CAAU,SAA/B,CAHyB;AAI/B,kBAAM,+BAA+B,KAAK,IAApC,EAA0C,SAA1C,EAAqD,SAArD,CAJyB;AAK/B,kBAAM,KAAK;AALoB,SAAjC;AAQA,cAAM,MAAM,wBAAwB,QAAxB,CAAZ;AAEA,cAAM,kBAAkB,UAAU,YAAV,CAAuB,cAAvB,CAAqC,CAArC,CAAqC,UAArC,CAAxB;AAEA,kBAAU,UAAV,CAAqB,IAArB,CAA0B,IAAI,EAAE,SAAN;AACtB,kBAAW,IADW;AAEtB,oBAAa,IAFS;AAGtB,oBAAY,CAAC,IAAI,EAAE,UAAN;AACT,kBAAW,eADF;AAET,kBAAW,EAAE,aAFJ;AAGT,uBAAe,CAAC,EAAE,YAAF,CAAe,MAAhB,CAHN;AAIT,yBAAkB,IAAI,UAJb,CAAD,CAHU;AAQtB,qBAAa,EARS;AAStB,+BAAwB,IAAI,EAAE,WAAN,CAAkB,IAAlB,EAAwB,EAAxB,EAA4B,EAA5B,CATF;AAUtB,qBAAa,EAVS,CAA1B;AAWD","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {CompilePipeMetadata, identifierName} from '../compile_metadata';\nimport {CompileReflector} from '../compile_reflector';\nimport {DefinitionKind} from '../constant_pool';\nimport * as o from '../output/output_ast';\nimport {OutputContext, error} from '../util';\n\nimport {R3DependencyMetadata, compileFactoryFunction, dependenciesFromGlobalMetadata} from './r3_factory';\nimport {Identifiers as R3} from './r3_identifiers';\n\nexport interface R3PipeMetadata {\n  name: string;\n  type: o.Expression;\n  pipeName: string;\n  deps: R3DependencyMetadata[];\n  pure: boolean;\n}\n\nexport interface R3PipeDef {\n  expression: o.Expression;\n  type: o.Type;\n}\n\nexport function compilePipeFromMetadata(metadata: R3PipeMetadata) {\n  const definitionMapValues: {key: string, quoted: boolean, value: o.Expression}[] = [];\n\n  // e.g. `name: 'myPipe'`\n  definitionMapValues.push({key: 'name', value: o.literal(metadata.pipeName), quoted: false});\n\n  // e.g. `type: MyPipe`\n  definitionMapValues.push({key: 'type', value: metadata.type, quoted: false});\n\n  const templateFactory = compileFactoryFunction({\n    name: metadata.name,\n    fnOrClass: metadata.type,\n    deps: metadata.deps,\n    useNew: true,\n    injectFn: R3.directiveInject,\n  });\n  definitionMapValues.push({key: 'factory', value: templateFactory, quoted: false});\n\n  // e.g. `pure: true`\n  definitionMapValues.push({key: 'pure', value: o.literal(metadata.pure), quoted: false});\n\n  const expression = o.importExpr(R3.definePipe).callFn([o.literalMap(definitionMapValues)]);\n  const type = new o.ExpressionType(o.importExpr(R3.PipeDef, [\n    new o.ExpressionType(metadata.type),\n    new o.ExpressionType(new o.LiteralExpr(metadata.pipeName)),\n  ]));\n  return {expression, type};\n}\n\n/**\n * Write a pipe definition to the output context.\n */\nexport function compilePipeFromRender2(\n    outputCtx: OutputContext, pipe: CompilePipeMetadata, reflector: CompileReflector) {\n  const definitionMapValues: {key: string, quoted: boolean, value: o.Expression}[] = [];\n\n  const name = identifierName(pipe.type);\n  if (!name) {\n    return error(`Cannot resolve the name of ${pipe.type}`);\n  }\n\n  const metadata: R3PipeMetadata = {\n    name,\n    pipeName: pipe.name,\n    type: outputCtx.importExpr(pipe.type.reference),\n    deps: dependenciesFromGlobalMetadata(pipe.type, outputCtx, reflector),\n    pure: pipe.pure,\n  };\n\n  const res = compilePipeFromMetadata(metadata);\n\n  const definitionField = outputCtx.constantPool.propertyNameOf(DefinitionKind.Pipe);\n\n  outputCtx.statements.push(new o.ClassStmt(\n      /* name */ name,\n      /* parent */ null,\n      /* fields */[new o.ClassField(\n          /* name */ definitionField,\n          /* type */ o.INFERRED_TYPE,\n          /* modifiers */[o.StmtModifier.Static],\n          /* initializer */ res.expression)],\n      /* getters */[],\n      /* constructorMethod */ new o.ClassMethod(null, [], []),\n      /* methods */[]));\n}\n"],"sourceRoot":""}