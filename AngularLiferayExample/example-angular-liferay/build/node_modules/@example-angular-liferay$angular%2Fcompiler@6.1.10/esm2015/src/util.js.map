{"version":3,"sources":["../../../../../../packages/compiler/src/util.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ConstantPool} from './constant_pool';\n\nimport * as o from './output/output_ast';\nimport {ParseError} from './parse_util';\n\nconst DASH_CASE_REGEXP = /-+([a-z0-9])/g;\n\nexport function dashCaseToCamelCase(input: string): string {\n  return input.replace(DASH_CASE_REGEXP, (...m: any[]) => m[1].toUpperCase());\n}\n\nexport function splitAtColon(input: string, defaultValues: string[]): string[] {\n  return _splitAt(input, ':', defaultValues);\n}\n\nexport function splitAtPeriod(input: string, defaultValues: string[]): string[] {\n  return _splitAt(input, '.', defaultValues);\n}\n\nfunction _splitAt(input: string, character: string, defaultValues: string[]): string[] {\n  const characterIndex = input.indexOf(character);\n  if (characterIndex == -1) return defaultValues;\n  return [input.slice(0, characterIndex).trim(), input.slice(characterIndex + 1).trim()];\n}\n\nexport function visitValue(value: any, visitor: ValueVisitor, context: any): any {\n  if (Array.isArray(value)) {\n    return visitor.visitArray(<any[]>value, context);\n  }\n\n  if (isStrictStringMap(value)) {\n    return visitor.visitStringMap(<{[key: string]: any}>value, context);\n  }\n\n  if (value == null || typeof value == 'string' || typeof value == 'number' ||\n      typeof value == 'boolean') {\n    return visitor.visitPrimitive(value, context);\n  }\n\n  return visitor.visitOther(value, context);\n}\n\nexport function isDefined(val: any): boolean {\n  return val !== null && val !== undefined;\n}\n\nexport function noUndefined<T>(val: T | undefined): T {\n  return val === undefined ? null ! : val;\n}\n\nexport interface ValueVisitor {\n  visitArray(arr: any[], context: any): any;\n  visitStringMap(map: {[key: string]: any}, context: any): any;\n  visitPrimitive(value: any, context: any): any;\n  visitOther(value: any, context: any): any;\n}\n\nexport class ValueTransformer implements ValueVisitor {\n  visitArray(arr: any[], context: any): any {\n    return arr.map(value => visitValue(value, this, context));\n  }\n  visitStringMap(map: {[key: string]: any}, context: any): any {\n    const result: {[key: string]: any} = {};\n    Object.keys(map).forEach(key => { result[key] = visitValue(map[key], this, context); });\n    return result;\n  }\n  visitPrimitive(value: any, context: any): any { return value; }\n  visitOther(value: any, context: any): any { return value; }\n}\n\nexport type SyncAsync<T> = T | Promise<T>;\n\nexport const SyncAsync = {\n  assertSync: <T>(value: SyncAsync<T>): T => {\n    if (isPromise(value)) {\n      throw new Error(`Illegal state: value cannot be a promise`);\n    }\n    return value;\n  },\n  then: <T, R>(value: SyncAsync<T>, cb: (value: T) => R | Promise<R>| SyncAsync<R>):\n            SyncAsync<R> => { return isPromise(value) ? value.then(cb) : cb(value);},\n  all: <T>(syncAsyncValues: SyncAsync<T>[]): SyncAsync<T[]> => {\n    return syncAsyncValues.some(isPromise) ? Promise.all(syncAsyncValues) : syncAsyncValues as T[];\n  }\n};\n\nexport function error(msg: string): never {\n  throw new Error(`Internal Error: ${msg}`);\n}\n\nexport function syntaxError(msg: string, parseErrors?: ParseError[]): Error {\n  const error = Error(msg);\n  (error as any)[ERROR_SYNTAX_ERROR] = true;\n  if (parseErrors) (error as any)[ERROR_PARSE_ERRORS] = parseErrors;\n  return error;\n}\n\nconst ERROR_SYNTAX_ERROR = 'ngSyntaxError';\nconst ERROR_PARSE_ERRORS = 'ngParseErrors';\n\nexport function isSyntaxError(error: Error): boolean {\n  return (error as any)[ERROR_SYNTAX_ERROR];\n}\n\nexport function getParseErrors(error: Error): ParseError[] {\n  return (error as any)[ERROR_PARSE_ERRORS] || [];\n}\n\n// Escape characters that have a special meaning in Regular Expressions\nexport function escapeRegExp(s: string): string {\n  return s.replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n}\n\nconst STRING_MAP_PROTO = Object.getPrototypeOf({});\nfunction isStrictStringMap(obj: any): boolean {\n  return typeof obj === 'object' && obj !== null && Object.getPrototypeOf(obj) === STRING_MAP_PROTO;\n}\n\nexport function utf8Encode(str: string): string {\n  let encoded = '';\n  for (let index = 0; index < str.length; index++) {\n    let codePoint = str.charCodeAt(index);\n\n    // decode surrogate\n    // see https://mathiasbynens.be/notes/javascript-encoding#surrogate-formulae\n    if (codePoint >= 0xd800 && codePoint <= 0xdbff && str.length > (index + 1)) {\n      const low = str.charCodeAt(index + 1);\n      if (low >= 0xdc00 && low <= 0xdfff) {\n        index++;\n        codePoint = ((codePoint - 0xd800) << 10) + low - 0xdc00 + 0x10000;\n      }\n    }\n\n    if (codePoint <= 0x7f) {\n      encoded += String.fromCharCode(codePoint);\n    } else if (codePoint <= 0x7ff) {\n      encoded += String.fromCharCode(((codePoint >> 6) & 0x1F) | 0xc0, (codePoint & 0x3f) | 0x80);\n    } else if (codePoint <= 0xffff) {\n      encoded += String.fromCharCode(\n          (codePoint >> 12) | 0xe0, ((codePoint >> 6) & 0x3f) | 0x80, (codePoint & 0x3f) | 0x80);\n    } else if (codePoint <= 0x1fffff) {\n      encoded += String.fromCharCode(\n          ((codePoint >> 18) & 0x07) | 0xf0, ((codePoint >> 12) & 0x3f) | 0x80,\n          ((codePoint >> 6) & 0x3f) | 0x80, (codePoint & 0x3f) | 0x80);\n    }\n  }\n\n  return encoded;\n}\n\nexport interface OutputContext {\n  genFilePath: string;\n  statements: o.Statement[];\n  constantPool: ConstantPool;\n  importExpr(reference: any, typeParams?: o.Type[]|null, useSummaries?: boolean): o.Expression;\n}\n\nexport function stringify(token: any): string {\n  if (typeof token === 'string') {\n    return token;\n  }\n\n  if (token instanceof Array) {\n    return '[' + token.map(stringify).join(', ') + ']';\n  }\n\n  if (token == null) {\n    return '' + token;\n  }\n\n  if (token.overriddenName) {\n    return `${token.overriddenName}`;\n  }\n\n  if (token.name) {\n    return `${token.name}`;\n  }\n\n  // WARNING: do not try to `JSON.stringify(token)` here\n  // see https://github.com/angular/angular/issues/23440\n  const res = token.toString();\n\n  if (res == null) {\n    return '' + res;\n  }\n\n  const newLineIndex = res.indexOf('\\n');\n  return newLineIndex === -1 ? res : res.substring(0, newLineIndex);\n}\n\n/**\n * Lazily retrieves the reference value from a forwardRef.\n */\nexport function resolveForwardRef(type: any): any {\n  if (typeof type === 'function' && type.hasOwnProperty('__forward_ref__')) {\n    return type();\n  } else {\n    return type;\n  }\n}\n\n/**\n * Determine if the argument is shaped like a Promise\n */\nexport function isPromise(obj: any): obj is Promise<any> {\n  // allow any Promise/A+ compliant thenable.\n  // It's up to the caller to ensure that obj.then conforms to the spec\n  return !!obj && typeof obj.then === 'function';\n}\n\nexport class Version {\n  public readonly major: string;\n  public readonly minor: string;\n  public readonly patch: string;\n\n  constructor(public full: string) {\n    const splits = full.split('.');\n    this.major = splits[0];\n    this.minor = splits[1];\n    this.patch = splits.slice(2).join('.');\n  }\n}\n\nexport interface Console {\n  log(message: string): void;\n  warn(message: string): void;\n}\n"],"sourceRoot":""}