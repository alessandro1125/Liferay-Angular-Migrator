{"version":3,"sources":["../../../../../../../packages/compiler/src/i18n/i18n_html_parser.ts"],"names":[],"mappings":";;;;;;;;;AAQA,aAAQ,0BAAR,QAAyC,SAAzC;AAEA,aAAQ,4BAAR,QAAgE,mCAAhE;AACA,aAAQ,eAAR,QAA8B,qBAA9B;AAGA,aAAQ,MAAR,QAAqB,UAArB;AACA,aAAQ,iBAAR,QAAgC,oBAAhC;AAEA,aAAQ,KAAR,QAAoB,qBAApB;AACA,aAAQ,MAAR,QAAqB,sBAArB;AACA,aAAQ,GAAR,QAAkB,mBAAlB;AACA,aAAQ,GAAR,QAAkB,mBAAlB;AACA,aAAQ,iBAAR,QAAgC,sBAAhC;AAEA,WAAM,MAAA,cAAA,CAAA;AAMJ,oBACY,WADZ,EACqC,YADrC,EAC4D,kBAD5D,EAEI,qBAAiD,2BAA2B,OAFhF,EAGI,OAHJ,EAGqB;AAFT,iBAAA,WAAA,GAAA,WAAA;AAGV,gBAAI,YAAJ,EAAkB;AAChB,sBAAM,aAAa,iBAAiB,kBAAjB,CAAnB;AACA,qBAAK,kBAAL,GACI,kBAAkB,IAAlB,CAAuB,YAAvB,EAAqC,MAArC,EAA6C,UAA7C,EAAyD,kBAAzD,EAA6E,OAA7E,CADJ;AAED,aAJD,MAIO;AACL,qBAAK,kBAAL,GACI,IAAI,iBAAJ,CAAsB,EAAtB,EAA0B,IAA1B,EAAgC,MAAhC,EAAwC,SAAxC,EAAmD,kBAAnD,EAAuE,OAAvE,CADJ;AAED;AACF;AAED,cACI,MADJ,EACoB,GADpB,EACiC,sBAA+B,KADhE,EAEI,sBAA2C,4BAF/C,EAE2E;AACzE,kBAAM,cACF,KAAK,WAAL,CAAiB,KAAjB,CAAuB,MAAvB,EAA+B,GAA/B,EAAoC,mBAApC,EAAyD,mBAAzD,CADJ;AAGA,gBAAI,YAAY,MAAZ,CAAmB,MAAvB,EAA+B;AAC7B,uBAAO,IAAI,eAAJ,CAAoB,YAAY,SAAhC,EAA2C,YAAY,MAAvD,CAAP;AACD;AAED,mBAAO,kBACH,YAAY,SADT,EACoB,KAAK,kBADzB,EAC6C,mBAD7C,EACkE,EADlE,EACsE,EADtE,CAAP;AAED;AAhCG;AAmCN,aAAA,gBAAA,CAA0B,MAA1B,EAAyC;AACvC,iBAAS,CAAC,UAAU,KAAX,EAAkB,WAAlB,EAAT;AAEA,gBAAQ,MAAR;AACE,iBAAK,KAAL;AACE,uBAAO,IAAI,GAAJ,EAAP;AACF,iBAAK,KAAL;AACE,uBAAO,IAAI,GAAJ,EAAP;AACF,iBAAK,QAAL;AACA,iBAAK,MAAL;AACE,uBAAO,IAAI,MAAJ,EAAP;AACF,iBAAK,OAAL;AACA,iBAAK,KAAL;AACA;AACE,uBAAO,IAAI,KAAJ,EAAP;AAXJ;AAaD","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {MissingTranslationStrategy} from '../core';\nimport {HtmlParser} from '../ml_parser/html_parser';\nimport {DEFAULT_INTERPOLATION_CONFIG, InterpolationConfig} from '../ml_parser/interpolation_config';\nimport {ParseTreeResult} from '../ml_parser/parser';\nimport {Console} from '../util';\n\nimport {digest} from './digest';\nimport {mergeTranslations} from './extractor_merger';\nimport {Serializer} from './serializers/serializer';\nimport {Xliff} from './serializers/xliff';\nimport {Xliff2} from './serializers/xliff2';\nimport {Xmb} from './serializers/xmb';\nimport {Xtb} from './serializers/xtb';\nimport {TranslationBundle} from './translation_bundle';\n\nexport class I18NHtmlParser implements HtmlParser {\n  // @override\n  getTagDefinition: any;\n\n  private _translationBundle: TranslationBundle;\n\n  constructor(\n      private _htmlParser: HtmlParser, translations?: string, translationsFormat?: string,\n      missingTranslation: MissingTranslationStrategy = MissingTranslationStrategy.Warning,\n      console?: Console) {\n    if (translations) {\n      const serializer = createSerializer(translationsFormat);\n      this._translationBundle =\n          TranslationBundle.load(translations, 'i18n', serializer, missingTranslation, console);\n    } else {\n      this._translationBundle =\n          new TranslationBundle({}, null, digest, undefined, missingTranslation, console);\n    }\n  }\n\n  parse(\n      source: string, url: string, parseExpansionForms: boolean = false,\n      interpolationConfig: InterpolationConfig = DEFAULT_INTERPOLATION_CONFIG): ParseTreeResult {\n    const parseResult =\n        this._htmlParser.parse(source, url, parseExpansionForms, interpolationConfig);\n\n    if (parseResult.errors.length) {\n      return new ParseTreeResult(parseResult.rootNodes, parseResult.errors);\n    }\n\n    return mergeTranslations(\n        parseResult.rootNodes, this._translationBundle, interpolationConfig, [], {});\n  }\n}\n\nfunction createSerializer(format?: string): Serializer {\n  format = (format || 'xlf').toLowerCase();\n\n  switch (format) {\n    case 'xmb':\n      return new Xmb();\n    case 'xtb':\n      return new Xtb();\n    case 'xliff2':\n    case 'xlf2':\n      return new Xliff2();\n    case 'xliff':\n    case 'xlf':\n    default:\n      return new Xliff();\n  }\n}\n"],"sourceRoot":""}