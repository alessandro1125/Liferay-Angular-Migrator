{"version":3,"sources":["../../../../../../packages/compiler/src/shadow_css.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n/**\n * This file is a port of shadowCSS from webcomponents.js to TypeScript.\n *\n * Please make sure to keep to edits in sync with the source file.\n *\n * Source:\n * https://github.com/webcomponents/webcomponentsjs/blob/4efecd7e0e/src/ShadowCSS/ShadowCSS.js\n *\n * The original file level comment is reproduced below\n */\n\n/*\n  This is a limited shim for ShadowDOM css styling.\n  https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html#styles\n\n  The intention here is to support only the styling features which can be\n  relatively simply implemented. The goal is to allow users to avoid the\n  most obvious pitfalls and do so without compromising performance significantly.\n  For ShadowDOM styling that's not covered here, a set of best practices\n  can be provided that should allow users to accomplish more complex styling.\n\n  The following is a list of specific ShadowDOM styling features and a brief\n  discussion of the approach used to shim.\n\n  Shimmed features:\n\n  * :host, :host-context: ShadowDOM allows styling of the shadowRoot's host\n  element using the :host rule. To shim this feature, the :host styles are\n  reformatted and prefixed with a given scope name and promoted to a\n  document level stylesheet.\n  For example, given a scope name of .foo, a rule like this:\n\n    :host {\n        background: red;\n      }\n    }\n\n  becomes:\n\n    .foo {\n      background: red;\n    }\n\n  * encapsulation: Styles defined within ShadowDOM, apply only to\n  dom inside the ShadowDOM. Polymer uses one of two techniques to implement\n  this feature.\n\n  By default, rules are prefixed with the host element tag name\n  as a descendant selector. This ensures styling does not leak out of the 'top'\n  of the element's ShadowDOM. For example,\n\n  div {\n      font-weight: bold;\n    }\n\n  becomes:\n\n  x-foo div {\n      font-weight: bold;\n    }\n\n  becomes:\n\n\n  Alternatively, if WebComponents.ShadowCSS.strictStyling is set to true then\n  selectors are scoped by adding an attribute selector suffix to each\n  simple selector that contains the host element tag name. Each element\n  in the element's ShadowDOM template is also given the scope attribute.\n  Thus, these rules match only elements that have the scope attribute.\n  For example, given a scope name of x-foo, a rule like this:\n\n    div {\n      font-weight: bold;\n    }\n\n  becomes:\n\n    div[x-foo] {\n      font-weight: bold;\n    }\n\n  Note that elements that are dynamically added to a scope must have the scope\n  selector added to them manually.\n\n  * upper/lower bound encapsulation: Styles which are defined outside a\n  shadowRoot should not cross the ShadowDOM boundary and should not apply\n  inside a shadowRoot.\n\n  This styling behavior is not emulated. Some possible ways to do this that\n  were rejected due to complexity and/or performance concerns include: (1) reset\n  every possible property for every possible selector for a given scope name;\n  (2) re-implement css in javascript.\n\n  As an alternative, users should make sure to use selectors\n  specific to the scope in which they are working.\n\n  * ::distributed: This behavior is not emulated. It's often not necessary\n  to style the contents of a specific insertion point and instead, descendants\n  of the host element can be styled selectively. Users can also create an\n  extra node around an insertion point and style that node's contents\n  via descendent selectors. For example, with a shadowRoot like this:\n\n    <style>\n      ::content(div) {\n        background: red;\n      }\n    </style>\n    <content></content>\n\n  could become:\n\n    <style>\n      / *@polyfill .content-container div * /\n      ::content(div) {\n        background: red;\n      }\n    </style>\n    <div class=\"content-container\">\n      <content></content>\n    </div>\n\n  Note the use of @polyfill in the comment above a ShadowDOM specific style\n  declaration. This is a directive to the styling shim to use the selector\n  in comments in lieu of the next selector when running under polyfill.\n*/\n\nexport class ShadowCss {\n  strictStyling: boolean = true;\n\n  constructor() {}\n\n  /*\n  * Shim some cssText with the given selector. Returns cssText that can\n  * be included in the document via WebComponents.ShadowCSS.addCssToDocument(css).\n  *\n  * When strictStyling is true:\n  * - selector is the attribute added to all elements inside the host,\n  * - hostSelector is the attribute added to the host itself.\n  */\n  shimCssText(cssText: string, selector: string, hostSelector: string = ''): string {\n    const commentsWithHash = extractCommentsWithHash(cssText);\n    cssText = stripComments(cssText);\n    cssText = this._insertDirectives(cssText);\n\n    const scopedCssText = this._scopeCssText(cssText, selector, hostSelector);\n    return [scopedCssText, ...commentsWithHash].join('\\n');\n  }\n\n  private _insertDirectives(cssText: string): string {\n    cssText = this._insertPolyfillDirectivesInCssText(cssText);\n    return this._insertPolyfillRulesInCssText(cssText);\n  }\n\n  /*\n   * Process styles to convert native ShadowDOM rules that will trip\n   * up the css parser; we rely on decorating the stylesheet with inert rules.\n   *\n   * For example, we convert this rule:\n   *\n   * polyfill-next-selector { content: ':host menu-item'; }\n   * ::content menu-item {\n   *\n   * to this:\n   *\n   * scopeName menu-item {\n   *\n  **/\n  private _insertPolyfillDirectivesInCssText(cssText: string): string {\n    // Difference with webcomponents.js: does not handle comments\n    return cssText.replace(\n        _cssContentNextSelectorRe, function(...m: string[]) { return m[2] + '{'; });\n  }\n\n  /*\n   * Process styles to add rules which will only apply under the polyfill\n   *\n   * For example, we convert this rule:\n   *\n   * polyfill-rule {\n   *   content: ':host menu-item';\n   * ...\n   * }\n   *\n   * to this:\n   *\n   * scopeName menu-item {...}\n   *\n  **/\n  private _insertPolyfillRulesInCssText(cssText: string): string {\n    // Difference with webcomponents.js: does not handle comments\n    return cssText.replace(_cssContentRuleRe, (...m: string[]) => {\n      const rule = m[0].replace(m[1], '').replace(m[2], '');\n      return m[4] + rule;\n    });\n  }\n\n  /* Ensure styles are scoped. Pseudo-scoping takes a rule like:\n   *\n   *  .foo {... }\n   *\n   *  and converts this to\n   *\n   *  scopeName .foo { ... }\n  */\n  private _scopeCssText(cssText: string, scopeSelector: string, hostSelector: string): string {\n    const unscopedRules = this._extractUnscopedRulesFromCssText(cssText);\n    // replace :host and :host-context -shadowcsshost and -shadowcsshost respectively\n    cssText = this._insertPolyfillHostInCssText(cssText);\n    cssText = this._convertColonHost(cssText);\n    cssText = this._convertColonHostContext(cssText);\n    cssText = this._convertShadowDOMSelectors(cssText);\n    if (scopeSelector) {\n      cssText = this._scopeSelectors(cssText, scopeSelector, hostSelector);\n    }\n    cssText = cssText + '\\n' + unscopedRules;\n    return cssText.trim();\n  }\n\n  /*\n   * Process styles to add rules which will only apply under the polyfill\n   * and do not process via CSSOM. (CSSOM is destructive to rules on rare\n   * occasions, e.g. -webkit-calc on Safari.)\n   * For example, we convert this rule:\n   *\n   * @polyfill-unscoped-rule {\n   *   content: 'menu-item';\n   * ... }\n   *\n   * to this:\n   *\n   * menu-item {...}\n   *\n  **/\n  private _extractUnscopedRulesFromCssText(cssText: string): string {\n    // Difference with webcomponents.js: does not handle comments\n    let r = '';\n    let m: RegExpExecArray|null;\n    _cssContentUnscopedRuleRe.lastIndex = 0;\n    while ((m = _cssContentUnscopedRuleRe.exec(cssText)) !== null) {\n      const rule = m[0].replace(m[2], '').replace(m[1], m[4]);\n      r += rule + '\\n\\n';\n    }\n    return r;\n  }\n\n  /*\n   * convert a rule like :host(.foo) > .bar { }\n   *\n   * to\n   *\n   * .foo<scopeName> > .bar\n  */\n  private _convertColonHost(cssText: string): string {\n    return this._convertColonRule(cssText, _cssColonHostRe, this._colonHostPartReplacer);\n  }\n\n  /*\n   * convert a rule like :host-context(.foo) > .bar { }\n   *\n   * to\n   *\n   * .foo<scopeName> > .bar, .foo scopeName > .bar { }\n   *\n   * and\n   *\n   * :host-context(.foo:host) .bar { ... }\n   *\n   * to\n   *\n   * .foo<scopeName> .bar { ... }\n  */\n  private _convertColonHostContext(cssText: string): string {\n    return this._convertColonRule(\n        cssText, _cssColonHostContextRe, this._colonHostContextPartReplacer);\n  }\n\n  private _convertColonRule(cssText: string, regExp: RegExp, partReplacer: Function): string {\n    // m[1] = :host(-context), m[2] = contents of (), m[3] rest of rule\n    return cssText.replace(regExp, function(...m: string[]) {\n      if (m[2]) {\n        const parts = m[2].split(',');\n        const r: string[] = [];\n        for (let i = 0; i < parts.length; i++) {\n          const p = parts[i].trim();\n          if (!p) break;\n          r.push(partReplacer(_polyfillHostNoCombinator, p, m[3]));\n        }\n        return r.join(',');\n      } else {\n        return _polyfillHostNoCombinator + m[3];\n      }\n    });\n  }\n\n  private _colonHostContextPartReplacer(host: string, part: string, suffix: string): string {\n    if (part.indexOf(_polyfillHost) > -1) {\n      return this._colonHostPartReplacer(host, part, suffix);\n    } else {\n      return host + part + suffix + ', ' + part + ' ' + host + suffix;\n    }\n  }\n\n  private _colonHostPartReplacer(host: string, part: string, suffix: string): string {\n    return host + part.replace(_polyfillHost, '') + suffix;\n  }\n\n  /*\n   * Convert combinators like ::shadow and pseudo-elements like ::content\n   * by replacing with space.\n  */\n  private _convertShadowDOMSelectors(cssText: string): string {\n    return _shadowDOMSelectorsRe.reduce((result, pattern) => result.replace(pattern, ' '), cssText);\n  }\n\n  // change a selector like 'div' to 'name div'\n  private _scopeSelectors(cssText: string, scopeSelector: string, hostSelector: string): string {\n    return processRules(cssText, (rule: CssRule) => {\n      let selector = rule.selector;\n      let content = rule.content;\n      if (rule.selector[0] != '@') {\n        selector =\n            this._scopeSelector(rule.selector, scopeSelector, hostSelector, this.strictStyling);\n      } else if (\n          rule.selector.startsWith('@media') || rule.selector.startsWith('@supports') ||\n          rule.selector.startsWith('@page') || rule.selector.startsWith('@document')) {\n        content = this._scopeSelectors(rule.content, scopeSelector, hostSelector);\n      }\n      return new CssRule(selector, content);\n    });\n  }\n\n  private _scopeSelector(\n      selector: string, scopeSelector: string, hostSelector: string, strict: boolean): string {\n    return selector.split(',')\n        .map(part => part.trim().split(_shadowDeepSelectors))\n        .map((deepParts) => {\n          const [shallowPart, ...otherParts] = deepParts;\n          const applyScope = (shallowPart: string) => {\n            if (this._selectorNeedsScoping(shallowPart, scopeSelector)) {\n              return strict ?\n                  this._applyStrictSelectorScope(shallowPart, scopeSelector, hostSelector) :\n                  this._applySelectorScope(shallowPart, scopeSelector, hostSelector);\n            } else {\n              return shallowPart;\n            }\n          };\n          return [applyScope(shallowPart), ...otherParts].join(' ');\n        })\n        .join(', ');\n  }\n\n  private _selectorNeedsScoping(selector: string, scopeSelector: string): boolean {\n    const re = this._makeScopeMatcher(scopeSelector);\n    return !re.test(selector);\n  }\n\n  private _makeScopeMatcher(scopeSelector: string): RegExp {\n    const lre = /\\[/g;\n    const rre = /\\]/g;\n    scopeSelector = scopeSelector.replace(lre, '\\\\[').replace(rre, '\\\\]');\n    return new RegExp('^(' + scopeSelector + ')' + _selectorReSuffix, 'm');\n  }\n\n  private _applySelectorScope(selector: string, scopeSelector: string, hostSelector: string):\n      string {\n    // Difference from webcomponents.js: scopeSelector could not be an array\n    return this._applySimpleSelectorScope(selector, scopeSelector, hostSelector);\n  }\n\n  // scope via name and [is=name]\n  private _applySimpleSelectorScope(selector: string, scopeSelector: string, hostSelector: string):\n      string {\n    // In Android browser, the lastIndex is not reset when the regex is used in String.replace()\n    _polyfillHostRe.lastIndex = 0;\n    if (_polyfillHostRe.test(selector)) {\n      const replaceBy = this.strictStyling ? `[${hostSelector}]` : scopeSelector;\n      return selector\n          .replace(\n              _polyfillHostNoCombinatorRe,\n              (hnc, selector) => {\n                return selector.replace(\n                    /([^:]*)(:*)(.*)/,\n                    (_: string, before: string, colon: string, after: string) => {\n                      return before + replaceBy + colon + after;\n                    });\n              })\n          .replace(_polyfillHostRe, replaceBy + ' ');\n    }\n\n    return scopeSelector + ' ' + selector;\n  }\n\n  // return a selector with [name] suffix on each simple selector\n  // e.g. .foo.bar > .zot becomes .foo[name].bar[name] > .zot[name]  /** @internal */\n  private _applyStrictSelectorScope(selector: string, scopeSelector: string, hostSelector: string):\n      string {\n    const isRe = /\\[is=([^\\]]*)\\]/g;\n    scopeSelector = scopeSelector.replace(isRe, (_: string, ...parts: string[]) => parts[0]);\n\n    const attrName = '[' + scopeSelector + ']';\n\n    const _scopeSelectorPart = (p: string) => {\n      let scopedP = p.trim();\n\n      if (!scopedP) {\n        return '';\n      }\n\n      if (p.indexOf(_polyfillHostNoCombinator) > -1) {\n        scopedP = this._applySimpleSelectorScope(p, scopeSelector, hostSelector);\n      } else {\n        // remove :host since it should be unnecessary\n        const t = p.replace(_polyfillHostRe, '');\n        if (t.length > 0) {\n          const matches = t.match(/([^:]*)(:*)(.*)/);\n          if (matches) {\n            scopedP = matches[1] + attrName + matches[2] + matches[3];\n          }\n        }\n      }\n\n      return scopedP;\n    };\n\n    const safeContent = new SafeSelector(selector);\n    selector = safeContent.content();\n\n    let scopedSelector = '';\n    let startIndex = 0;\n    let res: RegExpExecArray|null;\n    const sep = /( |>|\\+|~(?!=))\\s*/g;\n\n    // If a selector appears before :host it should not be shimmed as it\n    // matches on ancestor elements and not on elements in the host's shadow\n    // `:host-context(div)` is transformed to\n    // `-shadowcsshost-no-combinatordiv, div -shadowcsshost-no-combinator`\n    // the `div` is not part of the component in the 2nd selectors and should not be scoped.\n    // Historically `component-tag:host` was matching the component so we also want to preserve\n    // this behavior to avoid breaking legacy apps (it should not match).\n    // The behavior should be:\n    // - `tag:host` -> `tag[h]` (this is to avoid breaking legacy apps, should not match anything)\n    // - `tag :host` -> `tag [h]` (`tag` is not scoped because it's considered part of a\n    //   `:host-context(tag)`)\n    const hasHost = selector.indexOf(_polyfillHostNoCombinator) > -1;\n    // Only scope parts after the first `-shadowcsshost-no-combinator` when it is present\n    let shouldScope = !hasHost;\n\n    while ((res = sep.exec(selector)) !== null) {\n      const separator = res[1];\n      const part = selector.slice(startIndex, res.index).trim();\n      shouldScope = shouldScope || part.indexOf(_polyfillHostNoCombinator) > -1;\n      const scopedPart = shouldScope ? _scopeSelectorPart(part) : part;\n      scopedSelector += `${scopedPart} ${separator} `;\n      startIndex = sep.lastIndex;\n    }\n\n    const part = selector.substring(startIndex);\n    shouldScope = shouldScope || part.indexOf(_polyfillHostNoCombinator) > -1;\n    scopedSelector += shouldScope ? _scopeSelectorPart(part) : part;\n\n    // replace the placeholders with their original values\n    return safeContent.restore(scopedSelector);\n  }\n\n  private _insertPolyfillHostInCssText(selector: string): string {\n    return selector.replace(_colonHostContextRe, _polyfillHostContext)\n        .replace(_colonHostRe, _polyfillHost);\n  }\n}\n\nclass SafeSelector {\n  private placeholders: string[] = [];\n  private index = 0;\n  private _content: string;\n\n  constructor(selector: string) {\n    // Replaces attribute selectors with placeholders.\n    // The WS in [attr=\"va lue\"] would otherwise be interpreted as a selector separator.\n    selector = selector.replace(/(\\[[^\\]]*\\])/g, (_, keep) => {\n      const replaceBy = `__ph-${this.index}__`;\n      this.placeholders.push(keep);\n      this.index++;\n      return replaceBy;\n    });\n\n    // Replaces the expression in `:nth-child(2n + 1)` with a placeholder.\n    // WS and \"+\" would otherwise be interpreted as selector separators.\n    this._content = selector.replace(/(:nth-[-\\w]+)(\\([^)]+\\))/g, (_, pseudo, exp) => {\n      const replaceBy = `__ph-${this.index}__`;\n      this.placeholders.push(exp);\n      this.index++;\n      return pseudo + replaceBy;\n    });\n  }\n\n  restore(content: string): string {\n    return content.replace(/__ph-(\\d+)__/g, (ph, index) => this.placeholders[+index]);\n  }\n\n  content(): string { return this._content; }\n}\n\nconst _cssContentNextSelectorRe =\n    /polyfill-next-selector[^}]*content:[\\s]*?(['\"])(.*?)\\1[;\\s]*}([^{]*?){/gim;\nconst _cssContentRuleRe = /(polyfill-rule)[^}]*(content:[\\s]*(['\"])(.*?)\\3)[;\\s]*[^}]*}/gim;\nconst _cssContentUnscopedRuleRe =\n    /(polyfill-unscoped-rule)[^}]*(content:[\\s]*(['\"])(.*?)\\3)[;\\s]*[^}]*}/gim;\nconst _polyfillHost = '-shadowcsshost';\n// note: :host-context pre-processed to -shadowcsshostcontext.\nconst _polyfillHostContext = '-shadowcsscontext';\nconst _parenSuffix = ')(?:\\\\((' +\n    '(?:\\\\([^)(]*\\\\)|[^)(]*)+?' +\n    ')\\\\))?([^,{]*)';\nconst _cssColonHostRe = new RegExp('(' + _polyfillHost + _parenSuffix, 'gim');\nconst _cssColonHostContextRe = new RegExp('(' + _polyfillHostContext + _parenSuffix, 'gim');\nconst _polyfillHostNoCombinator = _polyfillHost + '-no-combinator';\nconst _polyfillHostNoCombinatorRe = /-shadowcsshost-no-combinator([^\\s]*)/;\nconst _shadowDOMSelectorsRe = [\n  /::shadow/g,\n  /::content/g,\n  // Deprecated selectors\n  /\\/shadow-deep\\//g,\n  /\\/shadow\\//g,\n];\n\n// The deep combinator is deprecated in the CSS spec\n// Support for `>>>`, `deep`, `::ng-deep` is then also deprecated and will be removed in the future.\n// see https://github.com/angular/angular/pull/17677\nconst _shadowDeepSelectors = /(?:>>>)|(?:\\/deep\\/)|(?:::ng-deep)/g;\nconst _selectorReSuffix = '([>\\\\s~+\\[.,{:][\\\\s\\\\S]*)?$';\nconst _polyfillHostRe = /-shadowcsshost/gim;\nconst _colonHostRe = /:host/gim;\nconst _colonHostContextRe = /:host-context/gim;\n\nconst _commentRe = /\\/\\*\\s*[\\s\\S]*?\\*\\//g;\n\nfunction stripComments(input: string): string {\n  return input.replace(_commentRe, '');\n}\n\nconst _commentWithHashRe = /\\/\\*\\s*#\\s*source(Mapping)?URL=[\\s\\S]+?\\*\\//g;\n\nfunction extractCommentsWithHash(input: string): string[] {\n  return input.match(_commentWithHashRe) || [];\n}\n\nconst _ruleRe = /(\\s*)([^;\\{\\}]+?)(\\s*)((?:{%BLOCK%}?\\s*;?)|(?:\\s*;))/g;\nconst _curlyRe = /([{}])/g;\nconst OPEN_CURLY = '{';\nconst CLOSE_CURLY = '}';\nconst BLOCK_PLACEHOLDER = '%BLOCK%';\n\nexport class CssRule {\n  constructor(public selector: string, public content: string) {}\n}\n\nexport function processRules(input: string, ruleCallback: (rule: CssRule) => CssRule): string {\n  const inputWithEscapedBlocks = escapeBlocks(input);\n  let nextBlockIndex = 0;\n  return inputWithEscapedBlocks.escapedString.replace(_ruleRe, function(...m: string[]) {\n    const selector = m[2];\n    let content = '';\n    let suffix = m[4];\n    let contentPrefix = '';\n    if (suffix && suffix.startsWith('{' + BLOCK_PLACEHOLDER)) {\n      content = inputWithEscapedBlocks.blocks[nextBlockIndex++];\n      suffix = suffix.substring(BLOCK_PLACEHOLDER.length + 1);\n      contentPrefix = '{';\n    }\n    const rule = ruleCallback(new CssRule(selector, content));\n    return `${m[1]}${rule.selector}${m[3]}${contentPrefix}${rule.content}${suffix}`;\n  });\n}\n\nclass StringWithEscapedBlocks {\n  constructor(public escapedString: string, public blocks: string[]) {}\n}\n\nfunction escapeBlocks(input: string): StringWithEscapedBlocks {\n  const inputParts = input.split(_curlyRe);\n  const resultParts: string[] = [];\n  const escapedBlocks: string[] = [];\n  let bracketCount = 0;\n  let currentBlockParts: string[] = [];\n  for (let partIndex = 0; partIndex < inputParts.length; partIndex++) {\n    const part = inputParts[partIndex];\n    if (part == CLOSE_CURLY) {\n      bracketCount--;\n    }\n    if (bracketCount > 0) {\n      currentBlockParts.push(part);\n    } else {\n      if (currentBlockParts.length > 0) {\n        escapedBlocks.push(currentBlockParts.join(''));\n        resultParts.push(BLOCK_PLACEHOLDER);\n        currentBlockParts = [];\n      }\n      resultParts.push(part);\n    }\n    if (part == OPEN_CURLY) {\n      bracketCount++;\n    }\n  }\n  if (currentBlockParts.length > 0) {\n    escapedBlocks.push(currentBlockParts.join(''));\n    resultParts.push(BLOCK_PLACEHOLDER);\n  }\n  return new StringWithEscapedBlocks(resultParts.join(''), escapedBlocks);\n}\n"],"sourceRoot":""}