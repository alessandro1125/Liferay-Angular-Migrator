{"version":3,"sources":["../../../../../../../../../../packages/compiler/src/aot/summary_serializer.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {CompileDirectiveMetadata, CompileDirectiveSummary, CompileNgModuleMetadata, CompileNgModuleSummary, CompilePipeMetadata, CompileProviderMetadata, CompileSummaryKind, CompileTypeMetadata, CompileTypeSummary} from '../compile_metadata';\nimport * as o from '../output/output_ast';\nimport {Summary, SummaryResolver} from '../summary_resolver';\nimport {OutputContext, ValueTransformer, ValueVisitor, visitValue} from '../util';\n\nimport {StaticSymbol, StaticSymbolCache} from './static_symbol';\nimport {ResolvedStaticSymbol, StaticSymbolResolver, unwrapResolvedMetadata} from './static_symbol_resolver';\nimport {isLoweredSymbol, ngfactoryFilePath, summaryForJitFileName, summaryForJitName} from './util';\n\nexport function serializeSummaries(\n    srcFileName: string, forJitCtx: OutputContext | null,\n    summaryResolver: SummaryResolver<StaticSymbol>, symbolResolver: StaticSymbolResolver,\n    symbols: ResolvedStaticSymbol[], types: {\n      summary: CompileTypeSummary,\n      metadata: CompileNgModuleMetadata | CompileDirectiveMetadata | CompilePipeMetadata |\n          CompileTypeMetadata\n    }[]): {json: string, exportAs: {symbol: StaticSymbol, exportAs: string}[]} {\n  const toJsonSerializer = new ToJsonSerializer(symbolResolver, summaryResolver, srcFileName);\n\n  // for symbols, we use everything except for the class metadata itself\n  // (we keep the statics though), as the class metadata is contained in the\n  // CompileTypeSummary.\n  symbols.forEach(\n      (resolvedSymbol) => toJsonSerializer.addSummary(\n          {symbol: resolvedSymbol.symbol, metadata: resolvedSymbol.metadata}));\n\n  // Add type summaries.\n  types.forEach(({summary, metadata}) => {\n    toJsonSerializer.addSummary(\n        {symbol: summary.type.reference, metadata: undefined, type: summary});\n  });\n  const {json, exportAs} = toJsonSerializer.serialize();\n  if (forJitCtx) {\n    const forJitSerializer = new ForJitSerializer(forJitCtx, symbolResolver, summaryResolver);\n    types.forEach(({summary, metadata}) => { forJitSerializer.addSourceType(summary, metadata); });\n    toJsonSerializer.unprocessedSymbolSummariesBySymbol.forEach((summary) => {\n      if (summaryResolver.isLibraryFile(summary.symbol.filePath) && summary.type) {\n        forJitSerializer.addLibType(summary.type);\n      }\n    });\n    forJitSerializer.serialize(exportAs);\n  }\n  return {json, exportAs};\n}\n\nexport function deserializeSummaries(\n    symbolCache: StaticSymbolCache, summaryResolver: SummaryResolver<StaticSymbol>,\n    libraryFileName: string, json: string): {\n  moduleName: string | null,\n  summaries: Summary<StaticSymbol>[],\n  importAs: {symbol: StaticSymbol, importAs: StaticSymbol}[]\n} {\n  const deserializer = new FromJsonDeserializer(symbolCache, summaryResolver);\n  return deserializer.deserialize(libraryFileName, json);\n}\n\nexport function createForJitStub(outputCtx: OutputContext, reference: StaticSymbol) {\n  return createSummaryForJitFunction(outputCtx, reference, o.NULL_EXPR);\n}\n\nfunction createSummaryForJitFunction(\n    outputCtx: OutputContext, reference: StaticSymbol, value: o.Expression) {\n  const fnName = summaryForJitName(reference.name);\n  outputCtx.statements.push(\n      o.fn([], [new o.ReturnStatement(value)], new o.ArrayType(o.DYNAMIC_TYPE)).toDeclStmt(fnName, [\n        o.StmtModifier.Final, o.StmtModifier.Exported\n      ]));\n}\n\nconst enum SerializationFlags {\n  None = 0,\n  ResolveValue = 1,\n}\n\nclass ToJsonSerializer extends ValueTransformer {\n  // Note: This only contains symbols without members.\n  private symbols: StaticSymbol[] = [];\n  private indexBySymbol = new Map<StaticSymbol, number>();\n  private reexportedBy = new Map<StaticSymbol, StaticSymbol>();\n  // This now contains a `__symbol: number` in the place of\n  // StaticSymbols, but otherwise has the same shape as the original objects.\n  private processedSummaryBySymbol = new Map<StaticSymbol, any>();\n  private processedSummaries: any[] = [];\n  private moduleName: string|null;\n\n  unprocessedSymbolSummariesBySymbol = new Map<StaticSymbol, Summary<StaticSymbol>>();\n\n  constructor(\n      private symbolResolver: StaticSymbolResolver,\n      private summaryResolver: SummaryResolver<StaticSymbol>, private srcFileName: string) {\n    super();\n    this.moduleName = symbolResolver.getKnownModuleName(srcFileName);\n  }\n\n  addSummary(summary: Summary<StaticSymbol>) {\n    let unprocessedSummary = this.unprocessedSymbolSummariesBySymbol.get(summary.symbol);\n    let processedSummary = this.processedSummaryBySymbol.get(summary.symbol);\n    if (!unprocessedSummary) {\n      unprocessedSummary = {symbol: summary.symbol, metadata: undefined};\n      this.unprocessedSymbolSummariesBySymbol.set(summary.symbol, unprocessedSummary);\n      processedSummary = {symbol: this.processValue(summary.symbol, SerializationFlags.None)};\n      this.processedSummaries.push(processedSummary);\n      this.processedSummaryBySymbol.set(summary.symbol, processedSummary);\n    }\n    if (!unprocessedSummary.metadata && summary.metadata) {\n      let metadata = summary.metadata || {};\n      if (metadata.__symbolic === 'class') {\n        // For classes, we keep everything except their class decorators.\n        // We need to keep e.g. the ctor args, method names, method decorators\n        // so that the class can be extended in another compilation unit.\n        // We don't keep the class decorators as\n        // 1) they refer to data\n        //   that should not cause a rebuild of downstream compilation units\n        //   (e.g. inline templates of @Component, or @NgModule.declarations)\n        // 2) their data is already captured in TypeSummaries, e.g. DirectiveSummary.\n        const clone: {[key: string]: any} = {};\n        Object.keys(metadata).forEach((propName) => {\n          if (propName !== 'decorators') {\n            clone[propName] = metadata[propName];\n          }\n        });\n        metadata = clone;\n      } else if (isCall(metadata)) {\n        if (!isFunctionCall(metadata) && !isMethodCallOnVariable(metadata)) {\n          // Don't store complex calls as we won't be able to simplify them anyways later on.\n          metadata = {\n            __symbolic: 'error',\n            message: 'Complex function calls are not supported.',\n          };\n        }\n      }\n      // Note: We need to keep storing ctor calls for e.g.\n      // `export const x = new InjectionToken(...)`\n      unprocessedSummary.metadata = metadata;\n      processedSummary.metadata = this.processValue(metadata, SerializationFlags.ResolveValue);\n      if (metadata instanceof StaticSymbol &&\n          this.summaryResolver.isLibraryFile(metadata.filePath)) {\n        const declarationSymbol = this.symbols[this.indexBySymbol.get(metadata) !];\n        if (!isLoweredSymbol(declarationSymbol.name)) {\n          // Note: symbols that were introduced during codegen in the user file can have a reexport\n          // if a user used `export *`. However, we can't rely on this as tsickle will change\n          // `export *` into named exports, using only the information from the typechecker.\n          // As we introduce the new symbols after typecheck, Tsickle does not know about them,\n          // and omits them when expanding `export *`.\n          // So we have to keep reexporting these symbols manually via .ngfactory files.\n          this.reexportedBy.set(declarationSymbol, summary.symbol);\n        }\n      }\n    }\n    if (!unprocessedSummary.type && summary.type) {\n      unprocessedSummary.type = summary.type;\n      // Note: We don't add the summaries of all referenced symbols as for the ResolvedSymbols,\n      // as the type summaries already contain the transitive data that they require\n      // (in a minimal way).\n      processedSummary.type = this.processValue(summary.type, SerializationFlags.None);\n      // except for reexported directives / pipes, so we need to store\n      // their summaries explicitly.\n      if (summary.type.summaryKind === CompileSummaryKind.NgModule) {\n        const ngModuleSummary = <CompileNgModuleSummary>summary.type;\n        ngModuleSummary.exportedDirectives.concat(ngModuleSummary.exportedPipes).forEach((id) => {\n          const symbol: StaticSymbol = id.reference;\n          if (this.summaryResolver.isLibraryFile(symbol.filePath) &&\n              !this.unprocessedSymbolSummariesBySymbol.has(symbol)) {\n            const summary = this.summaryResolver.resolveSummary(symbol);\n            if (summary) {\n              this.addSummary(summary);\n            }\n          }\n        });\n      }\n    }\n  }\n\n  serialize(): {json: string, exportAs: {symbol: StaticSymbol, exportAs: string}[]} {\n    const exportAs: {symbol: StaticSymbol, exportAs: string}[] = [];\n    const json = JSON.stringify({\n      moduleName: this.moduleName,\n      summaries: this.processedSummaries,\n      symbols: this.symbols.map((symbol, index) => {\n        symbol.assertNoMembers();\n        let importAs: string|number = undefined !;\n        if (this.summaryResolver.isLibraryFile(symbol.filePath)) {\n          const reexportSymbol = this.reexportedBy.get(symbol);\n          if (reexportSymbol) {\n            importAs = this.indexBySymbol.get(reexportSymbol) !;\n          } else {\n            const summary = this.unprocessedSymbolSummariesBySymbol.get(symbol);\n            if (!summary || !summary.metadata || summary.metadata.__symbolic !== 'interface') {\n              importAs = `${symbol.name}_${index}`;\n              exportAs.push({symbol, exportAs: importAs});\n            }\n          }\n        }\n        return {\n          __symbol: index,\n          name: symbol.name,\n          filePath: this.summaryResolver.toSummaryFileName(symbol.filePath, this.srcFileName),\n          importAs: importAs\n        };\n      })\n    });\n    return {json, exportAs};\n  }\n\n  private processValue(value: any, flags: SerializationFlags): any {\n    return visitValue(value, this, flags);\n  }\n\n  visitOther(value: any, context: any): any {\n    if (value instanceof StaticSymbol) {\n      let baseSymbol = this.symbolResolver.getStaticSymbol(value.filePath, value.name);\n      const index = this.visitStaticSymbol(baseSymbol, context);\n      return {__symbol: index, members: value.members};\n    }\n  }\n\n  /**\n   * Strip line and character numbers from ngsummaries.\n   * Emitting them causes white spaces changes to retrigger upstream\n   * recompilations in bazel.\n   * TODO: find out a way to have line and character numbers in errors without\n   * excessive recompilation in bazel.\n   */\n  visitStringMap(map: {[key: string]: any}, context: any): any {\n    if (map['__symbolic'] === 'resolved') {\n      return visitValue(map.symbol, this, context);\n    }\n    if (map['__symbolic'] === 'error') {\n      delete map['line'];\n      delete map['character'];\n    }\n    return super.visitStringMap(map, context);\n  }\n\n  /**\n   * Returns null if the options.resolveValue is true, and the summary for the symbol\n   * resolved to a type or could not be resolved.\n   */\n  private visitStaticSymbol(baseSymbol: StaticSymbol, flags: SerializationFlags): number {\n    let index: number|undefined|null = this.indexBySymbol.get(baseSymbol);\n    let summary: Summary<StaticSymbol>|null = null;\n    if (flags & SerializationFlags.ResolveValue &&\n        this.summaryResolver.isLibraryFile(baseSymbol.filePath)) {\n      if (this.unprocessedSymbolSummariesBySymbol.has(baseSymbol)) {\n        // the summary for this symbol was already added\n        // -> nothing to do.\n        return index !;\n      }\n      summary = this.loadSummary(baseSymbol);\n      if (summary && summary.metadata instanceof StaticSymbol) {\n        // The summary is a reexport\n        index = this.visitStaticSymbol(summary.metadata, flags);\n        // reset the summary as it is just a reexport, so we don't want to store it.\n        summary = null;\n      }\n    } else if (index != null) {\n      // Note: == on purpose to compare with undefined!\n      // No summary and the symbol is already added -> nothing to do.\n      return index;\n    }\n    // Note: == on purpose to compare with undefined!\n    if (index == null) {\n      index = this.symbols.length;\n      this.symbols.push(baseSymbol);\n    }\n    this.indexBySymbol.set(baseSymbol, index);\n    if (summary) {\n      this.addSummary(summary);\n    }\n    return index;\n  }\n\n  private loadSummary(symbol: StaticSymbol): Summary<StaticSymbol>|null {\n    let summary = this.summaryResolver.resolveSummary(symbol);\n    if (!summary) {\n      // some symbols might originate from a plain typescript library\n      // that just exported .d.ts and .metadata.json files, i.e. where no summary\n      // files were created.\n      const resolvedSymbol = this.symbolResolver.resolveSymbol(symbol);\n      if (resolvedSymbol) {\n        summary = {symbol: resolvedSymbol.symbol, metadata: resolvedSymbol.metadata};\n      }\n    }\n    return summary;\n  }\n}\n\nclass ForJitSerializer {\n  private data: Array<{\n    summary: CompileTypeSummary,\n    metadata: CompileNgModuleMetadata|CompileDirectiveMetadata|CompilePipeMetadata|\n    CompileTypeMetadata|null,\n    isLibrary: boolean\n  }> = [];\n\n  constructor(\n      private outputCtx: OutputContext, private symbolResolver: StaticSymbolResolver,\n      private summaryResolver: SummaryResolver<StaticSymbol>) {}\n\n  addSourceType(\n      summary: CompileTypeSummary, metadata: CompileNgModuleMetadata|CompileDirectiveMetadata|\n      CompilePipeMetadata|CompileTypeMetadata) {\n    this.data.push({summary, metadata, isLibrary: false});\n  }\n\n  addLibType(summary: CompileTypeSummary) {\n    this.data.push({summary, metadata: null, isLibrary: true});\n  }\n\n  serialize(exportAsArr: {symbol: StaticSymbol, exportAs: string}[]): void {\n    const exportAsBySymbol = new Map<StaticSymbol, string>();\n    for (const {symbol, exportAs} of exportAsArr) {\n      exportAsBySymbol.set(symbol, exportAs);\n    }\n    const ngModuleSymbols = new Set<StaticSymbol>();\n\n    for (const {summary, metadata, isLibrary} of this.data) {\n      if (summary.summaryKind === CompileSummaryKind.NgModule) {\n        // collect the symbols that refer to NgModule classes.\n        // Note: we can't just rely on `summary.type.summaryKind` to determine this as\n        // we don't add the summaries of all referenced symbols when we serialize type summaries.\n        // See serializeSummaries for details.\n        ngModuleSymbols.add(summary.type.reference);\n        const modSummary = <CompileNgModuleSummary>summary;\n        for (const mod of modSummary.modules) {\n          ngModuleSymbols.add(mod.reference);\n        }\n      }\n      if (!isLibrary) {\n        const fnName = summaryForJitName(summary.type.reference.name);\n        createSummaryForJitFunction(\n            this.outputCtx, summary.type.reference,\n            this.serializeSummaryWithDeps(summary, metadata !));\n      }\n    }\n\n    ngModuleSymbols.forEach((ngModuleSymbol) => {\n      if (this.summaryResolver.isLibraryFile(ngModuleSymbol.filePath)) {\n        let exportAs = exportAsBySymbol.get(ngModuleSymbol) || ngModuleSymbol.name;\n        const jitExportAsName = summaryForJitName(exportAs);\n        this.outputCtx.statements.push(o.variable(jitExportAsName)\n                                           .set(this.serializeSummaryRef(ngModuleSymbol))\n                                           .toDeclStmt(null, [o.StmtModifier.Exported]));\n      }\n    });\n  }\n\n  private serializeSummaryWithDeps(\n      summary: CompileTypeSummary, metadata: CompileNgModuleMetadata|CompileDirectiveMetadata|\n      CompilePipeMetadata|CompileTypeMetadata): o.Expression {\n    const expressions: o.Expression[] = [this.serializeSummary(summary)];\n    let providers: CompileProviderMetadata[] = [];\n    if (metadata instanceof CompileNgModuleMetadata) {\n      expressions.push(...\n                       // For directives / pipes, we only add the declared ones,\n                       // and rely on transitively importing NgModules to get the transitive\n                       // summaries.\n                       metadata.declaredDirectives.concat(metadata.declaredPipes)\n                           .map(type => type.reference)\n                           // For modules,\n                           // we also add the summaries for modules\n                           // from libraries.\n                           // This is ok as we produce reexports for all transitive modules.\n                           .concat(metadata.transitiveModule.modules.map(type => type.reference)\n                                       .filter(ref => ref !== metadata.type.reference))\n                           .map((ref) => this.serializeSummaryRef(ref)));\n      // Note: We don't use `NgModuleSummary.providers`, as that one is transitive,\n      // and we already have transitive modules.\n      providers = metadata.providers;\n    } else if (summary.summaryKind === CompileSummaryKind.Directive) {\n      const dirSummary = <CompileDirectiveSummary>summary;\n      providers = dirSummary.providers.concat(dirSummary.viewProviders);\n    }\n    // Note: We can't just refer to the `ngsummary.ts` files for `useClass` providers (as we do for\n    // declaredDirectives / declaredPipes), as we allow\n    // providers without ctor arguments to skip the `@Injectable` decorator,\n    // i.e. we didn't generate .ngsummary.ts files for these.\n    expressions.push(\n        ...providers.filter(provider => !!provider.useClass).map(provider => this.serializeSummary({\n          summaryKind: CompileSummaryKind.Injectable, type: provider.useClass\n        } as CompileTypeSummary)));\n    return o.literalArr(expressions);\n  }\n\n  private serializeSummaryRef(typeSymbol: StaticSymbol): o.Expression {\n    const jitImportedSymbol = this.symbolResolver.getStaticSymbol(\n        summaryForJitFileName(typeSymbol.filePath), summaryForJitName(typeSymbol.name));\n    return this.outputCtx.importExpr(jitImportedSymbol);\n  }\n\n  private serializeSummary(data: {[key: string]: any}): o.Expression {\n    const outputCtx = this.outputCtx;\n\n    class Transformer implements ValueVisitor {\n      visitArray(arr: any[], context: any): any {\n        return o.literalArr(arr.map(entry => visitValue(entry, this, context)));\n      }\n      visitStringMap(map: {[key: string]: any}, context: any): any {\n        return new o.LiteralMapExpr(Object.keys(map).map(\n            (key) => new o.LiteralMapEntry(key, visitValue(map[key], this, context), false)));\n      }\n      visitPrimitive(value: any, context: any): any { return o.literal(value); }\n      visitOther(value: any, context: any): any {\n        if (value instanceof StaticSymbol) {\n          return outputCtx.importExpr(value);\n        } else {\n          throw new Error(`Illegal State: Encountered value ${value}`);\n        }\n      }\n    }\n\n    return visitValue(data, new Transformer(), null);\n  }\n}\n\nclass FromJsonDeserializer extends ValueTransformer {\n  // TODO(issue/24571): remove '!'.\n  private symbols !: StaticSymbol[];\n\n  constructor(\n      private symbolCache: StaticSymbolCache,\n      private summaryResolver: SummaryResolver<StaticSymbol>) {\n    super();\n  }\n\n  deserialize(libraryFileName: string, json: string): {\n    moduleName: string | null,\n    summaries: Summary<StaticSymbol>[],\n    importAs: {symbol: StaticSymbol, importAs: StaticSymbol}[]\n  } {\n    const data: {moduleName: string | null, summaries: any[], symbols: any[]} = JSON.parse(json);\n    const allImportAs: {symbol: StaticSymbol, importAs: StaticSymbol}[] = [];\n    this.symbols = data.symbols.map(\n        (serializedSymbol) => this.symbolCache.get(\n            this.summaryResolver.fromSummaryFileName(serializedSymbol.filePath, libraryFileName),\n            serializedSymbol.name));\n    data.symbols.forEach((serializedSymbol, index) => {\n      const symbol = this.symbols[index];\n      const importAs = serializedSymbol.importAs;\n      if (typeof importAs === 'number') {\n        allImportAs.push({symbol, importAs: this.symbols[importAs]});\n      } else if (typeof importAs === 'string') {\n        allImportAs.push(\n            {symbol, importAs: this.symbolCache.get(ngfactoryFilePath(libraryFileName), importAs)});\n      }\n    });\n    const summaries = visitValue(data.summaries, this, null) as Summary<StaticSymbol>[];\n    return {moduleName: data.moduleName, summaries, importAs: allImportAs};\n  }\n\n  visitStringMap(map: {[key: string]: any}, context: any): any {\n    if ('__symbol' in map) {\n      const baseSymbol = this.symbols[map['__symbol']];\n      const members = map['members'];\n      return members.length ? this.symbolCache.get(baseSymbol.filePath, baseSymbol.name, members) :\n                              baseSymbol;\n    } else {\n      return super.visitStringMap(map, context);\n    }\n  }\n}\n\nfunction isCall(metadata: any): boolean {\n  return metadata && metadata.__symbolic === 'call';\n}\n\nfunction isFunctionCall(metadata: any): boolean {\n  return isCall(metadata) && unwrapResolvedMetadata(metadata.expression) instanceof StaticSymbol;\n}\n\nfunction isMethodCallOnVariable(metadata: any): boolean {\n  return isCall(metadata) && metadata.expression && metadata.expression.__symbolic === 'select' &&\n      unwrapResolvedMetadata(metadata.expression.expression) instanceof StaticSymbol;\n}\n"],"sourceRoot":""}