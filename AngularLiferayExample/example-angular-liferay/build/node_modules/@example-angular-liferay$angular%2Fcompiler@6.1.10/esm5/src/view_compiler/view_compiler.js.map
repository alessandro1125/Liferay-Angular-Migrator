{"version":3,"sources":["../../../../../../../../../../packages/compiler/src/view_compiler/view_compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {CompileDirectiveMetadata, CompilePipeSummary, rendererTypeName, tokenReference, viewClassName} from '../compile_metadata';\nimport {CompileReflector} from '../compile_reflector';\nimport {BindingForm, BuiltinConverter, EventHandlerVars, LocalResolver, convertActionBinding, convertPropertyBinding, convertPropertyBindingBuiltins} from '../compiler_util/expression_converter';\nimport {ArgumentType, BindingFlags, ChangeDetectionStrategy, NodeFlags, QueryBindingType, QueryValueType, ViewFlags} from '../core';\nimport {AST, ASTWithSource, Interpolation} from '../expression_parser/ast';\nimport {Identifiers} from '../identifiers';\nimport {LifecycleHooks} from '../lifecycle_reflector';\nimport {isNgContainer} from '../ml_parser/tags';\nimport * as o from '../output/output_ast';\nimport {convertValueToOutputAst} from '../output/value_util';\nimport {ParseSourceSpan} from '../parse_util';\nimport {AttrAst, BoundDirectivePropertyAst, BoundElementPropertyAst, BoundEventAst, BoundTextAst, DirectiveAst, ElementAst, EmbeddedTemplateAst, NgContentAst, PropertyBindingType, ProviderAst, QueryMatch, ReferenceAst, TemplateAst, TemplateAstVisitor, TextAst, VariableAst, templateVisitAll} from '../template_parser/template_ast';\nimport {OutputContext} from '../util';\n\nimport {componentFactoryResolverProviderDef, depDef, lifecycleHookToNodeFlag, providerDef} from './provider_compiler';\n\nconst CLASS_ATTR = 'class';\nconst STYLE_ATTR = 'style';\nconst IMPLICIT_TEMPLATE_VAR = '\\$implicit';\n\nexport class ViewCompileResult {\n  constructor(public viewClassVar: string, public rendererTypeVar: string) {}\n}\n\nexport class ViewCompiler {\n  constructor(private _reflector: CompileReflector) {}\n\n  compileComponent(\n      outputCtx: OutputContext, component: CompileDirectiveMetadata, template: TemplateAst[],\n      styles: o.Expression, usedPipes: CompilePipeSummary[]): ViewCompileResult {\n    let embeddedViewCount = 0;\n    const staticQueryIds = findStaticQueryIds(template);\n\n    let renderComponentVarName: string = undefined !;\n    if (!component.isHost) {\n      const template = component.template !;\n      const customRenderData: o.LiteralMapEntry[] = [];\n      if (template.animations && template.animations.length) {\n        customRenderData.push(new o.LiteralMapEntry(\n            'animation', convertValueToOutputAst(outputCtx, template.animations), true));\n      }\n\n      const renderComponentVar = o.variable(rendererTypeName(component.type.reference));\n      renderComponentVarName = renderComponentVar.name !;\n      outputCtx.statements.push(\n          renderComponentVar\n              .set(o.importExpr(Identifiers.createRendererType2).callFn([new o.LiteralMapExpr([\n                new o.LiteralMapEntry('encapsulation', o.literal(template.encapsulation), false),\n                new o.LiteralMapEntry('styles', styles, false),\n                new o.LiteralMapEntry('data', new o.LiteralMapExpr(customRenderData), false)\n              ])]))\n              .toDeclStmt(\n                  o.importType(Identifiers.RendererType2),\n                  [o.StmtModifier.Final, o.StmtModifier.Exported]));\n    }\n\n    const viewBuilderFactory = (parent: ViewBuilder | null): ViewBuilder => {\n      const embeddedViewIndex = embeddedViewCount++;\n      return new ViewBuilder(\n          this._reflector, outputCtx, parent, component, embeddedViewIndex, usedPipes,\n          staticQueryIds, viewBuilderFactory);\n    };\n\n    const visitor = viewBuilderFactory(null);\n    visitor.visitAll([], template);\n\n    outputCtx.statements.push(...visitor.build());\n\n    return new ViewCompileResult(visitor.viewName, renderComponentVarName);\n  }\n}\n\ninterface ViewBuilderFactory {\n  (parent: ViewBuilder): ViewBuilder;\n}\n\ninterface UpdateExpression {\n  context: o.Expression;\n  nodeIndex: number;\n  bindingIndex: number;\n  sourceSpan: ParseSourceSpan;\n  value: AST;\n}\n\nconst LOG_VAR = o.variable('_l');\nconst VIEW_VAR = o.variable('_v');\nconst CHECK_VAR = o.variable('_ck');\nconst COMP_VAR = o.variable('_co');\nconst EVENT_NAME_VAR = o.variable('en');\nconst ALLOW_DEFAULT_VAR = o.variable(`ad`);\n\nclass ViewBuilder implements TemplateAstVisitor, LocalResolver {\n  private compType: o.Type;\n  private nodes: (() => {\n    sourceSpan: ParseSourceSpan | null,\n    nodeDef: o.Expression,\n    nodeFlags: NodeFlags, updateDirectives?: UpdateExpression[], updateRenderer?: UpdateExpression[]\n  })[] = [];\n  private purePipeNodeIndices: {[pipeName: string]: number} = Object.create(null);\n  // Need Object.create so that we don't have builtin values...\n  private refNodeIndices: {[refName: string]: number} = Object.create(null);\n  private variables: VariableAst[] = [];\n  private children: ViewBuilder[] = [];\n\n  public readonly viewName: string;\n\n  constructor(\n      private reflector: CompileReflector, private outputCtx: OutputContext,\n      private parent: ViewBuilder|null, private component: CompileDirectiveMetadata,\n      private embeddedViewIndex: number, private usedPipes: CompilePipeSummary[],\n      private staticQueryIds: Map<TemplateAst, StaticAndDynamicQueryIds>,\n      private viewBuilderFactory: ViewBuilderFactory) {\n    // TODO(tbosch): The old view compiler used to use an `any` type\n    // for the context in any embedded view. We keep this behaivor for now\n    // to be able to introduce the new view compiler without too many errors.\n    this.compType = this.embeddedViewIndex > 0 ?\n        o.DYNAMIC_TYPE :\n        o.expressionType(outputCtx.importExpr(this.component.type.reference)) !;\n    this.viewName = viewClassName(this.component.type.reference, this.embeddedViewIndex);\n  }\n\n  visitAll(variables: VariableAst[], astNodes: TemplateAst[]) {\n    this.variables = variables;\n    // create the pipes for the pure pipes immediately, so that we know their indices.\n    if (!this.parent) {\n      this.usedPipes.forEach((pipe) => {\n        if (pipe.pure) {\n          this.purePipeNodeIndices[pipe.name] = this._createPipe(null, pipe);\n        }\n      });\n    }\n\n    if (!this.parent) {\n      const queryIds = staticViewQueryIds(this.staticQueryIds);\n      this.component.viewQueries.forEach((query, queryIndex) => {\n        // Note: queries start with id 1 so we can use the number in a Bloom filter!\n        const queryId = queryIndex + 1;\n        const bindingType = query.first ? QueryBindingType.First : QueryBindingType.All;\n        const flags =\n            NodeFlags.TypeViewQuery | calcStaticDynamicQueryFlags(queryIds, queryId, query.first);\n        this.nodes.push(() => ({\n                          sourceSpan: null,\n                          nodeFlags: flags,\n                          nodeDef: o.importExpr(Identifiers.queryDef).callFn([\n                            o.literal(flags), o.literal(queryId),\n                            new o.LiteralMapExpr([new o.LiteralMapEntry(\n                                query.propertyName, o.literal(bindingType), false)])\n                          ])\n                        }));\n      });\n    }\n    templateVisitAll(this, astNodes);\n    if (this.parent && (astNodes.length === 0 || needsAdditionalRootNode(astNodes))) {\n      // if the view is an embedded view, then we need to add an additional root node in some cases\n      this.nodes.push(() => ({\n                        sourceSpan: null,\n                        nodeFlags: NodeFlags.TypeElement,\n                        nodeDef: o.importExpr(Identifiers.anchorDef).callFn([\n                          o.literal(NodeFlags.None), o.NULL_EXPR, o.NULL_EXPR, o.literal(0)\n                        ])\n                      }));\n    }\n  }\n\n  build(targetStatements: o.Statement[] = []): o.Statement[] {\n    this.children.forEach((child) => child.build(targetStatements));\n\n    const {updateRendererStmts, updateDirectivesStmts, nodeDefExprs} =\n        this._createNodeExpressions();\n\n    const updateRendererFn = this._createUpdateFn(updateRendererStmts);\n    const updateDirectivesFn = this._createUpdateFn(updateDirectivesStmts);\n\n\n    let viewFlags = ViewFlags.None;\n    if (!this.parent && this.component.changeDetection === ChangeDetectionStrategy.OnPush) {\n      viewFlags |= ViewFlags.OnPush;\n    }\n    const viewFactory = new o.DeclareFunctionStmt(\n        this.viewName, [new o.FnParam(LOG_VAR.name !)],\n        [new o.ReturnStatement(o.importExpr(Identifiers.viewDef).callFn([\n          o.literal(viewFlags),\n          o.literalArr(nodeDefExprs),\n          updateDirectivesFn,\n          updateRendererFn,\n        ]))],\n        o.importType(Identifiers.ViewDefinition),\n        this.embeddedViewIndex === 0 ? [o.StmtModifier.Exported] : []);\n\n    targetStatements.push(viewFactory);\n    return targetStatements;\n  }\n\n  private _createUpdateFn(updateStmts: o.Statement[]): o.Expression {\n    let updateFn: o.Expression;\n    if (updateStmts.length > 0) {\n      const preStmts: o.Statement[] = [];\n      if (!this.component.isHost && o.findReadVarNames(updateStmts).has(COMP_VAR.name !)) {\n        preStmts.push(COMP_VAR.set(VIEW_VAR.prop('component')).toDeclStmt(this.compType));\n      }\n      updateFn = o.fn(\n          [\n            new o.FnParam(CHECK_VAR.name !, o.INFERRED_TYPE),\n            new o.FnParam(VIEW_VAR.name !, o.INFERRED_TYPE)\n          ],\n          [...preStmts, ...updateStmts], o.INFERRED_TYPE);\n    } else {\n      updateFn = o.NULL_EXPR;\n    }\n    return updateFn;\n  }\n\n  visitNgContent(ast: NgContentAst, context: any): any {\n    // ngContentDef(ngContentIndex: number, index: number): NodeDef;\n    this.nodes.push(() => ({\n                      sourceSpan: ast.sourceSpan,\n                      nodeFlags: NodeFlags.TypeNgContent,\n                      nodeDef: o.importExpr(Identifiers.ngContentDef).callFn([\n                        o.literal(ast.ngContentIndex), o.literal(ast.index)\n                      ])\n                    }));\n  }\n\n  visitText(ast: TextAst, context: any): any {\n    // Static text nodes have no check function\n    const checkIndex = -1;\n    this.nodes.push(() => ({\n                      sourceSpan: ast.sourceSpan,\n                      nodeFlags: NodeFlags.TypeText,\n                      nodeDef: o.importExpr(Identifiers.textDef).callFn([\n                        o.literal(checkIndex),\n                        o.literal(ast.ngContentIndex),\n                        o.literalArr([o.literal(ast.value)]),\n                      ])\n                    }));\n  }\n\n  visitBoundText(ast: BoundTextAst, context: any): any {\n    const nodeIndex = this.nodes.length;\n    // reserve the space in the nodeDefs array\n    this.nodes.push(null !);\n\n    const astWithSource = <ASTWithSource>ast.value;\n    const inter = <Interpolation>astWithSource.ast;\n\n    const updateRendererExpressions = inter.expressions.map(\n        (expr, bindingIndex) => this._preprocessUpdateExpression(\n            {nodeIndex, bindingIndex, sourceSpan: ast.sourceSpan, context: COMP_VAR, value: expr}));\n\n    // Check index is the same as the node index during compilation\n    // They might only differ at runtime\n    const checkIndex = nodeIndex;\n\n    this.nodes[nodeIndex] = () => ({\n      sourceSpan: ast.sourceSpan,\n      nodeFlags: NodeFlags.TypeText,\n      nodeDef: o.importExpr(Identifiers.textDef).callFn([\n        o.literal(checkIndex),\n        o.literal(ast.ngContentIndex),\n        o.literalArr(inter.strings.map(s => o.literal(s))),\n      ]),\n      updateRenderer: updateRendererExpressions\n    });\n  }\n\n  visitEmbeddedTemplate(ast: EmbeddedTemplateAst, context: any): any {\n    const nodeIndex = this.nodes.length;\n    // reserve the space in the nodeDefs array\n    this.nodes.push(null !);\n\n    const {flags, queryMatchesExpr, hostEvents} = this._visitElementOrTemplate(nodeIndex, ast);\n\n    const childVisitor = this.viewBuilderFactory(this);\n    this.children.push(childVisitor);\n    childVisitor.visitAll(ast.variables, ast.children);\n\n    const childCount = this.nodes.length - nodeIndex - 1;\n\n    // anchorDef(\n    //   flags: NodeFlags, matchedQueries: [string, QueryValueType][], ngContentIndex: number,\n    //   childCount: number, handleEventFn?: ElementHandleEventFn, templateFactory?:\n    //   ViewDefinitionFactory): NodeDef;\n    this.nodes[nodeIndex] = () => ({\n      sourceSpan: ast.sourceSpan,\n      nodeFlags: NodeFlags.TypeElement | flags,\n      nodeDef: o.importExpr(Identifiers.anchorDef).callFn([\n        o.literal(flags),\n        queryMatchesExpr,\n        o.literal(ast.ngContentIndex),\n        o.literal(childCount),\n        this._createElementHandleEventFn(nodeIndex, hostEvents),\n        o.variable(childVisitor.viewName),\n      ])\n    });\n  }\n\n  visitElement(ast: ElementAst, context: any): any {\n    const nodeIndex = this.nodes.length;\n    // reserve the space in the nodeDefs array so we can add children\n    this.nodes.push(null !);\n\n    // Using a null element name creates an anchor.\n    const elName: string|null = isNgContainer(ast.name) ? null : ast.name;\n\n    const {flags, usedEvents, queryMatchesExpr, hostBindings: dirHostBindings, hostEvents} =\n        this._visitElementOrTemplate(nodeIndex, ast);\n\n    let inputDefs: o.Expression[] = [];\n    let updateRendererExpressions: UpdateExpression[] = [];\n    let outputDefs: o.Expression[] = [];\n    if (elName) {\n      const hostBindings: any[] = ast.inputs\n                                      .map((inputAst) => ({\n                                             context: COMP_VAR as o.Expression,\n                                             inputAst,\n                                             dirAst: null as any,\n                                           }))\n                                      .concat(dirHostBindings);\n      if (hostBindings.length) {\n        updateRendererExpressions =\n            hostBindings.map((hostBinding, bindingIndex) => this._preprocessUpdateExpression({\n              context: hostBinding.context,\n              nodeIndex,\n              bindingIndex,\n              sourceSpan: hostBinding.inputAst.sourceSpan,\n              value: hostBinding.inputAst.value\n            }));\n        inputDefs = hostBindings.map(\n            hostBinding => elementBindingDef(hostBinding.inputAst, hostBinding.dirAst));\n      }\n      outputDefs = usedEvents.map(\n          ([target, eventName]) => o.literalArr([o.literal(target), o.literal(eventName)]));\n    }\n\n    templateVisitAll(this, ast.children);\n\n    const childCount = this.nodes.length - nodeIndex - 1;\n\n    const compAst = ast.directives.find(dirAst => dirAst.directive.isComponent);\n    let compRendererType = o.NULL_EXPR as o.Expression;\n    let compView = o.NULL_EXPR as o.Expression;\n    if (compAst) {\n      compView = this.outputCtx.importExpr(compAst.directive.componentViewType);\n      compRendererType = this.outputCtx.importExpr(compAst.directive.rendererType);\n    }\n\n    // Check index is the same as the node index during compilation\n    // They might only differ at runtime\n    const checkIndex = nodeIndex;\n\n    this.nodes[nodeIndex] = () => ({\n      sourceSpan: ast.sourceSpan,\n      nodeFlags: NodeFlags.TypeElement | flags,\n      nodeDef: o.importExpr(Identifiers.elementDef).callFn([\n        o.literal(checkIndex),\n        o.literal(flags),\n        queryMatchesExpr,\n        o.literal(ast.ngContentIndex),\n        o.literal(childCount),\n        o.literal(elName),\n        elName ? fixedAttrsDef(ast) : o.NULL_EXPR,\n        inputDefs.length ? o.literalArr(inputDefs) : o.NULL_EXPR,\n        outputDefs.length ? o.literalArr(outputDefs) : o.NULL_EXPR,\n        this._createElementHandleEventFn(nodeIndex, hostEvents),\n        compView,\n        compRendererType,\n      ]),\n      updateRenderer: updateRendererExpressions\n    });\n  }\n\n  private _visitElementOrTemplate(nodeIndex: number, ast: {\n    hasViewContainer: boolean,\n    outputs: BoundEventAst[],\n    directives: DirectiveAst[],\n    providers: ProviderAst[],\n    references: ReferenceAst[],\n    queryMatches: QueryMatch[]\n  }): {\n    flags: NodeFlags,\n    usedEvents: [string | null, string][],\n    queryMatchesExpr: o.Expression,\n    hostBindings:\n        {context: o.Expression, inputAst: BoundElementPropertyAst, dirAst: DirectiveAst}[],\n    hostEvents: {context: o.Expression, eventAst: BoundEventAst, dirAst: DirectiveAst}[],\n  } {\n    let flags = NodeFlags.None;\n    if (ast.hasViewContainer) {\n      flags |= NodeFlags.EmbeddedViews;\n    }\n    const usedEvents = new Map<string, [string | null, string]>();\n    ast.outputs.forEach((event) => {\n      const {name, target} = elementEventNameAndTarget(event, null);\n      usedEvents.set(elementEventFullName(target, name), [target, name]);\n    });\n    ast.directives.forEach((dirAst) => {\n      dirAst.hostEvents.forEach((event) => {\n        const {name, target} = elementEventNameAndTarget(event, dirAst);\n        usedEvents.set(elementEventFullName(target, name), [target, name]);\n      });\n    });\n    const hostBindings:\n        {context: o.Expression, inputAst: BoundElementPropertyAst, dirAst: DirectiveAst}[] = [];\n    const hostEvents: {context: o.Expression, eventAst: BoundEventAst, dirAst: DirectiveAst}[] = [];\n    this._visitComponentFactoryResolverProvider(ast.directives);\n\n    ast.providers.forEach((providerAst, providerIndex) => {\n      let dirAst: DirectiveAst = undefined !;\n      let dirIndex: number = undefined !;\n      ast.directives.forEach((localDirAst, i) => {\n        if (localDirAst.directive.type.reference === tokenReference(providerAst.token)) {\n          dirAst = localDirAst;\n          dirIndex = i;\n        }\n      });\n      if (dirAst) {\n        const {hostBindings: dirHostBindings, hostEvents: dirHostEvents} = this._visitDirective(\n            providerAst, dirAst, dirIndex, nodeIndex, ast.references, ast.queryMatches, usedEvents,\n            this.staticQueryIds.get(<any>ast) !);\n        hostBindings.push(...dirHostBindings);\n        hostEvents.push(...dirHostEvents);\n      } else {\n        this._visitProvider(providerAst, ast.queryMatches);\n      }\n    });\n\n    let queryMatchExprs: o.Expression[] = [];\n    ast.queryMatches.forEach((match) => {\n      let valueType: QueryValueType = undefined !;\n      if (tokenReference(match.value) ===\n          this.reflector.resolveExternalReference(Identifiers.ElementRef)) {\n        valueType = QueryValueType.ElementRef;\n      } else if (\n          tokenReference(match.value) ===\n          this.reflector.resolveExternalReference(Identifiers.ViewContainerRef)) {\n        valueType = QueryValueType.ViewContainerRef;\n      } else if (\n          tokenReference(match.value) ===\n          this.reflector.resolveExternalReference(Identifiers.TemplateRef)) {\n        valueType = QueryValueType.TemplateRef;\n      }\n      if (valueType != null) {\n        queryMatchExprs.push(o.literalArr([o.literal(match.queryId), o.literal(valueType)]));\n      }\n    });\n    ast.references.forEach((ref) => {\n      let valueType: QueryValueType = undefined !;\n      if (!ref.value) {\n        valueType = QueryValueType.RenderElement;\n      } else if (\n          tokenReference(ref.value) ===\n          this.reflector.resolveExternalReference(Identifiers.TemplateRef)) {\n        valueType = QueryValueType.TemplateRef;\n      }\n      if (valueType != null) {\n        this.refNodeIndices[ref.name] = nodeIndex;\n        queryMatchExprs.push(o.literalArr([o.literal(ref.name), o.literal(valueType)]));\n      }\n    });\n    ast.outputs.forEach((outputAst) => {\n      hostEvents.push({context: COMP_VAR, eventAst: outputAst, dirAst: null !});\n    });\n\n    return {\n      flags,\n      usedEvents: Array.from(usedEvents.values()),\n      queryMatchesExpr: queryMatchExprs.length ? o.literalArr(queryMatchExprs) : o.NULL_EXPR,\n      hostBindings,\n      hostEvents: hostEvents\n    };\n  }\n\n  private _visitDirective(\n      providerAst: ProviderAst, dirAst: DirectiveAst, directiveIndex: number,\n      elementNodeIndex: number, refs: ReferenceAst[], queryMatches: QueryMatch[],\n      usedEvents: Map<string, any>, queryIds: StaticAndDynamicQueryIds): {\n    hostBindings:\n        {context: o.Expression, inputAst: BoundElementPropertyAst, dirAst: DirectiveAst}[],\n    hostEvents: {context: o.Expression, eventAst: BoundEventAst, dirAst: DirectiveAst}[]\n  } {\n    const nodeIndex = this.nodes.length;\n    // reserve the space in the nodeDefs array so we can add children\n    this.nodes.push(null !);\n\n    dirAst.directive.queries.forEach((query, queryIndex) => {\n      const queryId = dirAst.contentQueryStartId + queryIndex;\n      const flags =\n          NodeFlags.TypeContentQuery | calcStaticDynamicQueryFlags(queryIds, queryId, query.first);\n      const bindingType = query.first ? QueryBindingType.First : QueryBindingType.All;\n      this.nodes.push(() => ({\n                        sourceSpan: dirAst.sourceSpan,\n                        nodeFlags: flags,\n                        nodeDef: o.importExpr(Identifiers.queryDef).callFn([\n                          o.literal(flags), o.literal(queryId),\n                          new o.LiteralMapExpr([new o.LiteralMapEntry(\n                              query.propertyName, o.literal(bindingType), false)])\n                        ]),\n                      }));\n    });\n\n    // Note: the operation below might also create new nodeDefs,\n    // but we don't want them to be a child of a directive,\n    // as they might be a provider/pipe on their own.\n    // I.e. we only allow queries as children of directives nodes.\n    const childCount = this.nodes.length - nodeIndex - 1;\n\n    let {flags, queryMatchExprs, providerExpr, depsExpr} =\n        this._visitProviderOrDirective(providerAst, queryMatches);\n\n    refs.forEach((ref) => {\n      if (ref.value && tokenReference(ref.value) === tokenReference(providerAst.token)) {\n        this.refNodeIndices[ref.name] = nodeIndex;\n        queryMatchExprs.push(\n            o.literalArr([o.literal(ref.name), o.literal(QueryValueType.Provider)]));\n      }\n    });\n\n    if (dirAst.directive.isComponent) {\n      flags |= NodeFlags.Component;\n    }\n\n    const inputDefs = dirAst.inputs.map((inputAst, inputIndex) => {\n      const mapValue = o.literalArr([o.literal(inputIndex), o.literal(inputAst.directiveName)]);\n      // Note: it's important to not quote the key so that we can capture renames by minifiers!\n      return new o.LiteralMapEntry(inputAst.directiveName, mapValue, false);\n    });\n\n    const outputDefs: o.LiteralMapEntry[] = [];\n    const dirMeta = dirAst.directive;\n    Object.keys(dirMeta.outputs).forEach((propName) => {\n      const eventName = dirMeta.outputs[propName];\n      if (usedEvents.has(eventName)) {\n        // Note: it's important to not quote the key so that we can capture renames by minifiers!\n        outputDefs.push(new o.LiteralMapEntry(propName, o.literal(eventName), false));\n      }\n    });\n    let updateDirectiveExpressions: UpdateExpression[] = [];\n    if (dirAst.inputs.length || (flags & (NodeFlags.DoCheck | NodeFlags.OnInit)) > 0) {\n      updateDirectiveExpressions =\n          dirAst.inputs.map((input, bindingIndex) => this._preprocessUpdateExpression({\n            nodeIndex,\n            bindingIndex,\n            sourceSpan: input.sourceSpan,\n            context: COMP_VAR,\n            value: input.value\n          }));\n    }\n\n    const dirContextExpr =\n        o.importExpr(Identifiers.nodeValue).callFn([VIEW_VAR, o.literal(nodeIndex)]);\n    const hostBindings = dirAst.hostProperties.map((inputAst) => ({\n                                                     context: dirContextExpr,\n                                                     dirAst,\n                                                     inputAst,\n                                                   }));\n    const hostEvents = dirAst.hostEvents.map((hostEventAst) => ({\n                                               context: dirContextExpr,\n                                               eventAst: hostEventAst, dirAst,\n                                             }));\n\n    // Check index is the same as the node index during compilation\n    // They might only differ at runtime\n    const checkIndex = nodeIndex;\n\n    this.nodes[nodeIndex] = () => ({\n      sourceSpan: dirAst.sourceSpan,\n      nodeFlags: NodeFlags.TypeDirective | flags,\n      nodeDef: o.importExpr(Identifiers.directiveDef).callFn([\n        o.literal(checkIndex),\n        o.literal(flags),\n        queryMatchExprs.length ? o.literalArr(queryMatchExprs) : o.NULL_EXPR,\n        o.literal(childCount),\n        providerExpr,\n        depsExpr,\n        inputDefs.length ? new o.LiteralMapExpr(inputDefs) : o.NULL_EXPR,\n        outputDefs.length ? new o.LiteralMapExpr(outputDefs) : o.NULL_EXPR,\n      ]),\n      updateDirectives: updateDirectiveExpressions,\n      directive: dirAst.directive.type,\n    });\n\n    return {hostBindings, hostEvents};\n  }\n\n  private _visitProvider(providerAst: ProviderAst, queryMatches: QueryMatch[]): void {\n    this._addProviderNode(this._visitProviderOrDirective(providerAst, queryMatches));\n  }\n\n  private _visitComponentFactoryResolverProvider(directives: DirectiveAst[]) {\n    const componentDirMeta = directives.find(dirAst => dirAst.directive.isComponent);\n    if (componentDirMeta && componentDirMeta.directive.entryComponents.length) {\n      const {providerExpr, depsExpr, flags, tokenExpr} = componentFactoryResolverProviderDef(\n          this.reflector, this.outputCtx, NodeFlags.PrivateProvider,\n          componentDirMeta.directive.entryComponents);\n      this._addProviderNode({\n        providerExpr,\n        depsExpr,\n        flags,\n        tokenExpr,\n        queryMatchExprs: [],\n        sourceSpan: componentDirMeta.sourceSpan\n      });\n    }\n  }\n\n  private _addProviderNode(data: {\n    flags: NodeFlags,\n    queryMatchExprs: o.Expression[],\n    providerExpr: o.Expression,\n    depsExpr: o.Expression,\n    tokenExpr: o.Expression,\n    sourceSpan: ParseSourceSpan\n  }) {\n    const nodeIndex = this.nodes.length;\n    // providerDef(\n    //   flags: NodeFlags, matchedQueries: [string, QueryValueType][], token:any,\n    //   value: any, deps: ([DepFlags, any] | any)[]): NodeDef;\n    this.nodes.push(\n        () => ({\n          sourceSpan: data.sourceSpan,\n          nodeFlags: data.flags,\n          nodeDef: o.importExpr(Identifiers.providerDef).callFn([\n            o.literal(data.flags),\n            data.queryMatchExprs.length ? o.literalArr(data.queryMatchExprs) : o.NULL_EXPR,\n            data.tokenExpr, data.providerExpr, data.depsExpr\n          ])\n        }));\n  }\n\n  private _visitProviderOrDirective(providerAst: ProviderAst, queryMatches: QueryMatch[]): {\n    flags: NodeFlags,\n    tokenExpr: o.Expression,\n    sourceSpan: ParseSourceSpan,\n    queryMatchExprs: o.Expression[],\n    providerExpr: o.Expression,\n    depsExpr: o.Expression\n  } {\n    let flags = NodeFlags.None;\n    let queryMatchExprs: o.Expression[] = [];\n\n    queryMatches.forEach((match) => {\n      if (tokenReference(match.value) === tokenReference(providerAst.token)) {\n        queryMatchExprs.push(\n            o.literalArr([o.literal(match.queryId), o.literal(QueryValueType.Provider)]));\n      }\n    });\n    const {providerExpr, depsExpr, flags: providerFlags, tokenExpr} =\n        providerDef(this.outputCtx, providerAst);\n    return {\n      flags: flags | providerFlags,\n      queryMatchExprs,\n      providerExpr,\n      depsExpr,\n      tokenExpr,\n      sourceSpan: providerAst.sourceSpan\n    };\n  }\n\n  getLocal(name: string): o.Expression|null {\n    if (name == EventHandlerVars.event.name) {\n      return EventHandlerVars.event;\n    }\n    let currViewExpr: o.Expression = VIEW_VAR;\n    for (let currBuilder: ViewBuilder|null = this; currBuilder; currBuilder = currBuilder.parent,\n                          currViewExpr = currViewExpr.prop('parent').cast(o.DYNAMIC_TYPE)) {\n      // check references\n      const refNodeIndex = currBuilder.refNodeIndices[name];\n      if (refNodeIndex != null) {\n        return o.importExpr(Identifiers.nodeValue).callFn([currViewExpr, o.literal(refNodeIndex)]);\n      }\n\n      // check variables\n      const varAst = currBuilder.variables.find((varAst) => varAst.name === name);\n      if (varAst) {\n        const varValue = varAst.value || IMPLICIT_TEMPLATE_VAR;\n        return currViewExpr.prop('context').prop(varValue);\n      }\n    }\n    return null;\n  }\n\n  private _createLiteralArrayConverter(sourceSpan: ParseSourceSpan, argCount: number):\n      BuiltinConverter {\n    if (argCount === 0) {\n      const valueExpr = o.importExpr(Identifiers.EMPTY_ARRAY);\n      return () => valueExpr;\n    }\n\n    const checkIndex = this.nodes.length;\n\n    this.nodes.push(() => ({\n                      sourceSpan,\n                      nodeFlags: NodeFlags.TypePureArray,\n                      nodeDef: o.importExpr(Identifiers.pureArrayDef).callFn([\n                        o.literal(checkIndex),\n                        o.literal(argCount),\n                      ])\n                    }));\n\n    return (args: o.Expression[]) => callCheckStmt(checkIndex, args);\n  }\n\n  private _createLiteralMapConverter(\n      sourceSpan: ParseSourceSpan, keys: {key: string, quoted: boolean}[]): BuiltinConverter {\n    if (keys.length === 0) {\n      const valueExpr = o.importExpr(Identifiers.EMPTY_MAP);\n      return () => valueExpr;\n    }\n\n    const map = o.literalMap(keys.map((e, i) => ({...e, value: o.literal(i)})));\n    const checkIndex = this.nodes.length;\n    this.nodes.push(() => ({\n                      sourceSpan,\n                      nodeFlags: NodeFlags.TypePureObject,\n                      nodeDef: o.importExpr(Identifiers.pureObjectDef).callFn([\n                        o.literal(checkIndex),\n                        map,\n                      ])\n                    }));\n\n    return (args: o.Expression[]) => callCheckStmt(checkIndex, args);\n  }\n\n  private _createPipeConverter(expression: UpdateExpression, name: string, argCount: number):\n      BuiltinConverter {\n    const pipe = this.usedPipes.find((pipeSummary) => pipeSummary.name === name) !;\n    if (pipe.pure) {\n      const checkIndex = this.nodes.length;\n      this.nodes.push(() => ({\n                        sourceSpan: expression.sourceSpan,\n                        nodeFlags: NodeFlags.TypePurePipe,\n                        nodeDef: o.importExpr(Identifiers.purePipeDef).callFn([\n                          o.literal(checkIndex),\n                          o.literal(argCount),\n                        ])\n                      }));\n\n      // find underlying pipe in the component view\n      let compViewExpr: o.Expression = VIEW_VAR;\n      let compBuilder: ViewBuilder = this;\n      while (compBuilder.parent) {\n        compBuilder = compBuilder.parent;\n        compViewExpr = compViewExpr.prop('parent').cast(o.DYNAMIC_TYPE);\n      }\n      const pipeNodeIndex = compBuilder.purePipeNodeIndices[name];\n      const pipeValueExpr: o.Expression =\n          o.importExpr(Identifiers.nodeValue).callFn([compViewExpr, o.literal(pipeNodeIndex)]);\n\n      return (args: o.Expression[]) => callUnwrapValue(\n                 expression.nodeIndex, expression.bindingIndex,\n                 callCheckStmt(checkIndex, [pipeValueExpr].concat(args)));\n    } else {\n      const nodeIndex = this._createPipe(expression.sourceSpan, pipe);\n      const nodeValueExpr =\n          o.importExpr(Identifiers.nodeValue).callFn([VIEW_VAR, o.literal(nodeIndex)]);\n\n      return (args: o.Expression[]) => callUnwrapValue(\n                 expression.nodeIndex, expression.bindingIndex,\n                 nodeValueExpr.callMethod('transform', args));\n    }\n  }\n\n  private _createPipe(sourceSpan: ParseSourceSpan|null, pipe: CompilePipeSummary): number {\n    const nodeIndex = this.nodes.length;\n    let flags = NodeFlags.None;\n    pipe.type.lifecycleHooks.forEach((lifecycleHook) => {\n      // for pipes, we only support ngOnDestroy\n      if (lifecycleHook === LifecycleHooks.OnDestroy) {\n        flags |= lifecycleHookToNodeFlag(lifecycleHook);\n      }\n    });\n\n    const depExprs = pipe.type.diDeps.map((diDep) => depDef(this.outputCtx, diDep));\n    // function pipeDef(\n    //   flags: NodeFlags, ctor: any, deps: ([DepFlags, any] | any)[]): NodeDef\n    this.nodes.push(\n        () => ({\n          sourceSpan,\n          nodeFlags: NodeFlags.TypePipe,\n          nodeDef: o.importExpr(Identifiers.pipeDef).callFn([\n            o.literal(flags), this.outputCtx.importExpr(pipe.type.reference), o.literalArr(depExprs)\n          ])\n        }));\n    return nodeIndex;\n  }\n\n  /**\n   * For the AST in `UpdateExpression.value`:\n   * - create nodes for pipes, literal arrays and, literal maps,\n   * - update the AST to replace pipes, literal arrays and, literal maps with calls to check fn.\n   *\n   * WARNING: This might create new nodeDefs (for pipes and literal arrays and literal maps)!\n   */\n  private _preprocessUpdateExpression(expression: UpdateExpression): UpdateExpression {\n    return {\n      nodeIndex: expression.nodeIndex,\n      bindingIndex: expression.bindingIndex,\n      sourceSpan: expression.sourceSpan,\n      context: expression.context,\n      value: convertPropertyBindingBuiltins(\n          {\n            createLiteralArrayConverter: (argCount: number) => this._createLiteralArrayConverter(\n                                             expression.sourceSpan, argCount),\n            createLiteralMapConverter:\n                (keys: {key: string, quoted: boolean}[]) =>\n                    this._createLiteralMapConverter(expression.sourceSpan, keys),\n            createPipeConverter: (name: string, argCount: number) =>\n                                     this._createPipeConverter(expression, name, argCount)\n          },\n          expression.value)\n    };\n  }\n\n  private _createNodeExpressions(): {\n    updateRendererStmts: o.Statement[],\n    updateDirectivesStmts: o.Statement[],\n    nodeDefExprs: o.Expression[]\n  } {\n    const self = this;\n    let updateBindingCount = 0;\n    const updateRendererStmts: o.Statement[] = [];\n    const updateDirectivesStmts: o.Statement[] = [];\n    const nodeDefExprs = this.nodes.map((factory, nodeIndex) => {\n      const {nodeDef, nodeFlags, updateDirectives, updateRenderer, sourceSpan} = factory();\n      if (updateRenderer) {\n        updateRendererStmts.push(\n            ...createUpdateStatements(nodeIndex, sourceSpan, updateRenderer, false));\n      }\n      if (updateDirectives) {\n        updateDirectivesStmts.push(...createUpdateStatements(\n            nodeIndex, sourceSpan, updateDirectives,\n            (nodeFlags & (NodeFlags.DoCheck | NodeFlags.OnInit)) > 0));\n      }\n      // We use a comma expression to call the log function before\n      // the nodeDef function, but still use the result of the nodeDef function\n      // as the value.\n      // Note: We only add the logger to elements / text nodes,\n      // so we don't generate too much code.\n      const logWithNodeDef = nodeFlags & NodeFlags.CatRenderNode ?\n          new o.CommaExpr([LOG_VAR.callFn([]).callFn([]), nodeDef]) :\n          nodeDef;\n      return o.applySourceSpanToExpressionIfNeeded(logWithNodeDef, sourceSpan);\n    });\n    return {updateRendererStmts, updateDirectivesStmts, nodeDefExprs};\n\n    function createUpdateStatements(\n        nodeIndex: number, sourceSpan: ParseSourceSpan | null, expressions: UpdateExpression[],\n        allowEmptyExprs: boolean): o.Statement[] {\n      const updateStmts: o.Statement[] = [];\n      const exprs = expressions.map(({sourceSpan, context, value}) => {\n        const bindingId = `${updateBindingCount++}`;\n        const nameResolver = context === COMP_VAR ? self : null;\n        const {stmts, currValExpr} =\n            convertPropertyBinding(nameResolver, context, value, bindingId, BindingForm.General);\n        updateStmts.push(...stmts.map(\n            (stmt: o.Statement) => o.applySourceSpanToStatementIfNeeded(stmt, sourceSpan)));\n        return o.applySourceSpanToExpressionIfNeeded(currValExpr, sourceSpan);\n      });\n      if (expressions.length || allowEmptyExprs) {\n        updateStmts.push(o.applySourceSpanToStatementIfNeeded(\n            callCheckStmt(nodeIndex, exprs).toStmt(), sourceSpan));\n      }\n      return updateStmts;\n    }\n  }\n\n  private _createElementHandleEventFn(\n      nodeIndex: number,\n      handlers: {context: o.Expression, eventAst: BoundEventAst, dirAst: DirectiveAst}[]) {\n    const handleEventStmts: o.Statement[] = [];\n    let handleEventBindingCount = 0;\n    handlers.forEach(({context, eventAst, dirAst}) => {\n      const bindingId = `${handleEventBindingCount++}`;\n      const nameResolver = context === COMP_VAR ? this : null;\n      const {stmts, allowDefault} =\n          convertActionBinding(nameResolver, context, eventAst.handler, bindingId);\n      const trueStmts = stmts;\n      if (allowDefault) {\n        trueStmts.push(ALLOW_DEFAULT_VAR.set(allowDefault.and(ALLOW_DEFAULT_VAR)).toStmt());\n      }\n      const {target: eventTarget, name: eventName} = elementEventNameAndTarget(eventAst, dirAst);\n      const fullEventName = elementEventFullName(eventTarget, eventName);\n      handleEventStmts.push(o.applySourceSpanToStatementIfNeeded(\n          new o.IfStmt(o.literal(fullEventName).identical(EVENT_NAME_VAR), trueStmts),\n          eventAst.sourceSpan));\n    });\n    let handleEventFn: o.Expression;\n    if (handleEventStmts.length > 0) {\n      const preStmts: o.Statement[] =\n          [ALLOW_DEFAULT_VAR.set(o.literal(true)).toDeclStmt(o.BOOL_TYPE)];\n      if (!this.component.isHost && o.findReadVarNames(handleEventStmts).has(COMP_VAR.name !)) {\n        preStmts.push(COMP_VAR.set(VIEW_VAR.prop('component')).toDeclStmt(this.compType));\n      }\n      handleEventFn = o.fn(\n          [\n            new o.FnParam(VIEW_VAR.name !, o.INFERRED_TYPE),\n            new o.FnParam(EVENT_NAME_VAR.name !, o.INFERRED_TYPE),\n            new o.FnParam(EventHandlerVars.event.name !, o.INFERRED_TYPE)\n          ],\n          [...preStmts, ...handleEventStmts, new o.ReturnStatement(ALLOW_DEFAULT_VAR)],\n          o.INFERRED_TYPE);\n    } else {\n      handleEventFn = o.NULL_EXPR;\n    }\n    return handleEventFn;\n  }\n\n  visitDirective(ast: DirectiveAst, context: {usedEvents: Set<string>}): any {}\n  visitDirectiveProperty(ast: BoundDirectivePropertyAst, context: any): any {}\n  visitReference(ast: ReferenceAst, context: any): any {}\n  visitVariable(ast: VariableAst, context: any): any {}\n  visitEvent(ast: BoundEventAst, context: any): any {}\n  visitElementProperty(ast: BoundElementPropertyAst, context: any): any {}\n  visitAttr(ast: AttrAst, context: any): any {}\n}\n\nfunction needsAdditionalRootNode(astNodes: TemplateAst[]): boolean {\n  const lastAstNode = astNodes[astNodes.length - 1];\n  if (lastAstNode instanceof EmbeddedTemplateAst) {\n    return lastAstNode.hasViewContainer;\n  }\n\n  if (lastAstNode instanceof ElementAst) {\n    if (isNgContainer(lastAstNode.name) && lastAstNode.children.length) {\n      return needsAdditionalRootNode(lastAstNode.children);\n    }\n    return lastAstNode.hasViewContainer;\n  }\n\n  return lastAstNode instanceof NgContentAst;\n}\n\n\nfunction elementBindingDef(inputAst: BoundElementPropertyAst, dirAst: DirectiveAst): o.Expression {\n  switch (inputAst.type) {\n    case PropertyBindingType.Attribute:\n      return o.literalArr([\n        o.literal(BindingFlags.TypeElementAttribute), o.literal(inputAst.name),\n        o.literal(inputAst.securityContext)\n      ]);\n    case PropertyBindingType.Property:\n      return o.literalArr([\n        o.literal(BindingFlags.TypeProperty), o.literal(inputAst.name),\n        o.literal(inputAst.securityContext)\n      ]);\n    case PropertyBindingType.Animation:\n      const bindingType = BindingFlags.TypeProperty |\n          (dirAst && dirAst.directive.isComponent ? BindingFlags.SyntheticHostProperty :\n                                                    BindingFlags.SyntheticProperty);\n      return o.literalArr([\n        o.literal(bindingType), o.literal('@' + inputAst.name), o.literal(inputAst.securityContext)\n      ]);\n    case PropertyBindingType.Class:\n      return o.literalArr(\n          [o.literal(BindingFlags.TypeElementClass), o.literal(inputAst.name), o.NULL_EXPR]);\n    case PropertyBindingType.Style:\n      return o.literalArr([\n        o.literal(BindingFlags.TypeElementStyle), o.literal(inputAst.name), o.literal(inputAst.unit)\n      ]);\n  }\n}\n\n\nfunction fixedAttrsDef(elementAst: ElementAst): o.Expression {\n  const mapResult: {[key: string]: string} = Object.create(null);\n  elementAst.attrs.forEach(attrAst => { mapResult[attrAst.name] = attrAst.value; });\n  elementAst.directives.forEach(dirAst => {\n    Object.keys(dirAst.directive.hostAttributes).forEach(name => {\n      const value = dirAst.directive.hostAttributes[name];\n      const prevValue = mapResult[name];\n      mapResult[name] = prevValue != null ? mergeAttributeValue(name, prevValue, value) : value;\n    });\n  });\n  // Note: We need to sort to get a defined output order\n  // for tests and for caching generated artifacts...\n  return o.literalArr(Object.keys(mapResult).sort().map(\n      (attrName) => o.literalArr([o.literal(attrName), o.literal(mapResult[attrName])])));\n}\n\nfunction mergeAttributeValue(attrName: string, attrValue1: string, attrValue2: string): string {\n  if (attrName == CLASS_ATTR || attrName == STYLE_ATTR) {\n    return `${attrValue1} ${attrValue2}`;\n  } else {\n    return attrValue2;\n  }\n}\n\nfunction callCheckStmt(nodeIndex: number, exprs: o.Expression[]): o.Expression {\n  if (exprs.length > 10) {\n    return CHECK_VAR.callFn(\n        [VIEW_VAR, o.literal(nodeIndex), o.literal(ArgumentType.Dynamic), o.literalArr(exprs)]);\n  } else {\n    return CHECK_VAR.callFn(\n        [VIEW_VAR, o.literal(nodeIndex), o.literal(ArgumentType.Inline), ...exprs]);\n  }\n}\n\nfunction callUnwrapValue(nodeIndex: number, bindingIdx: number, expr: o.Expression): o.Expression {\n  return o.importExpr(Identifiers.unwrapValue).callFn([\n    VIEW_VAR, o.literal(nodeIndex), o.literal(bindingIdx), expr\n  ]);\n}\n\ninterface StaticAndDynamicQueryIds {\n  staticQueryIds: Set<number>;\n  dynamicQueryIds: Set<number>;\n}\n\n\nfunction findStaticQueryIds(\n    nodes: TemplateAst[], result = new Map<TemplateAst, StaticAndDynamicQueryIds>()):\n    Map<TemplateAst, StaticAndDynamicQueryIds> {\n  nodes.forEach((node) => {\n    const staticQueryIds = new Set<number>();\n    const dynamicQueryIds = new Set<number>();\n    let queryMatches: QueryMatch[] = undefined !;\n    if (node instanceof ElementAst) {\n      findStaticQueryIds(node.children, result);\n      node.children.forEach((child) => {\n        const childData = result.get(child) !;\n        childData.staticQueryIds.forEach(queryId => staticQueryIds.add(queryId));\n        childData.dynamicQueryIds.forEach(queryId => dynamicQueryIds.add(queryId));\n      });\n      queryMatches = node.queryMatches;\n    } else if (node instanceof EmbeddedTemplateAst) {\n      findStaticQueryIds(node.children, result);\n      node.children.forEach((child) => {\n        const childData = result.get(child) !;\n        childData.staticQueryIds.forEach(queryId => dynamicQueryIds.add(queryId));\n        childData.dynamicQueryIds.forEach(queryId => dynamicQueryIds.add(queryId));\n      });\n      queryMatches = node.queryMatches;\n    }\n    if (queryMatches) {\n      queryMatches.forEach((match) => staticQueryIds.add(match.queryId));\n    }\n    dynamicQueryIds.forEach(queryId => staticQueryIds.delete(queryId));\n    result.set(node, {staticQueryIds, dynamicQueryIds});\n  });\n  return result;\n}\n\nfunction staticViewQueryIds(nodeStaticQueryIds: Map<TemplateAst, StaticAndDynamicQueryIds>):\n    StaticAndDynamicQueryIds {\n  const staticQueryIds = new Set<number>();\n  const dynamicQueryIds = new Set<number>();\n  Array.from(nodeStaticQueryIds.values()).forEach((entry) => {\n    entry.staticQueryIds.forEach(queryId => staticQueryIds.add(queryId));\n    entry.dynamicQueryIds.forEach(queryId => dynamicQueryIds.add(queryId));\n  });\n  dynamicQueryIds.forEach(queryId => staticQueryIds.delete(queryId));\n  return {staticQueryIds, dynamicQueryIds};\n}\n\nfunction elementEventNameAndTarget(\n    eventAst: BoundEventAst, dirAst: DirectiveAst | null): {name: string, target: string | null} {\n  if (eventAst.isAnimation) {\n    return {\n      name: `@${eventAst.name}.${eventAst.phase}`,\n      target: dirAst && dirAst.directive.isComponent ? 'component' : null\n    };\n  } else {\n    return eventAst;\n  }\n}\n\nfunction calcStaticDynamicQueryFlags(\n    queryIds: StaticAndDynamicQueryIds, queryId: number, isFirst: boolean) {\n  let flags = NodeFlags.None;\n  // Note: We only make queries static that query for a single item.\n  // This is because of backwards compatibility with the old view compiler...\n  if (isFirst && (queryIds.staticQueryIds.has(queryId) || !queryIds.dynamicQueryIds.has(queryId))) {\n    flags |= NodeFlags.StaticQuery;\n  } else {\n    flags |= NodeFlags.DynamicQuery;\n  }\n  return flags;\n}\n\nexport function elementEventFullName(target: string | null, name: string): string {\n  return target ? `${target}:${name}` : name;\n}\n"],"sourceRoot":""}