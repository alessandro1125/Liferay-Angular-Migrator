{"version":3,"sources":["../../../../../../../../../../packages/compiler/src/output/js_emitter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n\nimport {StaticSymbol} from '../aot/static_symbol';\nimport {CompileIdentifierMetadata} from '../compile_metadata';\n\nimport {EmitterVisitorContext, OutputEmitter} from './abstract_emitter';\nimport {AbstractJsEmitterVisitor} from './abstract_js_emitter';\nimport * as o from './output_ast';\n\nexport class JavaScriptEmitter implements OutputEmitter {\n  emitStatements(genFilePath: string, stmts: o.Statement[], preamble: string = ''): string {\n    const converter = new JsEmitterVisitor();\n    const ctx = EmitterVisitorContext.createRoot();\n    converter.visitAllStatements(stmts, ctx);\n\n    const preambleLines = preamble ? preamble.split('\\n') : [];\n    converter.importsWithPrefixes.forEach((prefix, importedModuleName) => {\n      // Note: can't write the real word for import as it screws up system.js auto detection...\n      preambleLines.push(\n          `var ${prefix} = req` +\n          `uire('${importedModuleName}');`);\n    });\n\n    const sm = ctx.toSourceMapGenerator(genFilePath, preambleLines.length).toJsComment();\n    const lines = [...preambleLines, ctx.toSource(), sm];\n    if (sm) {\n      // always add a newline at the end, as some tools have bugs without it.\n      lines.push('');\n    }\n    return lines.join('\\n');\n  }\n}\n\nclass JsEmitterVisitor extends AbstractJsEmitterVisitor {\n  importsWithPrefixes = new Map<string, string>();\n\n  visitExternalExpr(ast: o.ExternalExpr, ctx: EmitterVisitorContext): any {\n    const {name, moduleName} = ast.value;\n    if (moduleName) {\n      let prefix = this.importsWithPrefixes.get(moduleName);\n      if (prefix == null) {\n        prefix = `i${this.importsWithPrefixes.size}`;\n        this.importsWithPrefixes.set(moduleName, prefix);\n      }\n      ctx.print(ast, `${prefix}.`);\n    }\n    ctx.print(ast, name !);\n    return null;\n  }\n  visitDeclareVarStmt(stmt: o.DeclareVarStmt, ctx: EmitterVisitorContext): any {\n    super.visitDeclareVarStmt(stmt, ctx);\n    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n      ctx.println(stmt, exportVar(stmt.name));\n    }\n    return null;\n  }\n  visitDeclareFunctionStmt(stmt: o.DeclareFunctionStmt, ctx: EmitterVisitorContext): any {\n    super.visitDeclareFunctionStmt(stmt, ctx);\n    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n      ctx.println(stmt, exportVar(stmt.name));\n    }\n    return null;\n  }\n  visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any {\n    super.visitDeclareClassStmt(stmt, ctx);\n    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n      ctx.println(stmt, exportVar(stmt.name));\n    }\n    return null;\n  }\n}\n\nfunction exportVar(varName: string): string {\n  return `Object.defineProperty(exports, '${varName}', { get: function() { return ${varName}; }});`;\n}\n"],"sourceRoot":""}