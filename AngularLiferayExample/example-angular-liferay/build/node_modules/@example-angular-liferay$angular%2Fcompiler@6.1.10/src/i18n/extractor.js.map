{"version":3,"sources":["../../../../../../../packages/compiler/src/i18n/extractor.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n\n/**\n * Extract i18n messages from source code\n */\nimport {analyzeAndValidateNgModules} from '../aot/compiler';\nimport {createAotUrlResolver} from '../aot/compiler_factory';\nimport {StaticReflector} from '../aot/static_reflector';\nimport {StaticSymbolCache} from '../aot/static_symbol';\nimport {StaticSymbolResolver, StaticSymbolResolverHost} from '../aot/static_symbol_resolver';\nimport {AotSummaryResolver, AotSummaryResolverHost} from '../aot/summary_resolver';\nimport {CompileDirectiveMetadata} from '../compile_metadata';\nimport {CompilerConfig} from '../config';\nimport {ViewEncapsulation} from '../core';\nimport {DirectiveNormalizer} from '../directive_normalizer';\nimport {DirectiveResolver} from '../directive_resolver';\nimport {CompileMetadataResolver} from '../metadata_resolver';\nimport {HtmlParser} from '../ml_parser/html_parser';\nimport {InterpolationConfig} from '../ml_parser/interpolation_config';\nimport {NgModuleResolver} from '../ng_module_resolver';\nimport {ParseError} from '../parse_util';\nimport {PipeResolver} from '../pipe_resolver';\nimport {DomElementSchemaRegistry} from '../schema/dom_element_schema_registry';\nimport {syntaxError} from '../util';\n\nimport {MessageBundle} from './message_bundle';\n\n\n\n/**\n * The host of the Extractor disconnects the implementation from TypeScript / other language\n * services and from underlying file systems.\n */\nexport interface ExtractorHost extends StaticSymbolResolverHost, AotSummaryResolverHost {\n  /**\n   * Converts a path that refers to a resource into an absolute filePath\n   * that can be lateron used for loading the resource via `loadResource.\n   */\n  resourceNameToFileName(path: string, containingFile: string): string|null;\n  /**\n   * Loads a resource (e.g. html / css)\n   */\n  loadResource(path: string): Promise<string>|string;\n}\n\nexport class Extractor {\n  constructor(\n      public host: ExtractorHost, private staticSymbolResolver: StaticSymbolResolver,\n      private messageBundle: MessageBundle, private metadataResolver: CompileMetadataResolver) {}\n\n  extract(rootFiles: string[]): Promise<MessageBundle> {\n    const {files, ngModules} = analyzeAndValidateNgModules(\n        rootFiles, this.host, this.staticSymbolResolver, this.metadataResolver);\n    return Promise\n        .all(ngModules.map(\n            ngModule => this.metadataResolver.loadNgModuleDirectiveAndPipeMetadata(\n                ngModule.type.reference, false)))\n        .then(() => {\n          const errors: ParseError[] = [];\n\n          files.forEach(file => {\n            const compMetas: CompileDirectiveMetadata[] = [];\n            file.directives.forEach(directiveType => {\n              const dirMeta = this.metadataResolver.getDirectiveMetadata(directiveType);\n              if (dirMeta && dirMeta.isComponent) {\n                compMetas.push(dirMeta);\n              }\n            });\n            compMetas.forEach(compMeta => {\n              const html = compMeta.template !.template !;\n              // Template URL points to either an HTML or TS file depending on\n              // whether the file is used with `templateUrl:` or `template:`,\n              // respectively.\n              const templateUrl = compMeta.template !.templateUrl !;\n              const interpolationConfig =\n                  InterpolationConfig.fromArray(compMeta.template !.interpolation);\n              errors.push(...this.messageBundle.updateFromTemplate(\n                  html, templateUrl, interpolationConfig) !);\n            });\n          });\n\n          if (errors.length) {\n            throw new Error(errors.map(e => e.toString()).join('\\n'));\n          }\n\n          return this.messageBundle;\n        });\n  }\n\n  static create(host: ExtractorHost, locale: string|null):\n      {extractor: Extractor, staticReflector: StaticReflector} {\n    const htmlParser = new HtmlParser();\n\n    const urlResolver = createAotUrlResolver(host);\n    const symbolCache = new StaticSymbolCache();\n    const summaryResolver = new AotSummaryResolver(host, symbolCache);\n    const staticSymbolResolver = new StaticSymbolResolver(host, symbolCache, summaryResolver);\n    const staticReflector = new StaticReflector(summaryResolver, staticSymbolResolver);\n\n    const config =\n        new CompilerConfig({defaultEncapsulation: ViewEncapsulation.Emulated, useJit: false});\n\n    const normalizer = new DirectiveNormalizer(\n        {get: (url: string) => host.loadResource(url)}, urlResolver, htmlParser, config);\n    const elementSchemaRegistry = new DomElementSchemaRegistry();\n    const resolver = new CompileMetadataResolver(\n        config, htmlParser, new NgModuleResolver(staticReflector),\n        new DirectiveResolver(staticReflector), new PipeResolver(staticReflector), summaryResolver,\n        elementSchemaRegistry, normalizer, console, symbolCache, staticReflector);\n\n    // TODO(vicb): implicit tags & attributes\n    const messageBundle = new MessageBundle(htmlParser, [], {}, locale);\n\n    const extractor = new Extractor(host, staticSymbolResolver, messageBundle, resolver);\n    return {extractor, staticReflector};\n  }\n}\n"],"sourceRoot":""}