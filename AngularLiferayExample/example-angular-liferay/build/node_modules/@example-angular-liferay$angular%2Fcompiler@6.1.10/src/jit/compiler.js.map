{"version":3,"sources":["../../../../../../../packages/compiler/src/jit/compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {CompileDirectiveMetadata, CompileIdentifierMetadata, CompileNgModuleMetadata, CompilePipeSummary, CompileProviderMetadata, CompileStylesheetMetadata, CompileTypeSummary, ProviderMeta, ProxyClass, identifierName, ngModuleJitUrl, sharedStylesheetJitUrl, templateJitUrl, templateSourceUrl} from '../compile_metadata';\nimport {CompileReflector} from '../compile_reflector';\nimport {CompilerConfig} from '../config';\nimport {ConstantPool} from '../constant_pool';\nimport {Type} from '../core';\nimport {CompileMetadataResolver} from '../metadata_resolver';\nimport {NgModuleCompiler} from '../ng_module_compiler';\nimport * as ir from '../output/output_ast';\nimport {interpretStatements} from '../output/output_interpreter';\nimport {jitStatements} from '../output/output_jit';\nimport {CompiledStylesheet, StyleCompiler} from '../style_compiler';\nimport {SummaryResolver} from '../summary_resolver';\nimport {TemplateAst} from '../template_parser/template_ast';\nimport {TemplateParser} from '../template_parser/template_parser';\nimport {Console, OutputContext, SyncAsync, stringify} from '../util';\nimport {ViewCompiler} from '../view_compiler/view_compiler';\n\nexport interface ModuleWithComponentFactories {\n  ngModuleFactory: object;\n  componentFactories: object[];\n}\n\n/**\n * An internal module of the Angular compiler that begins with component types,\n * extracts templates, and eventually produces a compiled version of the component\n * ready for linking into an application.\n *\n * @security  When compiling templates at runtime, you must ensure that the entire template comes\n * from a trusted source. Attacker-controlled data introduced by a template could expose your\n * application to XSS risks.  For more detail, see the [Security Guide](http://g.co/ng/security).\n */\nexport class JitCompiler {\n  private _compiledTemplateCache = new Map<Type, CompiledTemplate>();\n  private _compiledHostTemplateCache = new Map<Type, CompiledTemplate>();\n  private _compiledDirectiveWrapperCache = new Map<Type, Type>();\n  private _compiledNgModuleCache = new Map<Type, object>();\n  private _sharedStylesheetCount = 0;\n  private _addedAotSummaries = new Set<() => any[]>();\n\n  constructor(\n      private _metadataResolver: CompileMetadataResolver, private _templateParser: TemplateParser,\n      private _styleCompiler: StyleCompiler, private _viewCompiler: ViewCompiler,\n      private _ngModuleCompiler: NgModuleCompiler, private _summaryResolver: SummaryResolver<Type>,\n      private _reflector: CompileReflector, private _compilerConfig: CompilerConfig,\n      private _console: Console,\n      private getExtraNgModuleProviders: (ngModule: any) => CompileProviderMetadata[]) {}\n\n  compileModuleSync(moduleType: Type): object {\n    return SyncAsync.assertSync(this._compileModuleAndComponents(moduleType, true));\n  }\n\n  compileModuleAsync(moduleType: Type): Promise<object> {\n    return Promise.resolve(this._compileModuleAndComponents(moduleType, false));\n  }\n\n  compileModuleAndAllComponentsSync(moduleType: Type): ModuleWithComponentFactories {\n    return SyncAsync.assertSync(this._compileModuleAndAllComponents(moduleType, true));\n  }\n\n  compileModuleAndAllComponentsAsync(moduleType: Type): Promise<ModuleWithComponentFactories> {\n    return Promise.resolve(this._compileModuleAndAllComponents(moduleType, false));\n  }\n\n  getComponentFactory(component: Type): object {\n    const summary = this._metadataResolver.getDirectiveSummary(component);\n    return summary.componentFactory as object;\n  }\n\n  loadAotSummaries(summaries: () => any[]) {\n    this.clearCache();\n    this._addAotSummaries(summaries);\n  }\n\n  private _addAotSummaries(fn: () => any[]) {\n    if (this._addedAotSummaries.has(fn)) {\n      return;\n    }\n    this._addedAotSummaries.add(fn);\n    const summaries = fn();\n    for (let i = 0; i < summaries.length; i++) {\n      const entry = summaries[i];\n      if (typeof entry === 'function') {\n        this._addAotSummaries(entry);\n      } else {\n        const summary = entry as CompileTypeSummary;\n        this._summaryResolver.addSummary(\n            {symbol: summary.type.reference, metadata: null, type: summary});\n      }\n    }\n  }\n\n  hasAotSummary(ref: Type) { return !!this._summaryResolver.resolveSummary(ref); }\n\n  private _filterJitIdentifiers(ids: CompileIdentifierMetadata[]): any[] {\n    return ids.map(mod => mod.reference).filter((ref) => !this.hasAotSummary(ref));\n  }\n\n  private _compileModuleAndComponents(moduleType: Type, isSync: boolean): SyncAsync<object> {\n    return SyncAsync.then(this._loadModules(moduleType, isSync), () => {\n      this._compileComponents(moduleType, null);\n      return this._compileModule(moduleType);\n    });\n  }\n\n  private _compileModuleAndAllComponents(moduleType: Type, isSync: boolean):\n      SyncAsync<ModuleWithComponentFactories> {\n    return SyncAsync.then(this._loadModules(moduleType, isSync), () => {\n      const componentFactories: object[] = [];\n      this._compileComponents(moduleType, componentFactories);\n      return {\n        ngModuleFactory: this._compileModule(moduleType),\n        componentFactories: componentFactories\n      };\n    });\n  }\n\n  private _loadModules(mainModule: any, isSync: boolean): SyncAsync<any> {\n    const loading: Promise<any>[] = [];\n    const mainNgModule = this._metadataResolver.getNgModuleMetadata(mainModule) !;\n    // Note: for runtime compilation, we want to transitively compile all modules,\n    // so we also need to load the declared directives / pipes for all nested modules.\n    this._filterJitIdentifiers(mainNgModule.transitiveModule.modules).forEach((nestedNgModule) => {\n      // getNgModuleMetadata only returns null if the value passed in is not an NgModule\n      const moduleMeta = this._metadataResolver.getNgModuleMetadata(nestedNgModule) !;\n      this._filterJitIdentifiers(moduleMeta.declaredDirectives).forEach((ref) => {\n        const promise =\n            this._metadataResolver.loadDirectiveMetadata(moduleMeta.type.reference, ref, isSync);\n        if (promise) {\n          loading.push(promise);\n        }\n      });\n      this._filterJitIdentifiers(moduleMeta.declaredPipes)\n          .forEach((ref) => this._metadataResolver.getOrLoadPipeMetadata(ref));\n    });\n    return SyncAsync.all(loading);\n  }\n\n  private _compileModule(moduleType: Type): object {\n    let ngModuleFactory = this._compiledNgModuleCache.get(moduleType) !;\n    if (!ngModuleFactory) {\n      const moduleMeta = this._metadataResolver.getNgModuleMetadata(moduleType) !;\n      // Always provide a bound Compiler\n      const extraProviders = this.getExtraNgModuleProviders(moduleMeta.type.reference);\n      const outputCtx = createOutputContext();\n      const compileResult = this._ngModuleCompiler.compile(outputCtx, moduleMeta, extraProviders);\n      ngModuleFactory = this._interpretOrJit(\n          ngModuleJitUrl(moduleMeta), outputCtx.statements)[compileResult.ngModuleFactoryVar];\n      this._compiledNgModuleCache.set(moduleMeta.type.reference, ngModuleFactory);\n    }\n    return ngModuleFactory;\n  }\n\n  /**\n   * @internal\n   */\n  _compileComponents(mainModule: Type, allComponentFactories: object[]|null) {\n    const ngModule = this._metadataResolver.getNgModuleMetadata(mainModule) !;\n    const moduleByJitDirective = new Map<any, CompileNgModuleMetadata>();\n    const templates = new Set<CompiledTemplate>();\n\n    const transJitModules = this._filterJitIdentifiers(ngModule.transitiveModule.modules);\n    transJitModules.forEach((localMod) => {\n      const localModuleMeta = this._metadataResolver.getNgModuleMetadata(localMod) !;\n      this._filterJitIdentifiers(localModuleMeta.declaredDirectives).forEach((dirRef) => {\n        moduleByJitDirective.set(dirRef, localModuleMeta);\n        const dirMeta = this._metadataResolver.getDirectiveMetadata(dirRef);\n        if (dirMeta.isComponent) {\n          templates.add(this._createCompiledTemplate(dirMeta, localModuleMeta));\n          if (allComponentFactories) {\n            const template =\n                this._createCompiledHostTemplate(dirMeta.type.reference, localModuleMeta);\n            templates.add(template);\n            allComponentFactories.push(dirMeta.componentFactory as object);\n          }\n        }\n      });\n    });\n    transJitModules.forEach((localMod) => {\n      const localModuleMeta = this._metadataResolver.getNgModuleMetadata(localMod) !;\n      this._filterJitIdentifiers(localModuleMeta.declaredDirectives).forEach((dirRef) => {\n        const dirMeta = this._metadataResolver.getDirectiveMetadata(dirRef);\n        if (dirMeta.isComponent) {\n          dirMeta.entryComponents.forEach((entryComponentType) => {\n            const moduleMeta = moduleByJitDirective.get(entryComponentType.componentType) !;\n            templates.add(\n                this._createCompiledHostTemplate(entryComponentType.componentType, moduleMeta));\n          });\n        }\n      });\n      localModuleMeta.entryComponents.forEach((entryComponentType) => {\n        if (!this.hasAotSummary(entryComponentType.componentType)) {\n          const moduleMeta = moduleByJitDirective.get(entryComponentType.componentType) !;\n          templates.add(\n              this._createCompiledHostTemplate(entryComponentType.componentType, moduleMeta));\n        }\n      });\n    });\n    templates.forEach((template) => this._compileTemplate(template));\n  }\n\n  clearCacheFor(type: Type) {\n    this._compiledNgModuleCache.delete(type);\n    this._metadataResolver.clearCacheFor(type);\n    this._compiledHostTemplateCache.delete(type);\n    const compiledTemplate = this._compiledTemplateCache.get(type);\n    if (compiledTemplate) {\n      this._compiledTemplateCache.delete(type);\n    }\n  }\n\n  clearCache(): void {\n    // Note: don't clear the _addedAotSummaries, as they don't change!\n    this._metadataResolver.clearCache();\n    this._compiledTemplateCache.clear();\n    this._compiledHostTemplateCache.clear();\n    this._compiledNgModuleCache.clear();\n  }\n\n  private _createCompiledHostTemplate(compType: Type, ngModule: CompileNgModuleMetadata):\n      CompiledTemplate {\n    if (!ngModule) {\n      throw new Error(\n          `Component ${stringify(compType)} is not part of any NgModule or the module has not been imported into your module.`);\n    }\n    let compiledTemplate = this._compiledHostTemplateCache.get(compType);\n    if (!compiledTemplate) {\n      const compMeta = this._metadataResolver.getDirectiveMetadata(compType);\n      assertComponent(compMeta);\n\n      const hostMeta = this._metadataResolver.getHostComponentMetadata(\n          compMeta, (compMeta.componentFactory as any).viewDefFactory);\n      compiledTemplate =\n          new CompiledTemplate(true, compMeta.type, hostMeta, ngModule, [compMeta.type]);\n      this._compiledHostTemplateCache.set(compType, compiledTemplate);\n    }\n    return compiledTemplate;\n  }\n\n  private _createCompiledTemplate(\n      compMeta: CompileDirectiveMetadata, ngModule: CompileNgModuleMetadata): CompiledTemplate {\n    let compiledTemplate = this._compiledTemplateCache.get(compMeta.type.reference);\n    if (!compiledTemplate) {\n      assertComponent(compMeta);\n      compiledTemplate = new CompiledTemplate(\n          false, compMeta.type, compMeta, ngModule, ngModule.transitiveModule.directives);\n      this._compiledTemplateCache.set(compMeta.type.reference, compiledTemplate);\n    }\n    return compiledTemplate;\n  }\n\n  private _compileTemplate(template: CompiledTemplate) {\n    if (template.isCompiled) {\n      return;\n    }\n    const compMeta = template.compMeta;\n    const externalStylesheetsByModuleUrl = new Map<string, CompiledStylesheet>();\n    const outputContext = createOutputContext();\n    const componentStylesheet = this._styleCompiler.compileComponent(outputContext, compMeta);\n    compMeta.template !.externalStylesheets.forEach((stylesheetMeta) => {\n      const compiledStylesheet =\n          this._styleCompiler.compileStyles(createOutputContext(), compMeta, stylesheetMeta);\n      externalStylesheetsByModuleUrl.set(stylesheetMeta.moduleUrl !, compiledStylesheet);\n    });\n    this._resolveStylesCompileResult(componentStylesheet, externalStylesheetsByModuleUrl);\n    const pipes = template.ngModule.transitiveModule.pipes.map(\n        pipe => this._metadataResolver.getPipeSummary(pipe.reference));\n    const {template: parsedTemplate, pipes: usedPipes} =\n        this._parseTemplate(compMeta, template.ngModule, template.directives);\n    const compileResult = this._viewCompiler.compileComponent(\n        outputContext, compMeta, parsedTemplate, ir.variable(componentStylesheet.stylesVar),\n        usedPipes);\n    const evalResult = this._interpretOrJit(\n        templateJitUrl(template.ngModule.type, template.compMeta), outputContext.statements);\n    const viewClass = evalResult[compileResult.viewClassVar];\n    const rendererType = evalResult[compileResult.rendererTypeVar];\n    template.compiled(viewClass, rendererType);\n  }\n\n  private _parseTemplate(\n      compMeta: CompileDirectiveMetadata, ngModule: CompileNgModuleMetadata,\n      directiveIdentifiers: CompileIdentifierMetadata[]):\n      {template: TemplateAst[], pipes: CompilePipeSummary[]} {\n    // Note: ! is ok here as components always have a template.\n    const preserveWhitespaces = compMeta.template !.preserveWhitespaces;\n    const directives =\n        directiveIdentifiers.map(dir => this._metadataResolver.getDirectiveSummary(dir.reference));\n    const pipes = ngModule.transitiveModule.pipes.map(\n        pipe => this._metadataResolver.getPipeSummary(pipe.reference));\n    return this._templateParser.parse(\n        compMeta, compMeta.template !.htmlAst !, directives, pipes, ngModule.schemas,\n        templateSourceUrl(ngModule.type, compMeta, compMeta.template !), preserveWhitespaces);\n  }\n\n  private _resolveStylesCompileResult(\n      result: CompiledStylesheet, externalStylesheetsByModuleUrl: Map<string, CompiledStylesheet>) {\n    result.dependencies.forEach((dep, i) => {\n      const nestedCompileResult = externalStylesheetsByModuleUrl.get(dep.moduleUrl) !;\n      const nestedStylesArr = this._resolveAndEvalStylesCompileResult(\n          nestedCompileResult, externalStylesheetsByModuleUrl);\n      dep.setValue(nestedStylesArr);\n    });\n  }\n\n  private _resolveAndEvalStylesCompileResult(\n      result: CompiledStylesheet,\n      externalStylesheetsByModuleUrl: Map<string, CompiledStylesheet>): string[] {\n    this._resolveStylesCompileResult(result, externalStylesheetsByModuleUrl);\n    return this._interpretOrJit(\n        sharedStylesheetJitUrl(result.meta, this._sharedStylesheetCount++),\n        result.outputCtx.statements)[result.stylesVar];\n  }\n\n  private _interpretOrJit(sourceUrl: string, statements: ir.Statement[]): any {\n    if (!this._compilerConfig.useJit) {\n      return interpretStatements(statements, this._reflector);\n    } else {\n      return jitStatements(sourceUrl, statements, this._reflector, this._compilerConfig.jitDevMode);\n    }\n  }\n}\n\nclass CompiledTemplate {\n  private _viewClass: Function = null !;\n  isCompiled = false;\n\n  constructor(\n      public isHost: boolean, public compType: CompileIdentifierMetadata,\n      public compMeta: CompileDirectiveMetadata, public ngModule: CompileNgModuleMetadata,\n      public directives: CompileIdentifierMetadata[]) {}\n\n  compiled(viewClass: Function, rendererType: any) {\n    this._viewClass = viewClass;\n    (<ProxyClass>this.compMeta.componentViewType).setDelegate(viewClass);\n    for (let prop in rendererType) {\n      (<any>this.compMeta.rendererType)[prop] = rendererType[prop];\n    }\n    this.isCompiled = true;\n  }\n}\n\nfunction assertComponent(meta: CompileDirectiveMetadata) {\n  if (!meta.isComponent) {\n    throw new Error(\n        `Could not compile '${identifierName(meta.type)}' because it is not a component.`);\n  }\n}\n\nfunction createOutputContext(): OutputContext {\n  const importExpr = (symbol: any) =>\n      ir.importExpr({name: identifierName(symbol), moduleName: null, runtime: symbol});\n  return {statements: [], genFilePath: '', importExpr, constantPool: new ConstantPool()};\n}\n"],"sourceRoot":""}