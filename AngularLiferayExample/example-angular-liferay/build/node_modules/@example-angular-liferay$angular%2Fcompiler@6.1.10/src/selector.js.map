{"version":3,"sources":["../../../../../../packages/compiler/src/selector.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {getHtmlTagDefinition} from './ml_parser/html_tags';\n\nconst _SELECTOR_REGEXP = new RegExp(\n    '(\\\\:not\\\\()|' +           //\":not(\"\n        '([-\\\\w]+)|' +         // \"tag\"\n        '(?:\\\\.([-\\\\w]+))|' +  // \".class\"\n        // \"-\" should appear first in the regexp below as FF31 parses \"[.-\\w]\" as a range\n        '(?:\\\\[([-.\\\\w*]+)(?:=([\\\"\\']?)([^\\\\]\\\"\\']*)\\\\5)?\\\\])|' +  // \"[name]\", \"[name=value]\",\n                                                                   // \"[name=\"value\"]\",\n                                                                   // \"[name='value']\"\n        '(\\\\))|' +                                                 // \")\"\n        '(\\\\s*,\\\\s*)',                                             // \",\"\n    'g');\n\n/**\n * A css selector contains an element name,\n * css classes and attribute/value pairs with the purpose\n * of selecting subsets out of them.\n */\nexport class CssSelector {\n  element: string|null = null;\n  classNames: string[] = [];\n  /**\n   * The selectors are encoded in pairs where:\n   * - even locations are attribute names\n   * - odd locations are attribute values.\n   *\n   * Example:\n   * Selector: `[key1=value1][key2]` would parse to:\n   * ```\n   * ['key1', 'value1', 'key2', '']\n   * ```\n   */\n  attrs: string[] = [];\n  notSelectors: CssSelector[] = [];\n\n  static parse(selector: string): CssSelector[] {\n    const results: CssSelector[] = [];\n    const _addResult = (res: CssSelector[], cssSel: CssSelector) => {\n      if (cssSel.notSelectors.length > 0 && !cssSel.element && cssSel.classNames.length == 0 &&\n          cssSel.attrs.length == 0) {\n        cssSel.element = '*';\n      }\n      res.push(cssSel);\n    };\n    let cssSelector = new CssSelector();\n    let match: string[]|null;\n    let current = cssSelector;\n    let inNot = false;\n    _SELECTOR_REGEXP.lastIndex = 0;\n    while (match = _SELECTOR_REGEXP.exec(selector)) {\n      if (match[1]) {\n        if (inNot) {\n          throw new Error('Nesting :not is not allowed in a selector');\n        }\n        inNot = true;\n        current = new CssSelector();\n        cssSelector.notSelectors.push(current);\n      }\n      if (match[2]) {\n        current.setElement(match[2]);\n      }\n      if (match[3]) {\n        current.addClassName(match[3]);\n      }\n      if (match[4]) {\n        current.addAttribute(match[4], match[6]);\n      }\n      if (match[7]) {\n        inNot = false;\n        current = cssSelector;\n      }\n      if (match[8]) {\n        if (inNot) {\n          throw new Error('Multiple selectors in :not are not supported');\n        }\n        _addResult(results, cssSelector);\n        cssSelector = current = new CssSelector();\n      }\n    }\n    _addResult(results, cssSelector);\n    return results;\n  }\n\n  isElementSelector(): boolean {\n    return this.hasElementSelector() && this.classNames.length == 0 && this.attrs.length == 0 &&\n        this.notSelectors.length === 0;\n  }\n\n  hasElementSelector(): boolean { return !!this.element; }\n\n  setElement(element: string|null = null) { this.element = element; }\n\n  /** Gets a template string for an element that matches the selector. */\n  getMatchingElementTemplate(): string {\n    const tagName = this.element || 'div';\n    const classAttr = this.classNames.length > 0 ? ` class=\"${this.classNames.join(' ')}\"` : '';\n\n    let attrs = '';\n    for (let i = 0; i < this.attrs.length; i += 2) {\n      const attrName = this.attrs[i];\n      const attrValue = this.attrs[i + 1] !== '' ? `=\"${this.attrs[i + 1]}\"` : '';\n      attrs += ` ${attrName}${attrValue}`;\n    }\n\n    return getHtmlTagDefinition(tagName).isVoid ? `<${tagName}${classAttr}${attrs}/>` :\n                                                  `<${tagName}${classAttr}${attrs}></${tagName}>`;\n  }\n\n  getAttrs(): string[] {\n    const result: string[] = [];\n    if (this.classNames.length > 0) {\n      result.push('class', this.classNames.join(' '));\n    }\n    return result.concat(this.attrs);\n  }\n\n  addAttribute(name: string, value: string = '') {\n    this.attrs.push(name, value && value.toLowerCase() || '');\n  }\n\n  addClassName(name: string) { this.classNames.push(name.toLowerCase()); }\n\n  toString(): string {\n    let res: string = this.element || '';\n    if (this.classNames) {\n      this.classNames.forEach(klass => res += `.${klass}`);\n    }\n    if (this.attrs) {\n      for (let i = 0; i < this.attrs.length; i += 2) {\n        const name = this.attrs[i];\n        const value = this.attrs[i + 1];\n        res += `[${name}${value ? '=' + value : ''}]`;\n      }\n    }\n    this.notSelectors.forEach(notSelector => res += `:not(${notSelector})`);\n    return res;\n  }\n}\n\n/**\n * Reads a list of CssSelectors and allows to calculate which ones\n * are contained in a given CssSelector.\n */\nexport class SelectorMatcher {\n  static createNotMatcher(notSelectors: CssSelector[]): SelectorMatcher {\n    const notMatcher = new SelectorMatcher();\n    notMatcher.addSelectables(notSelectors, null);\n    return notMatcher;\n  }\n\n  private _elementMap = new Map<string, SelectorContext[]>();\n  private _elementPartialMap = new Map<string, SelectorMatcher>();\n  private _classMap = new Map<string, SelectorContext[]>();\n  private _classPartialMap = new Map<string, SelectorMatcher>();\n  private _attrValueMap = new Map<string, Map<string, SelectorContext[]>>();\n  private _attrValuePartialMap = new Map<string, Map<string, SelectorMatcher>>();\n  private _listContexts: SelectorListContext[] = [];\n\n  addSelectables(cssSelectors: CssSelector[], callbackCtxt?: any) {\n    let listContext: SelectorListContext = null !;\n    if (cssSelectors.length > 1) {\n      listContext = new SelectorListContext(cssSelectors);\n      this._listContexts.push(listContext);\n    }\n    for (let i = 0; i < cssSelectors.length; i++) {\n      this._addSelectable(cssSelectors[i], callbackCtxt, listContext);\n    }\n  }\n\n  /**\n   * Add an object that can be found later on by calling `match`.\n   * @param cssSelector A css selector\n   * @param callbackCtxt An opaque object that will be given to the callback of the `match` function\n   */\n  private _addSelectable(\n      cssSelector: CssSelector, callbackCtxt: any, listContext: SelectorListContext) {\n    let matcher: SelectorMatcher = this;\n    const element = cssSelector.element;\n    const classNames = cssSelector.classNames;\n    const attrs = cssSelector.attrs;\n    const selectable = new SelectorContext(cssSelector, callbackCtxt, listContext);\n\n    if (element) {\n      const isTerminal = attrs.length === 0 && classNames.length === 0;\n      if (isTerminal) {\n        this._addTerminal(matcher._elementMap, element, selectable);\n      } else {\n        matcher = this._addPartial(matcher._elementPartialMap, element);\n      }\n    }\n\n    if (classNames) {\n      for (let i = 0; i < classNames.length; i++) {\n        const isTerminal = attrs.length === 0 && i === classNames.length - 1;\n        const className = classNames[i];\n        if (isTerminal) {\n          this._addTerminal(matcher._classMap, className, selectable);\n        } else {\n          matcher = this._addPartial(matcher._classPartialMap, className);\n        }\n      }\n    }\n\n    if (attrs) {\n      for (let i = 0; i < attrs.length; i += 2) {\n        const isTerminal = i === attrs.length - 2;\n        const name = attrs[i];\n        const value = attrs[i + 1];\n        if (isTerminal) {\n          const terminalMap = matcher._attrValueMap;\n          let terminalValuesMap = terminalMap.get(name);\n          if (!terminalValuesMap) {\n            terminalValuesMap = new Map<string, SelectorContext[]>();\n            terminalMap.set(name, terminalValuesMap);\n          }\n          this._addTerminal(terminalValuesMap, value, selectable);\n        } else {\n          const partialMap = matcher._attrValuePartialMap;\n          let partialValuesMap = partialMap.get(name);\n          if (!partialValuesMap) {\n            partialValuesMap = new Map<string, SelectorMatcher>();\n            partialMap.set(name, partialValuesMap);\n          }\n          matcher = this._addPartial(partialValuesMap, value);\n        }\n      }\n    }\n  }\n\n  private _addTerminal(\n      map: Map<string, SelectorContext[]>, name: string, selectable: SelectorContext) {\n    let terminalList = map.get(name);\n    if (!terminalList) {\n      terminalList = [];\n      map.set(name, terminalList);\n    }\n    terminalList.push(selectable);\n  }\n\n  private _addPartial(map: Map<string, SelectorMatcher>, name: string): SelectorMatcher {\n    let matcher = map.get(name);\n    if (!matcher) {\n      matcher = new SelectorMatcher();\n      map.set(name, matcher);\n    }\n    return matcher;\n  }\n\n  /**\n   * Find the objects that have been added via `addSelectable`\n   * whose css selector is contained in the given css selector.\n   * @param cssSelector A css selector\n   * @param matchedCallback This callback will be called with the object handed into `addSelectable`\n   * @return boolean true if a match was found\n  */\n  match(cssSelector: CssSelector, matchedCallback: ((c: CssSelector, a: any) => void)|null):\n      boolean {\n    let result = false;\n    const element = cssSelector.element !;\n    const classNames = cssSelector.classNames;\n    const attrs = cssSelector.attrs;\n\n    for (let i = 0; i < this._listContexts.length; i++) {\n      this._listContexts[i].alreadyMatched = false;\n    }\n\n    result = this._matchTerminal(this._elementMap, element, cssSelector, matchedCallback) || result;\n    result = this._matchPartial(this._elementPartialMap, element, cssSelector, matchedCallback) ||\n        result;\n\n    if (classNames) {\n      for (let i = 0; i < classNames.length; i++) {\n        const className = classNames[i];\n        result =\n            this._matchTerminal(this._classMap, className, cssSelector, matchedCallback) || result;\n        result =\n            this._matchPartial(this._classPartialMap, className, cssSelector, matchedCallback) ||\n            result;\n      }\n    }\n\n    if (attrs) {\n      for (let i = 0; i < attrs.length; i += 2) {\n        const name = attrs[i];\n        const value = attrs[i + 1];\n\n        const terminalValuesMap = this._attrValueMap.get(name) !;\n        if (value) {\n          result =\n              this._matchTerminal(terminalValuesMap, '', cssSelector, matchedCallback) || result;\n        }\n        result =\n            this._matchTerminal(terminalValuesMap, value, cssSelector, matchedCallback) || result;\n\n        const partialValuesMap = this._attrValuePartialMap.get(name) !;\n        if (value) {\n          result = this._matchPartial(partialValuesMap, '', cssSelector, matchedCallback) || result;\n        }\n        result =\n            this._matchPartial(partialValuesMap, value, cssSelector, matchedCallback) || result;\n      }\n    }\n    return result;\n  }\n\n  /** @internal */\n  _matchTerminal(\n      map: Map<string, SelectorContext[]>, name: string, cssSelector: CssSelector,\n      matchedCallback: ((c: CssSelector, a: any) => void)|null): boolean {\n    if (!map || typeof name !== 'string') {\n      return false;\n    }\n\n    let selectables: SelectorContext[] = map.get(name) || [];\n    const starSelectables: SelectorContext[] = map.get('*') !;\n    if (starSelectables) {\n      selectables = selectables.concat(starSelectables);\n    }\n    if (selectables.length === 0) {\n      return false;\n    }\n    let selectable: SelectorContext;\n    let result = false;\n    for (let i = 0; i < selectables.length; i++) {\n      selectable = selectables[i];\n      result = selectable.finalize(cssSelector, matchedCallback) || result;\n    }\n    return result;\n  }\n\n  /** @internal */\n  _matchPartial(\n      map: Map<string, SelectorMatcher>, name: string, cssSelector: CssSelector,\n      matchedCallback: ((c: CssSelector, a: any) => void)|null): boolean {\n    if (!map || typeof name !== 'string') {\n      return false;\n    }\n\n    const nestedSelector = map.get(name);\n    if (!nestedSelector) {\n      return false;\n    }\n    // TODO(perf): get rid of recursion and measure again\n    // TODO(perf): don't pass the whole selector into the recursion,\n    // but only the not processed parts\n    return nestedSelector.match(cssSelector, matchedCallback);\n  }\n}\n\n\nexport class SelectorListContext {\n  alreadyMatched: boolean = false;\n\n  constructor(public selectors: CssSelector[]) {}\n}\n\n// Store context to pass back selector and context when a selector is matched\nexport class SelectorContext {\n  notSelectors: CssSelector[];\n\n  constructor(\n      public selector: CssSelector, public cbContext: any,\n      public listContext: SelectorListContext) {\n    this.notSelectors = selector.notSelectors;\n  }\n\n  finalize(cssSelector: CssSelector, callback: ((c: CssSelector, a: any) => void)|null): boolean {\n    let result = true;\n    if (this.notSelectors.length > 0 && (!this.listContext || !this.listContext.alreadyMatched)) {\n      const notMatcher = SelectorMatcher.createNotMatcher(this.notSelectors);\n      result = !notMatcher.match(cssSelector, null);\n    }\n    if (result && callback && (!this.listContext || !this.listContext.alreadyMatched)) {\n      if (this.listContext) {\n        this.listContext.alreadyMatched = true;\n      }\n      callback(this.selector, this.cbContext);\n    }\n    return result;\n  }\n}\n"],"sourceRoot":""}