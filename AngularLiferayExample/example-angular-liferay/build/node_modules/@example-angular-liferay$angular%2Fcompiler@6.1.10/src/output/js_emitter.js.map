{"version":3,"sources":["../../../../../../../packages/compiler/src/output/js_emitter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n\nimport {StaticSymbol} from '../aot/static_symbol';\nimport {CompileIdentifierMetadata} from '../compile_metadata';\n\nimport {EmitterVisitorContext, OutputEmitter} from './abstract_emitter';\nimport {AbstractJsEmitterVisitor} from './abstract_js_emitter';\nimport * as o from './output_ast';\n\nexport class JavaScriptEmitter implements OutputEmitter {\n  emitStatements(genFilePath: string, stmts: o.Statement[], preamble: string = ''): string {\n    const converter = new JsEmitterVisitor();\n    const ctx = EmitterVisitorContext.createRoot();\n    converter.visitAllStatements(stmts, ctx);\n\n    const preambleLines = preamble ? preamble.split('\\n') : [];\n    converter.importsWithPrefixes.forEach((prefix, importedModuleName) => {\n      // Note: can't write the real word for import as it screws up system.js auto detection...\n      preambleLines.push(\n          `var ${prefix} = req` +\n          `uire('${importedModuleName}');`);\n    });\n\n    const sm = ctx.toSourceMapGenerator(genFilePath, preambleLines.length).toJsComment();\n    const lines = [...preambleLines, ctx.toSource(), sm];\n    if (sm) {\n      // always add a newline at the end, as some tools have bugs without it.\n      lines.push('');\n    }\n    return lines.join('\\n');\n  }\n}\n\nclass JsEmitterVisitor extends AbstractJsEmitterVisitor {\n  importsWithPrefixes = new Map<string, string>();\n\n  visitExternalExpr(ast: o.ExternalExpr, ctx: EmitterVisitorContext): any {\n    const {name, moduleName} = ast.value;\n    if (moduleName) {\n      let prefix = this.importsWithPrefixes.get(moduleName);\n      if (prefix == null) {\n        prefix = `i${this.importsWithPrefixes.size}`;\n        this.importsWithPrefixes.set(moduleName, prefix);\n      }\n      ctx.print(ast, `${prefix}.`);\n    }\n    ctx.print(ast, name !);\n    return null;\n  }\n  visitDeclareVarStmt(stmt: o.DeclareVarStmt, ctx: EmitterVisitorContext): any {\n    super.visitDeclareVarStmt(stmt, ctx);\n    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n      ctx.println(stmt, exportVar(stmt.name));\n    }\n    return null;\n  }\n  visitDeclareFunctionStmt(stmt: o.DeclareFunctionStmt, ctx: EmitterVisitorContext): any {\n    super.visitDeclareFunctionStmt(stmt, ctx);\n    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n      ctx.println(stmt, exportVar(stmt.name));\n    }\n    return null;\n  }\n  visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any {\n    super.visitDeclareClassStmt(stmt, ctx);\n    if (stmt.hasModifier(o.StmtModifier.Exported)) {\n      ctx.println(stmt, exportVar(stmt.name));\n    }\n    return null;\n  }\n}\n\nfunction exportVar(varName: string): string {\n  return `Object.defineProperty(exports, '${varName}', { get: function() { return ${varName}; }});`;\n}\n"],"sourceRoot":""}