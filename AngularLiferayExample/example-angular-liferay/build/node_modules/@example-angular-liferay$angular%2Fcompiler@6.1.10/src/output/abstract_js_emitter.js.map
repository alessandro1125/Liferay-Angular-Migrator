{"version":3,"sources":["../../../../../../../packages/compiler/src/output/abstract_js_emitter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\n\nimport {AbstractEmitterVisitor, CATCH_ERROR_VAR, CATCH_STACK_VAR, EmitterVisitorContext} from './abstract_emitter';\nimport * as o from './output_ast';\n\nexport abstract class AbstractJsEmitterVisitor extends AbstractEmitterVisitor {\n  constructor() { super(false); }\n  visitDeclareClassStmt(stmt: o.ClassStmt, ctx: EmitterVisitorContext): any {\n    ctx.pushClass(stmt);\n    this._visitClassConstructor(stmt, ctx);\n\n    if (stmt.parent != null) {\n      ctx.print(stmt, `${stmt.name}.prototype = Object.create(`);\n      stmt.parent.visitExpression(this, ctx);\n      ctx.println(stmt, `.prototype);`);\n    }\n    stmt.getters.forEach((getter) => this._visitClassGetter(stmt, getter, ctx));\n    stmt.methods.forEach((method) => this._visitClassMethod(stmt, method, ctx));\n    ctx.popClass();\n    return null;\n  }\n\n  private _visitClassConstructor(stmt: o.ClassStmt, ctx: EmitterVisitorContext) {\n    ctx.print(stmt, `function ${stmt.name}(`);\n    if (stmt.constructorMethod != null) {\n      this._visitParams(stmt.constructorMethod.params, ctx);\n    }\n    ctx.println(stmt, `) {`);\n    ctx.incIndent();\n    if (stmt.constructorMethod != null) {\n      if (stmt.constructorMethod.body.length > 0) {\n        ctx.println(stmt, `var self = this;`);\n        this.visitAllStatements(stmt.constructorMethod.body, ctx);\n      }\n    }\n    ctx.decIndent();\n    ctx.println(stmt, `}`);\n  }\n\n  private _visitClassGetter(stmt: o.ClassStmt, getter: o.ClassGetter, ctx: EmitterVisitorContext) {\n    ctx.println(\n        stmt,\n        `Object.defineProperty(${stmt.name}.prototype, '${getter.name}', { get: function() {`);\n    ctx.incIndent();\n    if (getter.body.length > 0) {\n      ctx.println(stmt, `var self = this;`);\n      this.visitAllStatements(getter.body, ctx);\n    }\n    ctx.decIndent();\n    ctx.println(stmt, `}});`);\n  }\n\n  private _visitClassMethod(stmt: o.ClassStmt, method: o.ClassMethod, ctx: EmitterVisitorContext) {\n    ctx.print(stmt, `${stmt.name}.prototype.${method.name} = function(`);\n    this._visitParams(method.params, ctx);\n    ctx.println(stmt, `) {`);\n    ctx.incIndent();\n    if (method.body.length > 0) {\n      ctx.println(stmt, `var self = this;`);\n      this.visitAllStatements(method.body, ctx);\n    }\n    ctx.decIndent();\n    ctx.println(stmt, `};`);\n  }\n\n  visitWrappedNodeExpr(ast: o.WrappedNodeExpr<any>, ctx: EmitterVisitorContext): any {\n    throw new Error('Cannot emit a WrappedNodeExpr in Javascript.');\n  }\n\n  visitReadVarExpr(ast: o.ReadVarExpr, ctx: EmitterVisitorContext): string|null {\n    if (ast.builtin === o.BuiltinVar.This) {\n      ctx.print(ast, 'self');\n    } else if (ast.builtin === o.BuiltinVar.Super) {\n      throw new Error(\n          `'super' needs to be handled at a parent ast node, not at the variable level!`);\n    } else {\n      super.visitReadVarExpr(ast, ctx);\n    }\n    return null;\n  }\n  visitDeclareVarStmt(stmt: o.DeclareVarStmt, ctx: EmitterVisitorContext): any {\n    ctx.print(stmt, `var ${stmt.name}`);\n    if (stmt.value) {\n      ctx.print(stmt, ' = ');\n      stmt.value.visitExpression(this, ctx);\n    }\n    ctx.println(stmt, `;`);\n    return null;\n  }\n  visitCastExpr(ast: o.CastExpr, ctx: EmitterVisitorContext): any {\n    ast.value.visitExpression(this, ctx);\n    return null;\n  }\n  visitInvokeFunctionExpr(expr: o.InvokeFunctionExpr, ctx: EmitterVisitorContext): string|null {\n    const fnExpr = expr.fn;\n    if (fnExpr instanceof o.ReadVarExpr && fnExpr.builtin === o.BuiltinVar.Super) {\n      ctx.currentClass !.parent !.visitExpression(this, ctx);\n      ctx.print(expr, `.call(this`);\n      if (expr.args.length > 0) {\n        ctx.print(expr, `, `);\n        this.visitAllExpressions(expr.args, ctx, ',');\n      }\n      ctx.print(expr, `)`);\n    } else {\n      super.visitInvokeFunctionExpr(expr, ctx);\n    }\n    return null;\n  }\n  visitFunctionExpr(ast: o.FunctionExpr, ctx: EmitterVisitorContext): any {\n    ctx.print(ast, `function${ast.name ? ' ' + ast.name : ''}(`);\n    this._visitParams(ast.params, ctx);\n    ctx.println(ast, `) {`);\n    ctx.incIndent();\n    this.visitAllStatements(ast.statements, ctx);\n    ctx.decIndent();\n    ctx.print(ast, `}`);\n    return null;\n  }\n  visitDeclareFunctionStmt(stmt: o.DeclareFunctionStmt, ctx: EmitterVisitorContext): any {\n    ctx.print(stmt, `function ${stmt.name}(`);\n    this._visitParams(stmt.params, ctx);\n    ctx.println(stmt, `) {`);\n    ctx.incIndent();\n    this.visitAllStatements(stmt.statements, ctx);\n    ctx.decIndent();\n    ctx.println(stmt, `}`);\n    return null;\n  }\n  visitTryCatchStmt(stmt: o.TryCatchStmt, ctx: EmitterVisitorContext): any {\n    ctx.println(stmt, `try {`);\n    ctx.incIndent();\n    this.visitAllStatements(stmt.bodyStmts, ctx);\n    ctx.decIndent();\n    ctx.println(stmt, `} catch (${CATCH_ERROR_VAR.name}) {`);\n    ctx.incIndent();\n    const catchStmts =\n        [<o.Statement>CATCH_STACK_VAR.set(CATCH_ERROR_VAR.prop('stack')).toDeclStmt(null, [\n          o.StmtModifier.Final\n        ])].concat(stmt.catchStmts);\n    this.visitAllStatements(catchStmts, ctx);\n    ctx.decIndent();\n    ctx.println(stmt, `}`);\n    return null;\n  }\n\n  private _visitParams(params: o.FnParam[], ctx: EmitterVisitorContext): void {\n    this.visitAllObjects(param => ctx.print(null, param.name), params, ctx, ',');\n  }\n\n  getBuiltinMethodName(method: o.BuiltinMethod): string {\n    let name: string;\n    switch (method) {\n      case o.BuiltinMethod.ConcatArray:\n        name = 'concat';\n        break;\n      case o.BuiltinMethod.SubscribeObservable:\n        name = 'subscribe';\n        break;\n      case o.BuiltinMethod.Bind:\n        name = 'bind';\n        break;\n      default:\n        throw new Error(`Unknown builtin method: ${method}`);\n    }\n    return name;\n  }\n}\n"],"sourceRoot":""}