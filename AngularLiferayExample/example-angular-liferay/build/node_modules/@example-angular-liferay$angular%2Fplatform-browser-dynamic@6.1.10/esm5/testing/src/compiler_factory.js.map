{"version":3,"sources":["../../../../../../../../../../../packages/platform-browser-dynamic/testing/src/compiler_factory.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {CompileReflector, DirectiveResolver, ERROR_COMPONENT_TYPE, NgModuleResolver, PipeResolver} from '@angular/compiler';\nimport {MockDirectiveResolver, MockNgModuleResolver, MockPipeResolver} from '@angular/compiler/testing';\nimport {Compiler, CompilerFactory, CompilerOptions, Component, ComponentFactory, Directive, Injectable, Injector, ModuleWithComponentFactories, NgModule, NgModuleFactory, Pipe, PlatformRef, StaticProvider, Type, createPlatformFactory, ɵstringify} from '@angular/core';\nimport {MetadataOverride, ɵTestingCompiler as TestingCompiler, ɵTestingCompilerFactory as TestingCompilerFactory} from '@angular/core/testing';\nimport {ɵCompilerImpl as CompilerImpl, ɵplatformCoreDynamic as platformCoreDynamic} from '@angular/platform-browser-dynamic';\n\nimport {MetadataOverrider} from './metadata_overrider';\n\nexport const COMPILER_PROVIDERS: StaticProvider[] = [\n  {provide: MockPipeResolver, deps: [CompileReflector]},\n  {provide: PipeResolver, useExisting: MockPipeResolver},\n  {provide: MockDirectiveResolver, deps: [CompileReflector]},\n  {provide: DirectiveResolver, useExisting: MockDirectiveResolver},\n  {provide: MockNgModuleResolver, deps: [CompileReflector]},\n  {provide: NgModuleResolver, useExisting: MockNgModuleResolver},\n];\n\nexport class TestingCompilerFactoryImpl implements TestingCompilerFactory {\n  constructor(private _injector: Injector, private _compilerFactory: CompilerFactory) {}\n\n  createTestingCompiler(options: CompilerOptions[]): TestingCompiler {\n    const compiler = <CompilerImpl>this._compilerFactory.createCompiler(options);\n    return new TestingCompilerImpl(\n        compiler, compiler.injector.get(MockDirectiveResolver),\n        compiler.injector.get(MockPipeResolver), compiler.injector.get(MockNgModuleResolver));\n  }\n}\n\nexport class TestingCompilerImpl implements TestingCompiler {\n  private _overrider = new MetadataOverrider();\n  constructor(\n      private _compiler: CompilerImpl, private _directiveResolver: MockDirectiveResolver,\n      private _pipeResolver: MockPipeResolver, private _moduleResolver: MockNgModuleResolver) {}\n  get injector(): Injector { return this._compiler.injector; }\n\n  compileModuleSync<T>(moduleType: Type<T>): NgModuleFactory<T> {\n    return this._compiler.compileModuleSync(moduleType);\n  }\n\n  compileModuleAsync<T>(moduleType: Type<T>): Promise<NgModuleFactory<T>> {\n    return this._compiler.compileModuleAsync(moduleType);\n  }\n  compileModuleAndAllComponentsSync<T>(moduleType: Type<T>): ModuleWithComponentFactories<T> {\n    return this._compiler.compileModuleAndAllComponentsSync(moduleType);\n  }\n\n  compileModuleAndAllComponentsAsync<T>(moduleType: Type<T>):\n      Promise<ModuleWithComponentFactories<T>> {\n    return this._compiler.compileModuleAndAllComponentsAsync(moduleType);\n  }\n\n  getComponentFactory<T>(component: Type<T>): ComponentFactory<T> {\n    return this._compiler.getComponentFactory(component);\n  }\n\n  checkOverrideAllowed(type: Type<any>) {\n    if (this._compiler.hasAotSummary(type)) {\n      throw new Error(`${ɵstringify(type)} was AOT compiled, so its metadata cannot be changed.`);\n    }\n  }\n\n  overrideModule(ngModule: Type<any>, override: MetadataOverride<NgModule>): void {\n    this.checkOverrideAllowed(ngModule);\n    const oldMetadata = this._moduleResolver.resolve(ngModule, false);\n    this._moduleResolver.setNgModule(\n        ngModule, this._overrider.overrideMetadata(NgModule, oldMetadata, override));\n    this.clearCacheFor(ngModule);\n  }\n  overrideDirective(directive: Type<any>, override: MetadataOverride<Directive>): void {\n    this.checkOverrideAllowed(directive);\n    const oldMetadata = this._directiveResolver.resolve(directive, false);\n    this._directiveResolver.setDirective(\n        directive, this._overrider.overrideMetadata(Directive, oldMetadata !, override));\n    this.clearCacheFor(directive);\n  }\n  overrideComponent(component: Type<any>, override: MetadataOverride<Component>): void {\n    this.checkOverrideAllowed(component);\n    const oldMetadata = this._directiveResolver.resolve(component, false);\n    this._directiveResolver.setDirective(\n        component, this._overrider.overrideMetadata(Component, oldMetadata !, override));\n    this.clearCacheFor(component);\n  }\n  overridePipe(pipe: Type<any>, override: MetadataOverride<Pipe>): void {\n    this.checkOverrideAllowed(pipe);\n    const oldMetadata = this._pipeResolver.resolve(pipe, false);\n    this._pipeResolver.setPipe(pipe, this._overrider.overrideMetadata(Pipe, oldMetadata, override));\n    this.clearCacheFor(pipe);\n  }\n  loadAotSummaries(summaries: () => any[]) { this._compiler.loadAotSummaries(summaries); }\n  clearCache(): void { this._compiler.clearCache(); }\n  clearCacheFor(type: Type<any>) { this._compiler.clearCacheFor(type); }\n\n  getComponentFromError(error: Error) { return (error as any)[ERROR_COMPONENT_TYPE] || null; }\n\n  getModuleId(moduleType: Type<any>): string|undefined {\n    return this._moduleResolver.resolve(moduleType, true).id;\n  }\n}\n"],"sourceRoot":""}