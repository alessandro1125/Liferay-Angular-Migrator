{"version":3,"sources":["../../../../../../../../../../../packages/core/testing/src/test_bed.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ApplicationInitStatus, CompilerOptions, Component, Directive, InjectionToken, Injector, ModuleWithComponentFactories, NgModule, NgModuleFactory, NgModuleRef, NgZone, Optional, Pipe, PlatformRef, Provider, SchemaMetadata, SkipSelf, StaticProvider, Type, ɵAPP_ROOT as APP_ROOT, ɵDepFlags as DepFlags, ɵNodeFlags as NodeFlags, ɵclearOverrides as clearOverrides, ɵgetComponentViewDefinitionFactory as getComponentViewDefinitionFactory, ɵoverrideComponentView as overrideComponentView, ɵoverrideProvider as overrideProvider, ɵstringify as stringify} from '@angular/core';\n\nimport {AsyncTestCompleter} from './async_test_completer';\nimport {ComponentFixture} from './component_fixture';\nimport {MetadataOverride} from './metadata_override';\nimport {TestingCompiler, TestingCompilerFactory} from './test_compiler';\n\nconst UNDEFINED = new Object();\n\n/**\n * An abstract class for inserting the root test component element in a platform independent way.\n *\n * @experimental\n */\nexport class TestComponentRenderer {\n  insertRootElement(rootElementId: string) {}\n}\n\nlet _nextRootElementId = 0;\n\n/**\n * @experimental\n */\nexport const ComponentFixtureAutoDetect =\n    new InjectionToken<boolean[]>('ComponentFixtureAutoDetect');\n\n/**\n * @experimental\n */\nexport const ComponentFixtureNoNgZone = new InjectionToken<boolean[]>('ComponentFixtureNoNgZone');\n\n/**\n * @experimental\n */\nexport type TestModuleMetadata = {\n  providers?: any[],\n  declarations?: any[],\n  imports?: any[],\n  schemas?: Array<SchemaMetadata|any[]>,\n  aotSummaries?: () => any[],\n};\n\n/**\n * @description\n * Configures and initializes environment for unit testing and provides methods for\n * creating components and services in unit tests.\n *\n * TestBed is the primary api for writing unit tests for Angular applications and libraries.\n *\n *\n */\nexport class TestBed implements Injector {\n  /**\n   * Initialize the environment for testing with a compiler factory, a PlatformRef, and an\n   * angular module. These are common to every test in the suite.\n   *\n   * This may only be called once, to set up the common providers for the current test\n   * suite on the current platform. If you absolutely need to change the providers,\n   * first use `resetTestEnvironment`.\n   *\n   * Test modules and platforms for individual platforms are available from\n   * '@angular/<platform_name>/testing'.\n   *\n   * @experimental\n   */\n  static initTestEnvironment(\n      ngModule: Type<any>|Type<any>[], platform: PlatformRef, aotSummaries?: () => any[]): TestBed {\n    const testBed = getTestBed();\n    testBed.initTestEnvironment(ngModule, platform, aotSummaries);\n    return testBed;\n  }\n\n  /**\n   * Reset the providers for the test injector.\n   *\n   * @experimental\n   */\n  static resetTestEnvironment() { getTestBed().resetTestEnvironment(); }\n\n  static resetTestingModule(): typeof TestBed {\n    getTestBed().resetTestingModule();\n    return TestBed;\n  }\n\n  /**\n   * Allows overriding default compiler providers and settings\n   * which are defined in test_injector.js\n   */\n  static configureCompiler(config: {providers?: any[]; useJit?: boolean;}): typeof TestBed {\n    getTestBed().configureCompiler(config);\n    return TestBed;\n  }\n\n  /**\n   * Allows overriding default providers, directives, pipes, modules of the test injector,\n   * which are defined in test_injector.js\n   */\n  static configureTestingModule(moduleDef: TestModuleMetadata): typeof TestBed {\n    getTestBed().configureTestingModule(moduleDef);\n    return TestBed;\n  }\n\n  /**\n   * Compile components with a `templateUrl` for the test's NgModule.\n   * It is necessary to call this function\n   * as fetching urls is asynchronous.\n   */\n  static compileComponents(): Promise<any> { return getTestBed().compileComponents(); }\n\n  static overrideModule(ngModule: Type<any>, override: MetadataOverride<NgModule>): typeof TestBed {\n    getTestBed().overrideModule(ngModule, override);\n    return TestBed;\n  }\n\n  static overrideComponent(component: Type<any>, override: MetadataOverride<Component>):\n      typeof TestBed {\n    getTestBed().overrideComponent(component, override);\n    return TestBed;\n  }\n\n  static overrideDirective(directive: Type<any>, override: MetadataOverride<Directive>):\n      typeof TestBed {\n    getTestBed().overrideDirective(directive, override);\n    return TestBed;\n  }\n\n  static overridePipe(pipe: Type<any>, override: MetadataOverride<Pipe>): typeof TestBed {\n    getTestBed().overridePipe(pipe, override);\n    return TestBed;\n  }\n\n  static overrideTemplate(component: Type<any>, template: string): typeof TestBed {\n    getTestBed().overrideComponent(component, {set: {template, templateUrl: null !}});\n    return TestBed;\n  }\n\n  /**\n   * Overrides the template of the given component, compiling the template\n   * in the context of the TestingModule.\n   *\n   * Note: This works for JIT and AOTed components as well.\n   */\n  static overrideTemplateUsingTestingModule(component: Type<any>, template: string):\n      typeof TestBed {\n    getTestBed().overrideTemplateUsingTestingModule(component, template);\n    return TestBed;\n  }\n\n\n  /**\n   * Overwrites all providers for the given token with the given provider definition.\n   *\n   * Note: This works for JIT and AOTed components as well.\n   */\n  static overrideProvider(token: any, provider: {\n    useFactory: Function,\n    deps: any[],\n  }): typeof TestBed;\n  static overrideProvider(token: any, provider: {useValue: any;}): typeof TestBed;\n  static overrideProvider(token: any, provider: {\n    useFactory?: Function,\n    useValue?: any,\n    deps?: any[],\n  }): typeof TestBed {\n    getTestBed().overrideProvider(token, provider as any);\n    return TestBed;\n  }\n\n  /**\n   * Overwrites all providers for the given token with the given provider definition.\n   *\n   * @deprecated as it makes all NgModules lazy. Introduced only for migrating off of it.\n   */\n  static deprecatedOverrideProvider(token: any, provider: {\n    useFactory: Function,\n    deps: any[],\n  }): void;\n  static deprecatedOverrideProvider(token: any, provider: {useValue: any;}): void;\n  static deprecatedOverrideProvider(token: any, provider: {\n    useFactory?: Function,\n    useValue?: any,\n    deps?: any[],\n  }): typeof TestBed {\n    getTestBed().deprecatedOverrideProvider(token, provider as any);\n    return TestBed;\n  }\n\n  static get(token: any, notFoundValue: any = Injector.THROW_IF_NOT_FOUND) {\n    return getTestBed().get(token, notFoundValue);\n  }\n\n  static createComponent<T>(component: Type<T>): ComponentFixture<T> {\n    return getTestBed().createComponent(component);\n  }\n\n  private _instantiated: boolean = false;\n\n  private _compiler: TestingCompiler = null !;\n  private _moduleRef: NgModuleRef<any> = null !;\n  private _moduleFactory: NgModuleFactory<any> = null !;\n\n  private _compilerOptions: CompilerOptions[] = [];\n\n  private _moduleOverrides: [Type<any>, MetadataOverride<NgModule>][] = [];\n  private _componentOverrides: [Type<any>, MetadataOverride<Component>][] = [];\n  private _directiveOverrides: [Type<any>, MetadataOverride<Directive>][] = [];\n  private _pipeOverrides: [Type<any>, MetadataOverride<Pipe>][] = [];\n\n  private _providers: Provider[] = [];\n  private _declarations: Array<Type<any>|any[]|any> = [];\n  private _imports: Array<Type<any>|any[]|any> = [];\n  private _schemas: Array<SchemaMetadata|any[]> = [];\n  private _activeFixtures: ComponentFixture<any>[] = [];\n\n  private _testEnvAotSummaries: () => any[] = () => [];\n  private _aotSummaries: Array<() => any[]> = [];\n  private _templateOverrides: Array<{component: Type<any>, templateOf: Type<any>}> = [];\n\n  private _isRoot: boolean = true;\n  private _rootProviderOverrides: Provider[] = [];\n\n  platform: PlatformRef = null !;\n\n  ngModule: Type<any>|Type<any>[] = null !;\n\n  /**\n   * Initialize the environment for testing with a compiler factory, a PlatformRef, and an\n   * angular module. These are common to every test in the suite.\n   *\n   * This may only be called once, to set up the common providers for the current test\n   * suite on the current platform. If you absolutely need to change the providers,\n   * first use `resetTestEnvironment`.\n   *\n   * Test modules and platforms for individual platforms are available from\n   * '@angular/<platform_name>/testing'.\n   *\n   * @experimental\n   */\n  initTestEnvironment(\n      ngModule: Type<any>|Type<any>[], platform: PlatformRef, aotSummaries?: () => any[]) {\n    if (this.platform || this.ngModule) {\n      throw new Error('Cannot set base providers because it has already been called');\n    }\n    this.platform = platform;\n    this.ngModule = ngModule;\n    if (aotSummaries) {\n      this._testEnvAotSummaries = aotSummaries;\n    }\n  }\n\n  /**\n   * Reset the providers for the test injector.\n   *\n   * @experimental\n   */\n  resetTestEnvironment() {\n    this.resetTestingModule();\n    this.platform = null !;\n    this.ngModule = null !;\n    this._testEnvAotSummaries = () => [];\n  }\n\n  resetTestingModule() {\n    clearOverrides();\n    this._aotSummaries = [];\n    this._templateOverrides = [];\n    this._compiler = null !;\n    this._moduleOverrides = [];\n    this._componentOverrides = [];\n    this._directiveOverrides = [];\n    this._pipeOverrides = [];\n\n    this._isRoot = true;\n    this._rootProviderOverrides = [];\n\n    this._moduleRef = null !;\n    this._moduleFactory = null !;\n    this._compilerOptions = [];\n    this._providers = [];\n    this._declarations = [];\n    this._imports = [];\n    this._schemas = [];\n    this._instantiated = false;\n    this._activeFixtures.forEach((fixture) => {\n      try {\n        fixture.destroy();\n      } catch (e) {\n        console.error('Error during cleanup of component', {\n          component: fixture.componentInstance,\n          stacktrace: e,\n        });\n      }\n    });\n    this._activeFixtures = [];\n  }\n\n  configureCompiler(config: {providers?: any[], useJit?: boolean}) {\n    this._assertNotInstantiated('TestBed.configureCompiler', 'configure the compiler');\n    this._compilerOptions.push(config);\n  }\n\n  configureTestingModule(moduleDef: TestModuleMetadata) {\n    this._assertNotInstantiated('TestBed.configureTestingModule', 'configure the test module');\n    if (moduleDef.providers) {\n      this._providers.push(...moduleDef.providers);\n    }\n    if (moduleDef.declarations) {\n      this._declarations.push(...moduleDef.declarations);\n    }\n    if (moduleDef.imports) {\n      this._imports.push(...moduleDef.imports);\n    }\n    if (moduleDef.schemas) {\n      this._schemas.push(...moduleDef.schemas);\n    }\n    if (moduleDef.aotSummaries) {\n      this._aotSummaries.push(moduleDef.aotSummaries);\n    }\n  }\n\n  compileComponents(): Promise<any> {\n    if (this._moduleFactory || this._instantiated) {\n      return Promise.resolve(null);\n    }\n\n    const moduleType = this._createCompilerAndModule();\n    return this._compiler.compileModuleAndAllComponentsAsync(moduleType)\n        .then((moduleAndComponentFactories) => {\n          this._moduleFactory = moduleAndComponentFactories.ngModuleFactory;\n        });\n  }\n\n  private _initIfNeeded() {\n    if (this._instantiated) {\n      return;\n    }\n    if (!this._moduleFactory) {\n      try {\n        const moduleType = this._createCompilerAndModule();\n        this._moduleFactory =\n            this._compiler.compileModuleAndAllComponentsSync(moduleType).ngModuleFactory;\n      } catch (e) {\n        const errorCompType = this._compiler.getComponentFromError(e);\n        if (errorCompType) {\n          throw new Error(\n              `This test module uses the component ${stringify(errorCompType)} which is using a \"templateUrl\" or \"styleUrls\", but they were never compiled. ` +\n              `Please call \"TestBed.compileComponents\" before your test.`);\n        } else {\n          throw e;\n        }\n      }\n    }\n    for (const {component, templateOf} of this._templateOverrides) {\n      const compFactory = this._compiler.getComponentFactory(templateOf);\n      overrideComponentView(component, compFactory);\n    }\n\n    const ngZone = new NgZone({enableLongStackTrace: true});\n    const providers: StaticProvider[] = [{provide: NgZone, useValue: ngZone}];\n    const ngZoneInjector = Injector.create({\n      providers: providers,\n      parent: this.platform.injector,\n      name: this._moduleFactory.moduleType.name\n    });\n    this._moduleRef = this._moduleFactory.create(ngZoneInjector);\n    // ApplicationInitStatus.runInitializers() is marked @internal to core. So casting to any\n    // before accessing it.\n    (this._moduleRef.injector.get(ApplicationInitStatus) as any).runInitializers();\n    this._instantiated = true;\n  }\n\n  private _createCompilerAndModule(): Type<any> {\n    const providers = this._providers.concat([{provide: TestBed, useValue: this}]);\n    const declarations =\n        [...this._declarations, ...this._templateOverrides.map(entry => entry.templateOf)];\n\n    const rootScopeImports = [];\n    const rootProviderOverrides = this._rootProviderOverrides;\n    if (this._isRoot) {\n      @NgModule({\n        providers: [\n          ...rootProviderOverrides,\n        ],\n        jit: true,\n      })\n      class RootScopeModule {\n      }\n      rootScopeImports.push(RootScopeModule);\n    }\n    providers.push({provide: APP_ROOT, useValue: this._isRoot});\n\n    const imports = [rootScopeImports, this.ngModule, this._imports];\n    const schemas = this._schemas;\n\n    @NgModule({providers, declarations, imports, schemas, jit: true})\n    class DynamicTestModule {\n    }\n\n    const compilerFactory: TestingCompilerFactory =\n        this.platform.injector.get(TestingCompilerFactory);\n    this._compiler = compilerFactory.createTestingCompiler(this._compilerOptions);\n    for (const summary of [this._testEnvAotSummaries, ...this._aotSummaries]) {\n      this._compiler.loadAotSummaries(summary);\n    }\n    this._moduleOverrides.forEach((entry) => this._compiler.overrideModule(entry[0], entry[1]));\n    this._componentOverrides.forEach(\n        (entry) => this._compiler.overrideComponent(entry[0], entry[1]));\n    this._directiveOverrides.forEach(\n        (entry) => this._compiler.overrideDirective(entry[0], entry[1]));\n    this._pipeOverrides.forEach((entry) => this._compiler.overridePipe(entry[0], entry[1]));\n    return DynamicTestModule;\n  }\n\n  private _assertNotInstantiated(methodName: string, methodDescription: string) {\n    if (this._instantiated) {\n      throw new Error(\n          `Cannot ${methodDescription} when the test module has already been instantiated. ` +\n          `Make sure you are not using \\`inject\\` before \\`${methodName}\\`.`);\n    }\n  }\n\n  get(token: any, notFoundValue: any = Injector.THROW_IF_NOT_FOUND) {\n    this._initIfNeeded();\n    if (token === TestBed) {\n      return this;\n    }\n    // Tests can inject things from the ng module and from the compiler,\n    // but the ng module can't inject things from the compiler and vice versa.\n    const result = this._moduleRef.injector.get(token, UNDEFINED);\n    return result === UNDEFINED ? this._compiler.injector.get(token, notFoundValue) : result;\n  }\n\n  execute(tokens: any[], fn: Function, context?: any): any {\n    this._initIfNeeded();\n    const params = tokens.map(t => this.get(t));\n    return fn.apply(context, params);\n  }\n\n  overrideModule(ngModule: Type<any>, override: MetadataOverride<NgModule>): void {\n    this._assertNotInstantiated('overrideModule', 'override module metadata');\n    this._moduleOverrides.push([ngModule, override]);\n  }\n\n  overrideComponent(component: Type<any>, override: MetadataOverride<Component>): void {\n    this._assertNotInstantiated('overrideComponent', 'override component metadata');\n    this._componentOverrides.push([component, override]);\n  }\n\n  overrideDirective(directive: Type<any>, override: MetadataOverride<Directive>): void {\n    this._assertNotInstantiated('overrideDirective', 'override directive metadata');\n    this._directiveOverrides.push([directive, override]);\n  }\n\n  overridePipe(pipe: Type<any>, override: MetadataOverride<Pipe>): void {\n    this._assertNotInstantiated('overridePipe', 'override pipe metadata');\n    this._pipeOverrides.push([pipe, override]);\n  }\n\n  /**\n   * Overwrites all providers for the given token with the given provider definition.\n   */\n  overrideProvider(token: any, provider: {\n    useFactory: Function,\n    deps: any[],\n  }): void;\n  overrideProvider(token: any, provider: {useValue: any;}): void;\n  overrideProvider(token: any, provider: {useFactory?: Function, useValue?: any, deps?: any[]}):\n      void {\n    this.overrideProviderImpl(token, provider);\n  }\n\n  /**\n   * Overwrites all providers for the given token with the given provider definition.\n   *\n   * @deprecated as it makes all NgModules lazy. Introduced only for migrating off of it.\n   */\n  deprecatedOverrideProvider(token: any, provider: {\n    useFactory: Function,\n    deps: any[],\n  }): void;\n  deprecatedOverrideProvider(token: any, provider: {useValue: any;}): void;\n  deprecatedOverrideProvider(\n      token: any, provider: {useFactory?: Function, useValue?: any, deps?: any[]}): void {\n    this.overrideProviderImpl(token, provider, /* deprecated */ true);\n  }\n\n  private overrideProviderImpl(\n      token: any, provider: {\n        useFactory?: Function,\n        useValue?: any,\n        deps?: any[],\n      },\n      deprecated = false): void {\n    if (typeof token !== 'string' && token.ngInjectableDef &&\n        token.ngInjectableDef.providedIn === 'root') {\n      if (provider.useFactory) {\n        this._rootProviderOverrides.push(\n            {provide: token, useFactory: provider.useFactory, deps: provider.deps || []});\n      } else {\n        this._rootProviderOverrides.push({provide: token, useValue: provider.useValue});\n      }\n    }\n    let flags: NodeFlags = 0;\n    let value: any;\n    if (provider.useFactory) {\n      flags |= NodeFlags.TypeFactoryProvider;\n      value = provider.useFactory;\n    } else {\n      flags |= NodeFlags.TypeValueProvider;\n      value = provider.useValue;\n    }\n    const deps = (provider.deps || []).map((dep) => {\n      let depFlags: DepFlags = DepFlags.None;\n      let depToken: any;\n      if (Array.isArray(dep)) {\n        dep.forEach((entry: any) => {\n          if (entry instanceof Optional) {\n            depFlags |= DepFlags.Optional;\n          } else if (entry instanceof SkipSelf) {\n            depFlags |= DepFlags.SkipSelf;\n          } else {\n            depToken = entry;\n          }\n        });\n      } else {\n        depToken = dep;\n      }\n      return [depFlags, depToken];\n    });\n    overrideProvider({token, flags, deps, value, deprecatedBehavior: deprecated});\n  }\n\n  overrideTemplateUsingTestingModule(component: Type<any>, template: string) {\n    this._assertNotInstantiated('overrideTemplateUsingTestingModule', 'override template');\n\n    @Component({selector: 'empty', template, jit: true})\n    class OverrideComponent {\n    }\n\n    this._templateOverrides.push({component, templateOf: OverrideComponent});\n  }\n\n  createComponent<T>(component: Type<T>): ComponentFixture<T> {\n    this._initIfNeeded();\n    const componentFactory = this._compiler.getComponentFactory(component);\n\n    if (!componentFactory) {\n      throw new Error(\n          `Cannot create the component ${stringify(component)} as it was not imported into the testing module!`);\n    }\n\n    const noNgZone = this.get(ComponentFixtureNoNgZone, false);\n    const autoDetect: boolean = this.get(ComponentFixtureAutoDetect, false);\n    const ngZone: NgZone = noNgZone ? null : this.get(NgZone, null);\n    const testComponentRenderer: TestComponentRenderer = this.get(TestComponentRenderer);\n    const rootElId = `root${_nextRootElementId++}`;\n    testComponentRenderer.insertRootElement(rootElId);\n\n    const initComponent = () => {\n      const componentRef =\n          componentFactory.create(Injector.NULL, [], `#${rootElId}`, this._moduleRef);\n      return new ComponentFixture<T>(componentRef, ngZone, autoDetect);\n    };\n\n    const fixture = !ngZone ? initComponent() : ngZone.run(initComponent);\n    this._activeFixtures.push(fixture);\n    return fixture;\n  }\n}\n\nlet _testBed: TestBed = null !;\n\n/**\n * @experimental\n */\nexport function getTestBed() {\n  return _testBed = _testBed || new TestBed();\n}\n\n/**\n * Allows injecting dependencies in `beforeEach()` and `it()`.\n *\n * Example:\n *\n * ```\n * beforeEach(inject([Dependency, AClass], (dep, object) => {\n *   // some code that uses `dep` and `object`\n *   // ...\n * }));\n *\n * it('...', inject([AClass], (object) => {\n *   object.doSomething();\n *   expect(...);\n * })\n * ```\n *\n * Notes:\n * - inject is currently a function because of some Traceur limitation the syntax should\n * eventually\n *   becomes `it('...', @Inject (object: AClass, async: AsyncTestCompleter) => { ... });`\n *\n *\n */\nexport function inject(tokens: any[], fn: Function): () => any {\n  const testBed = getTestBed();\n  if (tokens.indexOf(AsyncTestCompleter) >= 0) {\n    // Not using an arrow function to preserve context passed from call site\n    return function() {\n      // Return an async test method that returns a Promise if AsyncTestCompleter is one of\n      // the injected tokens.\n      return testBed.compileComponents().then(() => {\n        const completer: AsyncTestCompleter = testBed.get(AsyncTestCompleter);\n        testBed.execute(tokens, fn, this);\n        return completer.promise;\n      });\n    };\n  } else {\n    // Not using an arrow function to preserve context passed from call site\n    return function() { return testBed.execute(tokens, fn, this); };\n  }\n}\n\n/**\n * @experimental\n */\nexport class InjectSetupWrapper {\n  constructor(private _moduleDef: () => TestModuleMetadata) {}\n\n  private _addModule() {\n    const moduleDef = this._moduleDef();\n    if (moduleDef) {\n      getTestBed().configureTestingModule(moduleDef);\n    }\n  }\n\n  inject(tokens: any[], fn: Function): () => any {\n    const self = this;\n    // Not using an arrow function to preserve context passed from call site\n    return function() {\n      self._addModule();\n      return inject(tokens, fn).call(this);\n    };\n  }\n}\n\n/**\n * @experimental\n */\nexport function withModule(moduleDef: TestModuleMetadata): InjectSetupWrapper;\nexport function withModule(moduleDef: TestModuleMetadata, fn: Function): () => any;\nexport function withModule(moduleDef: TestModuleMetadata, fn?: Function | null): (() => any)|\n    InjectSetupWrapper {\n  if (fn) {\n    // Not using an arrow function to preserve context passed from call site\n    return function() {\n      const testBed = getTestBed();\n      if (moduleDef) {\n        testBed.configureTestingModule(moduleDef);\n      }\n      return fn.apply(this);\n    };\n  }\n  return new InjectSetupWrapper(() => moduleDef);\n}"],"sourceRoot":""}