{"version":3,"sources":["../../../../../../../../../../packages/core/src/view/provider.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {ChangeDetectorRef, SimpleChange, SimpleChanges, WrappedValue} from '../change_detection/change_detection';\nimport {INJECTOR, Injector, resolveForwardRef} from '../di';\nimport {ElementRef} from '../linker/element_ref';\nimport {TemplateRef} from '../linker/template_ref';\nimport {ViewContainerRef} from '../linker/view_container_ref';\nimport {Renderer as RendererV1, Renderer2} from '../render/api';\nimport {stringify} from '../util';\n\nimport {createChangeDetectorRef, createInjector, createRendererV1} from './refs';\nimport {BindingDef, BindingFlags, DepDef, DepFlags, NodeDef, NodeFlags, OutputDef, OutputType, ProviderData, QueryValueType, Services, ViewData, ViewFlags, ViewState, asElementData, asProviderData, shouldCallLifecycleInitHook} from './types';\nimport {calcBindingFlags, checkBinding, dispatchEvent, isComponentView, splitDepsDsl, splitMatchedQueriesDsl, tokenKey, viewParentEl} from './util';\n\nconst RendererV1TokenKey = tokenKey(RendererV1);\nconst Renderer2TokenKey = tokenKey(Renderer2);\nconst ElementRefTokenKey = tokenKey(ElementRef);\nconst ViewContainerRefTokenKey = tokenKey(ViewContainerRef);\nconst TemplateRefTokenKey = tokenKey(TemplateRef);\nconst ChangeDetectorRefTokenKey = tokenKey(ChangeDetectorRef);\nconst InjectorRefTokenKey = tokenKey(Injector);\nconst INJECTORRefTokenKey = tokenKey(INJECTOR);\n\nexport function directiveDef(\n    checkIndex: number, flags: NodeFlags,\n    matchedQueries: null | [string | number, QueryValueType][], childCount: number, ctor: any,\n    deps: ([DepFlags, any] | any)[], props?: null | {[name: string]: [number, string]},\n    outputs?: null | {[name: string]: string}): NodeDef {\n  const bindings: BindingDef[] = [];\n  if (props) {\n    for (let prop in props) {\n      const [bindingIndex, nonMinifiedName] = props[prop];\n      bindings[bindingIndex] = {\n        flags: BindingFlags.TypeProperty,\n        name: prop, nonMinifiedName,\n        ns: null,\n        securityContext: null,\n        suffix: null\n      };\n    }\n  }\n  const outputDefs: OutputDef[] = [];\n  if (outputs) {\n    for (let propName in outputs) {\n      outputDefs.push(\n          {type: OutputType.DirectiveOutput, propName, target: null, eventName: outputs[propName]});\n    }\n  }\n  flags |= NodeFlags.TypeDirective;\n  return _def(\n      checkIndex, flags, matchedQueries, childCount, ctor, ctor, deps, bindings, outputDefs);\n}\n\nexport function pipeDef(flags: NodeFlags, ctor: any, deps: ([DepFlags, any] | any)[]): NodeDef {\n  flags |= NodeFlags.TypePipe;\n  return _def(-1, flags, null, 0, ctor, ctor, deps);\n}\n\nexport function providerDef(\n    flags: NodeFlags, matchedQueries: null | [string | number, QueryValueType][], token: any,\n    value: any, deps: ([DepFlags, any] | any)[]): NodeDef {\n  return _def(-1, flags, matchedQueries, 0, token, value, deps);\n}\n\nexport function _def(\n    checkIndex: number, flags: NodeFlags,\n    matchedQueriesDsl: [string | number, QueryValueType][] | null, childCount: number, token: any,\n    value: any, deps: ([DepFlags, any] | any)[], bindings?: BindingDef[],\n    outputs?: OutputDef[]): NodeDef {\n  const {matchedQueries, references, matchedQueryIds} = splitMatchedQueriesDsl(matchedQueriesDsl);\n  if (!outputs) {\n    outputs = [];\n  }\n  if (!bindings) {\n    bindings = [];\n  }\n  // Need to resolve forwardRefs as e.g. for `useValue` we\n  // lowered the expression and then stopped evaluating it,\n  // i.e. also didn't unwrap it.\n  value = resolveForwardRef(value);\n\n  const depDefs = splitDepsDsl(deps, stringify(token));\n\n  return {\n    // will bet set by the view definition\n    nodeIndex: -1,\n    parent: null,\n    renderParent: null,\n    bindingIndex: -1,\n    outputIndex: -1,\n    // regular values\n    checkIndex,\n    flags,\n    childFlags: 0,\n    directChildFlags: 0,\n    childMatchedQueries: 0, matchedQueries, matchedQueryIds, references,\n    ngContentIndex: -1, childCount, bindings,\n    bindingFlags: calcBindingFlags(bindings), outputs,\n    element: null,\n    provider: {token, value, deps: depDefs},\n    text: null,\n    query: null,\n    ngContent: null\n  };\n}\n\nexport function createProviderInstance(view: ViewData, def: NodeDef): any {\n  return _createProviderInstance(view, def);\n}\n\nexport function createPipeInstance(view: ViewData, def: NodeDef): any {\n  // deps are looked up from component.\n  let compView = view;\n  while (compView.parent && !isComponentView(compView)) {\n    compView = compView.parent;\n  }\n  // pipes can see the private services of the component\n  const allowPrivateServices = true;\n  // pipes are always eager and classes!\n  return createClass(\n      compView.parent !, viewParentEl(compView) !, allowPrivateServices, def.provider !.value,\n      def.provider !.deps);\n}\n\nexport function createDirectiveInstance(view: ViewData, def: NodeDef): any {\n  // components can see other private services, other directives can't.\n  const allowPrivateServices = (def.flags & NodeFlags.Component) > 0;\n  // directives are always eager and classes!\n  const instance = createClass(\n      view, def.parent !, allowPrivateServices, def.provider !.value, def.provider !.deps);\n  if (def.outputs.length) {\n    for (let i = 0; i < def.outputs.length; i++) {\n      const output = def.outputs[i];\n      const subscription = instance[output.propName !].subscribe(\n          eventHandlerClosure(view, def.parent !.nodeIndex, output.eventName));\n      view.disposables ![def.outputIndex + i] = subscription.unsubscribe.bind(subscription);\n    }\n  }\n  return instance;\n}\n\nfunction eventHandlerClosure(view: ViewData, index: number, eventName: string) {\n  return (event: any) => dispatchEvent(view, index, eventName, event);\n}\n\nexport function checkAndUpdateDirectiveInline(\n    view: ViewData, def: NodeDef, v0: any, v1: any, v2: any, v3: any, v4: any, v5: any, v6: any,\n    v7: any, v8: any, v9: any): boolean {\n  const providerData = asProviderData(view, def.nodeIndex);\n  const directive = providerData.instance;\n  let changed = false;\n  let changes: SimpleChanges = undefined !;\n  const bindLen = def.bindings.length;\n  if (bindLen > 0 && checkBinding(view, def, 0, v0)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 0, v0, changes);\n  }\n  if (bindLen > 1 && checkBinding(view, def, 1, v1)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 1, v1, changes);\n  }\n  if (bindLen > 2 && checkBinding(view, def, 2, v2)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 2, v2, changes);\n  }\n  if (bindLen > 3 && checkBinding(view, def, 3, v3)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 3, v3, changes);\n  }\n  if (bindLen > 4 && checkBinding(view, def, 4, v4)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 4, v4, changes);\n  }\n  if (bindLen > 5 && checkBinding(view, def, 5, v5)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 5, v5, changes);\n  }\n  if (bindLen > 6 && checkBinding(view, def, 6, v6)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 6, v6, changes);\n  }\n  if (bindLen > 7 && checkBinding(view, def, 7, v7)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 7, v7, changes);\n  }\n  if (bindLen > 8 && checkBinding(view, def, 8, v8)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 8, v8, changes);\n  }\n  if (bindLen > 9 && checkBinding(view, def, 9, v9)) {\n    changed = true;\n    changes = updateProp(view, providerData, def, 9, v9, changes);\n  }\n  if (changes) {\n    directive.ngOnChanges(changes);\n  }\n  if ((def.flags & NodeFlags.OnInit) &&\n      shouldCallLifecycleInitHook(view, ViewState.InitState_CallingOnInit, def.nodeIndex)) {\n    directive.ngOnInit();\n  }\n  if (def.flags & NodeFlags.DoCheck) {\n    directive.ngDoCheck();\n  }\n  return changed;\n}\n\nexport function checkAndUpdateDirectiveDynamic(\n    view: ViewData, def: NodeDef, values: any[]): boolean {\n  const providerData = asProviderData(view, def.nodeIndex);\n  const directive = providerData.instance;\n  let changed = false;\n  let changes: SimpleChanges = undefined !;\n  for (let i = 0; i < values.length; i++) {\n    if (checkBinding(view, def, i, values[i])) {\n      changed = true;\n      changes = updateProp(view, providerData, def, i, values[i], changes);\n    }\n  }\n  if (changes) {\n    directive.ngOnChanges(changes);\n  }\n  if ((def.flags & NodeFlags.OnInit) &&\n      shouldCallLifecycleInitHook(view, ViewState.InitState_CallingOnInit, def.nodeIndex)) {\n    directive.ngOnInit();\n  }\n  if (def.flags & NodeFlags.DoCheck) {\n    directive.ngDoCheck();\n  }\n  return changed;\n}\n\nfunction _createProviderInstance(view: ViewData, def: NodeDef): any {\n  // private services can see other private services\n  const allowPrivateServices = (def.flags & NodeFlags.PrivateProvider) > 0;\n  const providerDef = def.provider;\n  switch (def.flags & NodeFlags.Types) {\n    case NodeFlags.TypeClassProvider:\n      return createClass(\n          view, def.parent !, allowPrivateServices, providerDef !.value, providerDef !.deps);\n    case NodeFlags.TypeFactoryProvider:\n      return callFactory(\n          view, def.parent !, allowPrivateServices, providerDef !.value, providerDef !.deps);\n    case NodeFlags.TypeUseExistingProvider:\n      return resolveDep(view, def.parent !, allowPrivateServices, providerDef !.deps[0]);\n    case NodeFlags.TypeValueProvider:\n      return providerDef !.value;\n  }\n}\n\nfunction createClass(\n    view: ViewData, elDef: NodeDef, allowPrivateServices: boolean, ctor: any, deps: DepDef[]): any {\n  const len = deps.length;\n  switch (len) {\n    case 0:\n      return new ctor();\n    case 1:\n      return new ctor(resolveDep(view, elDef, allowPrivateServices, deps[0]));\n    case 2:\n      return new ctor(\n          resolveDep(view, elDef, allowPrivateServices, deps[0]),\n          resolveDep(view, elDef, allowPrivateServices, deps[1]));\n    case 3:\n      return new ctor(\n          resolveDep(view, elDef, allowPrivateServices, deps[0]),\n          resolveDep(view, elDef, allowPrivateServices, deps[1]),\n          resolveDep(view, elDef, allowPrivateServices, deps[2]));\n    default:\n      const depValues = new Array(len);\n      for (let i = 0; i < len; i++) {\n        depValues[i] = resolveDep(view, elDef, allowPrivateServices, deps[i]);\n      }\n      return new ctor(...depValues);\n  }\n}\n\nfunction callFactory(\n    view: ViewData, elDef: NodeDef, allowPrivateServices: boolean, factory: any,\n    deps: DepDef[]): any {\n  const len = deps.length;\n  switch (len) {\n    case 0:\n      return factory();\n    case 1:\n      return factory(resolveDep(view, elDef, allowPrivateServices, deps[0]));\n    case 2:\n      return factory(\n          resolveDep(view, elDef, allowPrivateServices, deps[0]),\n          resolveDep(view, elDef, allowPrivateServices, deps[1]));\n    case 3:\n      return factory(\n          resolveDep(view, elDef, allowPrivateServices, deps[0]),\n          resolveDep(view, elDef, allowPrivateServices, deps[1]),\n          resolveDep(view, elDef, allowPrivateServices, deps[2]));\n    default:\n      const depValues = Array(len);\n      for (let i = 0; i < len; i++) {\n        depValues[i] = resolveDep(view, elDef, allowPrivateServices, deps[i]);\n      }\n      return factory(...depValues);\n  }\n}\n\n// This default value is when checking the hierarchy for a token.\n//\n// It means both:\n// - the token is not provided by the current injector,\n// - only the element injectors should be checked (ie do not check module injectors\n//\n//          mod1\n//         /\n//       el1   mod2\n//         \\  /\n//         el2\n//\n// When requesting el2.injector.get(token), we should check in the following order and return the\n// first found value:\n// - el2.injector.get(token, default)\n// - el1.injector.get(token, NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR) -> do not check the module\n// - mod2.injector.get(token, default)\nexport const NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR = {};\n\nexport function resolveDep(\n    view: ViewData, elDef: NodeDef, allowPrivateServices: boolean, depDef: DepDef,\n    notFoundValue: any = Injector.THROW_IF_NOT_FOUND): any {\n  if (depDef.flags & DepFlags.Value) {\n    return depDef.token;\n  }\n  const startView = view;\n  if (depDef.flags & DepFlags.Optional) {\n    notFoundValue = null;\n  }\n  const tokenKey = depDef.tokenKey;\n\n  if (tokenKey === ChangeDetectorRefTokenKey) {\n    // directives on the same element as a component should be able to control the change detector\n    // of that component as well.\n    allowPrivateServices = !!(elDef && elDef.element !.componentView);\n  }\n\n  if (elDef && (depDef.flags & DepFlags.SkipSelf)) {\n    allowPrivateServices = false;\n    elDef = elDef.parent !;\n  }\n\n  let searchView: ViewData|null = view;\n  while (searchView) {\n    if (elDef) {\n      switch (tokenKey) {\n        case RendererV1TokenKey: {\n          const compView = findCompView(searchView, elDef, allowPrivateServices);\n          return createRendererV1(compView);\n        }\n        case Renderer2TokenKey: {\n          const compView = findCompView(searchView, elDef, allowPrivateServices);\n          return compView.renderer;\n        }\n        case ElementRefTokenKey:\n          return new ElementRef(asElementData(searchView, elDef.nodeIndex).renderElement);\n        case ViewContainerRefTokenKey:\n          return asElementData(searchView, elDef.nodeIndex).viewContainer;\n        case TemplateRefTokenKey: {\n          if (elDef.element !.template) {\n            return asElementData(searchView, elDef.nodeIndex).template;\n          }\n          break;\n        }\n        case ChangeDetectorRefTokenKey: {\n          let cdView = findCompView(searchView, elDef, allowPrivateServices);\n          return createChangeDetectorRef(cdView);\n        }\n        case InjectorRefTokenKey:\n        case INJECTORRefTokenKey:\n          return createInjector(searchView, elDef);\n        default:\n          const providerDef =\n              (allowPrivateServices ? elDef.element !.allProviders :\n                                      elDef.element !.publicProviders) ![tokenKey];\n          if (providerDef) {\n            let providerData = asProviderData(searchView, providerDef.nodeIndex);\n            if (!providerData) {\n              providerData = {instance: _createProviderInstance(searchView, providerDef)};\n              searchView.nodes[providerDef.nodeIndex] = providerData as any;\n            }\n            return providerData.instance;\n          }\n      }\n    }\n\n    allowPrivateServices = isComponentView(searchView);\n    elDef = viewParentEl(searchView) !;\n    searchView = searchView.parent !;\n\n    if (depDef.flags & DepFlags.Self) {\n      searchView = null;\n    }\n  }\n\n  const value = startView.root.injector.get(depDef.token, NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR);\n\n  if (value !== NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR ||\n      notFoundValue === NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR) {\n    // Return the value from the root element injector when\n    // - it provides it\n    //   (value !== NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR)\n    // - the module injector should not be checked\n    //   (notFoundValue === NOT_FOUND_CHECK_ONLY_ELEMENT_INJECTOR)\n    return value;\n  }\n\n  return startView.root.ngModule.injector.get(depDef.token, notFoundValue);\n}\n\nfunction findCompView(view: ViewData, elDef: NodeDef, allowPrivateServices: boolean) {\n  let compView: ViewData;\n  if (allowPrivateServices) {\n    compView = asElementData(view, elDef.nodeIndex).componentView;\n  } else {\n    compView = view;\n    while (compView.parent && !isComponentView(compView)) {\n      compView = compView.parent;\n    }\n  }\n  return compView;\n}\n\nfunction updateProp(\n    view: ViewData, providerData: ProviderData, def: NodeDef, bindingIdx: number, value: any,\n    changes: SimpleChanges): SimpleChanges {\n  if (def.flags & NodeFlags.Component) {\n    const compView = asElementData(view, def.parent !.nodeIndex).componentView;\n    if (compView.def.flags & ViewFlags.OnPush) {\n      compView.state |= ViewState.ChecksEnabled;\n    }\n  }\n  const binding = def.bindings[bindingIdx];\n  const propName = binding.name !;\n  // Note: This is still safe with Closure Compiler as\n  // the user passed in the property name as an object has to `providerDef`,\n  // so Closure Compiler will have renamed the property correctly already.\n  providerData.instance[propName] = value;\n  if (def.flags & NodeFlags.OnChanges) {\n    changes = changes || {};\n    const oldValue = WrappedValue.unwrap(view.oldValues[def.bindingIndex + bindingIdx]);\n    const binding = def.bindings[bindingIdx];\n    changes[binding.nonMinifiedName !] =\n        new SimpleChange(oldValue, value, (view.state & ViewState.FirstCheck) !== 0);\n  }\n  view.oldValues[def.bindingIndex + bindingIdx] = value;\n  return changes;\n}\n\n// This function calls the ngAfterContentCheck, ngAfterContentInit,\n// ngAfterViewCheck, and ngAfterViewInit lifecycle hooks (depending on the node\n// flags in lifecycle). Unlike ngDoCheck, ngOnChanges and ngOnInit, which are\n// called during a pre-order traversal of the view tree (that is calling the\n// parent hooks before the child hooks) these events are sent in using a\n// post-order traversal of the tree (children before parents). This changes the\n// meaning of initIndex in the view state. For ngOnInit, initIndex tracks the\n// expected nodeIndex which a ngOnInit should be called. When sending\n// ngAfterContentInit and ngAfterViewInit it is the expected count of\n// ngAfterContentInit or ngAfterViewInit methods that have been called. This\n// ensure that despite being called recursively or after picking up after an\n// exception, the ngAfterContentInit or ngAfterViewInit will be called on the\n// correct nodes. Consider for example, the following (where E is an element\n// and D is a directive)\n//  Tree:       pre-order index  post-order index\n//    E1        0                6\n//      E2      1                1\n//       D3     2                0\n//      E4      3                5\n//       E5     4                4\n//        E6    5                2\n//        E7    6                3\n// As can be seen, the post-order index has an unclear relationship to the\n// pre-order index (postOrderIndex === preOrderIndex - parentCount +\n// childCount). Since number of calls to ngAfterContentInit and ngAfterViewInit\n// are stable (will be the same for the same view regardless of exceptions or\n// recursion) we just need to count them which will roughly correspond to the\n// post-order index (it skips elements and directives that do not have\n// lifecycle hooks).\n//\n// For example, if an exception is raised in the E6.onAfterViewInit() the\n// initIndex is left at 3 (by shouldCallLifecycleInitHook() which set it to\n// initIndex + 1). When checkAndUpdateView() is called again D3, E2 and E6 will\n// not have their ngAfterViewInit() called but, starting with E7, the rest of\n// the view will begin getting ngAfterViewInit() called until a check and\n// pass is complete.\n//\n// This algorthim also handles recursion. Consider if E4's ngAfterViewInit()\n// indirectly calls E1's ChangeDetectorRef.detectChanges(). The expected\n// initIndex is set to 6, the recusive checkAndUpdateView() starts walk again.\n// D3, E2, E6, E7, E5 and E4 are skipped, ngAfterViewInit() is called on E1.\n// When the recursion returns the initIndex will be 7 so E1 is skipped as it\n// has already been called in the recursively called checkAnUpdateView().\nexport function callLifecycleHooksChildrenFirst(view: ViewData, lifecycles: NodeFlags) {\n  if (!(view.def.nodeFlags & lifecycles)) {\n    return;\n  }\n  const nodes = view.def.nodes;\n  let initIndex = 0;\n  for (let i = 0; i < nodes.length; i++) {\n    const nodeDef = nodes[i];\n    let parent = nodeDef.parent;\n    if (!parent && nodeDef.flags & lifecycles) {\n      // matching root node (e.g. a pipe)\n      callProviderLifecycles(view, i, nodeDef.flags & lifecycles, initIndex++);\n    }\n    if ((nodeDef.childFlags & lifecycles) === 0) {\n      // no child matches one of the lifecycles\n      i += nodeDef.childCount;\n    }\n    while (parent && (parent.flags & NodeFlags.TypeElement) &&\n           i === parent.nodeIndex + parent.childCount) {\n      // last child of an element\n      if (parent.directChildFlags & lifecycles) {\n        initIndex = callElementProvidersLifecycles(view, parent, lifecycles, initIndex);\n      }\n      parent = parent.parent;\n    }\n  }\n}\n\nfunction callElementProvidersLifecycles(\n    view: ViewData, elDef: NodeDef, lifecycles: NodeFlags, initIndex: number): number {\n  for (let i = elDef.nodeIndex + 1; i <= elDef.nodeIndex + elDef.childCount; i++) {\n    const nodeDef = view.def.nodes[i];\n    if (nodeDef.flags & lifecycles) {\n      callProviderLifecycles(view, i, nodeDef.flags & lifecycles, initIndex++);\n    }\n    // only visit direct children\n    i += nodeDef.childCount;\n  }\n  return initIndex;\n}\n\nfunction callProviderLifecycles(\n    view: ViewData, index: number, lifecycles: NodeFlags, initIndex: number) {\n  const providerData = asProviderData(view, index);\n  if (!providerData) {\n    return;\n  }\n  const provider = providerData.instance;\n  if (!provider) {\n    return;\n  }\n  Services.setCurrentNode(view, index);\n  if (lifecycles & NodeFlags.AfterContentInit &&\n      shouldCallLifecycleInitHook(view, ViewState.InitState_CallingAfterContentInit, initIndex)) {\n    provider.ngAfterContentInit();\n  }\n  if (lifecycles & NodeFlags.AfterContentChecked) {\n    provider.ngAfterContentChecked();\n  }\n  if (lifecycles & NodeFlags.AfterViewInit &&\n      shouldCallLifecycleInitHook(view, ViewState.InitState_CallingAfterViewInit, initIndex)) {\n    provider.ngAfterViewInit();\n  }\n  if (lifecycles & NodeFlags.AfterViewChecked) {\n    provider.ngAfterViewChecked();\n  }\n  if (lifecycles & NodeFlags.OnDestroy) {\n    provider.ngOnDestroy();\n  }\n}\n"],"sourceRoot":""}