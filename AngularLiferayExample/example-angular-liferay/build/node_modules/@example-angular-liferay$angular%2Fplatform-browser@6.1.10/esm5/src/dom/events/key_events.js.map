{"version":3,"sources":["../../../../../../../../../../../packages/platform-browser/src/dom/events/key_events.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Inject, Injectable, NgZone} from '@angular/core';\n\nimport {getDOM} from '../dom_adapter';\nimport {DOCUMENT} from '../dom_tokens';\n\nimport {EventManagerPlugin} from './event_manager';\n\n/**\n * Defines supported modifiers for key events.\n */\nconst MODIFIER_KEYS = ['alt', 'control', 'meta', 'shift'];\n\n/**\n * Retrieves modifiers from key-event objects.\n */\nconst MODIFIER_KEY_GETTERS: {[key: string]: (event: KeyboardEvent) => boolean} = {\n  'alt': (event: KeyboardEvent) => event.altKey,\n  'control': (event: KeyboardEvent) => event.ctrlKey,\n  'meta': (event: KeyboardEvent) => event.metaKey,\n  'shift': (event: KeyboardEvent) => event.shiftKey\n};\n\n/**\n * @experimental\n * A browser plug-in that provides support for handling of key events in Angular.\n */\n@Injectable()\nexport class KeyEventsPlugin extends EventManagerPlugin {\n  /**\n   * Initializes an instance of the browser plug-in.\n   * @param doc The document in which key events will be detected.\n   */\n  constructor(@Inject(DOCUMENT) doc: any) { super(doc); }\n\n  /**\n    * Reports whether a named key event is supported.\n    * @param eventName The event name to query.\n    * @return True if the named key event is supported.\n   */\n  supports(eventName: string): boolean { return KeyEventsPlugin.parseEventName(eventName) != null; }\n\n  /**\n   * Registers a handler for a specific element and key event.\n   * @param element The HTML element to receive event notifications.\n   * @param eventName The name of the key event to listen for.\n   * @param handler A function to call when the notification occurs. Receives the\n   * event object as an argument.\n   * @returns The key event that was registered.\n  */\n  addEventListener(element: HTMLElement, eventName: string, handler: Function): Function {\n    const parsedEvent = KeyEventsPlugin.parseEventName(eventName) !;\n\n    const outsideHandler =\n        KeyEventsPlugin.eventCallback(parsedEvent['fullKey'], handler, this.manager.getZone());\n\n    return this.manager.getZone().runOutsideAngular(() => {\n      return getDOM().onAndCancel(element, parsedEvent['domEventName'], outsideHandler);\n    });\n  }\n\n  static parseEventName(eventName: string): {[key: string]: string}|null {\n    const parts: string[] = eventName.toLowerCase().split('.');\n\n    const domEventName = parts.shift();\n    if ((parts.length === 0) || !(domEventName === 'keydown' || domEventName === 'keyup')) {\n      return null;\n    }\n\n    const key = KeyEventsPlugin._normalizeKey(parts.pop() !);\n\n    let fullKey = '';\n    MODIFIER_KEYS.forEach(modifierName => {\n      const index: number = parts.indexOf(modifierName);\n      if (index > -1) {\n        parts.splice(index, 1);\n        fullKey += modifierName + '.';\n      }\n    });\n    fullKey += key;\n\n    if (parts.length != 0 || key.length === 0) {\n      // returning null instead of throwing to let another plugin process the event\n      return null;\n    }\n\n    const result: {[k: string]: string} = {};\n    result['domEventName'] = domEventName;\n    result['fullKey'] = fullKey;\n    return result;\n  }\n\n  static getEventFullKey(event: KeyboardEvent): string {\n    let fullKey = '';\n    let key = getDOM().getEventKey(event);\n    key = key.toLowerCase();\n    if (key === ' ') {\n      key = 'space';  // for readability\n    } else if (key === '.') {\n      key = 'dot';  // because '.' is used as a separator in event names\n    }\n    MODIFIER_KEYS.forEach(modifierName => {\n      if (modifierName != key) {\n        const modifierGetter = MODIFIER_KEY_GETTERS[modifierName];\n        if (modifierGetter(event)) {\n          fullKey += modifierName + '.';\n        }\n      }\n    });\n    fullKey += key;\n    return fullKey;\n  }\n\n  /**\n   * Configures a handler callback for a key event.\n   * @param fullKey The event name that combines all simultaneous keystrokes.\n   * @param handler The function that responds to the key event.\n   * @param zone The zone in which the event occurred.\n   * @returns A callback function.\n   */\n  static eventCallback(fullKey: any, handler: Function, zone: NgZone): Function {\n    return (event: any /** TODO #9100 */) => {\n      if (KeyEventsPlugin.getEventFullKey(event) === fullKey) {\n        zone.runGuarded(() => handler(event));\n      }\n    };\n  }\n\n  /** @internal */\n  static _normalizeKey(keyName: string): string {\n    // TODO: switch to a Map if the mapping grows too much\n    switch (keyName) {\n      case 'esc':\n        return 'escape';\n      default:\n        return keyName;\n    }\n  }\n}\n"],"sourceRoot":""}