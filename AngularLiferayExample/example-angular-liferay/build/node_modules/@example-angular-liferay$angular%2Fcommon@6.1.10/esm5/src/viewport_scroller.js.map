{"version":3,"sources":["../../../../../../../../../packages/common/src/viewport_scroller.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {defineInjectable, inject} from '@angular/core';\n\nimport {DOCUMENT} from './dom_tokens';\n\n/**\n * Manages the scroll position.\n */\nexport abstract class ViewportScroller {\n  // De-sugared tree-shakable injection\n  // See #23917\n  /** @nocollapse */\n  static ngInjectableDef = defineInjectable(\n      {providedIn: 'root', factory: () => new BrowserViewportScroller(inject(DOCUMENT), window)});\n\n  /**\n   * Configures the top offset used when scrolling to an anchor.\n   *\n   * When given a tuple with two number, the service will always use the numbers.\n   * When given a function, the service will invoke the function every time it restores scroll\n   * position.\n   */\n  abstract setOffset(offset: [number, number]|(() => [number, number])): void;\n\n  /**\n   * Returns the current scroll position.\n   */\n  abstract getScrollPosition(): [number, number];\n\n  /**\n   * Sets the scroll position.\n   */\n  abstract scrollToPosition(position: [number, number]): void;\n\n  /**\n   * Scrolls to the provided anchor.\n   */\n  abstract scrollToAnchor(anchor: string): void;\n\n  /**\n   *\n   * Disables automatic scroll restoration provided by the browser.\n   *\n   * See also [window.history.scrollRestoration\n   * info](https://developers.google.com/web/updates/2015/09/history-api-scroll-restoration)\n   */\n  abstract setHistoryScrollRestoration(scrollRestoration: 'auto'|'manual'): void;\n}\n\n/**\n * Manages the scroll position.\n */\nexport class BrowserViewportScroller implements ViewportScroller {\n  private offset: () => [number, number] = () => [0, 0];\n\n  constructor(private document: any, private window: any) {}\n\n  /**\n   * Configures the top offset used when scrolling to an anchor.\n   *\n   * * When given a number, the service will always use the number.\n   * * When given a function, the service will invoke the function every time it restores scroll\n   * position.\n   */\n  setOffset(offset: [number, number]|(() => [number, number])): void {\n    if (Array.isArray(offset)) {\n      this.offset = () => offset;\n    } else {\n      this.offset = offset;\n    }\n  }\n\n  /**\n   * Returns the current scroll position.\n   */\n  getScrollPosition(): [number, number] {\n    if (this.supportScrollRestoration()) {\n      return [this.window.scrollX, this.window.scrollY];\n    } else {\n      return [0, 0];\n    }\n  }\n\n  /**\n   * Sets the scroll position.\n   */\n  scrollToPosition(position: [number, number]): void {\n    if (this.supportScrollRestoration()) {\n      this.window.scrollTo(position[0], position[1]);\n    }\n  }\n\n  /**\n   * Scrolls to the provided anchor.\n   */\n  scrollToAnchor(anchor: string): void {\n    if (this.supportScrollRestoration()) {\n      const elSelectedById = this.document.querySelector(`#${anchor}`);\n      if (elSelectedById) {\n        this.scrollToElement(elSelectedById);\n        return;\n      }\n      const elSelectedByName = this.document.querySelector(`[name='${anchor}']`);\n      if (elSelectedByName) {\n        this.scrollToElement(elSelectedByName);\n        return;\n      }\n    }\n  }\n\n  /**\n   * Disables automatic scroll restoration provided by the browser.\n   */\n  setHistoryScrollRestoration(scrollRestoration: 'auto'|'manual'): void {\n    if (this.supportScrollRestoration()) {\n      const history = this.window.history;\n      if (history && history.scrollRestoration) {\n        history.scrollRestoration = scrollRestoration;\n      }\n    }\n  }\n\n  private scrollToElement(el: any): void {\n    const rect = el.getBoundingClientRect();\n    const left = rect.left + this.window.pageXOffset;\n    const top = rect.top + this.window.pageYOffset;\n    const offset = this.offset();\n    this.window.scrollTo(left - offset[0], top - offset[1]);\n  }\n\n  /**\n   * We only support scroll restoration when we can get a hold of window.\n   * This means that we do not support this behavior when running in a web worker.\n   *\n   * Lifting this restriction right now would require more changes in the dom adapter.\n   * Since webworkers aren't widely used, we will lift it once RouterScroller is\n   * battle-tested.\n   */\n  private supportScrollRestoration(): boolean {\n    try {\n      return !!this.window && !!this.window.scrollTo;\n    } catch (e) {\n      return false;\n    }\n  }\n}\n\n\n/**\n * Provides an empty implementation of the viewport scroller. This will\n * live in @angular/common as it will be used by both platform-server and platform-webworker.\n */\nexport class NullViewportScroller implements ViewportScroller {\n  /**\n   * Empty implementation\n   */\n  setOffset(offset: [number, number]|(() => [number, number])): void {}\n\n  /**\n   * Empty implementation\n   */\n  getScrollPosition(): [number, number] { return [0, 0]; }\n\n  /**\n   * Empty implementation\n   */\n  scrollToPosition(position: [number, number]): void {}\n\n  /**\n   * Empty implementation\n   */\n  scrollToAnchor(anchor: string): void {}\n\n  /**\n   * Empty implementation\n   */\n  setHistoryScrollRestoration(scrollRestoration: 'auto'|'manual'): void {}\n}"],"sourceRoot":""}