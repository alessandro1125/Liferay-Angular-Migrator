{"version":3,"sources":["../../../../../../../../../../../packages/common/http/src/headers.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\ninterface Update {\n  name: string;\n  value?: string|string[];\n  op: 'a'|'s'|'d';\n}\n\n/**\n * Immutable set of Http headers, with lazy parsing.\n *\n */\nexport class HttpHeaders {\n  /**\n   * Internal map of lowercase header names to values.\n   */\n  // TODO(issue/24571): remove '!'.\n  private headers !: Map<string, string[]>;\n\n\n  /**\n   * Internal map of lowercased header names to the normalized\n   * form of the name (the form seen first).\n   */\n  private normalizedNames: Map<string, string> = new Map();\n\n  /**\n   * Complete the lazy initialization of this object (needed before reading).\n   */\n  // TODO(issue/24571): remove '!'.\n  private lazyInit !: HttpHeaders | Function | null;\n\n  /**\n   * Queued updates to be materialized the next initialization.\n   */\n  private lazyUpdate: Update[]|null = null;\n\n  constructor(headers?: string|{[name: string]: string | string[]}) {\n    if (!headers) {\n      this.headers = new Map<string, string[]>();\n    } else if (typeof headers === 'string') {\n      this.lazyInit = () => {\n        this.headers = new Map<string, string[]>();\n        headers.split('\\n').forEach(line => {\n          const index = line.indexOf(':');\n          if (index > 0) {\n            const name = line.slice(0, index);\n            const key = name.toLowerCase();\n            const value = line.slice(index + 1).trim();\n            this.maybeSetNormalizedName(name, key);\n            if (this.headers.has(key)) {\n              this.headers.get(key) !.push(value);\n            } else {\n              this.headers.set(key, [value]);\n            }\n          }\n        });\n      };\n    } else {\n      this.lazyInit = () => {\n        this.headers = new Map<string, string[]>();\n        Object.keys(headers).forEach(name => {\n          let values: string|string[] = headers[name];\n          const key = name.toLowerCase();\n          if (typeof values === 'string') {\n            values = [values];\n          }\n          if (values.length > 0) {\n            this.headers.set(key, values);\n            this.maybeSetNormalizedName(name, key);\n          }\n        });\n      };\n    }\n  }\n\n  /**\n   * Checks for existence of header by given name.\n   */\n  has(name: string): boolean {\n    this.init();\n\n    return this.headers.has(name.toLowerCase());\n  }\n\n  /**\n   * Returns first header that matches given name.\n   */\n  get(name: string): string|null {\n    this.init();\n\n    const values = this.headers.get(name.toLowerCase());\n    return values && values.length > 0 ? values[0] : null;\n  }\n\n  /**\n   * Returns the names of the headers\n   */\n  keys(): string[] {\n    this.init();\n\n    return Array.from(this.normalizedNames.values());\n  }\n\n  /**\n   * Returns list of header values for a given name.\n   */\n  getAll(name: string): string[]|null {\n    this.init();\n\n    return this.headers.get(name.toLowerCase()) || null;\n  }\n\n  append(name: string, value: string|string[]): HttpHeaders {\n    return this.clone({name, value, op: 'a'});\n  }\n\n  set(name: string, value: string|string[]): HttpHeaders {\n    return this.clone({name, value, op: 's'});\n  }\n\n  delete (name: string, value?: string|string[]): HttpHeaders {\n    return this.clone({name, value, op: 'd'});\n  }\n\n  private maybeSetNormalizedName(name: string, lcName: string): void {\n    if (!this.normalizedNames.has(lcName)) {\n      this.normalizedNames.set(lcName, name);\n    }\n  }\n\n  private init(): void {\n    if (!!this.lazyInit) {\n      if (this.lazyInit instanceof HttpHeaders) {\n        this.copyFrom(this.lazyInit);\n      } else {\n        this.lazyInit();\n      }\n      this.lazyInit = null;\n      if (!!this.lazyUpdate) {\n        this.lazyUpdate.forEach(update => this.applyUpdate(update));\n        this.lazyUpdate = null;\n      }\n    }\n  }\n\n  private copyFrom(other: HttpHeaders) {\n    other.init();\n    Array.from(other.headers.keys()).forEach(key => {\n      this.headers.set(key, other.headers.get(key) !);\n      this.normalizedNames.set(key, other.normalizedNames.get(key) !);\n    });\n  }\n\n  private clone(update: Update): HttpHeaders {\n    const clone = new HttpHeaders();\n    clone.lazyInit =\n        (!!this.lazyInit && this.lazyInit instanceof HttpHeaders) ? this.lazyInit : this;\n    clone.lazyUpdate = (this.lazyUpdate || []).concat([update]);\n    return clone;\n  }\n\n  private applyUpdate(update: Update): void {\n    const key = update.name.toLowerCase();\n    switch (update.op) {\n      case 'a':\n      case 's':\n        let value = update.value !;\n        if (typeof value === 'string') {\n          value = [value];\n        }\n        if (value.length === 0) {\n          return;\n        }\n        this.maybeSetNormalizedName(update.name, key);\n        const base = (update.op === 'a' ? this.headers.get(key) : undefined) || [];\n        base.push(...value);\n        this.headers.set(key, base);\n        break;\n      case 'd':\n        const toDelete = update.value as string | undefined;\n        if (!toDelete) {\n          this.headers.delete(key);\n          this.normalizedNames.delete(key);\n        } else {\n          let existing = this.headers.get(key);\n          if (!existing) {\n            return;\n          }\n          existing = existing.filter(value => toDelete.indexOf(value) === -1);\n          if (existing.length === 0) {\n            this.headers.delete(key);\n            this.normalizedNames.delete(key);\n          } else {\n            this.headers.set(key, existing);\n          }\n        }\n        break;\n    }\n  }\n\n  /**\n   * @internal\n   */\n  forEach(fn: (name: string, values: string[]) => void) {\n    this.init();\n    Array.from(this.normalizedNames.keys())\n        .forEach(key => fn(this.normalizedNames.get(key) !, this.headers.get(key) !));\n  }\n}\n"],"sourceRoot":""}