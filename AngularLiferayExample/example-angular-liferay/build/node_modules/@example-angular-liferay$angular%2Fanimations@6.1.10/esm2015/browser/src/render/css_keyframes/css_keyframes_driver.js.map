{"version":3,"sources":["../../../../../../../../../packages/animations/browser/src/render/css_keyframes/css_keyframes_driver.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AnimationPlayer, ɵStyleData} from '@angular/animations';\n\nimport {allowPreviousPlayerStylesMerge, balancePreviousStylesIntoKeyframes, computeStyle} from '../../util';\nimport {AnimationDriver} from '../animation_driver';\nimport {containsElement, hypenatePropsObject, invokeQuery, matchesElement, validateStyleProperty} from '../shared';\n\nimport {CssKeyframesPlayer} from './css_keyframes_player';\nimport {DirectStylePlayer} from './direct_style_player';\n\nconst KEYFRAMES_NAME_PREFIX = 'gen_css_kf_';\nconst TAB_SPACE = ' ';\n\nexport class CssKeyframesDriver implements AnimationDriver {\n  private _count = 0;\n  private readonly _head: any = document.querySelector('head');\n  private _warningIssued = false;\n\n  validateStyleProperty(prop: string): boolean { return validateStyleProperty(prop); }\n\n  matchesElement(element: any, selector: string): boolean {\n    return matchesElement(element, selector);\n  }\n\n  containsElement(elm1: any, elm2: any): boolean { return containsElement(elm1, elm2); }\n\n  query(element: any, selector: string, multi: boolean): any[] {\n    return invokeQuery(element, selector, multi);\n  }\n\n  computeStyle(element: any, prop: string, defaultValue?: string): string {\n    return (window.getComputedStyle(element) as any)[prop] as string;\n  }\n\n  buildKeyframeElement(element: any, name: string, keyframes: {[key: string]: any}[]): any {\n    keyframes = keyframes.map(kf => hypenatePropsObject(kf));\n    let keyframeStr = `@keyframes ${name} {\\n`;\n    let tab = '';\n    keyframes.forEach(kf => {\n      tab = TAB_SPACE;\n      const offset = parseFloat(kf.offset);\n      keyframeStr += `${tab}${offset * 100}% {\\n`;\n      tab += TAB_SPACE;\n      Object.keys(kf).forEach(prop => {\n        const value = kf[prop];\n        switch (prop) {\n          case 'offset':\n            return;\n          case 'easing':\n            if (value) {\n              keyframeStr += `${tab}animation-timing-function: ${value};\\n`;\n            }\n            return;\n          default:\n            keyframeStr += `${tab}${prop}: ${value};\\n`;\n            return;\n        }\n      });\n      keyframeStr += `${tab}}\\n`;\n    });\n    keyframeStr += `}\\n`;\n\n    const kfElm = document.createElement('style');\n    kfElm.innerHTML = keyframeStr;\n    return kfElm;\n  }\n\n  animate(\n      element: any, keyframes: ɵStyleData[], duration: number, delay: number, easing: string,\n      previousPlayers: AnimationPlayer[] = [], scrubberAccessRequested?: boolean): AnimationPlayer {\n    if (scrubberAccessRequested) {\n      this._notifyFaultyScrubber();\n    }\n\n    const previousCssKeyframePlayers = <CssKeyframesPlayer[]>previousPlayers.filter(\n        player => player instanceof CssKeyframesPlayer);\n\n    const previousStyles: {[key: string]: any} = {};\n\n    if (allowPreviousPlayerStylesMerge(duration, delay)) {\n      previousCssKeyframePlayers.forEach(player => {\n        let styles = player.currentSnapshot;\n        Object.keys(styles).forEach(prop => previousStyles[prop] = styles[prop]);\n      });\n    }\n\n    keyframes = balancePreviousStylesIntoKeyframes(element, keyframes, previousStyles);\n    const finalStyles = flattenKeyframesIntoStyles(keyframes);\n\n    // if there is no animation then there is no point in applying\n    // styles and waiting for an event to get fired. This causes lag.\n    // It's better to just directly apply the styles to the element\n    // via the direct styling animation player.\n    if (duration == 0) {\n      return new DirectStylePlayer(element, finalStyles);\n    }\n\n    const animationName = `${KEYFRAMES_NAME_PREFIX}${this._count++}`;\n    const kfElm = this.buildKeyframeElement(element, animationName, keyframes);\n    document.querySelector('head') !.appendChild(kfElm);\n\n    const player = new CssKeyframesPlayer(\n        element, keyframes, animationName, duration, delay, easing, finalStyles);\n\n    player.onDestroy(() => removeElement(kfElm));\n    return player;\n  }\n\n  private _notifyFaultyScrubber() {\n    if (!this._warningIssued) {\n      console.warn(\n          '@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\\n',\n          '  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill.');\n      this._warningIssued = true;\n    }\n  }\n}\n\nfunction flattenKeyframesIntoStyles(\n    keyframes: null | {[key: string]: any} | {[key: string]: any}[]): {[key: string]: any} {\n  let flatKeyframes: {[key: string]: any} = {};\n  if (keyframes) {\n    const kfs = Array.isArray(keyframes) ? keyframes : [keyframes];\n    kfs.forEach(kf => {\n      Object.keys(kf).forEach(prop => {\n        if (prop == 'offset' || prop == 'easing') return;\n        flatKeyframes[prop] = kf[prop];\n      });\n    });\n  }\n  return flatKeyframes;\n}\n\nfunction removeElement(node: any) {\n  node.parentNode.removeChild(node);\n}\n"],"sourceRoot":""}