{"version":3,"sources":["../../../../../../../../../../../../packages/animations/browser/src/dsl/animation_ast_builder.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AUTO_STYLE, AnimateTimings, AnimationAnimateChildMetadata, AnimationAnimateMetadata, AnimationAnimateRefMetadata, AnimationGroupMetadata, AnimationKeyframesSequenceMetadata, AnimationMetadata, AnimationMetadataType, AnimationOptions, AnimationQueryMetadata, AnimationQueryOptions, AnimationReferenceMetadata, AnimationSequenceMetadata, AnimationStaggerMetadata, AnimationStateMetadata, AnimationStyleMetadata, AnimationTransitionMetadata, AnimationTriggerMetadata, style, ɵStyleData} from '@angular/animations';\n\nimport {AnimationDriver} from '../render/animation_driver';\nimport {getOrSetAsInMap} from '../render/shared';\nimport {ENTER_SELECTOR, LEAVE_SELECTOR, NG_ANIMATING_SELECTOR, NG_TRIGGER_SELECTOR, SUBSTITUTION_EXPR_START, copyObj, extractStyleParams, iteratorToArray, normalizeAnimationEntry, resolveTiming, validateStyleParams, visitDslNode} from '../util';\n\nimport {AnimateAst, AnimateChildAst, AnimateRefAst, Ast, DynamicTimingAst, GroupAst, KeyframesAst, QueryAst, ReferenceAst, SequenceAst, StaggerAst, StateAst, StyleAst, TimingAst, TransitionAst, TriggerAst} from './animation_ast';\nimport {AnimationDslVisitor} from './animation_dsl_visitor';\nimport {parseTransitionExpr} from './animation_transition_expr';\n\nconst SELF_TOKEN = ':self';\nconst SELF_TOKEN_REGEX = new RegExp(`\\s*${SELF_TOKEN}\\s*,?`, 'g');\n\n/*\n * [Validation]\n * The visitor code below will traverse the animation AST generated by the animation verb functions\n * (the output is a tree of objects) and attempt to perform a series of validations on the data. The\n * following corner-cases will be validated:\n *\n * 1. Overlap of animations\n * Given that a CSS property cannot be animated in more than one place at the same time, it's\n * important that this behaviour is detected and validated. The way in which this occurs is that\n * each time a style property is examined, a string-map containing the property will be updated with\n * the start and end times for when the property is used within an animation step.\n *\n * If there are two or more parallel animations that are currently running (these are invoked by the\n * group()) on the same element then the validator will throw an error. Since the start/end timing\n * values are collected for each property then if the current animation step is animating the same\n * property and its timing values fall anywhere into the window of time that the property is\n * currently being animated within then this is what causes an error.\n *\n * 2. Timing values\n * The validator will validate to see if a timing value of `duration delay easing` or\n * `durationNumber` is valid or not.\n *\n * (note that upon validation the code below will replace the timing data with an object containing\n * {duration,delay,easing}.\n *\n * 3. Offset Validation\n * Each of the style() calls are allowed to have an offset value when placed inside of keyframes().\n * Offsets within keyframes() are considered valid when:\n *\n *   - No offsets are used at all\n *   - Each style() entry contains an offset value\n *   - Each offset is between 0 and 1\n *   - Each offset is greater to or equal than the previous one\n *\n * Otherwise an error will be thrown.\n */\nexport function buildAnimationAst(\n    driver: AnimationDriver, metadata: AnimationMetadata | AnimationMetadata[],\n    errors: any[]): Ast<AnimationMetadataType> {\n  return new AnimationAstBuilderVisitor(driver).build(metadata, errors);\n}\n\nconst ROOT_SELECTOR = '';\n\nexport class AnimationAstBuilderVisitor implements AnimationDslVisitor {\n  constructor(private _driver: AnimationDriver) {}\n\n  build(metadata: AnimationMetadata|AnimationMetadata[], errors: any[]):\n      Ast<AnimationMetadataType> {\n    const context = new AnimationAstBuilderContext(errors);\n    this._resetContextStyleTimingState(context);\n    return <Ast<AnimationMetadataType>>visitDslNode(\n        this, normalizeAnimationEntry(metadata), context);\n  }\n\n  private _resetContextStyleTimingState(context: AnimationAstBuilderContext) {\n    context.currentQuerySelector = ROOT_SELECTOR;\n    context.collectedStyles = {};\n    context.collectedStyles[ROOT_SELECTOR] = {};\n    context.currentTime = 0;\n  }\n\n  visitTrigger(metadata: AnimationTriggerMetadata, context: AnimationAstBuilderContext):\n      TriggerAst {\n    let queryCount = context.queryCount = 0;\n    let depCount = context.depCount = 0;\n    const states: StateAst[] = [];\n    const transitions: TransitionAst[] = [];\n    if (metadata.name.charAt(0) == '@') {\n      context.errors.push(\n          'animation triggers cannot be prefixed with an `@` sign (e.g. trigger(\\'@foo\\', [...]))');\n    }\n\n    metadata.definitions.forEach(def => {\n      this._resetContextStyleTimingState(context);\n      if (def.type == AnimationMetadataType.State) {\n        const stateDef = def as AnimationStateMetadata;\n        const name = stateDef.name;\n        name.toString().split(/\\s*,\\s*/).forEach(n => {\n          stateDef.name = n;\n          states.push(this.visitState(stateDef, context));\n        });\n        stateDef.name = name;\n      } else if (def.type == AnimationMetadataType.Transition) {\n        const transition = this.visitTransition(def as AnimationTransitionMetadata, context);\n        queryCount += transition.queryCount;\n        depCount += transition.depCount;\n        transitions.push(transition);\n      } else {\n        context.errors.push(\n            'only state() and transition() definitions can sit inside of a trigger()');\n      }\n    });\n\n    return {\n      type: AnimationMetadataType.Trigger,\n      name: metadata.name, states, transitions, queryCount, depCount,\n      options: null\n    };\n  }\n\n  visitState(metadata: AnimationStateMetadata, context: AnimationAstBuilderContext): StateAst {\n    const styleAst = this.visitStyle(metadata.styles, context);\n    const astParams = (metadata.options && metadata.options.params) || null;\n    if (styleAst.containsDynamicStyles) {\n      const missingSubs = new Set<string>();\n      const params = astParams || {};\n      styleAst.styles.forEach(value => {\n        if (isObject(value)) {\n          const stylesObj = value as any;\n          Object.keys(stylesObj).forEach(prop => {\n            extractStyleParams(stylesObj[prop]).forEach(sub => {\n              if (!params.hasOwnProperty(sub)) {\n                missingSubs.add(sub);\n              }\n            });\n          });\n        }\n      });\n      if (missingSubs.size) {\n        const missingSubsArr = iteratorToArray(missingSubs.values());\n        context.errors.push(\n            `state(\"${metadata.name}\", ...) must define default values for all the following style substitutions: ${missingSubsArr.join(', ')}`);\n      }\n    }\n\n    return {\n      type: AnimationMetadataType.State,\n      name: metadata.name,\n      style: styleAst,\n      options: astParams ? {params: astParams} : null\n    };\n  }\n\n  visitTransition(metadata: AnimationTransitionMetadata, context: AnimationAstBuilderContext):\n      TransitionAst {\n    context.queryCount = 0;\n    context.depCount = 0;\n    const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);\n    const matchers = parseTransitionExpr(metadata.expr, context.errors);\n\n    return {\n      type: AnimationMetadataType.Transition,\n      matchers,\n      animation,\n      queryCount: context.queryCount,\n      depCount: context.depCount,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitSequence(metadata: AnimationSequenceMetadata, context: AnimationAstBuilderContext):\n      SequenceAst {\n    return {\n      type: AnimationMetadataType.Sequence,\n      steps: metadata.steps.map(s => visitDslNode(this, s, context)),\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitGroup(metadata: AnimationGroupMetadata, context: AnimationAstBuilderContext): GroupAst {\n    const currentTime = context.currentTime;\n    let furthestTime = 0;\n    const steps = metadata.steps.map(step => {\n      context.currentTime = currentTime;\n      const innerAst = visitDslNode(this, step, context);\n      furthestTime = Math.max(furthestTime, context.currentTime);\n      return innerAst;\n    });\n\n    context.currentTime = furthestTime;\n    return {\n      type: AnimationMetadataType.Group,\n      steps,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitAnimate(metadata: AnimationAnimateMetadata, context: AnimationAstBuilderContext):\n      AnimateAst {\n    const timingAst = constructTimingAst(metadata.timings, context.errors);\n    context.currentAnimateTimings = timingAst;\n\n    let styleAst: StyleAst|KeyframesAst;\n    let styleMetadata: AnimationMetadata = metadata.styles ? metadata.styles : style({});\n    if (styleMetadata.type == AnimationMetadataType.Keyframes) {\n      styleAst = this.visitKeyframes(styleMetadata as AnimationKeyframesSequenceMetadata, context);\n    } else {\n      let styleMetadata = metadata.styles as AnimationStyleMetadata;\n      let isEmpty = false;\n      if (!styleMetadata) {\n        isEmpty = true;\n        const newStyleData: {[prop: string]: string | number} = {};\n        if (timingAst.easing) {\n          newStyleData['easing'] = timingAst.easing;\n        }\n        styleMetadata = style(newStyleData);\n      }\n      context.currentTime += timingAst.duration + timingAst.delay;\n      const _styleAst = this.visitStyle(styleMetadata, context);\n      _styleAst.isEmptyStep = isEmpty;\n      styleAst = _styleAst;\n    }\n\n    context.currentAnimateTimings = null;\n    return {\n      type: AnimationMetadataType.Animate,\n      timings: timingAst,\n      style: styleAst,\n      options: null\n    };\n  }\n\n  visitStyle(metadata: AnimationStyleMetadata, context: AnimationAstBuilderContext): StyleAst {\n    const ast = this._makeStyleAst(metadata, context);\n    this._validateStyleAst(ast, context);\n    return ast;\n  }\n\n  private _makeStyleAst(metadata: AnimationStyleMetadata, context: AnimationAstBuilderContext):\n      StyleAst {\n    const styles: (ɵStyleData | string)[] = [];\n    if (Array.isArray(metadata.styles)) {\n      (metadata.styles as(ɵStyleData | string)[]).forEach(styleTuple => {\n        if (typeof styleTuple == 'string') {\n          if (styleTuple == AUTO_STYLE) {\n            styles.push(styleTuple as string);\n          } else {\n            context.errors.push(`The provided style string value ${styleTuple} is not allowed.`);\n          }\n        } else {\n          styles.push(styleTuple as ɵStyleData);\n        }\n      });\n    } else {\n      styles.push(metadata.styles);\n    }\n\n    let containsDynamicStyles = false;\n    let collectedEasing: string|null = null;\n    styles.forEach(styleData => {\n      if (isObject(styleData)) {\n        const styleMap = styleData as ɵStyleData;\n        const easing = styleMap['easing'];\n        if (easing) {\n          collectedEasing = easing as string;\n          delete styleMap['easing'];\n        }\n        if (!containsDynamicStyles) {\n          for (let prop in styleMap) {\n            const value = styleMap[prop];\n            if (value.toString().indexOf(SUBSTITUTION_EXPR_START) >= 0) {\n              containsDynamicStyles = true;\n              break;\n            }\n          }\n        }\n      }\n    });\n\n    return {\n      type: AnimationMetadataType.Style,\n      styles,\n      easing: collectedEasing,\n      offset: metadata.offset, containsDynamicStyles,\n      options: null\n    };\n  }\n\n  private _validateStyleAst(ast: StyleAst, context: AnimationAstBuilderContext): void {\n    const timings = context.currentAnimateTimings;\n    let endTime = context.currentTime;\n    let startTime = context.currentTime;\n    if (timings && startTime > 0) {\n      startTime -= timings.duration + timings.delay;\n    }\n\n    ast.styles.forEach(tuple => {\n      if (typeof tuple == 'string') return;\n\n      Object.keys(tuple).forEach(prop => {\n        if (!this._driver.validateStyleProperty(prop)) {\n          context.errors.push(\n              `The provided animation property \"${prop}\" is not a supported CSS property for animations`);\n          return;\n        }\n\n        const collectedStyles = context.collectedStyles[context.currentQuerySelector !];\n        const collectedEntry = collectedStyles[prop];\n        let updateCollectedStyle = true;\n        if (collectedEntry) {\n          if (startTime != endTime && startTime >= collectedEntry.startTime &&\n              endTime <= collectedEntry.endTime) {\n            context.errors.push(\n                `The CSS property \"${prop}\" that exists between the times of \"${collectedEntry.startTime}ms\" and \"${collectedEntry.endTime}ms\" is also being animated in a parallel animation between the times of \"${startTime}ms\" and \"${endTime}ms\"`);\n            updateCollectedStyle = false;\n          }\n\n          // we always choose the smaller start time value since we\n          // want to have a record of the entire animation window where\n          // the style property is being animated in between\n          startTime = collectedEntry.startTime;\n        }\n\n        if (updateCollectedStyle) {\n          collectedStyles[prop] = {startTime, endTime};\n        }\n\n        if (context.options) {\n          validateStyleParams(tuple[prop], context.options, context.errors);\n        }\n      });\n    });\n  }\n\n  visitKeyframes(metadata: AnimationKeyframesSequenceMetadata, context: AnimationAstBuilderContext):\n      KeyframesAst {\n    const ast: KeyframesAst = {type: AnimationMetadataType.Keyframes, styles: [], options: null};\n    if (!context.currentAnimateTimings) {\n      context.errors.push(`keyframes() must be placed inside of a call to animate()`);\n      return ast;\n    }\n\n    const MAX_KEYFRAME_OFFSET = 1;\n\n    let totalKeyframesWithOffsets = 0;\n    const offsets: number[] = [];\n    let offsetsOutOfOrder = false;\n    let keyframesOutOfRange = false;\n    let previousOffset: number = 0;\n\n    const keyframes: StyleAst[] = metadata.steps.map(styles => {\n      const style = this._makeStyleAst(styles, context);\n      let offsetVal: number|null =\n          style.offset != null ? style.offset : consumeOffset(style.styles);\n      let offset: number = 0;\n      if (offsetVal != null) {\n        totalKeyframesWithOffsets++;\n        offset = style.offset = offsetVal;\n      }\n      keyframesOutOfRange = keyframesOutOfRange || offset < 0 || offset > 1;\n      offsetsOutOfOrder = offsetsOutOfOrder || offset < previousOffset;\n      previousOffset = offset;\n      offsets.push(offset);\n      return style;\n    });\n\n    if (keyframesOutOfRange) {\n      context.errors.push(`Please ensure that all keyframe offsets are between 0 and 1`);\n    }\n\n    if (offsetsOutOfOrder) {\n      context.errors.push(`Please ensure that all keyframe offsets are in order`);\n    }\n\n    const length = metadata.steps.length;\n    let generatedOffset = 0;\n    if (totalKeyframesWithOffsets > 0 && totalKeyframesWithOffsets < length) {\n      context.errors.push(`Not all style() steps within the declared keyframes() contain offsets`);\n    } else if (totalKeyframesWithOffsets == 0) {\n      generatedOffset = MAX_KEYFRAME_OFFSET / (length - 1);\n    }\n\n    const limit = length - 1;\n    const currentTime = context.currentTime;\n    const currentAnimateTimings = context.currentAnimateTimings !;\n    const animateDuration = currentAnimateTimings.duration;\n    keyframes.forEach((kf, i) => {\n      const offset = generatedOffset > 0 ? (i == limit ? 1 : (generatedOffset * i)) : offsets[i];\n      const durationUpToThisFrame = offset * animateDuration;\n      context.currentTime = currentTime + currentAnimateTimings.delay + durationUpToThisFrame;\n      currentAnimateTimings.duration = durationUpToThisFrame;\n      this._validateStyleAst(kf, context);\n      kf.offset = offset;\n\n      ast.styles.push(kf);\n    });\n\n    return ast;\n  }\n\n  visitReference(metadata: AnimationReferenceMetadata, context: AnimationAstBuilderContext):\n      ReferenceAst {\n    return {\n      type: AnimationMetadataType.Reference,\n      animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context),\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitAnimateChild(metadata: AnimationAnimateChildMetadata, context: AnimationAstBuilderContext):\n      AnimateChildAst {\n    context.depCount++;\n    return {\n      type: AnimationMetadataType.AnimateChild,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitAnimateRef(metadata: AnimationAnimateRefMetadata, context: AnimationAstBuilderContext):\n      AnimateRefAst {\n    return {\n      type: AnimationMetadataType.AnimateRef,\n      animation: this.visitReference(metadata.animation, context),\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitQuery(metadata: AnimationQueryMetadata, context: AnimationAstBuilderContext): QueryAst {\n    const parentSelector = context.currentQuerySelector !;\n    const options = (metadata.options || {}) as AnimationQueryOptions;\n\n    context.queryCount++;\n    context.currentQuery = metadata;\n    const [selector, includeSelf] = normalizeSelector(metadata.selector);\n    context.currentQuerySelector =\n        parentSelector.length ? (parentSelector + ' ' + selector) : selector;\n    getOrSetAsInMap(context.collectedStyles, context.currentQuerySelector, {});\n\n    const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);\n    context.currentQuery = null;\n    context.currentQuerySelector = parentSelector;\n\n    return {\n      type: AnimationMetadataType.Query,\n      selector,\n      limit: options.limit || 0,\n      optional: !!options.optional, includeSelf, animation,\n      originalSelector: metadata.selector,\n      options: normalizeAnimationOptions(metadata.options)\n    };\n  }\n\n  visitStagger(metadata: AnimationStaggerMetadata, context: AnimationAstBuilderContext):\n      StaggerAst {\n    if (!context.currentQuery) {\n      context.errors.push(`stagger() can only be used inside of query()`);\n    }\n    const timings = metadata.timings === 'full' ?\n        {duration: 0, delay: 0, easing: 'full'} :\n        resolveTiming(metadata.timings, context.errors, true);\n\n    return {\n      type: AnimationMetadataType.Stagger,\n      animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context), timings,\n      options: null\n    };\n  }\n}\n\nfunction normalizeSelector(selector: string): [string, boolean] {\n  const hasAmpersand = selector.split(/\\s*,\\s*/).find(token => token == SELF_TOKEN) ? true : false;\n  if (hasAmpersand) {\n    selector = selector.replace(SELF_TOKEN_REGEX, '');\n  }\n\n  // the :enter and :leave selectors are filled in at runtime during timeline building\n  selector = selector.replace(/@\\*/g, NG_TRIGGER_SELECTOR)\n                 .replace(/@\\w+/g, match => NG_TRIGGER_SELECTOR + '-' + match.substr(1))\n                 .replace(/:animating/g, NG_ANIMATING_SELECTOR);\n\n  return [selector, hasAmpersand];\n}\n\n\nfunction normalizeParams(obj: {[key: string]: any} | any): {[key: string]: any}|null {\n  return obj ? copyObj(obj) : null;\n}\n\nexport type StyleTimeTuple = {\n  startTime: number; endTime: number;\n};\n\nexport class AnimationAstBuilderContext {\n  public queryCount: number = 0;\n  public depCount: number = 0;\n  public currentTransition: AnimationTransitionMetadata|null = null;\n  public currentQuery: AnimationQueryMetadata|null = null;\n  public currentQuerySelector: string|null = null;\n  public currentAnimateTimings: TimingAst|null = null;\n  public currentTime: number = 0;\n  public collectedStyles: {[selectorName: string]: {[propName: string]: StyleTimeTuple}} = {};\n  public options: AnimationOptions|null = null;\n  constructor(public errors: any[]) {}\n}\n\nfunction consumeOffset(styles: ɵStyleData | string | (ɵStyleData | string)[]): number|null {\n  if (typeof styles == 'string') return null;\n\n  let offset: number|null = null;\n\n  if (Array.isArray(styles)) {\n    styles.forEach(styleTuple => {\n      if (isObject(styleTuple) && styleTuple.hasOwnProperty('offset')) {\n        const obj = styleTuple as ɵStyleData;\n        offset = parseFloat(obj['offset'] as string);\n        delete obj['offset'];\n      }\n    });\n  } else if (isObject(styles) && styles.hasOwnProperty('offset')) {\n    const obj = styles as ɵStyleData;\n    offset = parseFloat(obj['offset'] as string);\n    delete obj['offset'];\n  }\n  return offset;\n}\n\nfunction isObject(value: any): boolean {\n  return !Array.isArray(value) && typeof value == 'object';\n}\n\nfunction constructTimingAst(value: string | number | AnimateTimings, errors: any[]) {\n  let timings: AnimateTimings|null = null;\n  if (value.hasOwnProperty('duration')) {\n    timings = value as AnimateTimings;\n  } else if (typeof value == 'number') {\n    const duration = resolveTiming(value as number, errors).duration;\n    return makeTimingAst(duration as number, 0, '');\n  }\n\n  const strValue = value as string;\n  const isDynamic = strValue.split(/\\s+/).some(v => v.charAt(0) == '{' && v.charAt(1) == '{');\n  if (isDynamic) {\n    const ast = makeTimingAst(0, 0, '') as any;\n    ast.dynamic = true;\n    ast.strValue = strValue;\n    return ast as DynamicTimingAst;\n  }\n\n  timings = timings || resolveTiming(strValue, errors);\n  return makeTimingAst(timings.duration, timings.delay, timings.easing);\n}\n\nfunction normalizeAnimationOptions(options: AnimationOptions | null): AnimationOptions {\n  if (options) {\n    options = copyObj(options);\n    if (options['params']) {\n      options['params'] = normalizeParams(options['params']) !;\n    }\n  } else {\n    options = {};\n  }\n  return options;\n}\n\nfunction makeTimingAst(duration: number, delay: number, easing: string | null): TimingAst {\n  return {duration, delay, easing};\n}\n"],"sourceRoot":""}