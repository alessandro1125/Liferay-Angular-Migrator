{"version":3,"sources":["../../../../../../../../../../../../packages/animations/browser/src/render/shared.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AUTO_STYLE, AnimationEvent, AnimationPlayer, NoopAnimationPlayer, ɵAnimationGroupPlayer, ɵPRE_STYLE as PRE_STYLE, ɵStyleData} from '@angular/animations';\n\nimport {AnimationStyleNormalizer} from '../../src/dsl/style_normalization/animation_style_normalizer';\nimport {AnimationDriver} from '../../src/render/animation_driver';\n\n// We don't include ambient node types here since @angular/animations/browser\n// is meant to target the browser so technically it should not depend on node\n// types. `process` is just declared locally here as a result.\ndeclare const process: any;\n\nexport function isBrowser() {\n  return (typeof window !== 'undefined' && typeof window.document !== 'undefined');\n}\n\nexport function isNode() {\n  return (typeof process !== 'undefined');\n}\n\nexport function optimizeGroupPlayer(players: AnimationPlayer[]): AnimationPlayer {\n  switch (players.length) {\n    case 0:\n      return new NoopAnimationPlayer();\n    case 1:\n      return players[0];\n    default:\n      return new ɵAnimationGroupPlayer(players);\n  }\n}\n\nexport function normalizeKeyframes(\n    driver: AnimationDriver, normalizer: AnimationStyleNormalizer, element: any,\n    keyframes: ɵStyleData[], preStyles: ɵStyleData = {},\n    postStyles: ɵStyleData = {}): ɵStyleData[] {\n  const errors: string[] = [];\n  const normalizedKeyframes: ɵStyleData[] = [];\n  let previousOffset = -1;\n  let previousKeyframe: ɵStyleData|null = null;\n  keyframes.forEach(kf => {\n    const offset = kf['offset'] as number;\n    const isSameOffset = offset == previousOffset;\n    const normalizedKeyframe: ɵStyleData = (isSameOffset && previousKeyframe) || {};\n    Object.keys(kf).forEach(prop => {\n      let normalizedProp = prop;\n      let normalizedValue = kf[prop];\n      if (prop !== 'offset') {\n        normalizedProp = normalizer.normalizePropertyName(normalizedProp, errors);\n        switch (normalizedValue) {\n          case PRE_STYLE:\n            normalizedValue = preStyles[prop];\n            break;\n\n          case AUTO_STYLE:\n            normalizedValue = postStyles[prop];\n            break;\n\n          default:\n            normalizedValue =\n                normalizer.normalizeStyleValue(prop, normalizedProp, normalizedValue, errors);\n            break;\n        }\n      }\n      normalizedKeyframe[normalizedProp] = normalizedValue;\n    });\n    if (!isSameOffset) {\n      normalizedKeyframes.push(normalizedKeyframe);\n    }\n    previousKeyframe = normalizedKeyframe;\n    previousOffset = offset;\n  });\n  if (errors.length) {\n    const LINE_START = '\\n - ';\n    throw new Error(\n        `Unable to animate due to the following errors:${LINE_START}${errors.join(LINE_START)}`);\n  }\n\n  return normalizedKeyframes;\n}\n\nexport function listenOnPlayer(\n    player: AnimationPlayer, eventName: string, event: AnimationEvent | undefined,\n    callback: (event: any) => any) {\n  switch (eventName) {\n    case 'start':\n      player.onStart(() => callback(event && copyAnimationEvent(event, 'start', player)));\n      break;\n    case 'done':\n      player.onDone(() => callback(event && copyAnimationEvent(event, 'done', player)));\n      break;\n    case 'destroy':\n      player.onDestroy(() => callback(event && copyAnimationEvent(event, 'destroy', player)));\n      break;\n  }\n}\n\nexport function copyAnimationEvent(\n    e: AnimationEvent, phaseName: string, player: AnimationPlayer): AnimationEvent {\n  const totalTime = player.totalTime;\n  const disabled = (player as any).disabled ? true : false;\n  const event = makeAnimationEvent(\n      e.element, e.triggerName, e.fromState, e.toState, phaseName || e.phaseName,\n      totalTime == undefined ? e.totalTime : totalTime, disabled);\n  const data = (e as any)['_data'];\n  if (data != null) {\n    (event as any)['_data'] = data;\n  }\n  return event;\n}\n\nexport function makeAnimationEvent(\n    element: any, triggerName: string, fromState: string, toState: string, phaseName: string = '',\n    totalTime: number = 0, disabled?: boolean): AnimationEvent {\n  return {element, triggerName, fromState, toState, phaseName, totalTime, disabled: !!disabled};\n}\n\nexport function getOrSetAsInMap(\n    map: Map<any, any>| {[key: string]: any}, key: any, defaultValue: any) {\n  let value: any;\n  if (map instanceof Map) {\n    value = map.get(key);\n    if (!value) {\n      map.set(key, value = defaultValue);\n    }\n  } else {\n    value = map[key];\n    if (!value) {\n      value = map[key] = defaultValue;\n    }\n  }\n  return value;\n}\n\nexport function parseTimelineCommand(command: string): [string, string] {\n  const separatorPos = command.indexOf(':');\n  const id = command.substring(1, separatorPos);\n  const action = command.substr(separatorPos + 1);\n  return [id, action];\n}\n\nlet _contains: (elm1: any, elm2: any) => boolean = (elm1: any, elm2: any) => false;\nlet _matches: (element: any, selector: string) => boolean = (element: any, selector: string) =>\n    false;\nlet _query: (element: any, selector: string, multi: boolean) => any[] =\n    (element: any, selector: string, multi: boolean) => {\n      return [];\n    };\n\n// Define utility methods for browsers and platform-server(domino) where Element\n// and utility methods exist.\nconst _isNode = isNode();\nif (_isNode || typeof Element !== 'undefined') {\n  // this is well supported in all browsers\n  _contains = (elm1: any, elm2: any) => { return elm1.contains(elm2) as boolean; };\n\n  if (_isNode || Element.prototype.matches) {\n    _matches = (element: any, selector: string) => element.matches(selector);\n  } else {\n    const proto = Element.prototype as any;\n    const fn = proto.matchesSelector || proto.mozMatchesSelector || proto.msMatchesSelector ||\n        proto.oMatchesSelector || proto.webkitMatchesSelector;\n    if (fn) {\n      _matches = (element: any, selector: string) => fn.apply(element, [selector]);\n    }\n  }\n\n  _query = (element: any, selector: string, multi: boolean): any[] => {\n    let results: any[] = [];\n    if (multi) {\n      results.push(...element.querySelectorAll(selector));\n    } else {\n      const elm = element.querySelector(selector);\n      if (elm) {\n        results.push(elm);\n      }\n    }\n    return results;\n  };\n}\n\nfunction containsVendorPrefix(prop: string): boolean {\n  // Webkit is the only real popular vendor prefix nowadays\n  // cc: http://shouldiprefix.com/\n  return prop.substring(1, 6) == 'ebkit';  // webkit or Webkit\n}\n\nlet _CACHED_BODY: {style: any}|null = null;\nlet _IS_WEBKIT = false;\nexport function validateStyleProperty(prop: string): boolean {\n  if (!_CACHED_BODY) {\n    _CACHED_BODY = getBodyNode() || {};\n    _IS_WEBKIT = _CACHED_BODY !.style ? ('WebkitAppearance' in _CACHED_BODY !.style) : false;\n  }\n\n  let result = true;\n  if (_CACHED_BODY !.style && !containsVendorPrefix(prop)) {\n    result = prop in _CACHED_BODY !.style;\n    if (!result && _IS_WEBKIT) {\n      const camelProp = 'Webkit' + prop.charAt(0).toUpperCase() + prop.substr(1);\n      result = camelProp in _CACHED_BODY !.style;\n    }\n  }\n\n  return result;\n}\n\nexport function getBodyNode(): any|null {\n  if (typeof document != 'undefined') {\n    return document.body;\n  }\n  return null;\n}\n\nexport const matchesElement = _matches;\nexport const containsElement = _contains;\nexport const invokeQuery = _query;\n\nexport function hypenatePropsObject(object: {[key: string]: any}): {[key: string]: any} {\n  const newObj: {[key: string]: any} = {};\n  Object.keys(object).forEach(prop => {\n    const newProp = prop.replace(/([a-z])([A-Z])/g, '$1-$2');\n    newObj[newProp] = object[prop];\n  });\n  return newObj;\n}\n"],"sourceRoot":""}