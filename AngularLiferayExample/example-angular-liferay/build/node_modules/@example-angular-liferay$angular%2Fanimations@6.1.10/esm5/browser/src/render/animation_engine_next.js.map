{"version":3,"sources":["../../../../../../../../../../../../packages/animations/browser/src/render/animation_engine_next.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {AnimationMetadata, AnimationPlayer, AnimationTriggerMetadata} from '@angular/animations';\nimport {TriggerAst} from '../dsl/animation_ast';\nimport {buildAnimationAst} from '../dsl/animation_ast_builder';\nimport {AnimationTrigger, buildTrigger} from '../dsl/animation_trigger';\nimport {AnimationStyleNormalizer} from '../dsl/style_normalization/animation_style_normalizer';\n\nimport {AnimationDriver} from './animation_driver';\nimport {parseTimelineCommand} from './shared';\nimport {TimelineAnimationEngine} from './timeline_animation_engine';\nimport {TransitionAnimationEngine} from './transition_animation_engine';\n\nexport class AnimationEngine {\n  private _transitionEngine: TransitionAnimationEngine;\n  private _timelineEngine: TimelineAnimationEngine;\n\n  private _triggerCache: {[key: string]: AnimationTrigger} = {};\n\n  // this method is designed to be overridden by the code that uses this engine\n  public onRemovalComplete = (element: any, context: any) => {};\n\n  constructor(\n      private bodyNode: any, private _driver: AnimationDriver,\n      normalizer: AnimationStyleNormalizer) {\n    this._transitionEngine = new TransitionAnimationEngine(bodyNode, _driver, normalizer);\n    this._timelineEngine = new TimelineAnimationEngine(bodyNode, _driver, normalizer);\n\n    this._transitionEngine.onRemovalComplete = (element: any, context: any) =>\n        this.onRemovalComplete(element, context);\n  }\n\n  registerTrigger(\n      componentId: string, namespaceId: string, hostElement: any, name: string,\n      metadata: AnimationTriggerMetadata): void {\n    const cacheKey = componentId + '-' + name;\n    let trigger = this._triggerCache[cacheKey];\n    if (!trigger) {\n      const errors: any[] = [];\n      const ast =\n          buildAnimationAst(this._driver, metadata as AnimationMetadata, errors) as TriggerAst;\n      if (errors.length) {\n        throw new Error(\n            `The animation trigger \"${name}\" has failed to build due to the following errors:\\n - ${errors.join(\"\\n - \")}`);\n      }\n      trigger = buildTrigger(name, ast);\n      this._triggerCache[cacheKey] = trigger;\n    }\n    this._transitionEngine.registerTrigger(namespaceId, name, trigger);\n  }\n\n  register(namespaceId: string, hostElement: any) {\n    this._transitionEngine.register(namespaceId, hostElement);\n  }\n\n  destroy(namespaceId: string, context: any) {\n    this._transitionEngine.destroy(namespaceId, context);\n  }\n\n  onInsert(namespaceId: string, element: any, parent: any, insertBefore: boolean): void {\n    this._transitionEngine.insertNode(namespaceId, element, parent, insertBefore);\n  }\n\n  onRemove(namespaceId: string, element: any, context: any): void {\n    this._transitionEngine.removeNode(namespaceId, element, context);\n  }\n\n  disableAnimations(element: any, disable: boolean) {\n    this._transitionEngine.markElementAsDisabled(element, disable);\n  }\n\n  process(namespaceId: string, element: any, property: string, value: any) {\n    if (property.charAt(0) == '@') {\n      const [id, action] = parseTimelineCommand(property);\n      const args = value as any[];\n      this._timelineEngine.command(id, element, action, args);\n    } else {\n      this._transitionEngine.trigger(namespaceId, element, property, value);\n    }\n  }\n\n  listen(\n      namespaceId: string, element: any, eventName: string, eventPhase: string,\n      callback: (event: any) => any): () => any {\n    // @@listen\n    if (eventName.charAt(0) == '@') {\n      const [id, action] = parseTimelineCommand(eventName);\n      return this._timelineEngine.listen(id, element, action, callback);\n    }\n    return this._transitionEngine.listen(namespaceId, element, eventName, eventPhase, callback);\n  }\n\n  flush(microtaskId: number = -1): void { this._transitionEngine.flush(microtaskId); }\n\n  get players(): AnimationPlayer[] {\n    return (this._transitionEngine.players as AnimationPlayer[])\n        .concat(this._timelineEngine.players as AnimationPlayer[]);\n  }\n\n  whenRenderingDone(): Promise<any> { return this._transitionEngine.whenRenderingDone(); }\n}\n"],"sourceRoot":""}