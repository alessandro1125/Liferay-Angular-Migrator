{"version":3,"sources":["browser.js"],"names":["AUTO_STYLE","NoopAnimationPlayer","ɵAnimationGroupPlayer","ɵPRE_STYLE","sequence","style","Injectable","isBrowser","window","document","isNode","process","optimizeGroupPlayer","players","length","normalizeKeyframes","driver","normalizer","element","keyframes","preStyles","postStyles","errors","normalizedKeyframes","previousOffset","previousKeyframe","forEach","kf","offset","isSameOffset","normalizedKeyframe","Object","keys","prop","normalizedProp","normalizedValue","normalizePropertyName","normalizeStyleValue","push","LINE_START","Error","join","listenOnPlayer","player","eventName","event","callback","onStart","copyAnimationEvent","onDone","onDestroy","e","phaseName","totalTime","disabled","makeAnimationEvent","triggerName","fromState","toState","undefined","data","getOrSetAsInMap","map","key","defaultValue","value","Map","get","set","parseTimelineCommand","command","separatorPos","indexOf","id","substring","action","substr","_contains","elm1","elm2","_matches","selector","_query","multi","_isNode","Element","contains","prototype","matches","proto","fn","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","apply","results","querySelectorAll","elm","querySelector","containsVendorPrefix","_CACHED_BODY","_IS_WEBKIT","validateStyleProperty","getBodyNode","result","camelProp","charAt","toUpperCase","body","matchesElement","containsElement","invokeQuery","hypenatePropsObject","object","newObj","newProp","replace","NoopAnimationDriver","query","computeStyle","animate","duration","delay","easing","previousPlayers","scrubberAccessRequested","decorators","type","AnimationDriver","NOOP","ONE_SECOND","SUBSTITUTION_EXPR_START","SUBSTITUTION_EXPR_END","ENTER_CLASSNAME","LEAVE_CLASSNAME","NG_TRIGGER_CLASSNAME","NG_TRIGGER_SELECTOR","NG_ANIMATING_CLASSNAME","NG_ANIMATING_SELECTOR","resolveTimingValue","match","_convertTimeValueToMS","parseFloat","unit","resolveTiming","timings","allowNegativeValues","hasOwnProperty","parseTimeExpression","exp","regex","delayMatch","Math","floor","easingVal","containsErrors","startIndex","splice","copyObj","obj","destination","normalizeStyles","styles","normalizedStyles","Array","isArray","copyStyles","readPrototype","getStyleAttributeString","writeStyleAttribute","styleAttrValue","i","item","getPropertyValue","startsWith","dashKey","camelCaseToDashCase","setAttribute","setStyles","dashCaseToCamelCase","eraseStyles","normalizeAnimationEntry","steps","validateStyleParams","options","params","extractStyleParams","varName","PARAM_REGEX","RegExp","val","toString","exec","lastIndex","interpolateParams","original","str","_","localVal","iteratorToArray","iterator","arr","next","done","DASH_CASE_REGEXP","input","m","toLowerCase","allowPreviousPlayerStylesMerge","balancePreviousStylesIntoKeyframes","previousStyles","previousStyleProps","startingKeyframe","missingStyleProps","visitDslNode","visitor","node","context","visitTrigger","visitState","visitTransition","visitSequence","visitGroup","visitAnimate","visitKeyframes","visitStyle","visitReference","visitAnimateChild","visitAnimateRef","visitQuery","visitStagger","getComputedStyle","ANY_STATE","parseTransitionExpr","transitionValue","expressions","split","parseInnerTransitionStr","eventStr","parseAnimationAlias","separator","makeLambdaFromStates","isFullAnyStateExpr","alias","TRUE_BOOLEAN_VALUES","Set","FALSE_BOOLEAN_VALUES","lhs","rhs","LHS_MATCH_BOOLEAN","has","RHS_MATCH_BOOLEAN","lhsMatch","rhsMatch","SELF_TOKEN","SELF_TOKEN_REGEX","buildAnimationAst","metadata","AnimationAstBuilderVisitor","build","ROOT_SELECTOR","constructor","_driver","AnimationAstBuilderContext","_resetContextStyleTimingState","currentQuerySelector","collectedStyles","currentTime","queryCount","depCount","states","transitions","name","definitions","def","stateDef","n","transition","styleAst","astParams","containsDynamicStyles","missingSubs","isObject","stylesObj","sub","add","size","missingSubsArr","values","animation","matchers","expr","normalizeAnimationOptions","s","furthestTime","step","innerAst","max","timingAst","constructTimingAst","currentAnimateTimings","styleMetadata","isEmpty","newStyleData","_styleAst","isEmptyStep","ast","_makeStyleAst","_validateStyleAst","styleTuple","collectedEasing","styleData","styleMap","endTime","startTime","tuple","collectedEntry","updateCollectedStyle","MAX_KEYFRAME_OFFSET","totalKeyframesWithOffsets","offsets","offsetsOutOfOrder","keyframesOutOfRange","style$$1","offsetVal","consumeOffset","generatedOffset","limit","animateDuration","durationUpToThisFrame","parentSelector","currentQuery","includeSelf","normalizeSelector","optional","originalSelector","hasAmpersand","find","token","normalizeParams","currentTransition","makeTimingAst","strValue","isDynamic","some","v","dynamic","createTimelineInstruction","preStyleProps","postStyleProps","subTimeline","ElementInstructionMap","_map","consume","instructions","delete","append","existingInstructions","clear","ONE_FRAME_IN_MILLISECONDS","ENTER_TOKEN","ENTER_TOKEN_REGEX","LEAVE_TOKEN","LEAVE_TOKEN_REGEX","buildAnimationTimelines","rootElement","enterClassName","leaveClassName","startingStyles","finalStyles","subInstructions","AnimationTimelineBuilderVisitor","buildKeyframes","AnimationTimelineContext","currentTimeline","timelines","filter","timeline","containsAnimation","tl","allowOnlyTimelineStyles","elementInstructions","innerContext","createSubContext","_visitSubInstructions","transformIntoNewTimeline","previousNode","instruction","instructionTimings","appendInstructionToTimeline","updateOptions","subContextCount","ctx","snapshotCurrentStyles","DEFAULT_NOOP_PREVIOUS_NODE","delayNextStep","applyStylesToKeyframe","innerTimelines","mergeTimelineCollectedStyles","_visitTiming","timingValue","incrementTime","getCurrentStyleProperties","forwardFrame","applyEmptyStep","innerTimeline","forwardTime","elms","currentQueryTotal","sameElementTimeline","currentQueryIndex","parentContext","abs","maxTime","staggerTransformer","currentStaggerTime","startingTime","_enterClassName","_leaveClassName","initialTimeline","TimelineBuilder","skipIfExists","newOptions","optionsToUpdate","newParams","paramsToUpdate","_copyOptions","oldParams","newTime","target","fork","updatedTimings","builder","SubTimelineBuilder","stretchStartingKeyframe","time","elements","slice","_elementTimelineStylesLookup","_previousKeyframe","_currentKeyframe","_keyframes","_styleSummary","_pendingStyles","_backFill","_currentEmptyStepKeyframe","_localTimelineStyles","create","_globalTimelineStyles","_loadKeyframe","hasPreStyleStep","_updateStyle","flattenStyles","props","getFinalKeyframe","properties","details0","details1","finalKeyframes","keyframe","finalKeyframe","preProps","postProps","kf0","kf1","_stretchStartingKeyframe","newKeyframes","startingGap","newFirstKeyframe","oldFirstKeyframe","roundOffset","oldOffset","timeAtKeyframe","decimalPoints","mult","pow","round","allStyles","allProperties","Animation","errorMessage","_animationAst","buildTimelines","destinationStyles","start","dest","AnimationStyleNormalizer","NoopAnimationStyleNormalizer","propertyName","userProvidedProperty","normalizedProperty","WebAnimationsStyleNormalizer","strVal","trim","DIMENSIONAL_PROP_MAP","valAndSuffixMatch","makeBooleanMap","createTransitionInstruction","isRemovalTransition","fromStyles","toStyles","queriedElements","EMPTY_OBJECT","AnimationTransitionFactory","_triggerName","_stateStyles","currentState","nextState","oneOrMoreTransitionsMatch","buildStyles","stateName","backupStateStyler","stateStyler","backupStyles","currentOptions","nextOptions","skipAstBuild","transitionAnimationParams","currentAnimationParams","currentStateStyles","nextAnimationParams","nextStateStyles","preStyleMap","postStyleMap","isRemoval","animationOptions","assign","queriedElementsList","matchFns","AnimationStateStyles","defaultParams","combinedParams","styleObj","buildTrigger","AnimationTrigger","transitionFactories","balanceProperties","fallbackTransition","createFallbackTransition","containsQueries","matchTransition","entry","f","matchStyles","key1","key2","EMPTY_INSTRUCTION_MAP","TimelineAnimationEngine","bodyNode","_normalizer","_animations","_playersById","register","_buildPlayer","autoStylesMap","inst","destroy","_getPlayer","index","listen","baseEvent","args","play","pause","reset","restart","finish","init","setPosition","QUEUED_CLASSNAME","QUEUED_SELECTOR","DISABLED_CLASSNAME","DISABLED_SELECTOR","STAR_CLASSNAME","STAR_SELECTOR","EMPTY_PLAYER_ARRAY","NULL_REMOVAL_STATE","namespaceId","setForRemoval","setForMove","hasAnimation","removedBeforeQueried","NULL_REMOVED_QUERIED_STATE","REMOVAL_FLAG","StateValue","isObj","normalizeTriggerValue","absorbOptions","VOID_VALUE","DEFAULT_STATE_VALUE","AnimationTransitionNamespace","hostElement","_engine","_triggers","_queue","_elementListeners","_hostClassName","addClass","phase","isTriggerEventValid","listeners","triggersWithStates","statesByElement","afterFlush","_getTrigger","trigger","defaultToFallback","TransitionAnimationPlayer","objEquals","reportError","playersOnElement","playersByElement","queued","isFallbackTransition","totalQueuedPlayers","removeClass","deregister","stateMap","clearElementCache","elementPlayers","_signalRemovalForInnerTriggers","namespaces","fetchNamespacesByElement","ns","triggerLeaveAnimation","destroyAfterComplete","triggerStates","markElementAsRemoved","processLeaveNode","prepareLeaveAnimationListeners","visitedTriggers","listener","elementStates","removeNode","engine","childElementCount","containsPotentialParentTransition","totalAnimations","currentPlayers","playersByQueriedElement","parent","parentNode","triggers","destroyInnerAnimations","_onRemovalComplete","insertNode","drainQueuedTransitions","microtaskId","destroyed","markedForDestroy","sort","a","b","d0","d1","p","elementContainsData","containsData","TransitionAnimationEngine","newHostElements","disabledNodes","_namespaceLookup","_namespaceList","_flushFns","_whenQuietFns","namespacesByHostElement","collectedEnterElements","collectedLeaveElements","onRemovalComplete","queuedPlayers","createNamespace","_balanceNamespaceList","collectEnterElement","found","nextNamespace","registerTrigger","_fetchNamespace","afterFlushAnimationsDone","nsId","isElementNode","insertBefore","details","markElementAsDisabled","_buildInstruction","subTimelines","skipBuildAst","containerElement","destroyActiveAnimationsForElement","finishActiveQueriedAnimationOnElement","whenRenderingDone","Promise","resolve","flush","cleanupFns","_flushAnimations","quietFns","skippedPlayers","skippedPlayersMap","queuedInstructions","allPreStyleElements","allPostStyleElements","disabledElementsSet","nodesThatAreDisabled","allTriggerElements","from","enterNodeMap","buildRootMap","enterNodeMapIds","nodes","root","className","allLeaveNodes","mergedLeaveNodes","leaveNodesWithoutAnimations","leaveNodeMapIds","leaveNodeMap","allPlayers","erroneousTransitions","nodeIsOrphaned","stringMap","setVal","error","allPreviousPlayersMap","animationElementMap","_beforeAnimationBuild","_getPreviousPlayers","prevPlayer","replaceNodes","replacePostStylesAsPre","postStylesMap","allLeaveQueriedNodes","cloakAndComputeStyles","preStylesMap","post","pre","rootPlayers","subPlayers","NO_PARENT_ANIMATION_ELEMENT_DETECTED","overrideTotalTime","parentWithAnimation","parentsToAdd","detectedParent","innerPlayer","_buildAnimation","setRealPlayer","parentPlayers","parentPlayer","playersForElement","syncPlayerEvents","queriedPlayerResults","queriedInnerElements","j","queriedPlayers","activePlayers","removeNodesAfterAnimationDone","isQueriedElement","toStateValue","queriedElementPlayers","isRemovalAnimation","targetNameSpaceId","targetTriggerName","timelineInstruction","realPlayer","getRealPlayer","beforeDestroy","allQueriedPlayers","allConsumedElements","allSubElements","allNewPlayers","flattenGroupPlayers","pp","wrappedPlayer","deleteOrUnsetInMap","_player","_containsRealPlayer","_queuedCallbacks","triggerCallback","_queueEvent","hasStarted","getPosition","currentValues","cloakElement","oldValue","display","valuesMap","elementPropsMap","defaultStyle","cloakVals","failedElements","roots","rootMap","NULL_NODE","nodeSet","localRootMap","getRoot","CLASSES_CACHE_KEY","classList","classes","remove","finalPlayers","_flattenGroupPlayersRecur","k1","k2","postEntry","preEntry","AnimationEngine","_triggerCache","_transitionEngine","_timelineEngine","componentId","cacheKey","onInsert","onRemove","disableAnimations","disable","property","eventPhase","concat","ELAPSED_TIME_MAX_DECIMAL_PLACES","ANIMATION_PROP","ANIMATIONEND_EVENT","ONE_SECOND$1","ElementAnimationStyleHandler","_element","_name","_duration","_delay","_easing","_fillMode","_onDoneFn","_finished","_destroyed","_startTime","_position","_eventFn","_handleCallback","applyKeyframeAnimation","addRemoveAnimationEvent","Date","now","playPauseAnimation","resume","position","findIndexForAnimation","setAnimationStyle","timestamp","_ngTestManualTimestamp","elapsedTime","toFixed","animationName","removeKeyframeAnimation","status","anim","getAnimationStyle","countChars","tokens","findMatchingTokenIndex","newValue","searchToken","doRemove","removeEventListener","addEventListener","char","count","c","DEFAULT_FILL_MODE","DEFAULT_EASING","CssKeyframesPlayer","_finalStyles","_onDoneFns","_onStartFns","_onDestroyFns","_started","currentSnapshot","_state","_buildStyler","_styler","_flushStartFns","_flushDoneFns","methods","finished","DirectStylePlayer","_startingStyles","__initialized","_styles","setProperty","removeProperty","KEYFRAMES_NAME_PREFIX","TAB_SPACE","CssKeyframesDriver","_count","_head","_warningIssued","buildKeyframeElement","keyframeStr","tab","kfElm","createElement","innerHTML","_notifyFaultyScrubber","previousCssKeyframePlayers","flattenKeyframesIntoStyles","appendChild","removeElement","console","warn","flatKeyframes","kfs","removeChild","WebAnimationsPlayer","_initialized","_onFinish","_preparePlayerBeforeStart","domPlayer","_triggerWebAnimation","_finalKeyframe","_resetDomPlayerState","cancel","WebAnimationsDriver","_isNativeImpl","test","getElementAnimateFn","_cssKeyframesDriver","overrideWebAnimationsSupport","supported","useKeyframes","fill","playerOptions","previousWebAnimationPlayers","supportsWebAnimations","ɵAnimation","ɵAnimationStyleNormalizer","ɵNoopAnimationStyleNormalizer","ɵWebAnimationsStyleNormalizer","ɵAnimationDriver","ɵNoopAnimationDriver","ɵAnimationEngine","ɵCssKeyframesDriver","ɵCssKeyframesPlayer","ɵcontainsElement","ɵinvokeQuery","ɵmatchesElement","ɵvalidateStyleProperty","ɵWebAnimationsDriver","ɵsupportsWebAnimations","ɵWebAnimationsPlayer","ɵallowPreviousPlayerStylesMerge"],"mappings":"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","file":"browser.js","sourcesContent":["/**\n * @license Angular v6.1.10\n * (c) 2010-2018 Google, Inc. https://angular.io/\n * License: MIT\n */\n\nimport { AUTO_STYLE, NoopAnimationPlayer, ɵAnimationGroupPlayer, ɵPRE_STYLE, sequence, style } from '@angular/animations';\nimport { Injectable } from '@angular/core';\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * @return {?}\n */\nfunction isBrowser() {\n    return (typeof window !== 'undefined' && typeof window.document !== 'undefined');\n}\n/**\n * @return {?}\n */\nfunction isNode() {\n    return (typeof process !== 'undefined');\n}\n/**\n * @param {?} players\n * @return {?}\n */\nfunction optimizeGroupPlayer(players) {\n    switch (players.length) {\n        case 0:\n            return new NoopAnimationPlayer();\n        case 1:\n            return players[0];\n        default:\n            return new ɵAnimationGroupPlayer(players);\n    }\n}\n/**\n * @param {?} driver\n * @param {?} normalizer\n * @param {?} element\n * @param {?} keyframes\n * @param {?=} preStyles\n * @param {?=} postStyles\n * @return {?}\n */\nfunction normalizeKeyframes(driver, normalizer, element, keyframes, preStyles = {}, postStyles = {}) {\n    /** @type {?} */\n    const errors = [];\n    /** @type {?} */\n    const normalizedKeyframes = [];\n    /** @type {?} */\n    let previousOffset = -1;\n    /** @type {?} */\n    let previousKeyframe = null;\n    keyframes.forEach(kf => {\n        /** @type {?} */\n        const offset = /** @type {?} */ (kf['offset']);\n        /** @type {?} */\n        const isSameOffset = offset == previousOffset;\n        /** @type {?} */\n        const normalizedKeyframe = (isSameOffset && previousKeyframe) || {};\n        Object.keys(kf).forEach(prop => {\n            /** @type {?} */\n            let normalizedProp = prop;\n            /** @type {?} */\n            let normalizedValue = kf[prop];\n            if (prop !== 'offset') {\n                normalizedProp = normalizer.normalizePropertyName(normalizedProp, errors);\n                switch (normalizedValue) {\n                    case ɵPRE_STYLE:\n                        normalizedValue = preStyles[prop];\n                        break;\n                    case AUTO_STYLE:\n                        normalizedValue = postStyles[prop];\n                        break;\n                    default:\n                        normalizedValue =\n                            normalizer.normalizeStyleValue(prop, normalizedProp, normalizedValue, errors);\n                        break;\n                }\n            }\n            normalizedKeyframe[normalizedProp] = normalizedValue;\n        });\n        if (!isSameOffset) {\n            normalizedKeyframes.push(normalizedKeyframe);\n        }\n        previousKeyframe = normalizedKeyframe;\n        previousOffset = offset;\n    });\n    if (errors.length) {\n        /** @type {?} */\n        const LINE_START = '\\n - ';\n        throw new Error(`Unable to animate due to the following errors:${LINE_START}${errors.join(LINE_START)}`);\n    }\n    return normalizedKeyframes;\n}\n/**\n * @param {?} player\n * @param {?} eventName\n * @param {?} event\n * @param {?} callback\n * @return {?}\n */\nfunction listenOnPlayer(player, eventName, event, callback) {\n    switch (eventName) {\n        case 'start':\n            player.onStart(() => callback(event && copyAnimationEvent(event, 'start', player)));\n            break;\n        case 'done':\n            player.onDone(() => callback(event && copyAnimationEvent(event, 'done', player)));\n            break;\n        case 'destroy':\n            player.onDestroy(() => callback(event && copyAnimationEvent(event, 'destroy', player)));\n            break;\n    }\n}\n/**\n * @param {?} e\n * @param {?} phaseName\n * @param {?} player\n * @return {?}\n */\nfunction copyAnimationEvent(e, phaseName, player) {\n    /** @type {?} */\n    const totalTime = player.totalTime;\n    /** @type {?} */\n    const disabled = (/** @type {?} */ (player)).disabled ? true : false;\n    /** @type {?} */\n    const event = makeAnimationEvent(e.element, e.triggerName, e.fromState, e.toState, phaseName || e.phaseName, totalTime == undefined ? e.totalTime : totalTime, disabled);\n    /** @type {?} */\n    const data = (/** @type {?} */ (e))['_data'];\n    if (data != null) {\n        (/** @type {?} */ (event))['_data'] = data;\n    }\n    return event;\n}\n/**\n * @param {?} element\n * @param {?} triggerName\n * @param {?} fromState\n * @param {?} toState\n * @param {?=} phaseName\n * @param {?=} totalTime\n * @param {?=} disabled\n * @return {?}\n */\nfunction makeAnimationEvent(element, triggerName, fromState, toState, phaseName = '', totalTime = 0, disabled) {\n    return { element, triggerName, fromState, toState, phaseName, totalTime, disabled: !!disabled };\n}\n/**\n * @param {?} map\n * @param {?} key\n * @param {?} defaultValue\n * @return {?}\n */\nfunction getOrSetAsInMap(map, key, defaultValue) {\n    /** @type {?} */\n    let value;\n    if (map instanceof Map) {\n        value = map.get(key);\n        if (!value) {\n            map.set(key, value = defaultValue);\n        }\n    }\n    else {\n        value = map[key];\n        if (!value) {\n            value = map[key] = defaultValue;\n        }\n    }\n    return value;\n}\n/**\n * @param {?} command\n * @return {?}\n */\nfunction parseTimelineCommand(command) {\n    /** @type {?} */\n    const separatorPos = command.indexOf(':');\n    /** @type {?} */\n    const id = command.substring(1, separatorPos);\n    /** @type {?} */\n    const action = command.substr(separatorPos + 1);\n    return [id, action];\n}\n/** @type {?} */\nlet _contains = (elm1, elm2) => false;\n/** @type {?} */\nlet _matches = (element, selector) => false;\n/** @type {?} */\nlet _query = (element, selector, multi) => {\n    return [];\n};\n/** @type {?} */\nconst _isNode = isNode();\nif (_isNode || typeof Element !== 'undefined') {\n    // this is well supported in all browsers\n    _contains = (elm1, elm2) => { return /** @type {?} */ (elm1.contains(elm2)); };\n    if (_isNode || Element.prototype.matches) {\n        _matches = (element, selector) => element.matches(selector);\n    }\n    else {\n        /** @type {?} */\n        const proto = /** @type {?} */ (Element.prototype);\n        /** @type {?} */\n        const fn = proto.matchesSelector || proto.mozMatchesSelector || proto.msMatchesSelector ||\n            proto.oMatchesSelector || proto.webkitMatchesSelector;\n        if (fn) {\n            _matches = (element, selector) => fn.apply(element, [selector]);\n        }\n    }\n    _query = (element, selector, multi) => {\n        /** @type {?} */\n        let results = [];\n        if (multi) {\n            results.push(...element.querySelectorAll(selector));\n        }\n        else {\n            /** @type {?} */\n            const elm = element.querySelector(selector);\n            if (elm) {\n                results.push(elm);\n            }\n        }\n        return results;\n    };\n}\n/**\n * @param {?} prop\n * @return {?}\n */\nfunction containsVendorPrefix(prop) {\n    // Webkit is the only real popular vendor prefix nowadays\n    // cc: http://shouldiprefix.com/\n    return prop.substring(1, 6) == 'ebkit'; // webkit or Webkit\n}\n/** @type {?} */\nlet _CACHED_BODY = null;\n/** @type {?} */\nlet _IS_WEBKIT = false;\n/**\n * @param {?} prop\n * @return {?}\n */\nfunction validateStyleProperty(prop) {\n    if (!_CACHED_BODY) {\n        _CACHED_BODY = getBodyNode() || {};\n        _IS_WEBKIT = /** @type {?} */ ((_CACHED_BODY)).style ? ('WebkitAppearance' in /** @type {?} */ ((_CACHED_BODY)).style) : false;\n    }\n    /** @type {?} */\n    let result = true;\n    if (/** @type {?} */ ((_CACHED_BODY)).style && !containsVendorPrefix(prop)) {\n        result = prop in /** @type {?} */ ((_CACHED_BODY)).style;\n        if (!result && _IS_WEBKIT) {\n            /** @type {?} */\n            const camelProp = 'Webkit' + prop.charAt(0).toUpperCase() + prop.substr(1);\n            result = camelProp in /** @type {?} */ ((_CACHED_BODY)).style;\n        }\n    }\n    return result;\n}\n/**\n * @return {?}\n */\nfunction getBodyNode() {\n    if (typeof document != 'undefined') {\n        return document.body;\n    }\n    return null;\n}\n/** @type {?} */\nconst matchesElement = _matches;\n/** @type {?} */\nconst containsElement = _contains;\n/** @type {?} */\nconst invokeQuery = _query;\n/**\n * @param {?} object\n * @return {?}\n */\nfunction hypenatePropsObject(object) {\n    /** @type {?} */\n    const newObj = {};\n    Object.keys(object).forEach(prop => {\n        /** @type {?} */\n        const newProp = prop.replace(/([a-z])([A-Z])/g, '$1-$2');\n        newObj[newProp] = object[prop];\n    });\n    return newObj;\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * \\@experimental\n */\nclass NoopAnimationDriver {\n    /**\n     * @param {?} prop\n     * @return {?}\n     */\n    validateStyleProperty(prop) { return validateStyleProperty(prop); }\n    /**\n     * @param {?} element\n     * @param {?} selector\n     * @return {?}\n     */\n    matchesElement(element, selector) {\n        return matchesElement(element, selector);\n    }\n    /**\n     * @param {?} elm1\n     * @param {?} elm2\n     * @return {?}\n     */\n    containsElement(elm1, elm2) { return containsElement(elm1, elm2); }\n    /**\n     * @param {?} element\n     * @param {?} selector\n     * @param {?} multi\n     * @return {?}\n     */\n    query(element, selector, multi) {\n        return invokeQuery(element, selector, multi);\n    }\n    /**\n     * @param {?} element\n     * @param {?} prop\n     * @param {?=} defaultValue\n     * @return {?}\n     */\n    computeStyle(element, prop, defaultValue) {\n        return defaultValue || '';\n    }\n    /**\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} duration\n     * @param {?} delay\n     * @param {?} easing\n     * @param {?=} previousPlayers\n     * @param {?=} scrubberAccessRequested\n     * @return {?}\n     */\n    animate(element, keyframes, duration, delay, easing, previousPlayers = [], scrubberAccessRequested) {\n        return new NoopAnimationPlayer(duration, delay);\n    }\n}\nNoopAnimationDriver.decorators = [\n    { type: Injectable }\n];\n/**\n * \\@experimental\n * @abstract\n */\nclass AnimationDriver {\n}\nAnimationDriver.NOOP = new NoopAnimationDriver();\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst ONE_SECOND = 1000;\n/** @type {?} */\nconst SUBSTITUTION_EXPR_START = '{{';\n/** @type {?} */\nconst SUBSTITUTION_EXPR_END = '}}';\n/** @type {?} */\nconst ENTER_CLASSNAME = 'ng-enter';\n/** @type {?} */\nconst LEAVE_CLASSNAME = 'ng-leave';\n/** @type {?} */\nconst NG_TRIGGER_CLASSNAME = 'ng-trigger';\n/** @type {?} */\nconst NG_TRIGGER_SELECTOR = '.ng-trigger';\n/** @type {?} */\nconst NG_ANIMATING_CLASSNAME = 'ng-animating';\n/** @type {?} */\nconst NG_ANIMATING_SELECTOR = '.ng-animating';\n/**\n * @param {?} value\n * @return {?}\n */\nfunction resolveTimingValue(value) {\n    if (typeof value == 'number')\n        return value;\n    /** @type {?} */\n    const matches = (/** @type {?} */ (value)).match(/^(-?[\\.\\d]+)(m?s)/);\n    if (!matches || matches.length < 2)\n        return 0;\n    return _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);\n}\n/**\n * @param {?} value\n * @param {?} unit\n * @return {?}\n */\nfunction _convertTimeValueToMS(value, unit) {\n    switch (unit) {\n        case 's':\n            return value * ONE_SECOND;\n        default: // ms or something else\n            // ms or something else\n            return value;\n    }\n}\n/**\n * @param {?} timings\n * @param {?} errors\n * @param {?=} allowNegativeValues\n * @return {?}\n */\nfunction resolveTiming(timings, errors, allowNegativeValues) {\n    return timings.hasOwnProperty('duration') ? /** @type {?} */ (timings) :\n        parseTimeExpression(/** @type {?} */ (timings), errors, allowNegativeValues);\n}\n/**\n * @param {?} exp\n * @param {?} errors\n * @param {?=} allowNegativeValues\n * @return {?}\n */\nfunction parseTimeExpression(exp, errors, allowNegativeValues) {\n    /** @type {?} */\n    const regex = /^(-?[\\.\\d]+)(m?s)(?:\\s+(-?[\\.\\d]+)(m?s))?(?:\\s+([-a-z]+(?:\\(.+?\\))?))?$/i;\n    /** @type {?} */\n    let duration;\n    /** @type {?} */\n    let delay = 0;\n    /** @type {?} */\n    let easing = '';\n    if (typeof exp === 'string') {\n        /** @type {?} */\n        const matches = exp.match(regex);\n        if (matches === null) {\n            errors.push(`The provided timing value \"${exp}\" is invalid.`);\n            return { duration: 0, delay: 0, easing: '' };\n        }\n        duration = _convertTimeValueToMS(parseFloat(matches[1]), matches[2]);\n        /** @type {?} */\n        const delayMatch = matches[3];\n        if (delayMatch != null) {\n            delay = _convertTimeValueToMS(Math.floor(parseFloat(delayMatch)), matches[4]);\n        }\n        /** @type {?} */\n        const easingVal = matches[5];\n        if (easingVal) {\n            easing = easingVal;\n        }\n    }\n    else {\n        duration = /** @type {?} */ (exp);\n    }\n    if (!allowNegativeValues) {\n        /** @type {?} */\n        let containsErrors = false;\n        /** @type {?} */\n        let startIndex = errors.length;\n        if (duration < 0) {\n            errors.push(`Duration values below 0 are not allowed for this animation step.`);\n            containsErrors = true;\n        }\n        if (delay < 0) {\n            errors.push(`Delay values below 0 are not allowed for this animation step.`);\n            containsErrors = true;\n        }\n        if (containsErrors) {\n            errors.splice(startIndex, 0, `The provided timing value \"${exp}\" is invalid.`);\n        }\n    }\n    return { duration, delay, easing };\n}\n/**\n * @param {?} obj\n * @param {?=} destination\n * @return {?}\n */\nfunction copyObj(obj, destination = {}) {\n    Object.keys(obj).forEach(prop => { destination[prop] = obj[prop]; });\n    return destination;\n}\n/**\n * @param {?} styles\n * @return {?}\n */\nfunction normalizeStyles(styles) {\n    /** @type {?} */\n    const normalizedStyles = {};\n    if (Array.isArray(styles)) {\n        styles.forEach(data => copyStyles(data, false, normalizedStyles));\n    }\n    else {\n        copyStyles(styles, false, normalizedStyles);\n    }\n    return normalizedStyles;\n}\n/**\n * @param {?} styles\n * @param {?} readPrototype\n * @param {?=} destination\n * @return {?}\n */\nfunction copyStyles(styles, readPrototype, destination = {}) {\n    if (readPrototype) {\n        // we make use of a for-in loop so that the\n        // prototypically inherited properties are\n        // revealed from the backFill map\n        for (let prop in styles) {\n            destination[prop] = styles[prop];\n        }\n    }\n    else {\n        copyObj(styles, destination);\n    }\n    return destination;\n}\n/**\n * @param {?} element\n * @param {?} key\n * @param {?} value\n * @return {?}\n */\nfunction getStyleAttributeString(element, key, value) {\n    // Return the key-value pair string to be added to the style attribute for the\n    // given CSS style key.\n    if (value) {\n        return key + ':' + value + ';';\n    }\n    else {\n        return '';\n    }\n}\n/**\n * @param {?} element\n * @return {?}\n */\nfunction writeStyleAttribute(element) {\n    /** @type {?} */\n    let styleAttrValue = '';\n    for (let i = 0; i < element.style.length; i++) {\n        /** @type {?} */\n        const key = element.style.item(i);\n        styleAttrValue += getStyleAttributeString(element, key, element.style.getPropertyValue(key));\n    }\n    for (const key in element.style) {\n        // Skip internal Domino properties that don't need to be reflected.\n        if (!element.style.hasOwnProperty(key) || key.startsWith('_')) {\n            continue;\n        }\n        /** @type {?} */\n        const dashKey = camelCaseToDashCase(key);\n        styleAttrValue += getStyleAttributeString(element, dashKey, element.style[key]);\n    }\n    element.setAttribute('style', styleAttrValue);\n}\n/**\n * @param {?} element\n * @param {?} styles\n * @return {?}\n */\nfunction setStyles(element, styles) {\n    if (element['style']) {\n        Object.keys(styles).forEach(prop => {\n            /** @type {?} */\n            const camelProp = dashCaseToCamelCase(prop);\n            element.style[camelProp] = styles[prop];\n        });\n        // On the server set the 'style' attribute since it's not automatically reflected.\n        if (isNode()) {\n            writeStyleAttribute(element);\n        }\n    }\n}\n/**\n * @param {?} element\n * @param {?} styles\n * @return {?}\n */\nfunction eraseStyles(element, styles) {\n    if (element['style']) {\n        Object.keys(styles).forEach(prop => {\n            /** @type {?} */\n            const camelProp = dashCaseToCamelCase(prop);\n            element.style[camelProp] = '';\n        });\n        // On the server set the 'style' attribute since it's not automatically reflected.\n        if (isNode()) {\n            writeStyleAttribute(element);\n        }\n    }\n}\n/**\n * @param {?} steps\n * @return {?}\n */\nfunction normalizeAnimationEntry(steps) {\n    if (Array.isArray(steps)) {\n        if (steps.length == 1)\n            return steps[0];\n        return sequence(steps);\n    }\n    return /** @type {?} */ (steps);\n}\n/**\n * @param {?} value\n * @param {?} options\n * @param {?} errors\n * @return {?}\n */\nfunction validateStyleParams(value, options, errors) {\n    /** @type {?} */\n    const params = options.params || {};\n    /** @type {?} */\n    const matches = extractStyleParams(value);\n    if (matches.length) {\n        matches.forEach(varName => {\n            if (!params.hasOwnProperty(varName)) {\n                errors.push(`Unable to resolve the local animation param ${varName} in the given list of values`);\n            }\n        });\n    }\n}\n/** @type {?} */\nconst PARAM_REGEX = new RegExp(`${SUBSTITUTION_EXPR_START}\\\\s*(.+?)\\\\s*${SUBSTITUTION_EXPR_END}`, 'g');\n/**\n * @param {?} value\n * @return {?}\n */\nfunction extractStyleParams(value) {\n    /** @type {?} */\n    let params = [];\n    if (typeof value === 'string') {\n        /** @type {?} */\n        const val = value.toString();\n        /** @type {?} */\n        let match;\n        while (match = PARAM_REGEX.exec(val)) {\n            params.push(/** @type {?} */ (match[1]));\n        }\n        PARAM_REGEX.lastIndex = 0;\n    }\n    return params;\n}\n/**\n * @param {?} value\n * @param {?} params\n * @param {?} errors\n * @return {?}\n */\nfunction interpolateParams(value, params, errors) {\n    /** @type {?} */\n    const original = value.toString();\n    /** @type {?} */\n    const str = original.replace(PARAM_REGEX, (_, varName) => {\n        /** @type {?} */\n        let localVal = params[varName];\n        // this means that the value was never overridden by the data passed in by the user\n        if (!params.hasOwnProperty(varName)) {\n            errors.push(`Please provide a value for the animation param ${varName}`);\n            localVal = '';\n        }\n        return localVal.toString();\n    });\n    // we do this to assert that numeric values stay as they are\n    return str == original ? value : str;\n}\n/**\n * @param {?} iterator\n * @return {?}\n */\nfunction iteratorToArray(iterator) {\n    /** @type {?} */\n    const arr = [];\n    /** @type {?} */\n    let item = iterator.next();\n    while (!item.done) {\n        arr.push(item.value);\n        item = iterator.next();\n    }\n    return arr;\n}\n/** @type {?} */\nconst DASH_CASE_REGEXP = /-+([a-z0-9])/g;\n/**\n * @param {?} input\n * @return {?}\n */\nfunction dashCaseToCamelCase(input) {\n    return input.replace(DASH_CASE_REGEXP, (...m) => m[1].toUpperCase());\n}\n/**\n * @param {?} input\n * @return {?}\n */\nfunction camelCaseToDashCase(input) {\n    return input.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n}\n/**\n * @param {?} duration\n * @param {?} delay\n * @return {?}\n */\nfunction allowPreviousPlayerStylesMerge(duration, delay) {\n    return duration === 0 || delay === 0;\n}\n/**\n * @param {?} element\n * @param {?} keyframes\n * @param {?} previousStyles\n * @return {?}\n */\nfunction balancePreviousStylesIntoKeyframes(element, keyframes, previousStyles) {\n    /** @type {?} */\n    const previousStyleProps = Object.keys(previousStyles);\n    if (previousStyleProps.length && keyframes.length) {\n        /** @type {?} */\n        let startingKeyframe = keyframes[0];\n        /** @type {?} */\n        let missingStyleProps = [];\n        previousStyleProps.forEach(prop => {\n            if (!startingKeyframe.hasOwnProperty(prop)) {\n                missingStyleProps.push(prop);\n            }\n            startingKeyframe[prop] = previousStyles[prop];\n        });\n        if (missingStyleProps.length) {\n            // tslint:disable-next-line\n            for (var i = 1; i < keyframes.length; i++) {\n                /** @type {?} */\n                let kf = keyframes[i];\n                missingStyleProps.forEach(function (prop) { kf[prop] = computeStyle(element, prop); });\n            }\n        }\n    }\n    return keyframes;\n}\n/**\n * @param {?} visitor\n * @param {?} node\n * @param {?} context\n * @return {?}\n */\nfunction visitDslNode(visitor, node, context) {\n    switch (node.type) {\n        case 7 /* Trigger */:\n            return visitor.visitTrigger(node, context);\n        case 0 /* State */:\n            return visitor.visitState(node, context);\n        case 1 /* Transition */:\n            return visitor.visitTransition(node, context);\n        case 2 /* Sequence */:\n            return visitor.visitSequence(node, context);\n        case 3 /* Group */:\n            return visitor.visitGroup(node, context);\n        case 4 /* Animate */:\n            return visitor.visitAnimate(node, context);\n        case 5 /* Keyframes */:\n            return visitor.visitKeyframes(node, context);\n        case 6 /* Style */:\n            return visitor.visitStyle(node, context);\n        case 8 /* Reference */:\n            return visitor.visitReference(node, context);\n        case 9 /* AnimateChild */:\n            return visitor.visitAnimateChild(node, context);\n        case 10 /* AnimateRef */:\n            return visitor.visitAnimateRef(node, context);\n        case 11 /* Query */:\n            return visitor.visitQuery(node, context);\n        case 12 /* Stagger */:\n            return visitor.visitStagger(node, context);\n        default:\n            throw new Error(`Unable to resolve animation metadata node #${node.type}`);\n    }\n}\n/**\n * @param {?} element\n * @param {?} prop\n * @return {?}\n */\nfunction computeStyle(element, prop) {\n    return (/** @type {?} */ (window.getComputedStyle(element)))[prop];\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** *\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n  @type {?} */\nconst ANY_STATE = '*';\n/**\n * @param {?} transitionValue\n * @param {?} errors\n * @return {?}\n */\nfunction parseTransitionExpr(transitionValue, errors) {\n    /** @type {?} */\n    const expressions = [];\n    if (typeof transitionValue == 'string') {\n        (/** @type {?} */ (transitionValue))\n            .split(/\\s*,\\s*/)\n            .forEach(str => parseInnerTransitionStr(str, expressions, errors));\n    }\n    else {\n        expressions.push(/** @type {?} */ (transitionValue));\n    }\n    return expressions;\n}\n/**\n * @param {?} eventStr\n * @param {?} expressions\n * @param {?} errors\n * @return {?}\n */\nfunction parseInnerTransitionStr(eventStr, expressions, errors) {\n    if (eventStr[0] == ':') {\n        /** @type {?} */\n        const result = parseAnimationAlias(eventStr, errors);\n        if (typeof result == 'function') {\n            expressions.push(result);\n            return;\n        }\n        eventStr = /** @type {?} */ (result);\n    }\n    /** @type {?} */\n    const match = eventStr.match(/^(\\*|[-\\w]+)\\s*(<?[=-]>)\\s*(\\*|[-\\w]+)$/);\n    if (match == null || match.length < 4) {\n        errors.push(`The provided transition expression \"${eventStr}\" is not supported`);\n        return expressions;\n    }\n    /** @type {?} */\n    const fromState = match[1];\n    /** @type {?} */\n    const separator = match[2];\n    /** @type {?} */\n    const toState = match[3];\n    expressions.push(makeLambdaFromStates(fromState, toState));\n    /** @type {?} */\n    const isFullAnyStateExpr = fromState == ANY_STATE && toState == ANY_STATE;\n    if (separator[0] == '<' && !isFullAnyStateExpr) {\n        expressions.push(makeLambdaFromStates(toState, fromState));\n    }\n}\n/**\n * @param {?} alias\n * @param {?} errors\n * @return {?}\n */\nfunction parseAnimationAlias(alias, errors) {\n    switch (alias) {\n        case ':enter':\n            return 'void => *';\n        case ':leave':\n            return '* => void';\n        case ':increment':\n            return (fromState, toState) => parseFloat(toState) > parseFloat(fromState);\n        case ':decrement':\n            return (fromState, toState) => parseFloat(toState) < parseFloat(fromState);\n        default:\n            errors.push(`The transition alias value \"${alias}\" is not supported`);\n            return '* => *';\n    }\n}\n/** @type {?} */\nconst TRUE_BOOLEAN_VALUES = new Set(['true', '1']);\n/** @type {?} */\nconst FALSE_BOOLEAN_VALUES = new Set(['false', '0']);\n/**\n * @param {?} lhs\n * @param {?} rhs\n * @return {?}\n */\nfunction makeLambdaFromStates(lhs, rhs) {\n    /** @type {?} */\n    const LHS_MATCH_BOOLEAN = TRUE_BOOLEAN_VALUES.has(lhs) || FALSE_BOOLEAN_VALUES.has(lhs);\n    /** @type {?} */\n    const RHS_MATCH_BOOLEAN = TRUE_BOOLEAN_VALUES.has(rhs) || FALSE_BOOLEAN_VALUES.has(rhs);\n    return (fromState, toState) => {\n        /** @type {?} */\n        let lhsMatch = lhs == ANY_STATE || lhs == fromState;\n        /** @type {?} */\n        let rhsMatch = rhs == ANY_STATE || rhs == toState;\n        if (!lhsMatch && LHS_MATCH_BOOLEAN && typeof fromState === 'boolean') {\n            lhsMatch = fromState ? TRUE_BOOLEAN_VALUES.has(lhs) : FALSE_BOOLEAN_VALUES.has(lhs);\n        }\n        if (!rhsMatch && RHS_MATCH_BOOLEAN && typeof toState === 'boolean') {\n            rhsMatch = toState ? TRUE_BOOLEAN_VALUES.has(rhs) : FALSE_BOOLEAN_VALUES.has(rhs);\n        }\n        return lhsMatch && rhsMatch;\n    };\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst SELF_TOKEN = ':self';\n/** @type {?} */\nconst SELF_TOKEN_REGEX = new RegExp(`\\s*${SELF_TOKEN}\\s*,?`, 'g');\n/**\n * @param {?} driver\n * @param {?} metadata\n * @param {?} errors\n * @return {?}\n */\nfunction buildAnimationAst(driver, metadata, errors) {\n    return new AnimationAstBuilderVisitor(driver).build(metadata, errors);\n}\n/** @type {?} */\nconst ROOT_SELECTOR = '';\nclass AnimationAstBuilderVisitor {\n    /**\n     * @param {?} _driver\n     */\n    constructor(_driver) {\n        this._driver = _driver;\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} errors\n     * @return {?}\n     */\n    build(metadata, errors) {\n        /** @type {?} */\n        const context = new AnimationAstBuilderContext(errors);\n        this._resetContextStyleTimingState(context);\n        return /** @type {?} */ (visitDslNode(this, normalizeAnimationEntry(metadata), context));\n    }\n    /**\n     * @param {?} context\n     * @return {?}\n     */\n    _resetContextStyleTimingState(context) {\n        context.currentQuerySelector = ROOT_SELECTOR;\n        context.collectedStyles = {};\n        context.collectedStyles[ROOT_SELECTOR] = {};\n        context.currentTime = 0;\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitTrigger(metadata, context) {\n        /** @type {?} */\n        let queryCount = context.queryCount = 0;\n        /** @type {?} */\n        let depCount = context.depCount = 0;\n        /** @type {?} */\n        const states = [];\n        /** @type {?} */\n        const transitions = [];\n        if (metadata.name.charAt(0) == '@') {\n            context.errors.push('animation triggers cannot be prefixed with an `@` sign (e.g. trigger(\\'@foo\\', [...]))');\n        }\n        metadata.definitions.forEach(def => {\n            this._resetContextStyleTimingState(context);\n            if (def.type == 0 /* State */) {\n                /** @type {?} */\n                const stateDef = /** @type {?} */ (def);\n                /** @type {?} */\n                const name = stateDef.name;\n                name.toString().split(/\\s*,\\s*/).forEach(n => {\n                    stateDef.name = n;\n                    states.push(this.visitState(stateDef, context));\n                });\n                stateDef.name = name;\n            }\n            else if (def.type == 1 /* Transition */) {\n                /** @type {?} */\n                const transition = this.visitTransition(/** @type {?} */ (def), context);\n                queryCount += transition.queryCount;\n                depCount += transition.depCount;\n                transitions.push(transition);\n            }\n            else {\n                context.errors.push('only state() and transition() definitions can sit inside of a trigger()');\n            }\n        });\n        return {\n            type: 7 /* Trigger */,\n            name: metadata.name, states, transitions, queryCount, depCount,\n            options: null\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitState(metadata, context) {\n        /** @type {?} */\n        const styleAst = this.visitStyle(metadata.styles, context);\n        /** @type {?} */\n        const astParams = (metadata.options && metadata.options.params) || null;\n        if (styleAst.containsDynamicStyles) {\n            /** @type {?} */\n            const missingSubs = new Set();\n            /** @type {?} */\n            const params = astParams || {};\n            styleAst.styles.forEach(value => {\n                if (isObject(value)) {\n                    /** @type {?} */\n                    const stylesObj = /** @type {?} */ (value);\n                    Object.keys(stylesObj).forEach(prop => {\n                        extractStyleParams(stylesObj[prop]).forEach(sub => {\n                            if (!params.hasOwnProperty(sub)) {\n                                missingSubs.add(sub);\n                            }\n                        });\n                    });\n                }\n            });\n            if (missingSubs.size) {\n                /** @type {?} */\n                const missingSubsArr = iteratorToArray(missingSubs.values());\n                context.errors.push(`state(\"${metadata.name}\", ...) must define default values for all the following style substitutions: ${missingSubsArr.join(', ')}`);\n            }\n        }\n        return {\n            type: 0 /* State */,\n            name: metadata.name,\n            style: styleAst,\n            options: astParams ? { params: astParams } : null\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitTransition(metadata, context) {\n        context.queryCount = 0;\n        context.depCount = 0;\n        /** @type {?} */\n        const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);\n        /** @type {?} */\n        const matchers = parseTransitionExpr(metadata.expr, context.errors);\n        return {\n            type: 1 /* Transition */,\n            matchers,\n            animation,\n            queryCount: context.queryCount,\n            depCount: context.depCount,\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitSequence(metadata, context) {\n        return {\n            type: 2 /* Sequence */,\n            steps: metadata.steps.map(s => visitDslNode(this, s, context)),\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitGroup(metadata, context) {\n        /** @type {?} */\n        const currentTime = context.currentTime;\n        /** @type {?} */\n        let furthestTime = 0;\n        /** @type {?} */\n        const steps = metadata.steps.map(step => {\n            context.currentTime = currentTime;\n            /** @type {?} */\n            const innerAst = visitDslNode(this, step, context);\n            furthestTime = Math.max(furthestTime, context.currentTime);\n            return innerAst;\n        });\n        context.currentTime = furthestTime;\n        return {\n            type: 3 /* Group */,\n            steps,\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitAnimate(metadata, context) {\n        /** @type {?} */\n        const timingAst = constructTimingAst(metadata.timings, context.errors);\n        context.currentAnimateTimings = timingAst;\n        /** @type {?} */\n        let styleAst;\n        /** @type {?} */\n        let styleMetadata = metadata.styles ? metadata.styles : style({});\n        if (styleMetadata.type == 5 /* Keyframes */) {\n            styleAst = this.visitKeyframes(/** @type {?} */ (styleMetadata), context);\n        }\n        else {\n            /** @type {?} */\n            let styleMetadata = /** @type {?} */ (metadata.styles);\n            /** @type {?} */\n            let isEmpty = false;\n            if (!styleMetadata) {\n                isEmpty = true;\n                /** @type {?} */\n                const newStyleData = {};\n                if (timingAst.easing) {\n                    newStyleData['easing'] = timingAst.easing;\n                }\n                styleMetadata = style(newStyleData);\n            }\n            context.currentTime += timingAst.duration + timingAst.delay;\n            /** @type {?} */\n            const _styleAst = this.visitStyle(styleMetadata, context);\n            _styleAst.isEmptyStep = isEmpty;\n            styleAst = _styleAst;\n        }\n        context.currentAnimateTimings = null;\n        return {\n            type: 4 /* Animate */,\n            timings: timingAst,\n            style: styleAst,\n            options: null\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitStyle(metadata, context) {\n        /** @type {?} */\n        const ast = this._makeStyleAst(metadata, context);\n        this._validateStyleAst(ast, context);\n        return ast;\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    _makeStyleAst(metadata, context) {\n        /** @type {?} */\n        const styles = [];\n        if (Array.isArray(metadata.styles)) {\n            (/** @type {?} */ (metadata.styles)).forEach(styleTuple => {\n                if (typeof styleTuple == 'string') {\n                    if (styleTuple == AUTO_STYLE) {\n                        styles.push(/** @type {?} */ (styleTuple));\n                    }\n                    else {\n                        context.errors.push(`The provided style string value ${styleTuple} is not allowed.`);\n                    }\n                }\n                else {\n                    styles.push(/** @type {?} */ (styleTuple));\n                }\n            });\n        }\n        else {\n            styles.push(metadata.styles);\n        }\n        /** @type {?} */\n        let containsDynamicStyles = false;\n        /** @type {?} */\n        let collectedEasing = null;\n        styles.forEach(styleData => {\n            if (isObject(styleData)) {\n                /** @type {?} */\n                const styleMap = /** @type {?} */ (styleData);\n                /** @type {?} */\n                const easing = styleMap['easing'];\n                if (easing) {\n                    collectedEasing = /** @type {?} */ (easing);\n                    delete styleMap['easing'];\n                }\n                if (!containsDynamicStyles) {\n                    for (let prop in styleMap) {\n                        /** @type {?} */\n                        const value = styleMap[prop];\n                        if (value.toString().indexOf(SUBSTITUTION_EXPR_START) >= 0) {\n                            containsDynamicStyles = true;\n                            break;\n                        }\n                    }\n                }\n            }\n        });\n        return {\n            type: 6 /* Style */,\n            styles,\n            easing: collectedEasing,\n            offset: metadata.offset, containsDynamicStyles,\n            options: null\n        };\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    _validateStyleAst(ast, context) {\n        /** @type {?} */\n        const timings = context.currentAnimateTimings;\n        /** @type {?} */\n        let endTime = context.currentTime;\n        /** @type {?} */\n        let startTime = context.currentTime;\n        if (timings && startTime > 0) {\n            startTime -= timings.duration + timings.delay;\n        }\n        ast.styles.forEach(tuple => {\n            if (typeof tuple == 'string')\n                return;\n            Object.keys(tuple).forEach(prop => {\n                if (!this._driver.validateStyleProperty(prop)) {\n                    context.errors.push(`The provided animation property \"${prop}\" is not a supported CSS property for animations`);\n                    return;\n                }\n                /** @type {?} */\n                const collectedStyles = context.collectedStyles[/** @type {?} */ ((context.currentQuerySelector))];\n                /** @type {?} */\n                const collectedEntry = collectedStyles[prop];\n                /** @type {?} */\n                let updateCollectedStyle = true;\n                if (collectedEntry) {\n                    if (startTime != endTime && startTime >= collectedEntry.startTime &&\n                        endTime <= collectedEntry.endTime) {\n                        context.errors.push(`The CSS property \"${prop}\" that exists between the times of \"${collectedEntry.startTime}ms\" and \"${collectedEntry.endTime}ms\" is also being animated in a parallel animation between the times of \"${startTime}ms\" and \"${endTime}ms\"`);\n                        updateCollectedStyle = false;\n                    }\n                    // we always choose the smaller start time value since we\n                    // want to have a record of the entire animation window where\n                    // the style property is being animated in between\n                    startTime = collectedEntry.startTime;\n                }\n                if (updateCollectedStyle) {\n                    collectedStyles[prop] = { startTime, endTime };\n                }\n                if (context.options) {\n                    validateStyleParams(tuple[prop], context.options, context.errors);\n                }\n            });\n        });\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitKeyframes(metadata, context) {\n        /** @type {?} */\n        const ast = { type: 5 /* Keyframes */, styles: [], options: null };\n        if (!context.currentAnimateTimings) {\n            context.errors.push(`keyframes() must be placed inside of a call to animate()`);\n            return ast;\n        }\n        /** @type {?} */\n        const MAX_KEYFRAME_OFFSET = 1;\n        /** @type {?} */\n        let totalKeyframesWithOffsets = 0;\n        /** @type {?} */\n        const offsets = [];\n        /** @type {?} */\n        let offsetsOutOfOrder = false;\n        /** @type {?} */\n        let keyframesOutOfRange = false;\n        /** @type {?} */\n        let previousOffset = 0;\n        /** @type {?} */\n        const keyframes = metadata.steps.map(styles => {\n            /** @type {?} */\n            const style$$1 = this._makeStyleAst(styles, context);\n            /** @type {?} */\n            let offsetVal = style$$1.offset != null ? style$$1.offset : consumeOffset(style$$1.styles);\n            /** @type {?} */\n            let offset = 0;\n            if (offsetVal != null) {\n                totalKeyframesWithOffsets++;\n                offset = style$$1.offset = offsetVal;\n            }\n            keyframesOutOfRange = keyframesOutOfRange || offset < 0 || offset > 1;\n            offsetsOutOfOrder = offsetsOutOfOrder || offset < previousOffset;\n            previousOffset = offset;\n            offsets.push(offset);\n            return style$$1;\n        });\n        if (keyframesOutOfRange) {\n            context.errors.push(`Please ensure that all keyframe offsets are between 0 and 1`);\n        }\n        if (offsetsOutOfOrder) {\n            context.errors.push(`Please ensure that all keyframe offsets are in order`);\n        }\n        /** @type {?} */\n        const length = metadata.steps.length;\n        /** @type {?} */\n        let generatedOffset = 0;\n        if (totalKeyframesWithOffsets > 0 && totalKeyframesWithOffsets < length) {\n            context.errors.push(`Not all style() steps within the declared keyframes() contain offsets`);\n        }\n        else if (totalKeyframesWithOffsets == 0) {\n            generatedOffset = MAX_KEYFRAME_OFFSET / (length - 1);\n        }\n        /** @type {?} */\n        const limit = length - 1;\n        /** @type {?} */\n        const currentTime = context.currentTime;\n        /** @type {?} */\n        const currentAnimateTimings = /** @type {?} */ ((context.currentAnimateTimings));\n        /** @type {?} */\n        const animateDuration = currentAnimateTimings.duration;\n        keyframes.forEach((kf, i) => {\n            /** @type {?} */\n            const offset = generatedOffset > 0 ? (i == limit ? 1 : (generatedOffset * i)) : offsets[i];\n            /** @type {?} */\n            const durationUpToThisFrame = offset * animateDuration;\n            context.currentTime = currentTime + currentAnimateTimings.delay + durationUpToThisFrame;\n            currentAnimateTimings.duration = durationUpToThisFrame;\n            this._validateStyleAst(kf, context);\n            kf.offset = offset;\n            ast.styles.push(kf);\n        });\n        return ast;\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitReference(metadata, context) {\n        return {\n            type: 8 /* Reference */,\n            animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context),\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitAnimateChild(metadata, context) {\n        context.depCount++;\n        return {\n            type: 9 /* AnimateChild */,\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitAnimateRef(metadata, context) {\n        return {\n            type: 10 /* AnimateRef */,\n            animation: this.visitReference(metadata.animation, context),\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitQuery(metadata, context) {\n        /** @type {?} */\n        const parentSelector = /** @type {?} */ ((context.currentQuerySelector));\n        /** @type {?} */\n        const options = /** @type {?} */ ((metadata.options || {}));\n        context.queryCount++;\n        context.currentQuery = metadata;\n        const [selector, includeSelf] = normalizeSelector(metadata.selector);\n        context.currentQuerySelector =\n            parentSelector.length ? (parentSelector + ' ' + selector) : selector;\n        getOrSetAsInMap(context.collectedStyles, context.currentQuerySelector, {});\n        /** @type {?} */\n        const animation = visitDslNode(this, normalizeAnimationEntry(metadata.animation), context);\n        context.currentQuery = null;\n        context.currentQuerySelector = parentSelector;\n        return {\n            type: 11 /* Query */,\n            selector,\n            limit: options.limit || 0,\n            optional: !!options.optional, includeSelf, animation,\n            originalSelector: metadata.selector,\n            options: normalizeAnimationOptions(metadata.options)\n        };\n    }\n    /**\n     * @param {?} metadata\n     * @param {?} context\n     * @return {?}\n     */\n    visitStagger(metadata, context) {\n        if (!context.currentQuery) {\n            context.errors.push(`stagger() can only be used inside of query()`);\n        }\n        /** @type {?} */\n        const timings = metadata.timings === 'full' ?\n            { duration: 0, delay: 0, easing: 'full' } :\n            resolveTiming(metadata.timings, context.errors, true);\n        return {\n            type: 12 /* Stagger */,\n            animation: visitDslNode(this, normalizeAnimationEntry(metadata.animation), context), timings,\n            options: null\n        };\n    }\n}\n/**\n * @param {?} selector\n * @return {?}\n */\nfunction normalizeSelector(selector) {\n    /** @type {?} */\n    const hasAmpersand = selector.split(/\\s*,\\s*/).find(token => token == SELF_TOKEN) ? true : false;\n    if (hasAmpersand) {\n        selector = selector.replace(SELF_TOKEN_REGEX, '');\n    }\n    // the :enter and :leave selectors are filled in at runtime during timeline building\n    selector = selector.replace(/@\\*/g, NG_TRIGGER_SELECTOR)\n        .replace(/@\\w+/g, match => NG_TRIGGER_SELECTOR + '-' + match.substr(1))\n        .replace(/:animating/g, NG_ANIMATING_SELECTOR);\n    return [selector, hasAmpersand];\n}\n/**\n * @param {?} obj\n * @return {?}\n */\nfunction normalizeParams(obj) {\n    return obj ? copyObj(obj) : null;\n}\nclass AnimationAstBuilderContext {\n    /**\n     * @param {?} errors\n     */\n    constructor(errors) {\n        this.errors = errors;\n        this.queryCount = 0;\n        this.depCount = 0;\n        this.currentTransition = null;\n        this.currentQuery = null;\n        this.currentQuerySelector = null;\n        this.currentAnimateTimings = null;\n        this.currentTime = 0;\n        this.collectedStyles = {};\n        this.options = null;\n    }\n}\n/**\n * @param {?} styles\n * @return {?}\n */\nfunction consumeOffset(styles) {\n    if (typeof styles == 'string')\n        return null;\n    /** @type {?} */\n    let offset = null;\n    if (Array.isArray(styles)) {\n        styles.forEach(styleTuple => {\n            if (isObject(styleTuple) && styleTuple.hasOwnProperty('offset')) {\n                /** @type {?} */\n                const obj = /** @type {?} */ (styleTuple);\n                offset = parseFloat(/** @type {?} */ (obj['offset']));\n                delete obj['offset'];\n            }\n        });\n    }\n    else if (isObject(styles) && styles.hasOwnProperty('offset')) {\n        /** @type {?} */\n        const obj = /** @type {?} */ (styles);\n        offset = parseFloat(/** @type {?} */ (obj['offset']));\n        delete obj['offset'];\n    }\n    return offset;\n}\n/**\n * @param {?} value\n * @return {?}\n */\nfunction isObject(value) {\n    return !Array.isArray(value) && typeof value == 'object';\n}\n/**\n * @param {?} value\n * @param {?} errors\n * @return {?}\n */\nfunction constructTimingAst(value, errors) {\n    /** @type {?} */\n    let timings = null;\n    if (value.hasOwnProperty('duration')) {\n        timings = /** @type {?} */ (value);\n    }\n    else if (typeof value == 'number') {\n        /** @type {?} */\n        const duration = resolveTiming(/** @type {?} */ (value), errors).duration;\n        return makeTimingAst(/** @type {?} */ (duration), 0, '');\n    }\n    /** @type {?} */\n    const strValue = /** @type {?} */ (value);\n    /** @type {?} */\n    const isDynamic = strValue.split(/\\s+/).some(v => v.charAt(0) == '{' && v.charAt(1) == '{');\n    if (isDynamic) {\n        /** @type {?} */\n        const ast = /** @type {?} */ (makeTimingAst(0, 0, ''));\n        ast.dynamic = true;\n        ast.strValue = strValue;\n        return /** @type {?} */ (ast);\n    }\n    timings = timings || resolveTiming(strValue, errors);\n    return makeTimingAst(timings.duration, timings.delay, timings.easing);\n}\n/**\n * @param {?} options\n * @return {?}\n */\nfunction normalizeAnimationOptions(options) {\n    if (options) {\n        options = copyObj(options);\n        if (options['params']) {\n            options['params'] = /** @type {?} */ ((normalizeParams(options['params'])));\n        }\n    }\n    else {\n        options = {};\n    }\n    return options;\n}\n/**\n * @param {?} duration\n * @param {?} delay\n * @param {?} easing\n * @return {?}\n */\nfunction makeTimingAst(duration, delay, easing) {\n    return { duration, delay, easing };\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * @param {?} element\n * @param {?} keyframes\n * @param {?} preStyleProps\n * @param {?} postStyleProps\n * @param {?} duration\n * @param {?} delay\n * @param {?=} easing\n * @param {?=} subTimeline\n * @return {?}\n */\nfunction createTimelineInstruction(element, keyframes, preStyleProps, postStyleProps, duration, delay, easing = null, subTimeline = false) {\n    return {\n        type: 1 /* TimelineAnimation */,\n        element,\n        keyframes,\n        preStyleProps,\n        postStyleProps,\n        duration,\n        delay,\n        totalTime: duration + delay, easing, subTimeline\n    };\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass ElementInstructionMap {\n    constructor() {\n        this._map = new Map();\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    consume(element) {\n        /** @type {?} */\n        let instructions = this._map.get(element);\n        if (instructions) {\n            this._map.delete(element);\n        }\n        else {\n            instructions = [];\n        }\n        return instructions;\n    }\n    /**\n     * @param {?} element\n     * @param {?} instructions\n     * @return {?}\n     */\n    append(element, instructions) {\n        /** @type {?} */\n        let existingInstructions = this._map.get(element);\n        if (!existingInstructions) {\n            this._map.set(element, existingInstructions = []);\n        }\n        existingInstructions.push(...instructions);\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    has(element) { return this._map.has(element); }\n    /**\n     * @return {?}\n     */\n    clear() { this._map.clear(); }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst ONE_FRAME_IN_MILLISECONDS = 1;\n/** @type {?} */\nconst ENTER_TOKEN = ':enter';\n/** @type {?} */\nconst ENTER_TOKEN_REGEX = new RegExp(ENTER_TOKEN, 'g');\n/** @type {?} */\nconst LEAVE_TOKEN = ':leave';\n/** @type {?} */\nconst LEAVE_TOKEN_REGEX = new RegExp(LEAVE_TOKEN, 'g');\n/**\n * @param {?} driver\n * @param {?} rootElement\n * @param {?} ast\n * @param {?} enterClassName\n * @param {?} leaveClassName\n * @param {?=} startingStyles\n * @param {?=} finalStyles\n * @param {?=} options\n * @param {?=} subInstructions\n * @param {?=} errors\n * @return {?}\n */\nfunction buildAnimationTimelines(driver, rootElement, ast, enterClassName, leaveClassName, startingStyles = {}, finalStyles = {}, options, subInstructions, errors = []) {\n    return new AnimationTimelineBuilderVisitor().buildKeyframes(driver, rootElement, ast, enterClassName, leaveClassName, startingStyles, finalStyles, options, subInstructions, errors);\n}\nclass AnimationTimelineBuilderVisitor {\n    /**\n     * @param {?} driver\n     * @param {?} rootElement\n     * @param {?} ast\n     * @param {?} enterClassName\n     * @param {?} leaveClassName\n     * @param {?} startingStyles\n     * @param {?} finalStyles\n     * @param {?} options\n     * @param {?=} subInstructions\n     * @param {?=} errors\n     * @return {?}\n     */\n    buildKeyframes(driver, rootElement, ast, enterClassName, leaveClassName, startingStyles, finalStyles, options, subInstructions, errors = []) {\n        subInstructions = subInstructions || new ElementInstructionMap();\n        /** @type {?} */\n        const context = new AnimationTimelineContext(driver, rootElement, subInstructions, enterClassName, leaveClassName, errors, []);\n        context.options = options;\n        context.currentTimeline.setStyles([startingStyles], null, context.errors, options);\n        visitDslNode(this, ast, context);\n        /** @type {?} */\n        const timelines = context.timelines.filter(timeline => timeline.containsAnimation());\n        if (timelines.length && Object.keys(finalStyles).length) {\n            /** @type {?} */\n            const tl = timelines[timelines.length - 1];\n            if (!tl.allowOnlyTimelineStyles()) {\n                tl.setStyles([finalStyles], null, context.errors, options);\n            }\n        }\n        return timelines.length ? timelines.map(timeline => timeline.buildKeyframes()) :\n            [createTimelineInstruction(rootElement, [], [], [], 0, 0, '', false)];\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitTrigger(ast, context) {\n        // these values are not visited in this AST\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitState(ast, context) {\n        // these values are not visited in this AST\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitTransition(ast, context) {\n        // these values are not visited in this AST\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitAnimateChild(ast, context) {\n        /** @type {?} */\n        const elementInstructions = context.subInstructions.consume(context.element);\n        if (elementInstructions) {\n            /** @type {?} */\n            const innerContext = context.createSubContext(ast.options);\n            /** @type {?} */\n            const startTime = context.currentTimeline.currentTime;\n            /** @type {?} */\n            const endTime = this._visitSubInstructions(elementInstructions, innerContext, /** @type {?} */ (innerContext.options));\n            if (startTime != endTime) {\n                // we do this on the upper context because we created a sub context for\n                // the sub child animations\n                context.transformIntoNewTimeline(endTime);\n            }\n        }\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitAnimateRef(ast, context) {\n        /** @type {?} */\n        const innerContext = context.createSubContext(ast.options);\n        innerContext.transformIntoNewTimeline();\n        this.visitReference(ast.animation, innerContext);\n        context.transformIntoNewTimeline(innerContext.currentTimeline.currentTime);\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} instructions\n     * @param {?} context\n     * @param {?} options\n     * @return {?}\n     */\n    _visitSubInstructions(instructions, context, options) {\n        /** @type {?} */\n        const startTime = context.currentTimeline.currentTime;\n        /** @type {?} */\n        let furthestTime = startTime;\n        /** @type {?} */\n        const duration = options.duration != null ? resolveTimingValue(options.duration) : null;\n        /** @type {?} */\n        const delay = options.delay != null ? resolveTimingValue(options.delay) : null;\n        if (duration !== 0) {\n            instructions.forEach(instruction => {\n                /** @type {?} */\n                const instructionTimings = context.appendInstructionToTimeline(instruction, duration, delay);\n                furthestTime =\n                    Math.max(furthestTime, instructionTimings.duration + instructionTimings.delay);\n            });\n        }\n        return furthestTime;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitReference(ast, context) {\n        context.updateOptions(ast.options, true);\n        visitDslNode(this, ast.animation, context);\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitSequence(ast, context) {\n        /** @type {?} */\n        const subContextCount = context.subContextCount;\n        /** @type {?} */\n        let ctx = context;\n        /** @type {?} */\n        const options = ast.options;\n        if (options && (options.params || options.delay)) {\n            ctx = context.createSubContext(options);\n            ctx.transformIntoNewTimeline();\n            if (options.delay != null) {\n                if (ctx.previousNode.type == 6 /* Style */) {\n                    ctx.currentTimeline.snapshotCurrentStyles();\n                    ctx.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;\n                }\n                /** @type {?} */\n                const delay = resolveTimingValue(options.delay);\n                ctx.delayNextStep(delay);\n            }\n        }\n        if (ast.steps.length) {\n            ast.steps.forEach(s => visitDslNode(this, s, ctx));\n            // this is here just incase the inner steps only contain or end with a style() call\n            ctx.currentTimeline.applyStylesToKeyframe();\n            // this means that some animation function within the sequence\n            // ended up creating a sub timeline (which means the current\n            // timeline cannot overlap with the contents of the sequence)\n            if (ctx.subContextCount > subContextCount) {\n                ctx.transformIntoNewTimeline();\n            }\n        }\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitGroup(ast, context) {\n        /** @type {?} */\n        const innerTimelines = [];\n        /** @type {?} */\n        let furthestTime = context.currentTimeline.currentTime;\n        /** @type {?} */\n        const delay = ast.options && ast.options.delay ? resolveTimingValue(ast.options.delay) : 0;\n        ast.steps.forEach(s => {\n            /** @type {?} */\n            const innerContext = context.createSubContext(ast.options);\n            if (delay) {\n                innerContext.delayNextStep(delay);\n            }\n            visitDslNode(this, s, innerContext);\n            furthestTime = Math.max(furthestTime, innerContext.currentTimeline.currentTime);\n            innerTimelines.push(innerContext.currentTimeline);\n        });\n        // this operation is run after the AST loop because otherwise\n        // if the parent timeline's collected styles were updated then\n        // it would pass in invalid data into the new-to-be forked items\n        innerTimelines.forEach(timeline => context.currentTimeline.mergeTimelineCollectedStyles(timeline));\n        context.transformIntoNewTimeline(furthestTime);\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    _visitTiming(ast, context) {\n        if ((/** @type {?} */ (ast)).dynamic) {\n            /** @type {?} */\n            const strValue = (/** @type {?} */ (ast)).strValue;\n            /** @type {?} */\n            const timingValue = context.params ? interpolateParams(strValue, context.params, context.errors) : strValue;\n            return resolveTiming(timingValue, context.errors);\n        }\n        else {\n            return { duration: ast.duration, delay: ast.delay, easing: ast.easing };\n        }\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitAnimate(ast, context) {\n        /** @type {?} */\n        const timings = context.currentAnimateTimings = this._visitTiming(ast.timings, context);\n        /** @type {?} */\n        const timeline = context.currentTimeline;\n        if (timings.delay) {\n            context.incrementTime(timings.delay);\n            timeline.snapshotCurrentStyles();\n        }\n        /** @type {?} */\n        const style$$1 = ast.style;\n        if (style$$1.type == 5 /* Keyframes */) {\n            this.visitKeyframes(style$$1, context);\n        }\n        else {\n            context.incrementTime(timings.duration);\n            this.visitStyle(/** @type {?} */ (style$$1), context);\n            timeline.applyStylesToKeyframe();\n        }\n        context.currentAnimateTimings = null;\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitStyle(ast, context) {\n        /** @type {?} */\n        const timeline = context.currentTimeline;\n        /** @type {?} */\n        const timings = /** @type {?} */ ((context.currentAnimateTimings));\n        // this is a special case for when a style() call\n        // directly follows  an animate() call (but not inside of an animate() call)\n        if (!timings && timeline.getCurrentStyleProperties().length) {\n            timeline.forwardFrame();\n        }\n        /** @type {?} */\n        const easing = (timings && timings.easing) || ast.easing;\n        if (ast.isEmptyStep) {\n            timeline.applyEmptyStep(easing);\n        }\n        else {\n            timeline.setStyles(ast.styles, easing, context.errors, context.options);\n        }\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitKeyframes(ast, context) {\n        /** @type {?} */\n        const currentAnimateTimings = /** @type {?} */ ((context.currentAnimateTimings));\n        /** @type {?} */\n        const startTime = (/** @type {?} */ ((context.currentTimeline))).duration;\n        /** @type {?} */\n        const duration = currentAnimateTimings.duration;\n        /** @type {?} */\n        const innerContext = context.createSubContext();\n        /** @type {?} */\n        const innerTimeline = innerContext.currentTimeline;\n        innerTimeline.easing = currentAnimateTimings.easing;\n        ast.styles.forEach(step => {\n            /** @type {?} */\n            const offset = step.offset || 0;\n            innerTimeline.forwardTime(offset * duration);\n            innerTimeline.setStyles(step.styles, step.easing, context.errors, context.options);\n            innerTimeline.applyStylesToKeyframe();\n        });\n        // this will ensure that the parent timeline gets all the styles from\n        // the child even if the new timeline below is not used\n        context.currentTimeline.mergeTimelineCollectedStyles(innerTimeline);\n        // we do this because the window between this timeline and the sub timeline\n        // should ensure that the styles within are exactly the same as they were before\n        context.transformIntoNewTimeline(startTime + duration);\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitQuery(ast, context) {\n        /** @type {?} */\n        const startTime = context.currentTimeline.currentTime;\n        /** @type {?} */\n        const options = /** @type {?} */ ((ast.options || {}));\n        /** @type {?} */\n        const delay = options.delay ? resolveTimingValue(options.delay) : 0;\n        if (delay && (context.previousNode.type === 6 /* Style */ ||\n            (startTime == 0 && context.currentTimeline.getCurrentStyleProperties().length))) {\n            context.currentTimeline.snapshotCurrentStyles();\n            context.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;\n        }\n        /** @type {?} */\n        let furthestTime = startTime;\n        /** @type {?} */\n        const elms = context.invokeQuery(ast.selector, ast.originalSelector, ast.limit, ast.includeSelf, options.optional ? true : false, context.errors);\n        context.currentQueryTotal = elms.length;\n        /** @type {?} */\n        let sameElementTimeline = null;\n        elms.forEach((element, i) => {\n            context.currentQueryIndex = i;\n            /** @type {?} */\n            const innerContext = context.createSubContext(ast.options, element);\n            if (delay) {\n                innerContext.delayNextStep(delay);\n            }\n            if (element === context.element) {\n                sameElementTimeline = innerContext.currentTimeline;\n            }\n            visitDslNode(this, ast.animation, innerContext);\n            // this is here just incase the inner steps only contain or end\n            // with a style() call (which is here to signal that this is a preparatory\n            // call to style an element before it is animated again)\n            innerContext.currentTimeline.applyStylesToKeyframe();\n            /** @type {?} */\n            const endTime = innerContext.currentTimeline.currentTime;\n            furthestTime = Math.max(furthestTime, endTime);\n        });\n        context.currentQueryIndex = 0;\n        context.currentQueryTotal = 0;\n        context.transformIntoNewTimeline(furthestTime);\n        if (sameElementTimeline) {\n            context.currentTimeline.mergeTimelineCollectedStyles(sameElementTimeline);\n            context.currentTimeline.snapshotCurrentStyles();\n        }\n        context.previousNode = ast;\n    }\n    /**\n     * @param {?} ast\n     * @param {?} context\n     * @return {?}\n     */\n    visitStagger(ast, context) {\n        /** @type {?} */\n        const parentContext = /** @type {?} */ ((context.parentContext));\n        /** @type {?} */\n        const tl = context.currentTimeline;\n        /** @type {?} */\n        const timings = ast.timings;\n        /** @type {?} */\n        const duration = Math.abs(timings.duration);\n        /** @type {?} */\n        const maxTime = duration * (context.currentQueryTotal - 1);\n        /** @type {?} */\n        let delay = duration * context.currentQueryIndex;\n        /** @type {?} */\n        let staggerTransformer = timings.duration < 0 ? 'reverse' : timings.easing;\n        switch (staggerTransformer) {\n            case 'reverse':\n                delay = maxTime - delay;\n                break;\n            case 'full':\n                delay = parentContext.currentStaggerTime;\n                break;\n        }\n        /** @type {?} */\n        const timeline = context.currentTimeline;\n        if (delay) {\n            timeline.delayNextStep(delay);\n        }\n        /** @type {?} */\n        const startingTime = timeline.currentTime;\n        visitDslNode(this, ast.animation, context);\n        context.previousNode = ast;\n        // time = duration + delay\n        // the reason why this computation is so complex is because\n        // the inner timeline may either have a delay value or a stretched\n        // keyframe depending on if a subtimeline is not used or is used.\n        parentContext.currentStaggerTime =\n            (tl.currentTime - startingTime) + (tl.startTime - parentContext.currentTimeline.startTime);\n    }\n}\n/** @type {?} */\nconst DEFAULT_NOOP_PREVIOUS_NODE = /** @type {?} */ ({});\nclass AnimationTimelineContext {\n    /**\n     * @param {?} _driver\n     * @param {?} element\n     * @param {?} subInstructions\n     * @param {?} _enterClassName\n     * @param {?} _leaveClassName\n     * @param {?} errors\n     * @param {?} timelines\n     * @param {?=} initialTimeline\n     */\n    constructor(_driver, element, subInstructions, _enterClassName, _leaveClassName, errors, timelines, initialTimeline) {\n        this._driver = _driver;\n        this.element = element;\n        this.subInstructions = subInstructions;\n        this._enterClassName = _enterClassName;\n        this._leaveClassName = _leaveClassName;\n        this.errors = errors;\n        this.timelines = timelines;\n        this.parentContext = null;\n        this.currentAnimateTimings = null;\n        this.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;\n        this.subContextCount = 0;\n        this.options = {};\n        this.currentQueryIndex = 0;\n        this.currentQueryTotal = 0;\n        this.currentStaggerTime = 0;\n        this.currentTimeline = initialTimeline || new TimelineBuilder(this._driver, element, 0);\n        timelines.push(this.currentTimeline);\n    }\n    /**\n     * @return {?}\n     */\n    get params() { return this.options.params; }\n    /**\n     * @param {?} options\n     * @param {?=} skipIfExists\n     * @return {?}\n     */\n    updateOptions(options, skipIfExists) {\n        if (!options)\n            return;\n        /** @type {?} */\n        const newOptions = /** @type {?} */ (options);\n        /** @type {?} */\n        let optionsToUpdate = this.options;\n        // NOTE: this will get patched up when other animation methods support duration overrides\n        if (newOptions.duration != null) {\n            (/** @type {?} */ (optionsToUpdate)).duration = resolveTimingValue(newOptions.duration);\n        }\n        if (newOptions.delay != null) {\n            optionsToUpdate.delay = resolveTimingValue(newOptions.delay);\n        }\n        /** @type {?} */\n        const newParams = newOptions.params;\n        if (newParams) {\n            /** @type {?} */\n            let paramsToUpdate = /** @type {?} */ ((optionsToUpdate.params));\n            if (!paramsToUpdate) {\n                paramsToUpdate = this.options.params = {};\n            }\n            Object.keys(newParams).forEach(name => {\n                if (!skipIfExists || !paramsToUpdate.hasOwnProperty(name)) {\n                    paramsToUpdate[name] = interpolateParams(newParams[name], paramsToUpdate, this.errors);\n                }\n            });\n        }\n    }\n    /**\n     * @return {?}\n     */\n    _copyOptions() {\n        /** @type {?} */\n        const options = {};\n        if (this.options) {\n            /** @type {?} */\n            const oldParams = this.options.params;\n            if (oldParams) {\n                /** @type {?} */\n                const params = options['params'] = {};\n                Object.keys(oldParams).forEach(name => { params[name] = oldParams[name]; });\n            }\n        }\n        return options;\n    }\n    /**\n     * @param {?=} options\n     * @param {?=} element\n     * @param {?=} newTime\n     * @return {?}\n     */\n    createSubContext(options = null, element, newTime) {\n        /** @type {?} */\n        const target = element || this.element;\n        /** @type {?} */\n        const context = new AnimationTimelineContext(this._driver, target, this.subInstructions, this._enterClassName, this._leaveClassName, this.errors, this.timelines, this.currentTimeline.fork(target, newTime || 0));\n        context.previousNode = this.previousNode;\n        context.currentAnimateTimings = this.currentAnimateTimings;\n        context.options = this._copyOptions();\n        context.updateOptions(options);\n        context.currentQueryIndex = this.currentQueryIndex;\n        context.currentQueryTotal = this.currentQueryTotal;\n        context.parentContext = this;\n        this.subContextCount++;\n        return context;\n    }\n    /**\n     * @param {?=} newTime\n     * @return {?}\n     */\n    transformIntoNewTimeline(newTime) {\n        this.previousNode = DEFAULT_NOOP_PREVIOUS_NODE;\n        this.currentTimeline = this.currentTimeline.fork(this.element, newTime);\n        this.timelines.push(this.currentTimeline);\n        return this.currentTimeline;\n    }\n    /**\n     * @param {?} instruction\n     * @param {?} duration\n     * @param {?} delay\n     * @return {?}\n     */\n    appendInstructionToTimeline(instruction, duration, delay) {\n        /** @type {?} */\n        const updatedTimings = {\n            duration: duration != null ? duration : instruction.duration,\n            delay: this.currentTimeline.currentTime + (delay != null ? delay : 0) + instruction.delay,\n            easing: ''\n        };\n        /** @type {?} */\n        const builder = new SubTimelineBuilder(this._driver, instruction.element, instruction.keyframes, instruction.preStyleProps, instruction.postStyleProps, updatedTimings, instruction.stretchStartingKeyframe);\n        this.timelines.push(builder);\n        return updatedTimings;\n    }\n    /**\n     * @param {?} time\n     * @return {?}\n     */\n    incrementTime(time) {\n        this.currentTimeline.forwardTime(this.currentTimeline.duration + time);\n    }\n    /**\n     * @param {?} delay\n     * @return {?}\n     */\n    delayNextStep(delay) {\n        // negative delays are not yet supported\n        if (delay > 0) {\n            this.currentTimeline.delayNextStep(delay);\n        }\n    }\n    /**\n     * @param {?} selector\n     * @param {?} originalSelector\n     * @param {?} limit\n     * @param {?} includeSelf\n     * @param {?} optional\n     * @param {?} errors\n     * @return {?}\n     */\n    invokeQuery(selector, originalSelector, limit, includeSelf, optional, errors) {\n        /** @type {?} */\n        let results = [];\n        if (includeSelf) {\n            results.push(this.element);\n        }\n        if (selector.length > 0) { // if :self is only used then the selector is empty\n            // if :self is only used then the selector is empty\n            selector = selector.replace(ENTER_TOKEN_REGEX, '.' + this._enterClassName);\n            selector = selector.replace(LEAVE_TOKEN_REGEX, '.' + this._leaveClassName);\n            /** @type {?} */\n            const multi = limit != 1;\n            /** @type {?} */\n            let elements = this._driver.query(this.element, selector, multi);\n            if (limit !== 0) {\n                elements = limit < 0 ? elements.slice(elements.length + limit, elements.length) :\n                    elements.slice(0, limit);\n            }\n            results.push(...elements);\n        }\n        if (!optional && results.length == 0) {\n            errors.push(`\\`query(\"${originalSelector}\")\\` returned zero elements. (Use \\`query(\"${originalSelector}\", { optional: true })\\` if you wish to allow this.)`);\n        }\n        return results;\n    }\n}\nclass TimelineBuilder {\n    /**\n     * @param {?} _driver\n     * @param {?} element\n     * @param {?} startTime\n     * @param {?=} _elementTimelineStylesLookup\n     */\n    constructor(_driver, element, startTime, _elementTimelineStylesLookup) {\n        this._driver = _driver;\n        this.element = element;\n        this.startTime = startTime;\n        this._elementTimelineStylesLookup = _elementTimelineStylesLookup;\n        this.duration = 0;\n        this._previousKeyframe = {};\n        this._currentKeyframe = {};\n        this._keyframes = new Map();\n        this._styleSummary = {};\n        this._pendingStyles = {};\n        this._backFill = {};\n        this._currentEmptyStepKeyframe = null;\n        if (!this._elementTimelineStylesLookup) {\n            this._elementTimelineStylesLookup = new Map();\n        }\n        this._localTimelineStyles = Object.create(this._backFill, {});\n        this._globalTimelineStyles = /** @type {?} */ ((this._elementTimelineStylesLookup.get(element)));\n        if (!this._globalTimelineStyles) {\n            this._globalTimelineStyles = this._localTimelineStyles;\n            this._elementTimelineStylesLookup.set(element, this._localTimelineStyles);\n        }\n        this._loadKeyframe();\n    }\n    /**\n     * @return {?}\n     */\n    containsAnimation() {\n        switch (this._keyframes.size) {\n            case 0:\n                return false;\n            case 1:\n                return this.getCurrentStyleProperties().length > 0;\n            default:\n                return true;\n        }\n    }\n    /**\n     * @return {?}\n     */\n    getCurrentStyleProperties() { return Object.keys(this._currentKeyframe); }\n    /**\n     * @return {?}\n     */\n    get currentTime() { return this.startTime + this.duration; }\n    /**\n     * @param {?} delay\n     * @return {?}\n     */\n    delayNextStep(delay) {\n        /** @type {?} */\n        const hasPreStyleStep = this._keyframes.size == 1 && Object.keys(this._pendingStyles).length;\n        if (this.duration || hasPreStyleStep) {\n            this.forwardTime(this.currentTime + delay);\n            if (hasPreStyleStep) {\n                this.snapshotCurrentStyles();\n            }\n        }\n        else {\n            this.startTime += delay;\n        }\n    }\n    /**\n     * @param {?} element\n     * @param {?=} currentTime\n     * @return {?}\n     */\n    fork(element, currentTime) {\n        this.applyStylesToKeyframe();\n        return new TimelineBuilder(this._driver, element, currentTime || this.currentTime, this._elementTimelineStylesLookup);\n    }\n    /**\n     * @return {?}\n     */\n    _loadKeyframe() {\n        if (this._currentKeyframe) {\n            this._previousKeyframe = this._currentKeyframe;\n        }\n        this._currentKeyframe = /** @type {?} */ ((this._keyframes.get(this.duration)));\n        if (!this._currentKeyframe) {\n            this._currentKeyframe = Object.create(this._backFill, {});\n            this._keyframes.set(this.duration, this._currentKeyframe);\n        }\n    }\n    /**\n     * @return {?}\n     */\n    forwardFrame() {\n        this.duration += ONE_FRAME_IN_MILLISECONDS;\n        this._loadKeyframe();\n    }\n    /**\n     * @param {?} time\n     * @return {?}\n     */\n    forwardTime(time) {\n        this.applyStylesToKeyframe();\n        this.duration = time;\n        this._loadKeyframe();\n    }\n    /**\n     * @param {?} prop\n     * @param {?} value\n     * @return {?}\n     */\n    _updateStyle(prop, value) {\n        this._localTimelineStyles[prop] = value;\n        this._globalTimelineStyles[prop] = value;\n        this._styleSummary[prop] = { time: this.currentTime, value };\n    }\n    /**\n     * @return {?}\n     */\n    allowOnlyTimelineStyles() { return this._currentEmptyStepKeyframe !== this._currentKeyframe; }\n    /**\n     * @param {?} easing\n     * @return {?}\n     */\n    applyEmptyStep(easing) {\n        if (easing) {\n            this._previousKeyframe['easing'] = easing;\n        }\n        // special case for animate(duration):\n        // all missing styles are filled with a `*` value then\n        // if any destination styles are filled in later on the same\n        // keyframe then they will override the overridden styles\n        // We use `_globalTimelineStyles` here because there may be\n        // styles in previous keyframes that are not present in this timeline\n        Object.keys(this._globalTimelineStyles).forEach(prop => {\n            this._backFill[prop] = this._globalTimelineStyles[prop] || AUTO_STYLE;\n            this._currentKeyframe[prop] = AUTO_STYLE;\n        });\n        this._currentEmptyStepKeyframe = this._currentKeyframe;\n    }\n    /**\n     * @param {?} input\n     * @param {?} easing\n     * @param {?} errors\n     * @param {?=} options\n     * @return {?}\n     */\n    setStyles(input, easing, errors, options) {\n        if (easing) {\n            this._previousKeyframe['easing'] = easing;\n        }\n        /** @type {?} */\n        const params = (options && options.params) || {};\n        /** @type {?} */\n        const styles = flattenStyles(input, this._globalTimelineStyles);\n        Object.keys(styles).forEach(prop => {\n            /** @type {?} */\n            const val = interpolateParams(styles[prop], params, errors);\n            this._pendingStyles[prop] = val;\n            if (!this._localTimelineStyles.hasOwnProperty(prop)) {\n                this._backFill[prop] = this._globalTimelineStyles.hasOwnProperty(prop) ?\n                    this._globalTimelineStyles[prop] :\n                    AUTO_STYLE;\n            }\n            this._updateStyle(prop, val);\n        });\n    }\n    /**\n     * @return {?}\n     */\n    applyStylesToKeyframe() {\n        /** @type {?} */\n        const styles = this._pendingStyles;\n        /** @type {?} */\n        const props = Object.keys(styles);\n        if (props.length == 0)\n            return;\n        this._pendingStyles = {};\n        props.forEach(prop => {\n            /** @type {?} */\n            const val = styles[prop];\n            this._currentKeyframe[prop] = val;\n        });\n        Object.keys(this._localTimelineStyles).forEach(prop => {\n            if (!this._currentKeyframe.hasOwnProperty(prop)) {\n                this._currentKeyframe[prop] = this._localTimelineStyles[prop];\n            }\n        });\n    }\n    /**\n     * @return {?}\n     */\n    snapshotCurrentStyles() {\n        Object.keys(this._localTimelineStyles).forEach(prop => {\n            /** @type {?} */\n            const val = this._localTimelineStyles[prop];\n            this._pendingStyles[prop] = val;\n            this._updateStyle(prop, val);\n        });\n    }\n    /**\n     * @return {?}\n     */\n    getFinalKeyframe() { return this._keyframes.get(this.duration); }\n    /**\n     * @return {?}\n     */\n    get properties() {\n        /** @type {?} */\n        const properties = [];\n        for (let prop in this._currentKeyframe) {\n            properties.push(prop);\n        }\n        return properties;\n    }\n    /**\n     * @param {?} timeline\n     * @return {?}\n     */\n    mergeTimelineCollectedStyles(timeline) {\n        Object.keys(timeline._styleSummary).forEach(prop => {\n            /** @type {?} */\n            const details0 = this._styleSummary[prop];\n            /** @type {?} */\n            const details1 = timeline._styleSummary[prop];\n            if (!details0 || details1.time > details0.time) {\n                this._updateStyle(prop, details1.value);\n            }\n        });\n    }\n    /**\n     * @return {?}\n     */\n    buildKeyframes() {\n        this.applyStylesToKeyframe();\n        /** @type {?} */\n        const preStyleProps = new Set();\n        /** @type {?} */\n        const postStyleProps = new Set();\n        /** @type {?} */\n        const isEmpty = this._keyframes.size === 1 && this.duration === 0;\n        /** @type {?} */\n        let finalKeyframes = [];\n        this._keyframes.forEach((keyframe, time) => {\n            /** @type {?} */\n            const finalKeyframe = copyStyles(keyframe, true);\n            Object.keys(finalKeyframe).forEach(prop => {\n                /** @type {?} */\n                const value = finalKeyframe[prop];\n                if (value == ɵPRE_STYLE) {\n                    preStyleProps.add(prop);\n                }\n                else if (value == AUTO_STYLE) {\n                    postStyleProps.add(prop);\n                }\n            });\n            if (!isEmpty) {\n                finalKeyframe['offset'] = time / this.duration;\n            }\n            finalKeyframes.push(finalKeyframe);\n        });\n        /** @type {?} */\n        const preProps = preStyleProps.size ? iteratorToArray(preStyleProps.values()) : [];\n        /** @type {?} */\n        const postProps = postStyleProps.size ? iteratorToArray(postStyleProps.values()) : [];\n        // special case for a 0-second animation (which is designed just to place styles onscreen)\n        if (isEmpty) {\n            /** @type {?} */\n            const kf0 = finalKeyframes[0];\n            /** @type {?} */\n            const kf1 = copyObj(kf0);\n            kf0['offset'] = 0;\n            kf1['offset'] = 1;\n            finalKeyframes = [kf0, kf1];\n        }\n        return createTimelineInstruction(this.element, finalKeyframes, preProps, postProps, this.duration, this.startTime, this.easing, false);\n    }\n}\nclass SubTimelineBuilder extends TimelineBuilder {\n    /**\n     * @param {?} driver\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} preStyleProps\n     * @param {?} postStyleProps\n     * @param {?} timings\n     * @param {?=} _stretchStartingKeyframe\n     */\n    constructor(driver, element, keyframes, preStyleProps, postStyleProps, timings, _stretchStartingKeyframe = false) {\n        super(driver, element, timings.delay);\n        this.element = element;\n        this.keyframes = keyframes;\n        this.preStyleProps = preStyleProps;\n        this.postStyleProps = postStyleProps;\n        this._stretchStartingKeyframe = _stretchStartingKeyframe;\n        this.timings = { duration: timings.duration, delay: timings.delay, easing: timings.easing };\n    }\n    /**\n     * @return {?}\n     */\n    containsAnimation() { return this.keyframes.length > 1; }\n    /**\n     * @return {?}\n     */\n    buildKeyframes() {\n        /** @type {?} */\n        let keyframes = this.keyframes;\n        let { delay, duration, easing } = this.timings;\n        if (this._stretchStartingKeyframe && delay) {\n            /** @type {?} */\n            const newKeyframes = [];\n            /** @type {?} */\n            const totalTime = duration + delay;\n            /** @type {?} */\n            const startingGap = delay / totalTime;\n            /** @type {?} */\n            const newFirstKeyframe = copyStyles(keyframes[0], false);\n            newFirstKeyframe['offset'] = 0;\n            newKeyframes.push(newFirstKeyframe);\n            /** @type {?} */\n            const oldFirstKeyframe = copyStyles(keyframes[0], false);\n            oldFirstKeyframe['offset'] = roundOffset(startingGap);\n            newKeyframes.push(oldFirstKeyframe);\n            /** @type {?} */\n            const limit = keyframes.length - 1;\n            for (let i = 1; i <= limit; i++) {\n                /** @type {?} */\n                let kf = copyStyles(keyframes[i], false);\n                /** @type {?} */\n                const oldOffset = /** @type {?} */ (kf['offset']);\n                /** @type {?} */\n                const timeAtKeyframe = delay + oldOffset * duration;\n                kf['offset'] = roundOffset(timeAtKeyframe / totalTime);\n                newKeyframes.push(kf);\n            }\n            // the new starting keyframe should be added at the start\n            duration = totalTime;\n            delay = 0;\n            easing = '';\n            keyframes = newKeyframes;\n        }\n        return createTimelineInstruction(this.element, keyframes, this.preStyleProps, this.postStyleProps, duration, delay, easing, true);\n    }\n}\n/**\n * @param {?} offset\n * @param {?=} decimalPoints\n * @return {?}\n */\nfunction roundOffset(offset, decimalPoints = 3) {\n    /** @type {?} */\n    const mult = Math.pow(10, decimalPoints - 1);\n    return Math.round(offset * mult) / mult;\n}\n/**\n * @param {?} input\n * @param {?} allStyles\n * @return {?}\n */\nfunction flattenStyles(input, allStyles) {\n    /** @type {?} */\n    const styles = {};\n    /** @type {?} */\n    let allProperties;\n    input.forEach(token => {\n        if (token === '*') {\n            allProperties = allProperties || Object.keys(allStyles);\n            allProperties.forEach(prop => { styles[prop] = AUTO_STYLE; });\n        }\n        else {\n            copyStyles(/** @type {?} */ (token), false, styles);\n        }\n    });\n    return styles;\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass Animation {\n    /**\n     * @param {?} _driver\n     * @param {?} input\n     */\n    constructor(_driver, input) {\n        this._driver = _driver;\n        /** @type {?} */\n        const errors = [];\n        /** @type {?} */\n        const ast = buildAnimationAst(_driver, input, errors);\n        if (errors.length) {\n            /** @type {?} */\n            const errorMessage = `animation validation failed:\\n${errors.join(\"\\n\")}`;\n            throw new Error(errorMessage);\n        }\n        this._animationAst = ast;\n    }\n    /**\n     * @param {?} element\n     * @param {?} startingStyles\n     * @param {?} destinationStyles\n     * @param {?} options\n     * @param {?=} subInstructions\n     * @return {?}\n     */\n    buildTimelines(element, startingStyles, destinationStyles, options, subInstructions) {\n        /** @type {?} */\n        const start = Array.isArray(startingStyles) ? normalizeStyles(startingStyles) : /** @type {?} */ (startingStyles);\n        /** @type {?} */\n        const dest = Array.isArray(destinationStyles) ? normalizeStyles(destinationStyles) : /** @type {?} */ (destinationStyles);\n        /** @type {?} */\n        const errors = [];\n        subInstructions = subInstructions || new ElementInstructionMap();\n        /** @type {?} */\n        const result = buildAnimationTimelines(this._driver, element, this._animationAst, ENTER_CLASSNAME, LEAVE_CLASSNAME, start, dest, options, subInstructions, errors);\n        if (errors.length) {\n            /** @type {?} */\n            const errorMessage = `animation building failed:\\n${errors.join(\"\\n\")}`;\n            throw new Error(errorMessage);\n        }\n        return result;\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n/**\n * \\@experimental Animation support is experimental.\n * @abstract\n */\nclass AnimationStyleNormalizer {\n}\n/**\n * \\@experimental Animation support is experimental.\n */\nclass NoopAnimationStyleNormalizer {\n    /**\n     * @param {?} propertyName\n     * @param {?} errors\n     * @return {?}\n     */\n    normalizePropertyName(propertyName, errors) { return propertyName; }\n    /**\n     * @param {?} userProvidedProperty\n     * @param {?} normalizedProperty\n     * @param {?} value\n     * @param {?} errors\n     * @return {?}\n     */\n    normalizeStyleValue(userProvidedProperty, normalizedProperty, value, errors) {\n        return /** @type {?} */ (value);\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass WebAnimationsStyleNormalizer extends AnimationStyleNormalizer {\n    /**\n     * @param {?} propertyName\n     * @param {?} errors\n     * @return {?}\n     */\n    normalizePropertyName(propertyName, errors) {\n        return dashCaseToCamelCase(propertyName);\n    }\n    /**\n     * @param {?} userProvidedProperty\n     * @param {?} normalizedProperty\n     * @param {?} value\n     * @param {?} errors\n     * @return {?}\n     */\n    normalizeStyleValue(userProvidedProperty, normalizedProperty, value, errors) {\n        /** @type {?} */\n        let unit = '';\n        /** @type {?} */\n        const strVal = value.toString().trim();\n        if (DIMENSIONAL_PROP_MAP[normalizedProperty] && value !== 0 && value !== '0') {\n            if (typeof value === 'number') {\n                unit = 'px';\n            }\n            else {\n                /** @type {?} */\n                const valAndSuffixMatch = value.match(/^[+-]?[\\d\\.]+([a-z]*)$/);\n                if (valAndSuffixMatch && valAndSuffixMatch[1].length == 0) {\n                    errors.push(`Please provide a CSS unit value for ${userProvidedProperty}:${value}`);\n                }\n            }\n        }\n        return strVal + unit;\n    }\n}\n/** @type {?} */\nconst DIMENSIONAL_PROP_MAP = makeBooleanMap('width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective'\n    .split(','));\n/**\n * @param {?} keys\n * @return {?}\n */\nfunction makeBooleanMap(keys) {\n    /** @type {?} */\n    const map = {};\n    keys.forEach(key => map[key] = true);\n    return map;\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * @param {?} element\n * @param {?} triggerName\n * @param {?} fromState\n * @param {?} toState\n * @param {?} isRemovalTransition\n * @param {?} fromStyles\n * @param {?} toStyles\n * @param {?} timelines\n * @param {?} queriedElements\n * @param {?} preStyleProps\n * @param {?} postStyleProps\n * @param {?} totalTime\n * @param {?=} errors\n * @return {?}\n */\nfunction createTransitionInstruction(element, triggerName, fromState, toState, isRemovalTransition, fromStyles, toStyles, timelines, queriedElements, preStyleProps, postStyleProps, totalTime, errors) {\n    return {\n        type: 0 /* TransitionAnimation */,\n        element,\n        triggerName,\n        isRemovalTransition,\n        fromState,\n        fromStyles,\n        toState,\n        toStyles,\n        timelines,\n        queriedElements,\n        preStyleProps,\n        postStyleProps,\n        totalTime,\n        errors\n    };\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst EMPTY_OBJECT = {};\nclass AnimationTransitionFactory {\n    /**\n     * @param {?} _triggerName\n     * @param {?} ast\n     * @param {?} _stateStyles\n     */\n    constructor(_triggerName, ast, _stateStyles) {\n        this._triggerName = _triggerName;\n        this.ast = ast;\n        this._stateStyles = _stateStyles;\n    }\n    /**\n     * @param {?} currentState\n     * @param {?} nextState\n     * @param {?} element\n     * @param {?} params\n     * @return {?}\n     */\n    match(currentState, nextState, element, params) {\n        return oneOrMoreTransitionsMatch(this.ast.matchers, currentState, nextState, element, params);\n    }\n    /**\n     * @param {?} stateName\n     * @param {?} params\n     * @param {?} errors\n     * @return {?}\n     */\n    buildStyles(stateName, params, errors) {\n        /** @type {?} */\n        const backupStateStyler = this._stateStyles['*'];\n        /** @type {?} */\n        const stateStyler = this._stateStyles[stateName];\n        /** @type {?} */\n        const backupStyles = backupStateStyler ? backupStateStyler.buildStyles(params, errors) : {};\n        return stateStyler ? stateStyler.buildStyles(params, errors) : backupStyles;\n    }\n    /**\n     * @param {?} driver\n     * @param {?} element\n     * @param {?} currentState\n     * @param {?} nextState\n     * @param {?} enterClassName\n     * @param {?} leaveClassName\n     * @param {?=} currentOptions\n     * @param {?=} nextOptions\n     * @param {?=} subInstructions\n     * @param {?=} skipAstBuild\n     * @return {?}\n     */\n    build(driver, element, currentState, nextState, enterClassName, leaveClassName, currentOptions, nextOptions, subInstructions, skipAstBuild) {\n        /** @type {?} */\n        const errors = [];\n        /** @type {?} */\n        const transitionAnimationParams = this.ast.options && this.ast.options.params || EMPTY_OBJECT;\n        /** @type {?} */\n        const currentAnimationParams = currentOptions && currentOptions.params || EMPTY_OBJECT;\n        /** @type {?} */\n        const currentStateStyles = this.buildStyles(currentState, currentAnimationParams, errors);\n        /** @type {?} */\n        const nextAnimationParams = nextOptions && nextOptions.params || EMPTY_OBJECT;\n        /** @type {?} */\n        const nextStateStyles = this.buildStyles(nextState, nextAnimationParams, errors);\n        /** @type {?} */\n        const queriedElements = new Set();\n        /** @type {?} */\n        const preStyleMap = new Map();\n        /** @type {?} */\n        const postStyleMap = new Map();\n        /** @type {?} */\n        const isRemoval = nextState === 'void';\n        /** @type {?} */\n        const animationOptions = { params: Object.assign({}, transitionAnimationParams, nextAnimationParams) };\n        /** @type {?} */\n        const timelines = skipAstBuild ? [] : buildAnimationTimelines(driver, element, this.ast.animation, enterClassName, leaveClassName, currentStateStyles, nextStateStyles, animationOptions, subInstructions, errors);\n        /** @type {?} */\n        let totalTime = 0;\n        timelines.forEach(tl => { totalTime = Math.max(tl.duration + tl.delay, totalTime); });\n        if (errors.length) {\n            return createTransitionInstruction(element, this._triggerName, currentState, nextState, isRemoval, currentStateStyles, nextStateStyles, [], [], preStyleMap, postStyleMap, totalTime, errors);\n        }\n        timelines.forEach(tl => {\n            /** @type {?} */\n            const elm = tl.element;\n            /** @type {?} */\n            const preProps = getOrSetAsInMap(preStyleMap, elm, {});\n            tl.preStyleProps.forEach(prop => preProps[prop] = true);\n            /** @type {?} */\n            const postProps = getOrSetAsInMap(postStyleMap, elm, {});\n            tl.postStyleProps.forEach(prop => postProps[prop] = true);\n            if (elm !== element) {\n                queriedElements.add(elm);\n            }\n        });\n        /** @type {?} */\n        const queriedElementsList = iteratorToArray(queriedElements.values());\n        return createTransitionInstruction(element, this._triggerName, currentState, nextState, isRemoval, currentStateStyles, nextStateStyles, timelines, queriedElementsList, preStyleMap, postStyleMap, totalTime);\n    }\n}\n/**\n * @param {?} matchFns\n * @param {?} currentState\n * @param {?} nextState\n * @param {?} element\n * @param {?} params\n * @return {?}\n */\nfunction oneOrMoreTransitionsMatch(matchFns, currentState, nextState, element, params) {\n    return matchFns.some(fn => fn(currentState, nextState, element, params));\n}\nclass AnimationStateStyles {\n    /**\n     * @param {?} styles\n     * @param {?} defaultParams\n     */\n    constructor(styles, defaultParams) {\n        this.styles = styles;\n        this.defaultParams = defaultParams;\n    }\n    /**\n     * @param {?} params\n     * @param {?} errors\n     * @return {?}\n     */\n    buildStyles(params, errors) {\n        /** @type {?} */\n        const finalStyles = {};\n        /** @type {?} */\n        const combinedParams = copyObj(this.defaultParams);\n        Object.keys(params).forEach(key => {\n            /** @type {?} */\n            const value = params[key];\n            if (value != null) {\n                combinedParams[key] = value;\n            }\n        });\n        this.styles.styles.forEach(value => {\n            if (typeof value !== 'string') {\n                /** @type {?} */\n                const styleObj = /** @type {?} */ (value);\n                Object.keys(styleObj).forEach(prop => {\n                    /** @type {?} */\n                    let val = styleObj[prop];\n                    if (val.length > 1) {\n                        val = interpolateParams(val, combinedParams, errors);\n                    }\n                    finalStyles[prop] = val;\n                });\n            }\n        });\n        return finalStyles;\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/**\n * \\@experimental Animation support is experimental.\n * @param {?} name\n * @param {?} ast\n * @return {?}\n */\nfunction buildTrigger(name, ast) {\n    return new AnimationTrigger(name, ast);\n}\n/**\n * \\@experimental Animation support is experimental.\n */\nclass AnimationTrigger {\n    /**\n     * @param {?} name\n     * @param {?} ast\n     */\n    constructor(name, ast) {\n        this.name = name;\n        this.ast = ast;\n        this.transitionFactories = [];\n        this.states = {};\n        ast.states.forEach(ast => {\n            /** @type {?} */\n            const defaultParams = (ast.options && ast.options.params) || {};\n            this.states[ast.name] = new AnimationStateStyles(ast.style, defaultParams);\n        });\n        balanceProperties(this.states, 'true', '1');\n        balanceProperties(this.states, 'false', '0');\n        ast.transitions.forEach(ast => {\n            this.transitionFactories.push(new AnimationTransitionFactory(name, ast, this.states));\n        });\n        this.fallbackTransition = createFallbackTransition(name, this.states);\n    }\n    /**\n     * @return {?}\n     */\n    get containsQueries() { return this.ast.queryCount > 0; }\n    /**\n     * @param {?} currentState\n     * @param {?} nextState\n     * @param {?} element\n     * @param {?} params\n     * @return {?}\n     */\n    matchTransition(currentState, nextState, element, params) {\n        /** @type {?} */\n        const entry = this.transitionFactories.find(f => f.match(currentState, nextState, element, params));\n        return entry || null;\n    }\n    /**\n     * @param {?} currentState\n     * @param {?} params\n     * @param {?} errors\n     * @return {?}\n     */\n    matchStyles(currentState, params, errors) {\n        return this.fallbackTransition.buildStyles(currentState, params, errors);\n    }\n}\n/**\n * @param {?} triggerName\n * @param {?} states\n * @return {?}\n */\nfunction createFallbackTransition(triggerName, states) {\n    /** @type {?} */\n    const matchers = [(fromState, toState) => true];\n    /** @type {?} */\n    const animation = { type: 2 /* Sequence */, steps: [], options: null };\n    /** @type {?} */\n    const transition = {\n        type: 1 /* Transition */,\n        animation,\n        matchers,\n        options: null,\n        queryCount: 0,\n        depCount: 0\n    };\n    return new AnimationTransitionFactory(triggerName, transition, states);\n}\n/**\n * @param {?} obj\n * @param {?} key1\n * @param {?} key2\n * @return {?}\n */\nfunction balanceProperties(obj, key1, key2) {\n    if (obj.hasOwnProperty(key1)) {\n        if (!obj.hasOwnProperty(key2)) {\n            obj[key2] = obj[key1];\n        }\n    }\n    else if (obj.hasOwnProperty(key2)) {\n        obj[key1] = obj[key2];\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst EMPTY_INSTRUCTION_MAP = new ElementInstructionMap();\nclass TimelineAnimationEngine {\n    /**\n     * @param {?} bodyNode\n     * @param {?} _driver\n     * @param {?} _normalizer\n     */\n    constructor(bodyNode, _driver, _normalizer) {\n        this.bodyNode = bodyNode;\n        this._driver = _driver;\n        this._normalizer = _normalizer;\n        this._animations = {};\n        this._playersById = {};\n        this.players = [];\n    }\n    /**\n     * @param {?} id\n     * @param {?} metadata\n     * @return {?}\n     */\n    register(id, metadata) {\n        /** @type {?} */\n        const errors = [];\n        /** @type {?} */\n        const ast = buildAnimationAst(this._driver, metadata, errors);\n        if (errors.length) {\n            throw new Error(`Unable to build the animation due to the following errors: ${errors.join(\"\\n\")}`);\n        }\n        else {\n            this._animations[id] = ast;\n        }\n    }\n    /**\n     * @param {?} i\n     * @param {?} preStyles\n     * @param {?=} postStyles\n     * @return {?}\n     */\n    _buildPlayer(i, preStyles, postStyles) {\n        /** @type {?} */\n        const element = i.element;\n        /** @type {?} */\n        const keyframes = normalizeKeyframes(this._driver, this._normalizer, element, i.keyframes, preStyles, postStyles);\n        return this._driver.animate(element, keyframes, i.duration, i.delay, i.easing, [], true);\n    }\n    /**\n     * @param {?} id\n     * @param {?} element\n     * @param {?=} options\n     * @return {?}\n     */\n    create(id, element, options = {}) {\n        /** @type {?} */\n        const errors = [];\n        /** @type {?} */\n        const ast = this._animations[id];\n        /** @type {?} */\n        let instructions;\n        /** @type {?} */\n        const autoStylesMap = new Map();\n        if (ast) {\n            instructions = buildAnimationTimelines(this._driver, element, ast, ENTER_CLASSNAME, LEAVE_CLASSNAME, {}, {}, options, EMPTY_INSTRUCTION_MAP, errors);\n            instructions.forEach(inst => {\n                /** @type {?} */\n                const styles = getOrSetAsInMap(autoStylesMap, inst.element, {});\n                inst.postStyleProps.forEach(prop => styles[prop] = null);\n            });\n        }\n        else {\n            errors.push('The requested animation doesn\\'t exist or has already been destroyed');\n            instructions = [];\n        }\n        if (errors.length) {\n            throw new Error(`Unable to create the animation due to the following errors: ${errors.join(\"\\n\")}`);\n        }\n        autoStylesMap.forEach((styles, element) => {\n            Object.keys(styles).forEach(prop => { styles[prop] = this._driver.computeStyle(element, prop, AUTO_STYLE); });\n        });\n        /** @type {?} */\n        const players = instructions.map(i => {\n            /** @type {?} */\n            const styles = autoStylesMap.get(i.element);\n            return this._buildPlayer(i, {}, styles);\n        });\n        /** @type {?} */\n        const player = optimizeGroupPlayer(players);\n        this._playersById[id] = player;\n        player.onDestroy(() => this.destroy(id));\n        this.players.push(player);\n        return player;\n    }\n    /**\n     * @param {?} id\n     * @return {?}\n     */\n    destroy(id) {\n        /** @type {?} */\n        const player = this._getPlayer(id);\n        player.destroy();\n        delete this._playersById[id];\n        /** @type {?} */\n        const index = this.players.indexOf(player);\n        if (index >= 0) {\n            this.players.splice(index, 1);\n        }\n    }\n    /**\n     * @param {?} id\n     * @return {?}\n     */\n    _getPlayer(id) {\n        /** @type {?} */\n        const player = this._playersById[id];\n        if (!player) {\n            throw new Error(`Unable to find the timeline player referenced by ${id}`);\n        }\n        return player;\n    }\n    /**\n     * @param {?} id\n     * @param {?} element\n     * @param {?} eventName\n     * @param {?} callback\n     * @return {?}\n     */\n    listen(id, element, eventName, callback) {\n        /** @type {?} */\n        const baseEvent = makeAnimationEvent(element, '', '', '');\n        listenOnPlayer(this._getPlayer(id), eventName, baseEvent, callback);\n        return () => { };\n    }\n    /**\n     * @param {?} id\n     * @param {?} element\n     * @param {?} command\n     * @param {?} args\n     * @return {?}\n     */\n    command(id, element, command, args) {\n        if (command == 'register') {\n            this.register(id, /** @type {?} */ (args[0]));\n            return;\n        }\n        if (command == 'create') {\n            /** @type {?} */\n            const options = /** @type {?} */ ((args[0] || {}));\n            this.create(id, element, options);\n            return;\n        }\n        /** @type {?} */\n        const player = this._getPlayer(id);\n        switch (command) {\n            case 'play':\n                player.play();\n                break;\n            case 'pause':\n                player.pause();\n                break;\n            case 'reset':\n                player.reset();\n                break;\n            case 'restart':\n                player.restart();\n                break;\n            case 'finish':\n                player.finish();\n                break;\n            case 'init':\n                player.init();\n                break;\n            case 'setPosition':\n                player.setPosition(parseFloat(/** @type {?} */ (args[0])));\n                break;\n            case 'destroy':\n                this.destroy(id);\n                break;\n        }\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst QUEUED_CLASSNAME = 'ng-animate-queued';\n/** @type {?} */\nconst QUEUED_SELECTOR = '.ng-animate-queued';\n/** @type {?} */\nconst DISABLED_CLASSNAME = 'ng-animate-disabled';\n/** @type {?} */\nconst DISABLED_SELECTOR = '.ng-animate-disabled';\n/** @type {?} */\nconst STAR_CLASSNAME = 'ng-star-inserted';\n/** @type {?} */\nconst STAR_SELECTOR = '.ng-star-inserted';\n/** @type {?} */\nconst EMPTY_PLAYER_ARRAY = [];\n/** @type {?} */\nconst NULL_REMOVAL_STATE = {\n    namespaceId: '',\n    setForRemoval: false,\n    setForMove: false,\n    hasAnimation: false,\n    removedBeforeQueried: false\n};\n/** @type {?} */\nconst NULL_REMOVED_QUERIED_STATE = {\n    namespaceId: '',\n    setForMove: false,\n    setForRemoval: false,\n    hasAnimation: false,\n    removedBeforeQueried: true\n};\n/** @type {?} */\nconst REMOVAL_FLAG = '__ng_removed';\nclass StateValue {\n    /**\n     * @param {?} input\n     * @param {?=} namespaceId\n     */\n    constructor(input, namespaceId = '') {\n        this.namespaceId = namespaceId;\n        /** @type {?} */\n        const isObj = input && input.hasOwnProperty('value');\n        /** @type {?} */\n        const value = isObj ? input['value'] : input;\n        this.value = normalizeTriggerValue(value);\n        if (isObj) {\n            /** @type {?} */\n            const options = copyObj(/** @type {?} */ (input));\n            delete options['value'];\n            this.options = /** @type {?} */ (options);\n        }\n        else {\n            this.options = {};\n        }\n        if (!this.options.params) {\n            this.options.params = {};\n        }\n    }\n    /**\n     * @return {?}\n     */\n    get params() { return /** @type {?} */ (this.options.params); }\n    /**\n     * @param {?} options\n     * @return {?}\n     */\n    absorbOptions(options) {\n        /** @type {?} */\n        const newParams = options.params;\n        if (newParams) {\n            /** @type {?} */\n            const oldParams = /** @type {?} */ ((this.options.params));\n            Object.keys(newParams).forEach(prop => {\n                if (oldParams[prop] == null) {\n                    oldParams[prop] = newParams[prop];\n                }\n            });\n        }\n    }\n}\n/** @type {?} */\nconst VOID_VALUE = 'void';\n/** @type {?} */\nconst DEFAULT_STATE_VALUE = new StateValue(VOID_VALUE);\nclass AnimationTransitionNamespace {\n    /**\n     * @param {?} id\n     * @param {?} hostElement\n     * @param {?} _engine\n     */\n    constructor(id, hostElement, _engine) {\n        this.id = id;\n        this.hostElement = hostElement;\n        this._engine = _engine;\n        this.players = [];\n        this._triggers = {};\n        this._queue = [];\n        this._elementListeners = new Map();\n        this._hostClassName = 'ng-tns-' + id;\n        addClass(hostElement, this._hostClassName);\n    }\n    /**\n     * @param {?} element\n     * @param {?} name\n     * @param {?} phase\n     * @param {?} callback\n     * @return {?}\n     */\n    listen(element, name, phase, callback) {\n        if (!this._triggers.hasOwnProperty(name)) {\n            throw new Error(`Unable to listen on the animation trigger event \"${phase}\" because the animation trigger \"${name}\" doesn\\'t exist!`);\n        }\n        if (phase == null || phase.length == 0) {\n            throw new Error(`Unable to listen on the animation trigger \"${name}\" because the provided event is undefined!`);\n        }\n        if (!isTriggerEventValid(phase)) {\n            throw new Error(`The provided animation trigger event \"${phase}\" for the animation trigger \"${name}\" is not supported!`);\n        }\n        /** @type {?} */\n        const listeners = getOrSetAsInMap(this._elementListeners, element, []);\n        /** @type {?} */\n        const data = { name, phase, callback };\n        listeners.push(data);\n        /** @type {?} */\n        const triggersWithStates = getOrSetAsInMap(this._engine.statesByElement, element, {});\n        if (!triggersWithStates.hasOwnProperty(name)) {\n            addClass(element, NG_TRIGGER_CLASSNAME);\n            addClass(element, NG_TRIGGER_CLASSNAME + '-' + name);\n            triggersWithStates[name] = DEFAULT_STATE_VALUE;\n        }\n        return () => {\n            // the event listener is removed AFTER the flush has occurred such\n            // that leave animations callbacks can fire (otherwise if the node\n            // is removed in between then the listeners would be deregistered)\n            this._engine.afterFlush(() => {\n                /** @type {?} */\n                const index = listeners.indexOf(data);\n                if (index >= 0) {\n                    listeners.splice(index, 1);\n                }\n                if (!this._triggers[name]) {\n                    delete triggersWithStates[name];\n                }\n            });\n        };\n    }\n    /**\n     * @param {?} name\n     * @param {?} ast\n     * @return {?}\n     */\n    register(name, ast) {\n        if (this._triggers[name]) {\n            // throw\n            return false;\n        }\n        else {\n            this._triggers[name] = ast;\n            return true;\n        }\n    }\n    /**\n     * @param {?} name\n     * @return {?}\n     */\n    _getTrigger(name) {\n        /** @type {?} */\n        const trigger = this._triggers[name];\n        if (!trigger) {\n            throw new Error(`The provided animation trigger \"${name}\" has not been registered!`);\n        }\n        return trigger;\n    }\n    /**\n     * @param {?} element\n     * @param {?} triggerName\n     * @param {?} value\n     * @param {?=} defaultToFallback\n     * @return {?}\n     */\n    trigger(element, triggerName, value, defaultToFallback = true) {\n        /** @type {?} */\n        const trigger = this._getTrigger(triggerName);\n        /** @type {?} */\n        const player = new TransitionAnimationPlayer(this.id, triggerName, element);\n        /** @type {?} */\n        let triggersWithStates = this._engine.statesByElement.get(element);\n        if (!triggersWithStates) {\n            addClass(element, NG_TRIGGER_CLASSNAME);\n            addClass(element, NG_TRIGGER_CLASSNAME + '-' + triggerName);\n            this._engine.statesByElement.set(element, triggersWithStates = {});\n        }\n        /** @type {?} */\n        let fromState = triggersWithStates[triggerName];\n        /** @type {?} */\n        const toState = new StateValue(value, this.id);\n        /** @type {?} */\n        const isObj = value && value.hasOwnProperty('value');\n        if (!isObj && fromState) {\n            toState.absorbOptions(fromState.options);\n        }\n        triggersWithStates[triggerName] = toState;\n        if (!fromState) {\n            fromState = DEFAULT_STATE_VALUE;\n        }\n        /** @type {?} */\n        const isRemoval = toState.value === VOID_VALUE;\n        // normally this isn't reached by here, however, if an object expression\n        // is passed in then it may be a new object each time. Comparing the value\n        // is important since that will stay the same despite there being a new object.\n        // The removal arc here is special cased because the same element is triggered\n        // twice in the event that it contains animations on the outer/inner portions\n        // of the host container\n        if (!isRemoval && fromState.value === toState.value) {\n            // this means that despite the value not changing, some inner params\n            // have changed which means that the animation final styles need to be applied\n            if (!objEquals(fromState.params, toState.params)) {\n                /** @type {?} */\n                const errors = [];\n                /** @type {?} */\n                const fromStyles = trigger.matchStyles(fromState.value, fromState.params, errors);\n                /** @type {?} */\n                const toStyles = trigger.matchStyles(toState.value, toState.params, errors);\n                if (errors.length) {\n                    this._engine.reportError(errors);\n                }\n                else {\n                    this._engine.afterFlush(() => {\n                        eraseStyles(element, fromStyles);\n                        setStyles(element, toStyles);\n                    });\n                }\n            }\n            return;\n        }\n        /** @type {?} */\n        const playersOnElement = getOrSetAsInMap(this._engine.playersByElement, element, []);\n        playersOnElement.forEach(player => {\n            // only remove the player if it is queued on the EXACT same trigger/namespace\n            // we only also deal with queued players here because if the animation has\n            // started then we want to keep the player alive until the flush happens\n            // (which is where the previousPlayers are passed into the new palyer)\n            if (player.namespaceId == this.id && player.triggerName == triggerName && player.queued) {\n                player.destroy();\n            }\n        });\n        /** @type {?} */\n        let transition = trigger.matchTransition(fromState.value, toState.value, element, toState.params);\n        /** @type {?} */\n        let isFallbackTransition = false;\n        if (!transition) {\n            if (!defaultToFallback)\n                return;\n            transition = trigger.fallbackTransition;\n            isFallbackTransition = true;\n        }\n        this._engine.totalQueuedPlayers++;\n        this._queue.push({ element, triggerName, transition, fromState, toState, player, isFallbackTransition });\n        if (!isFallbackTransition) {\n            addClass(element, QUEUED_CLASSNAME);\n            player.onStart(() => { removeClass(element, QUEUED_CLASSNAME); });\n        }\n        player.onDone(() => {\n            /** @type {?} */\n            let index = this.players.indexOf(player);\n            if (index >= 0) {\n                this.players.splice(index, 1);\n            }\n            /** @type {?} */\n            const players = this._engine.playersByElement.get(element);\n            if (players) {\n                /** @type {?} */\n                let index = players.indexOf(player);\n                if (index >= 0) {\n                    players.splice(index, 1);\n                }\n            }\n        });\n        this.players.push(player);\n        playersOnElement.push(player);\n        return player;\n    }\n    /**\n     * @param {?} name\n     * @return {?}\n     */\n    deregister(name) {\n        delete this._triggers[name];\n        this._engine.statesByElement.forEach((stateMap, element) => { delete stateMap[name]; });\n        this._elementListeners.forEach((listeners, element) => {\n            this._elementListeners.set(element, listeners.filter(entry => { return entry.name != name; }));\n        });\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    clearElementCache(element) {\n        this._engine.statesByElement.delete(element);\n        this._elementListeners.delete(element);\n        /** @type {?} */\n        const elementPlayers = this._engine.playersByElement.get(element);\n        if (elementPlayers) {\n            elementPlayers.forEach(player => player.destroy());\n            this._engine.playersByElement.delete(element);\n        }\n    }\n    /**\n     * @param {?} rootElement\n     * @param {?} context\n     * @param {?=} animate\n     * @return {?}\n     */\n    _signalRemovalForInnerTriggers(rootElement, context, animate = false) {\n        // emulate a leave animation for all inner nodes within this node.\n        // If there are no animations found for any of the nodes then clear the cache\n        // for the element.\n        this._engine.driver.query(rootElement, NG_TRIGGER_SELECTOR, true).forEach(elm => {\n            // this means that an inner remove() operation has already kicked off\n            // the animation on this element...\n            if (elm[REMOVAL_FLAG])\n                return;\n            /** @type {?} */\n            const namespaces = this._engine.fetchNamespacesByElement(elm);\n            if (namespaces.size) {\n                namespaces.forEach(ns => ns.triggerLeaveAnimation(elm, context, false, true));\n            }\n            else {\n                this.clearElementCache(elm);\n            }\n        });\n    }\n    /**\n     * @param {?} element\n     * @param {?} context\n     * @param {?=} destroyAfterComplete\n     * @param {?=} defaultToFallback\n     * @return {?}\n     */\n    triggerLeaveAnimation(element, context, destroyAfterComplete, defaultToFallback) {\n        /** @type {?} */\n        const triggerStates = this._engine.statesByElement.get(element);\n        if (triggerStates) {\n            /** @type {?} */\n            const players = [];\n            Object.keys(triggerStates).forEach(triggerName => {\n                // this check is here in the event that an element is removed\n                // twice (both on the host level and the component level)\n                if (this._triggers[triggerName]) {\n                    /** @type {?} */\n                    const player = this.trigger(element, triggerName, VOID_VALUE, defaultToFallback);\n                    if (player) {\n                        players.push(player);\n                    }\n                }\n            });\n            if (players.length) {\n                this._engine.markElementAsRemoved(this.id, element, true, context);\n                if (destroyAfterComplete) {\n                    optimizeGroupPlayer(players).onDone(() => this._engine.processLeaveNode(element));\n                }\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    prepareLeaveAnimationListeners(element) {\n        /** @type {?} */\n        const listeners = this._elementListeners.get(element);\n        if (listeners) {\n            /** @type {?} */\n            const visitedTriggers = new Set();\n            listeners.forEach(listener => {\n                /** @type {?} */\n                const triggerName = listener.name;\n                if (visitedTriggers.has(triggerName))\n                    return;\n                visitedTriggers.add(triggerName);\n                /** @type {?} */\n                const trigger = this._triggers[triggerName];\n                /** @type {?} */\n                const transition = trigger.fallbackTransition;\n                /** @type {?} */\n                const elementStates = /** @type {?} */ ((this._engine.statesByElement.get(element)));\n                /** @type {?} */\n                const fromState = elementStates[triggerName] || DEFAULT_STATE_VALUE;\n                /** @type {?} */\n                const toState = new StateValue(VOID_VALUE);\n                /** @type {?} */\n                const player = new TransitionAnimationPlayer(this.id, triggerName, element);\n                this._engine.totalQueuedPlayers++;\n                this._queue.push({\n                    element,\n                    triggerName,\n                    transition,\n                    fromState,\n                    toState,\n                    player,\n                    isFallbackTransition: true\n                });\n            });\n        }\n    }\n    /**\n     * @param {?} element\n     * @param {?} context\n     * @return {?}\n     */\n    removeNode(element, context) {\n        /** @type {?} */\n        const engine = this._engine;\n        if (element.childElementCount) {\n            this._signalRemovalForInnerTriggers(element, context, true);\n        }\n        // this means that a * => VOID animation was detected and kicked off\n        if (this.triggerLeaveAnimation(element, context, true))\n            return;\n        /** @type {?} */\n        let containsPotentialParentTransition = false;\n        if (engine.totalAnimations) {\n            /** @type {?} */\n            const currentPlayers = engine.players.length ? engine.playersByQueriedElement.get(element) : [];\n            // when this `if statement` does not continue forward it means that\n            // a previous animation query has selected the current element and\n            // is animating it. In this situation want to continue forwards and\n            // allow the element to be queued up for animation later.\n            if (currentPlayers && currentPlayers.length) {\n                containsPotentialParentTransition = true;\n            }\n            else {\n                /** @type {?} */\n                let parent = element;\n                while (parent = parent.parentNode) {\n                    /** @type {?} */\n                    const triggers = engine.statesByElement.get(parent);\n                    if (triggers) {\n                        containsPotentialParentTransition = true;\n                        break;\n                    }\n                }\n            }\n        }\n        // at this stage we know that the element will either get removed\n        // during flush or will be picked up by a parent query. Either way\n        // we need to fire the listeners for this element when it DOES get\n        // removed (once the query parent animation is done or after flush)\n        this.prepareLeaveAnimationListeners(element);\n        // whether or not a parent has an animation we need to delay the deferral of the leave\n        // operation until we have more information (which we do after flush() has been called)\n        if (containsPotentialParentTransition) {\n            engine.markElementAsRemoved(this.id, element, false, context);\n        }\n        else {\n            // we do this after the flush has occurred such\n            // that the callbacks can be fired\n            engine.afterFlush(() => this.clearElementCache(element));\n            engine.destroyInnerAnimations(element);\n            engine._onRemovalComplete(element, context);\n        }\n    }\n    /**\n     * @param {?} element\n     * @param {?} parent\n     * @return {?}\n     */\n    insertNode(element, parent) { addClass(element, this._hostClassName); }\n    /**\n     * @param {?} microtaskId\n     * @return {?}\n     */\n    drainQueuedTransitions(microtaskId) {\n        /** @type {?} */\n        const instructions = [];\n        this._queue.forEach(entry => {\n            /** @type {?} */\n            const player = entry.player;\n            if (player.destroyed)\n                return;\n            /** @type {?} */\n            const element = entry.element;\n            /** @type {?} */\n            const listeners = this._elementListeners.get(element);\n            if (listeners) {\n                listeners.forEach((listener) => {\n                    if (listener.name == entry.triggerName) {\n                        /** @type {?} */\n                        const baseEvent = makeAnimationEvent(element, entry.triggerName, entry.fromState.value, entry.toState.value);\n                        (/** @type {?} */ (baseEvent))['_data'] = microtaskId;\n                        listenOnPlayer(entry.player, listener.phase, baseEvent, listener.callback);\n                    }\n                });\n            }\n            if (player.markedForDestroy) {\n                this._engine.afterFlush(() => {\n                    // now we can destroy the element properly since the event listeners have\n                    // been bound to the player\n                    player.destroy();\n                });\n            }\n            else {\n                instructions.push(entry);\n            }\n        });\n        this._queue = [];\n        return instructions.sort((a, b) => {\n            /** @type {?} */\n            const d0 = a.transition.ast.depCount;\n            /** @type {?} */\n            const d1 = b.transition.ast.depCount;\n            if (d0 == 0 || d1 == 0) {\n                return d0 - d1;\n            }\n            return this._engine.driver.containsElement(a.element, b.element) ? 1 : -1;\n        });\n    }\n    /**\n     * @param {?} context\n     * @return {?}\n     */\n    destroy(context) {\n        this.players.forEach(p => p.destroy());\n        this._signalRemovalForInnerTriggers(this.hostElement, context);\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    elementContainsData(element) {\n        /** @type {?} */\n        let containsData = false;\n        if (this._elementListeners.has(element))\n            containsData = true;\n        containsData =\n            (this._queue.find(entry => entry.element === element) ? true : false) || containsData;\n        return containsData;\n    }\n}\nclass TransitionAnimationEngine {\n    /**\n     * @param {?} bodyNode\n     * @param {?} driver\n     * @param {?} _normalizer\n     */\n    constructor(bodyNode, driver, _normalizer) {\n        this.bodyNode = bodyNode;\n        this.driver = driver;\n        this._normalizer = _normalizer;\n        this.players = [];\n        this.newHostElements = new Map();\n        this.playersByElement = new Map();\n        this.playersByQueriedElement = new Map();\n        this.statesByElement = new Map();\n        this.disabledNodes = new Set();\n        this.totalAnimations = 0;\n        this.totalQueuedPlayers = 0;\n        this._namespaceLookup = {};\n        this._namespaceList = [];\n        this._flushFns = [];\n        this._whenQuietFns = [];\n        this.namespacesByHostElement = new Map();\n        this.collectedEnterElements = [];\n        this.collectedLeaveElements = [];\n        this.onRemovalComplete = (element, context) => { };\n    }\n    /**\n     * \\@internal\n     * @param {?} element\n     * @param {?} context\n     * @return {?}\n     */\n    _onRemovalComplete(element, context) { this.onRemovalComplete(element, context); }\n    /**\n     * @return {?}\n     */\n    get queuedPlayers() {\n        /** @type {?} */\n        const players = [];\n        this._namespaceList.forEach(ns => {\n            ns.players.forEach(player => {\n                if (player.queued) {\n                    players.push(player);\n                }\n            });\n        });\n        return players;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} hostElement\n     * @return {?}\n     */\n    createNamespace(namespaceId, hostElement) {\n        /** @type {?} */\n        const ns = new AnimationTransitionNamespace(namespaceId, hostElement, this);\n        if (hostElement.parentNode) {\n            this._balanceNamespaceList(ns, hostElement);\n        }\n        else {\n            // defer this later until flush during when the host element has\n            // been inserted so that we know exactly where to place it in\n            // the namespace list\n            this.newHostElements.set(hostElement, ns);\n            // given that this host element is apart of the animation code, it\n            // may or may not be inserted by a parent node that is an of an\n            // animation renderer type. If this happens then we can still have\n            // access to this item when we query for :enter nodes. If the parent\n            // is a renderer then the set data-structure will normalize the entry\n            this.collectEnterElement(hostElement);\n        }\n        return this._namespaceLookup[namespaceId] = ns;\n    }\n    /**\n     * @param {?} ns\n     * @param {?} hostElement\n     * @return {?}\n     */\n    _balanceNamespaceList(ns, hostElement) {\n        /** @type {?} */\n        const limit = this._namespaceList.length - 1;\n        if (limit >= 0) {\n            /** @type {?} */\n            let found = false;\n            for (let i = limit; i >= 0; i--) {\n                /** @type {?} */\n                const nextNamespace = this._namespaceList[i];\n                if (this.driver.containsElement(nextNamespace.hostElement, hostElement)) {\n                    this._namespaceList.splice(i + 1, 0, ns);\n                    found = true;\n                    break;\n                }\n            }\n            if (!found) {\n                this._namespaceList.splice(0, 0, ns);\n            }\n        }\n        else {\n            this._namespaceList.push(ns);\n        }\n        this.namespacesByHostElement.set(hostElement, ns);\n        return ns;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} hostElement\n     * @return {?}\n     */\n    register(namespaceId, hostElement) {\n        /** @type {?} */\n        let ns = this._namespaceLookup[namespaceId];\n        if (!ns) {\n            ns = this.createNamespace(namespaceId, hostElement);\n        }\n        return ns;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} name\n     * @param {?} trigger\n     * @return {?}\n     */\n    registerTrigger(namespaceId, name, trigger) {\n        /** @type {?} */\n        let ns = this._namespaceLookup[namespaceId];\n        if (ns && ns.register(name, trigger)) {\n            this.totalAnimations++;\n        }\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} context\n     * @return {?}\n     */\n    destroy(namespaceId, context) {\n        if (!namespaceId)\n            return;\n        /** @type {?} */\n        const ns = this._fetchNamespace(namespaceId);\n        this.afterFlush(() => {\n            this.namespacesByHostElement.delete(ns.hostElement);\n            delete this._namespaceLookup[namespaceId];\n            /** @type {?} */\n            const index = this._namespaceList.indexOf(ns);\n            if (index >= 0) {\n                this._namespaceList.splice(index, 1);\n            }\n        });\n        this.afterFlushAnimationsDone(() => ns.destroy(context));\n    }\n    /**\n     * @param {?} id\n     * @return {?}\n     */\n    _fetchNamespace(id) { return this._namespaceLookup[id]; }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    fetchNamespacesByElement(element) {\n        /** @type {?} */\n        const namespaces = new Set();\n        /** @type {?} */\n        const elementStates = this.statesByElement.get(element);\n        if (elementStates) {\n            /** @type {?} */\n            const keys = Object.keys(elementStates);\n            for (let i = 0; i < keys.length; i++) {\n                /** @type {?} */\n                const nsId = elementStates[keys[i]].namespaceId;\n                if (nsId) {\n                    /** @type {?} */\n                    const ns = this._fetchNamespace(nsId);\n                    if (ns) {\n                        namespaces.add(ns);\n                    }\n                }\n            }\n        }\n        return namespaces;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} name\n     * @param {?} value\n     * @return {?}\n     */\n    trigger(namespaceId, element, name, value) {\n        if (isElementNode(element)) {\n            /** @type {?} */\n            const ns = this._fetchNamespace(namespaceId);\n            if (ns) {\n                ns.trigger(element, name, value);\n                return true;\n            }\n        }\n        return false;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} parent\n     * @param {?} insertBefore\n     * @return {?}\n     */\n    insertNode(namespaceId, element, parent, insertBefore) {\n        if (!isElementNode(element))\n            return;\n        /** @type {?} */\n        const details = /** @type {?} */ (element[REMOVAL_FLAG]);\n        if (details && details.setForRemoval) {\n            details.setForRemoval = false;\n            details.setForMove = true;\n            /** @type {?} */\n            const index = this.collectedLeaveElements.indexOf(element);\n            if (index >= 0) {\n                this.collectedLeaveElements.splice(index, 1);\n            }\n        }\n        // in the event that the namespaceId is blank then the caller\n        // code does not contain any animation code in it, but it is\n        // just being called so that the node is marked as being inserted\n        if (namespaceId) {\n            /** @type {?} */\n            const ns = this._fetchNamespace(namespaceId);\n            // This if-statement is a workaround for router issue #21947.\n            // The router sometimes hits a race condition where while a route\n            // is being instantiated a new navigation arrives, triggering leave\n            // animation of DOM that has not been fully initialized, until this\n            // is resolved, we need to handle the scenario when DOM is not in a\n            // consistent state during the animation.\n            if (ns) {\n                ns.insertNode(element, parent);\n            }\n        }\n        // only *directives and host elements are inserted before\n        if (insertBefore) {\n            this.collectEnterElement(element);\n        }\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    collectEnterElement(element) { this.collectedEnterElements.push(element); }\n    /**\n     * @param {?} element\n     * @param {?} value\n     * @return {?}\n     */\n    markElementAsDisabled(element, value) {\n        if (value) {\n            if (!this.disabledNodes.has(element)) {\n                this.disabledNodes.add(element);\n                addClass(element, DISABLED_CLASSNAME);\n            }\n        }\n        else if (this.disabledNodes.has(element)) {\n            this.disabledNodes.delete(element);\n            removeClass(element, DISABLED_CLASSNAME);\n        }\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} context\n     * @return {?}\n     */\n    removeNode(namespaceId, element, context) {\n        if (!isElementNode(element)) {\n            this._onRemovalComplete(element, context);\n            return;\n        }\n        /** @type {?} */\n        const ns = namespaceId ? this._fetchNamespace(namespaceId) : null;\n        if (ns) {\n            ns.removeNode(element, context);\n        }\n        else {\n            this.markElementAsRemoved(namespaceId, element, false, context);\n        }\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?=} hasAnimation\n     * @param {?=} context\n     * @return {?}\n     */\n    markElementAsRemoved(namespaceId, element, hasAnimation, context) {\n        this.collectedLeaveElements.push(element);\n        element[REMOVAL_FLAG] = {\n            namespaceId,\n            setForRemoval: context, hasAnimation,\n            removedBeforeQueried: false\n        };\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} name\n     * @param {?} phase\n     * @param {?} callback\n     * @return {?}\n     */\n    listen(namespaceId, element, name, phase, callback) {\n        if (isElementNode(element)) {\n            return this._fetchNamespace(namespaceId).listen(element, name, phase, callback);\n        }\n        return () => { };\n    }\n    /**\n     * @param {?} entry\n     * @param {?} subTimelines\n     * @param {?} enterClassName\n     * @param {?} leaveClassName\n     * @param {?=} skipBuildAst\n     * @return {?}\n     */\n    _buildInstruction(entry, subTimelines, enterClassName, leaveClassName, skipBuildAst) {\n        return entry.transition.build(this.driver, entry.element, entry.fromState.value, entry.toState.value, enterClassName, leaveClassName, entry.fromState.options, entry.toState.options, subTimelines, skipBuildAst);\n    }\n    /**\n     * @param {?} containerElement\n     * @return {?}\n     */\n    destroyInnerAnimations(containerElement) {\n        /** @type {?} */\n        let elements = this.driver.query(containerElement, NG_TRIGGER_SELECTOR, true);\n        elements.forEach(element => this.destroyActiveAnimationsForElement(element));\n        if (this.playersByQueriedElement.size == 0)\n            return;\n        elements = this.driver.query(containerElement, NG_ANIMATING_SELECTOR, true);\n        elements.forEach(element => this.finishActiveQueriedAnimationOnElement(element));\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    destroyActiveAnimationsForElement(element) {\n        /** @type {?} */\n        const players = this.playersByElement.get(element);\n        if (players) {\n            players.forEach(player => {\n                // special case for when an element is set for destruction, but hasn't started.\n                // in this situation we want to delay the destruction until the flush occurs\n                // so that any event listeners attached to the player are triggered.\n                if (player.queued) {\n                    player.markedForDestroy = true;\n                }\n                else {\n                    player.destroy();\n                }\n            });\n        }\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    finishActiveQueriedAnimationOnElement(element) {\n        /** @type {?} */\n        const players = this.playersByQueriedElement.get(element);\n        if (players) {\n            players.forEach(player => player.finish());\n        }\n    }\n    /**\n     * @return {?}\n     */\n    whenRenderingDone() {\n        return new Promise(resolve => {\n            if (this.players.length) {\n                return optimizeGroupPlayer(this.players).onDone(() => resolve());\n            }\n            else {\n                resolve();\n            }\n        });\n    }\n    /**\n     * @param {?} element\n     * @return {?}\n     */\n    processLeaveNode(element) {\n        /** @type {?} */\n        const details = /** @type {?} */ (element[REMOVAL_FLAG]);\n        if (details && details.setForRemoval) {\n            // this will prevent it from removing it twice\n            element[REMOVAL_FLAG] = NULL_REMOVAL_STATE;\n            if (details.namespaceId) {\n                this.destroyInnerAnimations(element);\n                /** @type {?} */\n                const ns = this._fetchNamespace(details.namespaceId);\n                if (ns) {\n                    ns.clearElementCache(element);\n                }\n            }\n            this._onRemovalComplete(element, details.setForRemoval);\n        }\n        if (this.driver.matchesElement(element, DISABLED_SELECTOR)) {\n            this.markElementAsDisabled(element, false);\n        }\n        this.driver.query(element, DISABLED_SELECTOR, true).forEach(node => {\n            this.markElementAsDisabled(element, false);\n        });\n    }\n    /**\n     * @param {?=} microtaskId\n     * @return {?}\n     */\n    flush(microtaskId = -1) {\n        /** @type {?} */\n        let players = [];\n        if (this.newHostElements.size) {\n            this.newHostElements.forEach((ns, element) => this._balanceNamespaceList(ns, element));\n            this.newHostElements.clear();\n        }\n        if (this.totalAnimations && this.collectedEnterElements.length) {\n            for (let i = 0; i < this.collectedEnterElements.length; i++) {\n                /** @type {?} */\n                const elm = this.collectedEnterElements[i];\n                addClass(elm, STAR_CLASSNAME);\n            }\n        }\n        if (this._namespaceList.length &&\n            (this.totalQueuedPlayers || this.collectedLeaveElements.length)) {\n            /** @type {?} */\n            const cleanupFns = [];\n            try {\n                players = this._flushAnimations(cleanupFns, microtaskId);\n            }\n            finally {\n                for (let i = 0; i < cleanupFns.length; i++) {\n                    cleanupFns[i]();\n                }\n            }\n        }\n        else {\n            for (let i = 0; i < this.collectedLeaveElements.length; i++) {\n                /** @type {?} */\n                const element = this.collectedLeaveElements[i];\n                this.processLeaveNode(element);\n            }\n        }\n        this.totalQueuedPlayers = 0;\n        this.collectedEnterElements.length = 0;\n        this.collectedLeaveElements.length = 0;\n        this._flushFns.forEach(fn => fn());\n        this._flushFns = [];\n        if (this._whenQuietFns.length) {\n            /** @type {?} */\n            const quietFns = this._whenQuietFns;\n            this._whenQuietFns = [];\n            if (players.length) {\n                optimizeGroupPlayer(players).onDone(() => { quietFns.forEach(fn => fn()); });\n            }\n            else {\n                quietFns.forEach(fn => fn());\n            }\n        }\n    }\n    /**\n     * @param {?} errors\n     * @return {?}\n     */\n    reportError(errors) {\n        throw new Error(`Unable to process animations due to the following failed trigger transitions\\n ${errors.join('\\n')}`);\n    }\n    /**\n     * @param {?} cleanupFns\n     * @param {?} microtaskId\n     * @return {?}\n     */\n    _flushAnimations(cleanupFns, microtaskId) {\n        /** @type {?} */\n        const subTimelines = new ElementInstructionMap();\n        /** @type {?} */\n        const skippedPlayers = [];\n        /** @type {?} */\n        const skippedPlayersMap = new Map();\n        /** @type {?} */\n        const queuedInstructions = [];\n        /** @type {?} */\n        const queriedElements = new Map();\n        /** @type {?} */\n        const allPreStyleElements = new Map();\n        /** @type {?} */\n        const allPostStyleElements = new Map();\n        /** @type {?} */\n        const disabledElementsSet = new Set();\n        this.disabledNodes.forEach(node => {\n            disabledElementsSet.add(node);\n            /** @type {?} */\n            const nodesThatAreDisabled = this.driver.query(node, QUEUED_SELECTOR, true);\n            for (let i = 0; i < nodesThatAreDisabled.length; i++) {\n                disabledElementsSet.add(nodesThatAreDisabled[i]);\n            }\n        });\n        /** @type {?} */\n        const bodyNode = this.bodyNode;\n        /** @type {?} */\n        const allTriggerElements = Array.from(this.statesByElement.keys());\n        /** @type {?} */\n        const enterNodeMap = buildRootMap(allTriggerElements, this.collectedEnterElements);\n        /** @type {?} */\n        const enterNodeMapIds = new Map();\n        /** @type {?} */\n        let i = 0;\n        enterNodeMap.forEach((nodes, root) => {\n            /** @type {?} */\n            const className = ENTER_CLASSNAME + i++;\n            enterNodeMapIds.set(root, className);\n            nodes.forEach(node => addClass(node, className));\n        });\n        /** @type {?} */\n        const allLeaveNodes = [];\n        /** @type {?} */\n        const mergedLeaveNodes = new Set();\n        /** @type {?} */\n        const leaveNodesWithoutAnimations = new Set();\n        for (let i = 0; i < this.collectedLeaveElements.length; i++) {\n            /** @type {?} */\n            const element = this.collectedLeaveElements[i];\n            /** @type {?} */\n            const details = /** @type {?} */ (element[REMOVAL_FLAG]);\n            if (details && details.setForRemoval) {\n                allLeaveNodes.push(element);\n                mergedLeaveNodes.add(element);\n                if (details.hasAnimation) {\n                    this.driver.query(element, STAR_SELECTOR, true).forEach(elm => mergedLeaveNodes.add(elm));\n                }\n                else {\n                    leaveNodesWithoutAnimations.add(element);\n                }\n            }\n        }\n        /** @type {?} */\n        const leaveNodeMapIds = new Map();\n        /** @type {?} */\n        const leaveNodeMap = buildRootMap(allTriggerElements, Array.from(mergedLeaveNodes));\n        leaveNodeMap.forEach((nodes, root) => {\n            /** @type {?} */\n            const className = LEAVE_CLASSNAME + i++;\n            leaveNodeMapIds.set(root, className);\n            nodes.forEach(node => addClass(node, className));\n        });\n        cleanupFns.push(() => {\n            enterNodeMap.forEach((nodes, root) => {\n                /** @type {?} */\n                const className = /** @type {?} */ ((enterNodeMapIds.get(root)));\n                nodes.forEach(node => removeClass(node, className));\n            });\n            leaveNodeMap.forEach((nodes, root) => {\n                /** @type {?} */\n                const className = /** @type {?} */ ((leaveNodeMapIds.get(root)));\n                nodes.forEach(node => removeClass(node, className));\n            });\n            allLeaveNodes.forEach(element => { this.processLeaveNode(element); });\n        });\n        /** @type {?} */\n        const allPlayers = [];\n        /** @type {?} */\n        const erroneousTransitions = [];\n        for (let i = this._namespaceList.length - 1; i >= 0; i--) {\n            /** @type {?} */\n            const ns = this._namespaceList[i];\n            ns.drainQueuedTransitions(microtaskId).forEach(entry => {\n                /** @type {?} */\n                const player = entry.player;\n                /** @type {?} */\n                const element = entry.element;\n                allPlayers.push(player);\n                if (this.collectedEnterElements.length) {\n                    /** @type {?} */\n                    const details = /** @type {?} */ (element[REMOVAL_FLAG]);\n                    // move animations are currently not supported...\n                    if (details && details.setForMove) {\n                        player.destroy();\n                        return;\n                    }\n                }\n                /** @type {?} */\n                const nodeIsOrphaned = !bodyNode || !this.driver.containsElement(bodyNode, element);\n                /** @type {?} */\n                const leaveClassName = /** @type {?} */ ((leaveNodeMapIds.get(element)));\n                /** @type {?} */\n                const enterClassName = /** @type {?} */ ((enterNodeMapIds.get(element)));\n                /** @type {?} */\n                const instruction = /** @type {?} */ ((this._buildInstruction(entry, subTimelines, enterClassName, leaveClassName, nodeIsOrphaned)));\n                if (instruction.errors && instruction.errors.length) {\n                    erroneousTransitions.push(instruction);\n                    return;\n                }\n                // even though the element may not be apart of the DOM, it may\n                // still be added at a later point (due to the mechanics of content\n                // projection and/or dynamic component insertion) therefore it's\n                // important we still style the element.\n                if (nodeIsOrphaned) {\n                    player.onStart(() => eraseStyles(element, instruction.fromStyles));\n                    player.onDestroy(() => setStyles(element, instruction.toStyles));\n                    skippedPlayers.push(player);\n                    return;\n                }\n                // if a unmatched transition is queued to go then it SHOULD NOT render\n                // an animation and cancel the previously running animations.\n                if (entry.isFallbackTransition) {\n                    player.onStart(() => eraseStyles(element, instruction.fromStyles));\n                    player.onDestroy(() => setStyles(element, instruction.toStyles));\n                    skippedPlayers.push(player);\n                    return;\n                }\n                // this means that if a parent animation uses this animation as a sub trigger\n                // then it will instruct the timeline builder to not add a player delay, but\n                // instead stretch the first keyframe gap up until the animation starts. The\n                // reason this is important is to prevent extra initialization styles from being\n                // required by the user in the animation.\n                instruction.timelines.forEach(tl => tl.stretchStartingKeyframe = true);\n                subTimelines.append(element, instruction.timelines);\n                /** @type {?} */\n                const tuple = { instruction, player, element };\n                queuedInstructions.push(tuple);\n                instruction.queriedElements.forEach(element => getOrSetAsInMap(queriedElements, element, []).push(player));\n                instruction.preStyleProps.forEach((stringMap, element) => {\n                    /** @type {?} */\n                    const props = Object.keys(stringMap);\n                    if (props.length) {\n                        /** @type {?} */\n                        let setVal = /** @type {?} */ ((allPreStyleElements.get(element)));\n                        if (!setVal) {\n                            allPreStyleElements.set(element, setVal = new Set());\n                        }\n                        props.forEach(prop => setVal.add(prop));\n                    }\n                });\n                instruction.postStyleProps.forEach((stringMap, element) => {\n                    /** @type {?} */\n                    const props = Object.keys(stringMap);\n                    /** @type {?} */\n                    let setVal = /** @type {?} */ ((allPostStyleElements.get(element)));\n                    if (!setVal) {\n                        allPostStyleElements.set(element, setVal = new Set());\n                    }\n                    props.forEach(prop => setVal.add(prop));\n                });\n            });\n        }\n        if (erroneousTransitions.length) {\n            /** @type {?} */\n            const errors = [];\n            erroneousTransitions.forEach(instruction => {\n                errors.push(`@${instruction.triggerName} has failed due to:\\n`); /** @type {?} */\n                ((instruction.errors)).forEach(error => errors.push(`- ${error}\\n`));\n            });\n            allPlayers.forEach(player => player.destroy());\n            this.reportError(errors);\n        }\n        /** @type {?} */\n        const allPreviousPlayersMap = new Map();\n        /** @type {?} */\n        const animationElementMap = new Map();\n        queuedInstructions.forEach(entry => {\n            /** @type {?} */\n            const element = entry.element;\n            if (subTimelines.has(element)) {\n                animationElementMap.set(element, element);\n                this._beforeAnimationBuild(entry.player.namespaceId, entry.instruction, allPreviousPlayersMap);\n            }\n        });\n        skippedPlayers.forEach(player => {\n            /** @type {?} */\n            const element = player.element;\n            /** @type {?} */\n            const previousPlayers = this._getPreviousPlayers(element, false, player.namespaceId, player.triggerName, null);\n            previousPlayers.forEach(prevPlayer => {\n                getOrSetAsInMap(allPreviousPlayersMap, element, []).push(prevPlayer);\n                prevPlayer.destroy();\n            });\n        });\n        /** @type {?} */\n        const replaceNodes = allLeaveNodes.filter(node => {\n            return replacePostStylesAsPre(node, allPreStyleElements, allPostStyleElements);\n        });\n        /** @type {?} */\n        const postStylesMap = new Map();\n        /** @type {?} */\n        const allLeaveQueriedNodes = cloakAndComputeStyles(postStylesMap, this.driver, leaveNodesWithoutAnimations, allPostStyleElements, AUTO_STYLE);\n        allLeaveQueriedNodes.forEach(node => {\n            if (replacePostStylesAsPre(node, allPreStyleElements, allPostStyleElements)) {\n                replaceNodes.push(node);\n            }\n        });\n        /** @type {?} */\n        const preStylesMap = new Map();\n        enterNodeMap.forEach((nodes, root) => {\n            cloakAndComputeStyles(preStylesMap, this.driver, new Set(nodes), allPreStyleElements, ɵPRE_STYLE);\n        });\n        replaceNodes.forEach(node => {\n            /** @type {?} */\n            const post = postStylesMap.get(node);\n            /** @type {?} */\n            const pre = preStylesMap.get(node);\n            postStylesMap.set(node, /** @type {?} */ (Object.assign({}, post, pre)));\n        });\n        /** @type {?} */\n        const rootPlayers = [];\n        /** @type {?} */\n        const subPlayers = [];\n        /** @type {?} */\n        const NO_PARENT_ANIMATION_ELEMENT_DETECTED = {};\n        queuedInstructions.forEach(entry => {\n            const { element, player, instruction } = entry;\n            // this means that it was never consumed by a parent animation which\n            // means that it is independent and therefore should be set for animation\n            if (subTimelines.has(element)) {\n                if (disabledElementsSet.has(element)) {\n                    player.onDestroy(() => setStyles(element, instruction.toStyles));\n                    player.disabled = true;\n                    player.overrideTotalTime(instruction.totalTime);\n                    skippedPlayers.push(player);\n                    return;\n                }\n                /** @type {?} */\n                let parentWithAnimation = NO_PARENT_ANIMATION_ELEMENT_DETECTED;\n                if (animationElementMap.size > 1) {\n                    /** @type {?} */\n                    let elm = element;\n                    /** @type {?} */\n                    const parentsToAdd = [];\n                    while (elm = elm.parentNode) {\n                        /** @type {?} */\n                        const detectedParent = animationElementMap.get(elm);\n                        if (detectedParent) {\n                            parentWithAnimation = detectedParent;\n                            break;\n                        }\n                        parentsToAdd.push(elm);\n                    }\n                    parentsToAdd.forEach(parent => animationElementMap.set(parent, parentWithAnimation));\n                }\n                /** @type {?} */\n                const innerPlayer = this._buildAnimation(player.namespaceId, instruction, allPreviousPlayersMap, skippedPlayersMap, preStylesMap, postStylesMap);\n                player.setRealPlayer(innerPlayer);\n                if (parentWithAnimation === NO_PARENT_ANIMATION_ELEMENT_DETECTED) {\n                    rootPlayers.push(player);\n                }\n                else {\n                    /** @type {?} */\n                    const parentPlayers = this.playersByElement.get(parentWithAnimation);\n                    if (parentPlayers && parentPlayers.length) {\n                        player.parentPlayer = optimizeGroupPlayer(parentPlayers);\n                    }\n                    skippedPlayers.push(player);\n                }\n            }\n            else {\n                eraseStyles(element, instruction.fromStyles);\n                player.onDestroy(() => setStyles(element, instruction.toStyles));\n                // there still might be a ancestor player animating this\n                // element therefore we will still add it as a sub player\n                // even if its animation may be disabled\n                subPlayers.push(player);\n                if (disabledElementsSet.has(element)) {\n                    skippedPlayers.push(player);\n                }\n            }\n        });\n        // find all of the sub players' corresponding inner animation player\n        subPlayers.forEach(player => {\n            /** @type {?} */\n            const playersForElement = skippedPlayersMap.get(player.element);\n            if (playersForElement && playersForElement.length) {\n                /** @type {?} */\n                const innerPlayer = optimizeGroupPlayer(playersForElement);\n                player.setRealPlayer(innerPlayer);\n            }\n        });\n        // the reason why we don't actually play the animation is\n        // because all that a skipped player is designed to do is to\n        // fire the start/done transition callback events\n        skippedPlayers.forEach(player => {\n            if (player.parentPlayer) {\n                player.syncPlayerEvents(player.parentPlayer);\n            }\n            else {\n                player.destroy();\n            }\n        });\n        // run through all of the queued removals and see if they\n        // were picked up by a query. If not then perform the removal\n        // operation right away unless a parent animation is ongoing.\n        for (let i = 0; i < allLeaveNodes.length; i++) {\n            /** @type {?} */\n            const element = allLeaveNodes[i];\n            /** @type {?} */\n            const details = /** @type {?} */ (element[REMOVAL_FLAG]);\n            removeClass(element, LEAVE_CLASSNAME);\n            // this means the element has a removal animation that is being\n            // taken care of and therefore the inner elements will hang around\n            // until that animation is over (or the parent queried animation)\n            if (details && details.hasAnimation)\n                continue;\n            /** @type {?} */\n            let players = [];\n            // if this element is queried or if it contains queried children\n            // then we want for the element not to be removed from the page\n            // until the queried animations have finished\n            if (queriedElements.size) {\n                /** @type {?} */\n                let queriedPlayerResults = queriedElements.get(element);\n                if (queriedPlayerResults && queriedPlayerResults.length) {\n                    players.push(...queriedPlayerResults);\n                }\n                /** @type {?} */\n                let queriedInnerElements = this.driver.query(element, NG_ANIMATING_SELECTOR, true);\n                for (let j = 0; j < queriedInnerElements.length; j++) {\n                    /** @type {?} */\n                    let queriedPlayers = queriedElements.get(queriedInnerElements[j]);\n                    if (queriedPlayers && queriedPlayers.length) {\n                        players.push(...queriedPlayers);\n                    }\n                }\n            }\n            /** @type {?} */\n            const activePlayers = players.filter(p => !p.destroyed);\n            if (activePlayers.length) {\n                removeNodesAfterAnimationDone(this, element, activePlayers);\n            }\n            else {\n                this.processLeaveNode(element);\n            }\n        }\n        // this is required so the cleanup method doesn't remove them\n        allLeaveNodes.length = 0;\n        rootPlayers.forEach(player => {\n            this.players.push(player);\n            player.onDone(() => {\n                player.destroy();\n                /** @type {?} */\n                const index = this.players.indexOf(player);\n                this.players.splice(index, 1);\n            });\n            player.play();\n        });\n        return rootPlayers;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @return {?}\n     */\n    elementContainsData(namespaceId, element) {\n        /** @type {?} */\n        let containsData = false;\n        /** @type {?} */\n        const details = /** @type {?} */ (element[REMOVAL_FLAG]);\n        if (details && details.setForRemoval)\n            containsData = true;\n        if (this.playersByElement.has(element))\n            containsData = true;\n        if (this.playersByQueriedElement.has(element))\n            containsData = true;\n        if (this.statesByElement.has(element))\n            containsData = true;\n        return this._fetchNamespace(namespaceId).elementContainsData(element) || containsData;\n    }\n    /**\n     * @param {?} callback\n     * @return {?}\n     */\n    afterFlush(callback) { this._flushFns.push(callback); }\n    /**\n     * @param {?} callback\n     * @return {?}\n     */\n    afterFlushAnimationsDone(callback) { this._whenQuietFns.push(callback); }\n    /**\n     * @param {?} element\n     * @param {?} isQueriedElement\n     * @param {?=} namespaceId\n     * @param {?=} triggerName\n     * @param {?=} toStateValue\n     * @return {?}\n     */\n    _getPreviousPlayers(element, isQueriedElement, namespaceId, triggerName, toStateValue) {\n        /** @type {?} */\n        let players = [];\n        if (isQueriedElement) {\n            /** @type {?} */\n            const queriedElementPlayers = this.playersByQueriedElement.get(element);\n            if (queriedElementPlayers) {\n                players = queriedElementPlayers;\n            }\n        }\n        else {\n            /** @type {?} */\n            const elementPlayers = this.playersByElement.get(element);\n            if (elementPlayers) {\n                /** @type {?} */\n                const isRemovalAnimation = !toStateValue || toStateValue == VOID_VALUE;\n                elementPlayers.forEach(player => {\n                    if (player.queued)\n                        return;\n                    if (!isRemovalAnimation && player.triggerName != triggerName)\n                        return;\n                    players.push(player);\n                });\n            }\n        }\n        if (namespaceId || triggerName) {\n            players = players.filter(player => {\n                if (namespaceId && namespaceId != player.namespaceId)\n                    return false;\n                if (triggerName && triggerName != player.triggerName)\n                    return false;\n                return true;\n            });\n        }\n        return players;\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} instruction\n     * @param {?} allPreviousPlayersMap\n     * @return {?}\n     */\n    _beforeAnimationBuild(namespaceId, instruction, allPreviousPlayersMap) {\n        /** @type {?} */\n        const triggerName = instruction.triggerName;\n        /** @type {?} */\n        const rootElement = instruction.element;\n        /** @type {?} */\n        const targetNameSpaceId = instruction.isRemovalTransition ? undefined : namespaceId;\n        /** @type {?} */\n        const targetTriggerName = instruction.isRemovalTransition ? undefined : triggerName;\n        for (const timelineInstruction of instruction.timelines) {\n            /** @type {?} */\n            const element = timelineInstruction.element;\n            /** @type {?} */\n            const isQueriedElement = element !== rootElement;\n            /** @type {?} */\n            const players = getOrSetAsInMap(allPreviousPlayersMap, element, []);\n            /** @type {?} */\n            const previousPlayers = this._getPreviousPlayers(element, isQueriedElement, targetNameSpaceId, targetTriggerName, instruction.toState);\n            previousPlayers.forEach(player => {\n                /** @type {?} */\n                const realPlayer = /** @type {?} */ (player.getRealPlayer());\n                if (realPlayer.beforeDestroy) {\n                    realPlayer.beforeDestroy();\n                }\n                player.destroy();\n                players.push(player);\n            });\n        }\n        // this needs to be done so that the PRE/POST styles can be\n        // computed properly without interfering with the previous animation\n        eraseStyles(rootElement, instruction.fromStyles);\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} instruction\n     * @param {?} allPreviousPlayersMap\n     * @param {?} skippedPlayersMap\n     * @param {?} preStylesMap\n     * @param {?} postStylesMap\n     * @return {?}\n     */\n    _buildAnimation(namespaceId, instruction, allPreviousPlayersMap, skippedPlayersMap, preStylesMap, postStylesMap) {\n        /** @type {?} */\n        const triggerName = instruction.triggerName;\n        /** @type {?} */\n        const rootElement = instruction.element;\n        /** @type {?} */\n        const allQueriedPlayers = [];\n        /** @type {?} */\n        const allConsumedElements = new Set();\n        /** @type {?} */\n        const allSubElements = new Set();\n        /** @type {?} */\n        const allNewPlayers = instruction.timelines.map(timelineInstruction => {\n            /** @type {?} */\n            const element = timelineInstruction.element;\n            allConsumedElements.add(element);\n            /** @type {?} */\n            const details = element[REMOVAL_FLAG];\n            if (details && details.removedBeforeQueried)\n                return new NoopAnimationPlayer(timelineInstruction.duration, timelineInstruction.delay);\n            /** @type {?} */\n            const isQueriedElement = element !== rootElement;\n            /** @type {?} */\n            const previousPlayers = flattenGroupPlayers((allPreviousPlayersMap.get(element) || EMPTY_PLAYER_ARRAY)\n                .map(p => p.getRealPlayer()))\n                .filter(p => {\n                /** @type {?} */\n                const pp = /** @type {?} */ (p);\n                return pp.element ? pp.element === element : false;\n            });\n            /** @type {?} */\n            const preStyles = preStylesMap.get(element);\n            /** @type {?} */\n            const postStyles = postStylesMap.get(element);\n            /** @type {?} */\n            const keyframes = normalizeKeyframes(this.driver, this._normalizer, element, timelineInstruction.keyframes, preStyles, postStyles);\n            /** @type {?} */\n            const player = this._buildPlayer(timelineInstruction, keyframes, previousPlayers);\n            // this means that this particular player belongs to a sub trigger. It is\n            // important that we match this player up with the corresponding (@trigger.listener)\n            if (timelineInstruction.subTimeline && skippedPlayersMap) {\n                allSubElements.add(element);\n            }\n            if (isQueriedElement) {\n                /** @type {?} */\n                const wrappedPlayer = new TransitionAnimationPlayer(namespaceId, triggerName, element);\n                wrappedPlayer.setRealPlayer(player);\n                allQueriedPlayers.push(wrappedPlayer);\n            }\n            return player;\n        });\n        allQueriedPlayers.forEach(player => {\n            getOrSetAsInMap(this.playersByQueriedElement, player.element, []).push(player);\n            player.onDone(() => deleteOrUnsetInMap(this.playersByQueriedElement, player.element, player));\n        });\n        allConsumedElements.forEach(element => addClass(element, NG_ANIMATING_CLASSNAME));\n        /** @type {?} */\n        const player = optimizeGroupPlayer(allNewPlayers);\n        player.onDestroy(() => {\n            allConsumedElements.forEach(element => removeClass(element, NG_ANIMATING_CLASSNAME));\n            setStyles(rootElement, instruction.toStyles);\n        });\n        // this basically makes all of the callbacks for sub element animations\n        // be dependent on the upper players for when they finish\n        allSubElements.forEach(element => { getOrSetAsInMap(skippedPlayersMap, element, []).push(player); });\n        return player;\n    }\n    /**\n     * @param {?} instruction\n     * @param {?} keyframes\n     * @param {?} previousPlayers\n     * @return {?}\n     */\n    _buildPlayer(instruction, keyframes, previousPlayers) {\n        if (keyframes.length > 0) {\n            return this.driver.animate(instruction.element, keyframes, instruction.duration, instruction.delay, instruction.easing, previousPlayers);\n        }\n        // special case for when an empty transition|definition is provided\n        // ... there is no point in rendering an empty animation\n        return new NoopAnimationPlayer(instruction.duration, instruction.delay);\n    }\n}\nclass TransitionAnimationPlayer {\n    /**\n     * @param {?} namespaceId\n     * @param {?} triggerName\n     * @param {?} element\n     */\n    constructor(namespaceId, triggerName, element) {\n        this.namespaceId = namespaceId;\n        this.triggerName = triggerName;\n        this.element = element;\n        this._player = new NoopAnimationPlayer();\n        this._containsRealPlayer = false;\n        this._queuedCallbacks = {};\n        this.destroyed = false;\n        this.markedForDestroy = false;\n        this.disabled = false;\n        this.queued = true;\n        this.totalTime = 0;\n    }\n    /**\n     * @param {?} player\n     * @return {?}\n     */\n    setRealPlayer(player) {\n        if (this._containsRealPlayer)\n            return;\n        this._player = player;\n        Object.keys(this._queuedCallbacks).forEach(phase => {\n            this._queuedCallbacks[phase].forEach(callback => listenOnPlayer(player, phase, undefined, callback));\n        });\n        this._queuedCallbacks = {};\n        this._containsRealPlayer = true;\n        this.overrideTotalTime(player.totalTime);\n        (/** @type {?} */ (this)).queued = false;\n    }\n    /**\n     * @return {?}\n     */\n    getRealPlayer() { return this._player; }\n    /**\n     * @param {?} totalTime\n     * @return {?}\n     */\n    overrideTotalTime(totalTime) { (/** @type {?} */ (this)).totalTime = totalTime; }\n    /**\n     * @param {?} player\n     * @return {?}\n     */\n    syncPlayerEvents(player) {\n        /** @type {?} */\n        const p = /** @type {?} */ (this._player);\n        if (p.triggerCallback) {\n            player.onStart(() => /** @type {?} */ ((p.triggerCallback))('start'));\n        }\n        player.onDone(() => this.finish());\n        player.onDestroy(() => this.destroy());\n    }\n    /**\n     * @param {?} name\n     * @param {?} callback\n     * @return {?}\n     */\n    _queueEvent(name, callback) {\n        getOrSetAsInMap(this._queuedCallbacks, name, []).push(callback);\n    }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onDone(fn) {\n        if (this.queued) {\n            this._queueEvent('done', fn);\n        }\n        this._player.onDone(fn);\n    }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onStart(fn) {\n        if (this.queued) {\n            this._queueEvent('start', fn);\n        }\n        this._player.onStart(fn);\n    }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onDestroy(fn) {\n        if (this.queued) {\n            this._queueEvent('destroy', fn);\n        }\n        this._player.onDestroy(fn);\n    }\n    /**\n     * @return {?}\n     */\n    init() { this._player.init(); }\n    /**\n     * @return {?}\n     */\n    hasStarted() { return this.queued ? false : this._player.hasStarted(); }\n    /**\n     * @return {?}\n     */\n    play() { !this.queued && this._player.play(); }\n    /**\n     * @return {?}\n     */\n    pause() { !this.queued && this._player.pause(); }\n    /**\n     * @return {?}\n     */\n    restart() { !this.queued && this._player.restart(); }\n    /**\n     * @return {?}\n     */\n    finish() { this._player.finish(); }\n    /**\n     * @return {?}\n     */\n    destroy() {\n        (/** @type {?} */ (this)).destroyed = true;\n        this._player.destroy();\n    }\n    /**\n     * @return {?}\n     */\n    reset() { !this.queued && this._player.reset(); }\n    /**\n     * @param {?} p\n     * @return {?}\n     */\n    setPosition(p) {\n        if (!this.queued) {\n            this._player.setPosition(p);\n        }\n    }\n    /**\n     * @return {?}\n     */\n    getPosition() { return this.queued ? 0 : this._player.getPosition(); }\n    /**\n     * \\@internal\n     * @param {?} phaseName\n     * @return {?}\n     */\n    triggerCallback(phaseName) {\n        /** @type {?} */\n        const p = /** @type {?} */ (this._player);\n        if (p.triggerCallback) {\n            p.triggerCallback(phaseName);\n        }\n    }\n}\n/**\n * @param {?} map\n * @param {?} key\n * @param {?} value\n * @return {?}\n */\nfunction deleteOrUnsetInMap(map, key, value) {\n    /** @type {?} */\n    let currentValues;\n    if (map instanceof Map) {\n        currentValues = map.get(key);\n        if (currentValues) {\n            if (currentValues.length) {\n                /** @type {?} */\n                const index = currentValues.indexOf(value);\n                currentValues.splice(index, 1);\n            }\n            if (currentValues.length == 0) {\n                map.delete(key);\n            }\n        }\n    }\n    else {\n        currentValues = map[key];\n        if (currentValues) {\n            if (currentValues.length) {\n                /** @type {?} */\n                const index = currentValues.indexOf(value);\n                currentValues.splice(index, 1);\n            }\n            if (currentValues.length == 0) {\n                delete map[key];\n            }\n        }\n    }\n    return currentValues;\n}\n/**\n * @param {?} value\n * @return {?}\n */\nfunction normalizeTriggerValue(value) {\n    // we use `!= null` here because it's the most simple\n    // way to test against a \"falsy\" value without mixing\n    // in empty strings or a zero value. DO NOT OPTIMIZE.\n    return value != null ? value : null;\n}\n/**\n * @param {?} node\n * @return {?}\n */\nfunction isElementNode(node) {\n    return node && node['nodeType'] === 1;\n}\n/**\n * @param {?} eventName\n * @return {?}\n */\nfunction isTriggerEventValid(eventName) {\n    return eventName == 'start' || eventName == 'done';\n}\n/**\n * @param {?} element\n * @param {?=} value\n * @return {?}\n */\nfunction cloakElement(element, value) {\n    /** @type {?} */\n    const oldValue = element.style.display;\n    element.style.display = value != null ? value : 'none';\n    return oldValue;\n}\n/**\n * @param {?} valuesMap\n * @param {?} driver\n * @param {?} elements\n * @param {?} elementPropsMap\n * @param {?} defaultStyle\n * @return {?}\n */\nfunction cloakAndComputeStyles(valuesMap, driver, elements, elementPropsMap, defaultStyle) {\n    /** @type {?} */\n    const cloakVals = [];\n    elements.forEach(element => cloakVals.push(cloakElement(element)));\n    /** @type {?} */\n    const failedElements = [];\n    elementPropsMap.forEach((props, element) => {\n        /** @type {?} */\n        const styles = {};\n        props.forEach(prop => {\n            /** @type {?} */\n            const value = styles[prop] = driver.computeStyle(element, prop, defaultStyle);\n            // there is no easy way to detect this because a sub element could be removed\n            // by a parent animation element being detached.\n            if (!value || value.length == 0) {\n                element[REMOVAL_FLAG] = NULL_REMOVED_QUERIED_STATE;\n                failedElements.push(element);\n            }\n        });\n        valuesMap.set(element, styles);\n    });\n    /** @type {?} */\n    let i = 0;\n    elements.forEach(element => cloakElement(element, cloakVals[i++]));\n    return failedElements;\n}\n/**\n * @param {?} roots\n * @param {?} nodes\n * @return {?}\n */\nfunction buildRootMap(roots, nodes) {\n    /** @type {?} */\n    const rootMap = new Map();\n    roots.forEach(root => rootMap.set(root, []));\n    if (nodes.length == 0)\n        return rootMap;\n    /** @type {?} */\n    const NULL_NODE = 1;\n    /** @type {?} */\n    const nodeSet = new Set(nodes);\n    /** @type {?} */\n    const localRootMap = new Map();\n    /**\n     * @param {?} node\n     * @return {?}\n     */\n    function getRoot(node) {\n        if (!node)\n            return NULL_NODE;\n        /** @type {?} */\n        let root = localRootMap.get(node);\n        if (root)\n            return root;\n        /** @type {?} */\n        const parent = node.parentNode;\n        if (rootMap.has(parent)) { // ngIf inside @trigger\n            // ngIf inside @trigger\n            root = parent;\n        }\n        else if (nodeSet.has(parent)) { // ngIf inside ngIf\n            // ngIf inside ngIf\n            root = NULL_NODE;\n        }\n        else { // recurse upwards\n            // recurse upwards\n            root = getRoot(parent);\n        }\n        localRootMap.set(node, root);\n        return root;\n    }\n    nodes.forEach(node => {\n        /** @type {?} */\n        const root = getRoot(node);\n        if (root !== NULL_NODE) {\n            /** @type {?} */ ((rootMap.get(root))).push(node);\n        }\n    });\n    return rootMap;\n}\n/** @type {?} */\nconst CLASSES_CACHE_KEY = '$$classes';\n/**\n * @param {?} element\n * @param {?} className\n * @return {?}\n */\nfunction addClass(element, className) {\n    if (element.classList) {\n        element.classList.add(className);\n    }\n    else {\n        /** @type {?} */\n        let classes = element[CLASSES_CACHE_KEY];\n        if (!classes) {\n            classes = element[CLASSES_CACHE_KEY] = {};\n        }\n        classes[className] = true;\n    }\n}\n/**\n * @param {?} element\n * @param {?} className\n * @return {?}\n */\nfunction removeClass(element, className) {\n    if (element.classList) {\n        element.classList.remove(className);\n    }\n    else {\n        /** @type {?} */\n        let classes = element[CLASSES_CACHE_KEY];\n        if (classes) {\n            delete classes[className];\n        }\n    }\n}\n/**\n * @param {?} engine\n * @param {?} element\n * @param {?} players\n * @return {?}\n */\nfunction removeNodesAfterAnimationDone(engine, element, players) {\n    optimizeGroupPlayer(players).onDone(() => engine.processLeaveNode(element));\n}\n/**\n * @param {?} players\n * @return {?}\n */\nfunction flattenGroupPlayers(players) {\n    /** @type {?} */\n    const finalPlayers = [];\n    _flattenGroupPlayersRecur(players, finalPlayers);\n    return finalPlayers;\n}\n/**\n * @param {?} players\n * @param {?} finalPlayers\n * @return {?}\n */\nfunction _flattenGroupPlayersRecur(players, finalPlayers) {\n    for (let i = 0; i < players.length; i++) {\n        /** @type {?} */\n        const player = players[i];\n        if (player instanceof ɵAnimationGroupPlayer) {\n            _flattenGroupPlayersRecur(player.players, finalPlayers);\n        }\n        else {\n            finalPlayers.push(/** @type {?} */ (player));\n        }\n    }\n}\n/**\n * @param {?} a\n * @param {?} b\n * @return {?}\n */\nfunction objEquals(a, b) {\n    /** @type {?} */\n    const k1 = Object.keys(a);\n    /** @type {?} */\n    const k2 = Object.keys(b);\n    if (k1.length != k2.length)\n        return false;\n    for (let i = 0; i < k1.length; i++) {\n        /** @type {?} */\n        const prop = k1[i];\n        if (!b.hasOwnProperty(prop) || a[prop] !== b[prop])\n            return false;\n    }\n    return true;\n}\n/**\n * @param {?} element\n * @param {?} allPreStyleElements\n * @param {?} allPostStyleElements\n * @return {?}\n */\nfunction replacePostStylesAsPre(element, allPreStyleElements, allPostStyleElements) {\n    /** @type {?} */\n    const postEntry = allPostStyleElements.get(element);\n    if (!postEntry)\n        return false;\n    /** @type {?} */\n    let preEntry = allPreStyleElements.get(element);\n    if (preEntry) {\n        postEntry.forEach(data => /** @type {?} */ ((preEntry)).add(data));\n    }\n    else {\n        allPreStyleElements.set(element, postEntry);\n    }\n    allPostStyleElements.delete(element);\n    return true;\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass AnimationEngine {\n    /**\n     * @param {?} bodyNode\n     * @param {?} _driver\n     * @param {?} normalizer\n     */\n    constructor(bodyNode, _driver, normalizer) {\n        this.bodyNode = bodyNode;\n        this._driver = _driver;\n        this._triggerCache = {};\n        this.onRemovalComplete = (element, context) => { };\n        this._transitionEngine = new TransitionAnimationEngine(bodyNode, _driver, normalizer);\n        this._timelineEngine = new TimelineAnimationEngine(bodyNode, _driver, normalizer);\n        this._transitionEngine.onRemovalComplete = (element, context) => this.onRemovalComplete(element, context);\n    }\n    /**\n     * @param {?} componentId\n     * @param {?} namespaceId\n     * @param {?} hostElement\n     * @param {?} name\n     * @param {?} metadata\n     * @return {?}\n     */\n    registerTrigger(componentId, namespaceId, hostElement, name, metadata) {\n        /** @type {?} */\n        const cacheKey = componentId + '-' + name;\n        /** @type {?} */\n        let trigger = this._triggerCache[cacheKey];\n        if (!trigger) {\n            /** @type {?} */\n            const errors = [];\n            /** @type {?} */\n            const ast = /** @type {?} */ (buildAnimationAst(this._driver, /** @type {?} */ (metadata), errors));\n            if (errors.length) {\n                throw new Error(`The animation trigger \"${name}\" has failed to build due to the following errors:\\n - ${errors.join(\"\\n - \")}`);\n            }\n            trigger = buildTrigger(name, ast);\n            this._triggerCache[cacheKey] = trigger;\n        }\n        this._transitionEngine.registerTrigger(namespaceId, name, trigger);\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} hostElement\n     * @return {?}\n     */\n    register(namespaceId, hostElement) {\n        this._transitionEngine.register(namespaceId, hostElement);\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} context\n     * @return {?}\n     */\n    destroy(namespaceId, context) {\n        this._transitionEngine.destroy(namespaceId, context);\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} parent\n     * @param {?} insertBefore\n     * @return {?}\n     */\n    onInsert(namespaceId, element, parent, insertBefore) {\n        this._transitionEngine.insertNode(namespaceId, element, parent, insertBefore);\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} context\n     * @return {?}\n     */\n    onRemove(namespaceId, element, context) {\n        this._transitionEngine.removeNode(namespaceId, element, context);\n    }\n    /**\n     * @param {?} element\n     * @param {?} disable\n     * @return {?}\n     */\n    disableAnimations(element, disable) {\n        this._transitionEngine.markElementAsDisabled(element, disable);\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} property\n     * @param {?} value\n     * @return {?}\n     */\n    process(namespaceId, element, property, value) {\n        if (property.charAt(0) == '@') {\n            const [id, action] = parseTimelineCommand(property);\n            /** @type {?} */\n            const args = /** @type {?} */ (value);\n            this._timelineEngine.command(id, element, action, args);\n        }\n        else {\n            this._transitionEngine.trigger(namespaceId, element, property, value);\n        }\n    }\n    /**\n     * @param {?} namespaceId\n     * @param {?} element\n     * @param {?} eventName\n     * @param {?} eventPhase\n     * @param {?} callback\n     * @return {?}\n     */\n    listen(namespaceId, element, eventName, eventPhase, callback) {\n        // @@listen\n        if (eventName.charAt(0) == '@') {\n            const [id, action] = parseTimelineCommand(eventName);\n            return this._timelineEngine.listen(id, element, action, callback);\n        }\n        return this._transitionEngine.listen(namespaceId, element, eventName, eventPhase, callback);\n    }\n    /**\n     * @param {?=} microtaskId\n     * @return {?}\n     */\n    flush(microtaskId = -1) { this._transitionEngine.flush(microtaskId); }\n    /**\n     * @return {?}\n     */\n    get players() {\n        return (/** @type {?} */ (this._transitionEngine.players))\n            .concat(/** @type {?} */ (this._timelineEngine.players));\n    }\n    /**\n     * @return {?}\n     */\n    whenRenderingDone() { return this._transitionEngine.whenRenderingDone(); }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** *\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n  @type {?} */\nconst ELAPSED_TIME_MAX_DECIMAL_PLACES = 3;\n/** @type {?} */\nconst ANIMATION_PROP = 'animation';\n/** @type {?} */\nconst ANIMATIONEND_EVENT = 'animationend';\n/** @type {?} */\nconst ONE_SECOND$1 = 1000;\nclass ElementAnimationStyleHandler {\n    /**\n     * @param {?} _element\n     * @param {?} _name\n     * @param {?} _duration\n     * @param {?} _delay\n     * @param {?} _easing\n     * @param {?} _fillMode\n     * @param {?} _onDoneFn\n     */\n    constructor(_element, _name, _duration, _delay, _easing, _fillMode, _onDoneFn) {\n        this._element = _element;\n        this._name = _name;\n        this._duration = _duration;\n        this._delay = _delay;\n        this._easing = _easing;\n        this._fillMode = _fillMode;\n        this._onDoneFn = _onDoneFn;\n        this._finished = false;\n        this._destroyed = false;\n        this._startTime = 0;\n        this._position = 0;\n        this._eventFn = (e) => this._handleCallback(e);\n    }\n    /**\n     * @return {?}\n     */\n    apply() {\n        applyKeyframeAnimation(this._element, `${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`);\n        addRemoveAnimationEvent(this._element, this._eventFn, false);\n        this._startTime = Date.now();\n    }\n    /**\n     * @return {?}\n     */\n    pause() { playPauseAnimation(this._element, this._name, 'paused'); }\n    /**\n     * @return {?}\n     */\n    resume() { playPauseAnimation(this._element, this._name, 'running'); }\n    /**\n     * @param {?} position\n     * @return {?}\n     */\n    setPosition(position) {\n        /** @type {?} */\n        const index = findIndexForAnimation(this._element, this._name);\n        this._position = position * this._duration;\n        setAnimationStyle(this._element, 'Delay', `-${this._position}ms`, index);\n    }\n    /**\n     * @return {?}\n     */\n    getPosition() { return this._position; }\n    /**\n     * @param {?} event\n     * @return {?}\n     */\n    _handleCallback(event) {\n        /** @type {?} */\n        const timestamp = event._ngTestManualTimestamp || Date.now();\n        /** @type {?} */\n        const elapsedTime = parseFloat(event.elapsedTime.toFixed(ELAPSED_TIME_MAX_DECIMAL_PLACES)) * ONE_SECOND$1;\n        if (event.animationName == this._name &&\n            Math.max(timestamp - this._startTime, 0) >= this._delay && elapsedTime >= this._duration) {\n            this.finish();\n        }\n    }\n    /**\n     * @return {?}\n     */\n    finish() {\n        if (this._finished)\n            return;\n        this._finished = true;\n        this._onDoneFn();\n        addRemoveAnimationEvent(this._element, this._eventFn, true);\n    }\n    /**\n     * @return {?}\n     */\n    destroy() {\n        if (this._destroyed)\n            return;\n        this._destroyed = true;\n        this.finish();\n        removeKeyframeAnimation(this._element, this._name);\n    }\n}\n/**\n * @param {?} element\n * @param {?} name\n * @param {?} status\n * @return {?}\n */\nfunction playPauseAnimation(element, name, status) {\n    /** @type {?} */\n    const index = findIndexForAnimation(element, name);\n    setAnimationStyle(element, 'PlayState', status, index);\n}\n/**\n * @param {?} element\n * @param {?} value\n * @return {?}\n */\nfunction applyKeyframeAnimation(element, value) {\n    /** @type {?} */\n    const anim = getAnimationStyle(element, '').trim();\n    /** @type {?} */\n    let index = 0;\n    if (anim.length) {\n        index = countChars(anim, ',') + 1;\n        value = `${anim}, ${value}`;\n    }\n    setAnimationStyle(element, '', value);\n    return index;\n}\n/**\n * @param {?} element\n * @param {?} name\n * @return {?}\n */\nfunction removeKeyframeAnimation(element, name) {\n    /** @type {?} */\n    const anim = getAnimationStyle(element, '');\n    /** @type {?} */\n    const tokens = anim.split(',');\n    /** @type {?} */\n    const index = findMatchingTokenIndex(tokens, name);\n    if (index >= 0) {\n        tokens.splice(index, 1);\n        /** @type {?} */\n        const newValue = tokens.join(',');\n        setAnimationStyle(element, '', newValue);\n    }\n}\n/**\n * @param {?} element\n * @param {?} value\n * @return {?}\n */\nfunction findIndexForAnimation(element, value) {\n    /** @type {?} */\n    const anim = getAnimationStyle(element, '');\n    if (anim.indexOf(',') > 0) {\n        /** @type {?} */\n        const tokens = anim.split(',');\n        return findMatchingTokenIndex(tokens, value);\n    }\n    return findMatchingTokenIndex([anim], value);\n}\n/**\n * @param {?} tokens\n * @param {?} searchToken\n * @return {?}\n */\nfunction findMatchingTokenIndex(tokens, searchToken) {\n    for (let i = 0; i < tokens.length; i++) {\n        if (tokens[i].indexOf(searchToken) >= 0) {\n            return i;\n        }\n    }\n    return -1;\n}\n/**\n * @param {?} element\n * @param {?} fn\n * @param {?} doRemove\n * @return {?}\n */\nfunction addRemoveAnimationEvent(element, fn, doRemove) {\n    doRemove ? element.removeEventListener(ANIMATIONEND_EVENT, fn) :\n        element.addEventListener(ANIMATIONEND_EVENT, fn);\n}\n/**\n * @param {?} element\n * @param {?} name\n * @param {?} value\n * @param {?=} index\n * @return {?}\n */\nfunction setAnimationStyle(element, name, value, index) {\n    /** @type {?} */\n    const prop = ANIMATION_PROP + name;\n    if (index != null) {\n        /** @type {?} */\n        const oldValue = element.style[prop];\n        if (oldValue.length) {\n            /** @type {?} */\n            const tokens = oldValue.split(',');\n            tokens[index] = value;\n            value = tokens.join(',');\n        }\n    }\n    element.style[prop] = value;\n}\n/**\n * @param {?} element\n * @param {?} name\n * @return {?}\n */\nfunction getAnimationStyle(element, name) {\n    return element.style[ANIMATION_PROP + name];\n}\n/**\n * @param {?} value\n * @param {?} char\n * @return {?}\n */\nfunction countChars(value, char) {\n    /** @type {?} */\n    let count = 0;\n    for (let i = 0; i < value.length; i++) {\n        /** @type {?} */\n        const c = value.charAt(i);\n        if (c === char)\n            count++;\n    }\n    return count;\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst DEFAULT_FILL_MODE = 'forwards';\n/** @type {?} */\nconst DEFAULT_EASING = 'linear';\nclass CssKeyframesPlayer {\n    /**\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} animationName\n     * @param {?} _duration\n     * @param {?} _delay\n     * @param {?} easing\n     * @param {?} _finalStyles\n     */\n    constructor(element, keyframes, animationName, _duration, _delay, easing, _finalStyles) {\n        this.element = element;\n        this.keyframes = keyframes;\n        this.animationName = animationName;\n        this._duration = _duration;\n        this._delay = _delay;\n        this._finalStyles = _finalStyles;\n        this._onDoneFns = [];\n        this._onStartFns = [];\n        this._onDestroyFns = [];\n        this._started = false;\n        this.currentSnapshot = {};\n        this._state = 0;\n        this.easing = easing || DEFAULT_EASING;\n        this.totalTime = _duration + _delay;\n        this._buildStyler();\n    }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onStart(fn) { this._onStartFns.push(fn); }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onDone(fn) { this._onDoneFns.push(fn); }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onDestroy(fn) { this._onDestroyFns.push(fn); }\n    /**\n     * @return {?}\n     */\n    destroy() {\n        this.init();\n        if (this._state >= 4 /* DESTROYED */)\n            return;\n        this._state = 4 /* DESTROYED */;\n        this._styler.destroy();\n        this._flushStartFns();\n        this._flushDoneFns();\n        this._onDestroyFns.forEach(fn => fn());\n        this._onDestroyFns = [];\n    }\n    /**\n     * @return {?}\n     */\n    _flushDoneFns() {\n        this._onDoneFns.forEach(fn => fn());\n        this._onDoneFns = [];\n    }\n    /**\n     * @return {?}\n     */\n    _flushStartFns() {\n        this._onStartFns.forEach(fn => fn());\n        this._onStartFns = [];\n    }\n    /**\n     * @return {?}\n     */\n    finish() {\n        this.init();\n        if (this._state >= 3 /* FINISHED */)\n            return;\n        this._state = 3 /* FINISHED */;\n        this._styler.finish();\n        this._flushStartFns();\n        this._flushDoneFns();\n    }\n    /**\n     * @param {?} value\n     * @return {?}\n     */\n    setPosition(value) { this._styler.setPosition(value); }\n    /**\n     * @return {?}\n     */\n    getPosition() { return this._styler.getPosition(); }\n    /**\n     * @return {?}\n     */\n    hasStarted() { return this._state >= 2 /* STARTED */; }\n    /**\n     * @return {?}\n     */\n    init() {\n        if (this._state >= 1 /* INITIALIZED */)\n            return;\n        this._state = 1 /* INITIALIZED */;\n        /** @type {?} */\n        const elm = this.element;\n        this._styler.apply();\n        if (this._delay) {\n            this._styler.pause();\n        }\n    }\n    /**\n     * @return {?}\n     */\n    play() {\n        this.init();\n        if (!this.hasStarted()) {\n            this._flushStartFns();\n            this._state = 2 /* STARTED */;\n        }\n        this._styler.resume();\n    }\n    /**\n     * @return {?}\n     */\n    pause() {\n        this.init();\n        this._styler.pause();\n    }\n    /**\n     * @return {?}\n     */\n    restart() {\n        this.reset();\n        this.play();\n    }\n    /**\n     * @return {?}\n     */\n    reset() {\n        this._styler.destroy();\n        this._buildStyler();\n        this._styler.apply();\n    }\n    /**\n     * @return {?}\n     */\n    _buildStyler() {\n        this._styler = new ElementAnimationStyleHandler(this.element, this.animationName, this._duration, this._delay, this.easing, DEFAULT_FILL_MODE, () => this.finish());\n    }\n    /**\n     * \\@internal\n     * @param {?} phaseName\n     * @return {?}\n     */\n    triggerCallback(phaseName) {\n        /** @type {?} */\n        const methods = phaseName == 'start' ? this._onStartFns : this._onDoneFns;\n        methods.forEach(fn => fn());\n        methods.length = 0;\n    }\n    /**\n     * @return {?}\n     */\n    beforeDestroy() {\n        this.init();\n        /** @type {?} */\n        const styles = {};\n        if (this.hasStarted()) {\n            /** @type {?} */\n            const finished = this._state >= 3 /* FINISHED */;\n            Object.keys(this._finalStyles).forEach(prop => {\n                if (prop != 'offset') {\n                    styles[prop] = finished ? this._finalStyles[prop] : computeStyle(this.element, prop);\n                }\n            });\n        }\n        this.currentSnapshot = styles;\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass DirectStylePlayer extends NoopAnimationPlayer {\n    /**\n     * @param {?} element\n     * @param {?} styles\n     */\n    constructor(element, styles) {\n        super();\n        this.element = element;\n        this._startingStyles = {};\n        this.__initialized = false;\n        this._styles = hypenatePropsObject(styles);\n    }\n    /**\n     * @return {?}\n     */\n    init() {\n        if (this.__initialized || !this._startingStyles)\n            return;\n        this.__initialized = true;\n        Object.keys(this._styles).forEach(prop => {\n            /** @type {?} */ ((this._startingStyles))[prop] = this.element.style[prop];\n        });\n        super.init();\n    }\n    /**\n     * @return {?}\n     */\n    play() {\n        if (!this._startingStyles)\n            return;\n        this.init();\n        Object.keys(this._styles)\n            .forEach(prop => this.element.style.setProperty(prop, this._styles[prop]));\n        super.play();\n    }\n    /**\n     * @return {?}\n     */\n    destroy() {\n        if (!this._startingStyles)\n            return;\n        Object.keys(this._startingStyles).forEach(prop => {\n            /** @type {?} */\n            const value = /** @type {?} */ ((this._startingStyles))[prop];\n            if (value) {\n                this.element.style.setProperty(prop, value);\n            }\n            else {\n                this.element.style.removeProperty(prop);\n            }\n        });\n        this._startingStyles = null;\n        super.destroy();\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n/** @type {?} */\nconst KEYFRAMES_NAME_PREFIX = 'gen_css_kf_';\n/** @type {?} */\nconst TAB_SPACE = ' ';\nclass CssKeyframesDriver {\n    constructor() {\n        this._count = 0;\n        this._head = document.querySelector('head');\n        this._warningIssued = false;\n    }\n    /**\n     * @param {?} prop\n     * @return {?}\n     */\n    validateStyleProperty(prop) { return validateStyleProperty(prop); }\n    /**\n     * @param {?} element\n     * @param {?} selector\n     * @return {?}\n     */\n    matchesElement(element, selector) {\n        return matchesElement(element, selector);\n    }\n    /**\n     * @param {?} elm1\n     * @param {?} elm2\n     * @return {?}\n     */\n    containsElement(elm1, elm2) { return containsElement(elm1, elm2); }\n    /**\n     * @param {?} element\n     * @param {?} selector\n     * @param {?} multi\n     * @return {?}\n     */\n    query(element, selector, multi) {\n        return invokeQuery(element, selector, multi);\n    }\n    /**\n     * @param {?} element\n     * @param {?} prop\n     * @param {?=} defaultValue\n     * @return {?}\n     */\n    computeStyle(element, prop, defaultValue) {\n        return /** @type {?} */ ((/** @type {?} */ (window.getComputedStyle(element)))[prop]);\n    }\n    /**\n     * @param {?} element\n     * @param {?} name\n     * @param {?} keyframes\n     * @return {?}\n     */\n    buildKeyframeElement(element, name, keyframes) {\n        keyframes = keyframes.map(kf => hypenatePropsObject(kf));\n        /** @type {?} */\n        let keyframeStr = `@keyframes ${name} {\\n`;\n        /** @type {?} */\n        let tab = '';\n        keyframes.forEach(kf => {\n            tab = TAB_SPACE;\n            /** @type {?} */\n            const offset = parseFloat(kf[\"offset\"]);\n            keyframeStr += `${tab}${offset * 100}% {\\n`;\n            tab += TAB_SPACE;\n            Object.keys(kf).forEach(prop => {\n                /** @type {?} */\n                const value = kf[prop];\n                switch (prop) {\n                    case 'offset':\n                        return;\n                    case 'easing':\n                        if (value) {\n                            keyframeStr += `${tab}animation-timing-function: ${value};\\n`;\n                        }\n                        return;\n                    default:\n                        keyframeStr += `${tab}${prop}: ${value};\\n`;\n                        return;\n                }\n            });\n            keyframeStr += `${tab}}\\n`;\n        });\n        keyframeStr += `}\\n`;\n        /** @type {?} */\n        const kfElm = document.createElement('style');\n        kfElm.innerHTML = keyframeStr;\n        return kfElm;\n    }\n    /**\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} duration\n     * @param {?} delay\n     * @param {?} easing\n     * @param {?=} previousPlayers\n     * @param {?=} scrubberAccessRequested\n     * @return {?}\n     */\n    animate(element, keyframes, duration, delay, easing, previousPlayers = [], scrubberAccessRequested) {\n        if (scrubberAccessRequested) {\n            this._notifyFaultyScrubber();\n        }\n        /** @type {?} */\n        const previousCssKeyframePlayers = /** @type {?} */ (previousPlayers.filter(player => player instanceof CssKeyframesPlayer));\n        /** @type {?} */\n        const previousStyles = {};\n        if (allowPreviousPlayerStylesMerge(duration, delay)) {\n            previousCssKeyframePlayers.forEach(player => {\n                /** @type {?} */\n                let styles = player.currentSnapshot;\n                Object.keys(styles).forEach(prop => previousStyles[prop] = styles[prop]);\n            });\n        }\n        keyframes = balancePreviousStylesIntoKeyframes(element, keyframes, previousStyles);\n        /** @type {?} */\n        const finalStyles = flattenKeyframesIntoStyles(keyframes);\n        // if there is no animation then there is no point in applying\n        // styles and waiting for an event to get fired. This causes lag.\n        // It's better to just directly apply the styles to the element\n        // via the direct styling animation player.\n        if (duration == 0) {\n            return new DirectStylePlayer(element, finalStyles);\n        }\n        /** @type {?} */\n        const animationName = `${KEYFRAMES_NAME_PREFIX}${this._count++}`;\n        /** @type {?} */\n        const kfElm = this.buildKeyframeElement(element, animationName, keyframes); /** @type {?} */\n        ((document.querySelector('head'))).appendChild(kfElm);\n        /** @type {?} */\n        const player = new CssKeyframesPlayer(element, keyframes, animationName, duration, delay, easing, finalStyles);\n        player.onDestroy(() => removeElement(kfElm));\n        return player;\n    }\n    /**\n     * @return {?}\n     */\n    _notifyFaultyScrubber() {\n        if (!this._warningIssued) {\n            console.warn('@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\\n', '  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill.');\n            this._warningIssued = true;\n        }\n    }\n}\n/**\n * @param {?} keyframes\n * @return {?}\n */\nfunction flattenKeyframesIntoStyles(keyframes) {\n    /** @type {?} */\n    let flatKeyframes = {};\n    if (keyframes) {\n        /** @type {?} */\n        const kfs = Array.isArray(keyframes) ? keyframes : [keyframes];\n        kfs.forEach(kf => {\n            Object.keys(kf).forEach(prop => {\n                if (prop == 'offset' || prop == 'easing')\n                    return;\n                flatKeyframes[prop] = kf[prop];\n            });\n        });\n    }\n    return flatKeyframes;\n}\n/**\n * @param {?} node\n * @return {?}\n */\nfunction removeElement(node) {\n    node.parentNode.removeChild(node);\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass WebAnimationsPlayer {\n    /**\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} options\n     */\n    constructor(element, keyframes, options) {\n        this.element = element;\n        this.keyframes = keyframes;\n        this.options = options;\n        this._onDoneFns = [];\n        this._onStartFns = [];\n        this._onDestroyFns = [];\n        this._initialized = false;\n        this._finished = false;\n        this._started = false;\n        this._destroyed = false;\n        this.time = 0;\n        this.parentPlayer = null;\n        this.currentSnapshot = {};\n        this._duration = /** @type {?} */ (options['duration']);\n        this._delay = /** @type {?} */ (options['delay']) || 0;\n        this.time = this._duration + this._delay;\n    }\n    /**\n     * @return {?}\n     */\n    _onFinish() {\n        if (!this._finished) {\n            this._finished = true;\n            this._onDoneFns.forEach(fn => fn());\n            this._onDoneFns = [];\n        }\n    }\n    /**\n     * @return {?}\n     */\n    init() {\n        this._buildPlayer();\n        this._preparePlayerBeforeStart();\n    }\n    /**\n     * @return {?}\n     */\n    _buildPlayer() {\n        if (this._initialized)\n            return;\n        this._initialized = true;\n        /** @type {?} */\n        const keyframes = this.keyframes;\n        (/** @type {?} */ (this)).domPlayer =\n            this._triggerWebAnimation(this.element, keyframes, this.options);\n        this._finalKeyframe = keyframes.length ? keyframes[keyframes.length - 1] : {};\n        this.domPlayer.addEventListener('finish', () => this._onFinish());\n    }\n    /**\n     * @return {?}\n     */\n    _preparePlayerBeforeStart() {\n        // this is required so that the player doesn't start to animate right away\n        if (this._delay) {\n            this._resetDomPlayerState();\n        }\n        else {\n            this.domPlayer.pause();\n        }\n    }\n    /**\n     * \\@internal\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} options\n     * @return {?}\n     */\n    _triggerWebAnimation(element, keyframes, options) {\n        // jscompiler doesn't seem to know animate is a native property because it's not fully\n        // supported yet across common browsers (we polyfill it for Edge/Safari) [CL #143630929]\n        return /** @type {?} */ (element['animate'](keyframes, options));\n    }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onStart(fn) { this._onStartFns.push(fn); }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onDone(fn) { this._onDoneFns.push(fn); }\n    /**\n     * @param {?} fn\n     * @return {?}\n     */\n    onDestroy(fn) { this._onDestroyFns.push(fn); }\n    /**\n     * @return {?}\n     */\n    play() {\n        this._buildPlayer();\n        if (!this.hasStarted()) {\n            this._onStartFns.forEach(fn => fn());\n            this._onStartFns = [];\n            this._started = true;\n        }\n        this.domPlayer.play();\n    }\n    /**\n     * @return {?}\n     */\n    pause() {\n        this.init();\n        this.domPlayer.pause();\n    }\n    /**\n     * @return {?}\n     */\n    finish() {\n        this.init();\n        this._onFinish();\n        this.domPlayer.finish();\n    }\n    /**\n     * @return {?}\n     */\n    reset() {\n        this._resetDomPlayerState();\n        this._destroyed = false;\n        this._finished = false;\n        this._started = false;\n    }\n    /**\n     * @return {?}\n     */\n    _resetDomPlayerState() {\n        if (this.domPlayer) {\n            this.domPlayer.cancel();\n        }\n    }\n    /**\n     * @return {?}\n     */\n    restart() {\n        this.reset();\n        this.play();\n    }\n    /**\n     * @return {?}\n     */\n    hasStarted() { return this._started; }\n    /**\n     * @return {?}\n     */\n    destroy() {\n        if (!this._destroyed) {\n            this._destroyed = true;\n            this._resetDomPlayerState();\n            this._onFinish();\n            this._onDestroyFns.forEach(fn => fn());\n            this._onDestroyFns = [];\n        }\n    }\n    /**\n     * @param {?} p\n     * @return {?}\n     */\n    setPosition(p) { this.domPlayer.currentTime = p * this.time; }\n    /**\n     * @return {?}\n     */\n    getPosition() { return this.domPlayer.currentTime / this.time; }\n    /**\n     * @return {?}\n     */\n    get totalTime() { return this._delay + this._duration; }\n    /**\n     * @return {?}\n     */\n    beforeDestroy() {\n        /** @type {?} */\n        const styles = {};\n        if (this.hasStarted()) {\n            Object.keys(this._finalKeyframe).forEach(prop => {\n                if (prop != 'offset') {\n                    styles[prop] =\n                        this._finished ? this._finalKeyframe[prop] : computeStyle(this.element, prop);\n                }\n            });\n        }\n        this.currentSnapshot = styles;\n    }\n    /**\n     * \\@internal\n     * @param {?} phaseName\n     * @return {?}\n     */\n    triggerCallback(phaseName) {\n        /** @type {?} */\n        const methods = phaseName == 'start' ? this._onStartFns : this._onDoneFns;\n        methods.forEach(fn => fn());\n        methods.length = 0;\n    }\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\nclass WebAnimationsDriver {\n    constructor() {\n        this._isNativeImpl = /\\{\\s*\\[native\\s+code\\]\\s*\\}/.test(getElementAnimateFn().toString());\n        this._cssKeyframesDriver = new CssKeyframesDriver();\n    }\n    /**\n     * @param {?} prop\n     * @return {?}\n     */\n    validateStyleProperty(prop) { return validateStyleProperty(prop); }\n    /**\n     * @param {?} element\n     * @param {?} selector\n     * @return {?}\n     */\n    matchesElement(element, selector) {\n        return matchesElement(element, selector);\n    }\n    /**\n     * @param {?} elm1\n     * @param {?} elm2\n     * @return {?}\n     */\n    containsElement(elm1, elm2) { return containsElement(elm1, elm2); }\n    /**\n     * @param {?} element\n     * @param {?} selector\n     * @param {?} multi\n     * @return {?}\n     */\n    query(element, selector, multi) {\n        return invokeQuery(element, selector, multi);\n    }\n    /**\n     * @param {?} element\n     * @param {?} prop\n     * @param {?=} defaultValue\n     * @return {?}\n     */\n    computeStyle(element, prop, defaultValue) {\n        return /** @type {?} */ ((/** @type {?} */ (window.getComputedStyle(element)))[prop]);\n    }\n    /**\n     * @param {?} supported\n     * @return {?}\n     */\n    overrideWebAnimationsSupport(supported) { this._isNativeImpl = supported; }\n    /**\n     * @param {?} element\n     * @param {?} keyframes\n     * @param {?} duration\n     * @param {?} delay\n     * @param {?} easing\n     * @param {?=} previousPlayers\n     * @param {?=} scrubberAccessRequested\n     * @return {?}\n     */\n    animate(element, keyframes, duration, delay, easing, previousPlayers = [], scrubberAccessRequested) {\n        /** @type {?} */\n        const useKeyframes = !scrubberAccessRequested && !this._isNativeImpl;\n        if (useKeyframes) {\n            return this._cssKeyframesDriver.animate(element, keyframes, duration, delay, easing, previousPlayers);\n        }\n        /** @type {?} */\n        const fill = delay == 0 ? 'both' : 'forwards';\n        /** @type {?} */\n        const playerOptions = { duration, delay, fill };\n        // we check for this to avoid having a null|undefined value be present\n        // for the easing (which results in an error for certain browsers #9752)\n        if (easing) {\n            playerOptions['easing'] = easing;\n        }\n        /** @type {?} */\n        const previousStyles = {};\n        /** @type {?} */\n        const previousWebAnimationPlayers = /** @type {?} */ (previousPlayers.filter(player => player instanceof WebAnimationsPlayer));\n        if (allowPreviousPlayerStylesMerge(duration, delay)) {\n            previousWebAnimationPlayers.forEach(player => {\n                /** @type {?} */\n                let styles = player.currentSnapshot;\n                Object.keys(styles).forEach(prop => previousStyles[prop] = styles[prop]);\n            });\n        }\n        keyframes = keyframes.map(styles => copyStyles(styles, false));\n        keyframes = balancePreviousStylesIntoKeyframes(element, keyframes, previousStyles);\n        return new WebAnimationsPlayer(element, keyframes, playerOptions);\n    }\n}\n/**\n * @return {?}\n */\nfunction supportsWebAnimations() {\n    return typeof getElementAnimateFn() === 'function';\n}\n/**\n * @return {?}\n */\nfunction getElementAnimateFn() {\n    return (isBrowser() && (/** @type {?} */ (Element)).prototype['animate']) || {};\n}\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n\n/**\n * @fileoverview added by tsickle\n * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { AnimationDriver, Animation as ɵAnimation, AnimationStyleNormalizer as ɵAnimationStyleNormalizer, NoopAnimationStyleNormalizer as ɵNoopAnimationStyleNormalizer, WebAnimationsStyleNormalizer as ɵWebAnimationsStyleNormalizer, AnimationDriver as ɵAnimationDriver, NoopAnimationDriver as ɵNoopAnimationDriver, AnimationEngine as ɵAnimationEngine, CssKeyframesDriver as ɵCssKeyframesDriver, CssKeyframesPlayer as ɵCssKeyframesPlayer, containsElement as ɵcontainsElement, invokeQuery as ɵinvokeQuery, matchesElement as ɵmatchesElement, validateStyleProperty as ɵvalidateStyleProperty, WebAnimationsDriver as ɵWebAnimationsDriver, supportsWebAnimations as ɵsupportsWebAnimations, WebAnimationsPlayer as ɵWebAnimationsPlayer, allowPreviousPlayerStylesMerge as ɵallowPreviousPlayerStylesMerge };\n//# sourceMappingURL=browser.js.map\n"]}