{"version":3,"sources":["_collection-weak.js"],"names":["redefineAll","require","getWeak","anObject","isObject","anInstance","forOf","createArrayMethod","$has","validate","arrayFind","arrayFindIndex","id","uncaughtFrozenStore","that","_l","UncaughtFrozenStore","a","findUncaughtFrozen","store","key","it","prototype","get","entry","has","set","value","push","index","splice","module","exports","getConstructor","wrapper","NAME","IS_MAP","ADDER","C","iterable","_t","_i","undefined","data","def","ufstore"],"mappings":"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","file":"_collection-weak.js","sourcesContent":["'use strict';\nvar redefineAll = require('./_redefine-all');\nvar getWeak = require('./_meta').getWeak;\nvar anObject = require('./_an-object');\nvar isObject = require('./_is-object');\nvar anInstance = require('./_an-instance');\nvar forOf = require('./_for-of');\nvar createArrayMethod = require('./_array-methods');\nvar $has = require('./_has');\nvar validate = require('./_validate-collection');\nvar arrayFind = createArrayMethod(5);\nvar arrayFindIndex = createArrayMethod(6);\nvar id = 0;\n\n// fallback for uncaught frozen keys\nvar uncaughtFrozenStore = function (that) {\n  return that._l || (that._l = new UncaughtFrozenStore());\n};\nvar UncaughtFrozenStore = function () {\n  this.a = [];\n};\nvar findUncaughtFrozen = function (store, key) {\n  return arrayFind(store.a, function (it) {\n    return it[0] === key;\n  });\n};\nUncaughtFrozenStore.prototype = {\n  get: function (key) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) return entry[1];\n  },\n  has: function (key) {\n    return !!findUncaughtFrozen(this, key);\n  },\n  set: function (key, value) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) entry[1] = value;\n    else this.a.push([key, value]);\n  },\n  'delete': function (key) {\n    var index = arrayFindIndex(this.a, function (it) {\n      return it[0] === key;\n    });\n    if (~index) this.a.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {\n    var C = wrapper(function (that, iterable) {\n      anInstance(that, C, NAME, '_i');\n      that._t = NAME;      // collection type\n      that._i = id++;      // collection id\n      that._l = undefined; // leak store for uncaught frozen objects\n      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function (key) {\n        if (!isObject(key)) return false;\n        var data = getWeak(key);\n        if (data === true) return uncaughtFrozenStore(validate(this, NAME))['delete'](key);\n        return data && $has(data, this._i) && delete data[this._i];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key) {\n        if (!isObject(key)) return false;\n        var data = getWeak(key);\n        if (data === true) return uncaughtFrozenStore(validate(this, NAME)).has(key);\n        return data && $has(data, this._i);\n      }\n    });\n    return C;\n  },\n  def: function (that, key, value) {\n    var data = getWeak(anObject(key), true);\n    if (data === true) uncaughtFrozenStore(that).set(key, value);\n    else data[that._i] = value;\n    return that;\n  },\n  ufstore: uncaughtFrozenStore\n};\n"]}