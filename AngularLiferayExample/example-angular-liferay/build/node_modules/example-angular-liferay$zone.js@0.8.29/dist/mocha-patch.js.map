{"version":3,"sources":["mocha-patch.js"],"names":["global","factory","exports","module","define","amd","context","Mocha","Error","Zone","ProxyZoneSpec","SyncTestZoneSpec","rootZone","current","syncZone","fork","testZone","suiteZone","mochaOriginal","after","afterEach","before","beforeEach","describe","it","modifyArguments","args","syncTest","asyncTest","_loop_1","i","arg","length","toString","wrapDescribeInZone","fn","run","arguments","wrapTestInZone","done","wrapSuiteInZone","suite","apply","xdescribe","skip","only","specify","test","xit","xspecify","suiteTeardown","teardown","suiteSetup","setup","originalRunTest","originalRun","Runner","prototype","runTest","_this","scheduleMicroTask","call","on","e","err","proxyZoneSpec","get","message","getAndClearPendingTasksInfo","window","self"],"mappings":"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","file":"mocha-patch.js","sourcesContent":["/**\n* @license\n* Copyright Google Inc. All Rights Reserved.\n*\n* Use of this source code is governed by an MIT-style license that can be\n* found in the LICENSE file at https://angular.io/license\n*/\n(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(factory());\n}(this, (function () { 'use strict';\n\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n(function (context) {\n    var Mocha = context.Mocha;\n    if (typeof Mocha === 'undefined') {\n        throw new Error('Missing Mocha.js');\n    }\n    if (typeof Zone === 'undefined') {\n        throw new Error('Missing Zone.js');\n    }\n    var ProxyZoneSpec = Zone['ProxyZoneSpec'];\n    var SyncTestZoneSpec = Zone['SyncTestZoneSpec'];\n    if (!ProxyZoneSpec) {\n        throw new Error('Missing ProxyZoneSpec');\n    }\n    if (Mocha['__zone_patch__']) {\n        throw new Error('\"Mocha\" has already been patched with \"Zone\".');\n    }\n    Mocha['__zone_patch__'] = true;\n    var rootZone = Zone.current;\n    var syncZone = rootZone.fork(new SyncTestZoneSpec('Mocha.describe'));\n    var testZone = null;\n    var suiteZone = rootZone.fork(new ProxyZoneSpec());\n    var mochaOriginal = {\n        after: Mocha.after,\n        afterEach: Mocha.afterEach,\n        before: Mocha.before,\n        beforeEach: Mocha.beforeEach,\n        describe: Mocha.describe,\n        it: Mocha.it\n    };\n    function modifyArguments(args, syncTest, asyncTest) {\n        var _loop_1 = function (i) {\n            var arg = args[i];\n            if (typeof arg === 'function') {\n                // The `done` callback is only passed through if the function expects at\n                // least one argument.\n                // Note we have to make a function with correct number of arguments,\n                // otherwise mocha will\n                // think that all functions are sync or async.\n                args[i] = (arg.length === 0) ? syncTest(arg) : asyncTest(arg);\n                // Mocha uses toString to view the test body in the result list, make sure we return the\n                // correct function body\n                args[i].toString = function () {\n                    return arg.toString();\n                };\n            }\n        };\n        for (var i = 0; i < args.length; i++) {\n            _loop_1(i);\n        }\n        return args;\n    }\n    function wrapDescribeInZone(args) {\n        var syncTest = function (fn) {\n            return function () {\n                return syncZone.run(fn, this, arguments);\n            };\n        };\n        return modifyArguments(args, syncTest);\n    }\n    function wrapTestInZone(args) {\n        var asyncTest = function (fn) {\n            return function (done) {\n                return testZone.run(fn, this, [done]);\n            };\n        };\n        var syncTest = function (fn) {\n            return function () {\n                return testZone.run(fn, this);\n            };\n        };\n        return modifyArguments(args, syncTest, asyncTest);\n    }\n    function wrapSuiteInZone(args) {\n        var asyncTest = function (fn) {\n            return function (done) {\n                return suiteZone.run(fn, this, [done]);\n            };\n        };\n        var syncTest = function (fn) {\n            return function () {\n                return suiteZone.run(fn, this);\n            };\n        };\n        return modifyArguments(args, syncTest, asyncTest);\n    }\n    context.describe = context.suite = Mocha.describe = function () {\n        return mochaOriginal.describe.apply(this, wrapDescribeInZone(arguments));\n    };\n    context.xdescribe = context.suite.skip = Mocha.describe.skip = function () {\n        return mochaOriginal.describe.skip.apply(this, wrapDescribeInZone(arguments));\n    };\n    context.describe.only = context.suite.only = Mocha.describe.only = function () {\n        return mochaOriginal.describe.only.apply(this, wrapDescribeInZone(arguments));\n    };\n    context.it = context.specify = context.test = Mocha.it = function () {\n        return mochaOriginal.it.apply(this, wrapTestInZone(arguments));\n    };\n    context.xit = context.xspecify = Mocha.it.skip = function () {\n        return mochaOriginal.it.skip.apply(this, wrapTestInZone(arguments));\n    };\n    context.it.only = context.test.only = Mocha.it.only = function () {\n        return mochaOriginal.it.only.apply(this, wrapTestInZone(arguments));\n    };\n    context.after = context.suiteTeardown = Mocha.after = function () {\n        return mochaOriginal.after.apply(this, wrapSuiteInZone(arguments));\n    };\n    context.afterEach = context.teardown = Mocha.afterEach = function () {\n        return mochaOriginal.afterEach.apply(this, wrapTestInZone(arguments));\n    };\n    context.before = context.suiteSetup = Mocha.before = function () {\n        return mochaOriginal.before.apply(this, wrapSuiteInZone(arguments));\n    };\n    context.beforeEach = context.setup = Mocha.beforeEach = function () {\n        return mochaOriginal.beforeEach.apply(this, wrapTestInZone(arguments));\n    };\n    (function (originalRunTest, originalRun) {\n        Mocha.Runner.prototype.runTest = function (fn) {\n            var _this = this;\n            Zone.current.scheduleMicroTask('mocha.forceTask', function () {\n                originalRunTest.call(_this, fn);\n            });\n        };\n        Mocha.Runner.prototype.run = function (fn) {\n            this.on('test', function (e) {\n                testZone = rootZone.fork(new ProxyZoneSpec());\n            });\n            this.on('fail', function (test, err) {\n                var proxyZoneSpec = testZone && testZone.get('ProxyZoneSpec');\n                if (proxyZoneSpec && err) {\n                    err.message += proxyZoneSpec.getAndClearPendingTasksInfo();\n                }\n            });\n            return originalRun.call(this, fn);\n        };\n    })(Mocha.Runner.prototype.runTest, Mocha.Runner.prototype.run);\n})(typeof window !== 'undefined' && window || typeof self !== 'undefined' && self || global);\n\n})));\n"]}